function init_three_triangulator(){"use strict";Autodesk.Viewing.Private.Triangulator||(Autodesk.Viewing.Private.Triangulator=function(){function a(a,b,c){return c+":"+(a<b?a+":"+b:b+":"+a)}function b(b,c,d,e,f,g,h){this.pt1=b,this.pt2=c,this.p1=-1,this.p2=-1,this.eid1=a(d,e,h),this.eid2=a(f,g,h)}function c(){this.bbox=new THREE.Box2,this.left=null,this.right=null,this.node_edges=[]}function d(a,b,c){this.pts=a,this.edges=b,this.bbox=c,this.pipResult=!1}function e(a,b){this.edges=a,this.bbox=b,this.pts=[],this.idmap={},this.xymap={},this.contours=[],this.scale=1e6/this.bbox.size().length()}function f(a){this.indices=[],this.cset=a;var b=this.pts=a.pts;this.intervalTree=new d(a.pts,a.edges,a.bbox),this.intervalTree.build();for(var c=0;c<b.length;c++)b[c].id=c;var e=new lmv_poly2tri.SweepContext([]);if(e.points_=b.slice(),a.contours)for(var f=this.cset.contours,g=0;g<f.length;g++){for(var h=f[g],i=h[0]!==h[h.length-1],j=[],k=0;k<h.length-1;k++)j.push(b[h[k]]);e.initEdges(j,i)}else for(var l=this.cset.edges,c=0;c<l.length;c++){var m=l[c];if(m.p1!=m.p2){var n=[b[m.p1],b[m.p2]];e.initEdges(n,!0)}}this.triangulate(e),this.processResult(e)}var g=Autodesk.Viewing.Private;return d.prototype.splitNode=function(a){if(!(a.bbox.min.y>=a.bbox.max.y||a.node_edges.length<3)){var b=.5*(a.bbox.min.y+a.bbox.max.y);a.left=new c,a.right=new c;for(var d=this.pts,e=a.node_edges,f=[],g=new THREE.Vector2,h=0;h<e.length;h++){var i=this.edges[e[h]],j=d[i.p1].y,k=d[i.p2].y;if(j>k){var l=j;j=k,k=l}var m=null;k<b?(a.left.node_edges.push(e[h]),m=a.left.bbox):j>b?(a.right.node_edges.push(e[h]),m=a.right.bbox):f.push(e[h]),m&&(g.set(d[i.p1].x,d[i.p1].y),m.expandByPoint(g),g.set(d[i.p2].x,d[i.p2].y),m.expandByPoint(g))}a.node_edges=f,a.left.node_edges.length&&this.splitNode(a.left),a.right.node_edges.length&&this.splitNode(a.right)}},d.prototype.build=function(){this.root=new c;for(var a=this.root.node_edges,b=0;b<this.edges.length;b++)a.push(b);this.root.bbox.copy(this.bbox),this.splitNode(this.root)},d.prototype.pointInPolygonRec=function(a,b,c){if(a.bbox.min.y<=c&&a.bbox.max.y>=c)for(var d=this.pts,e=a.node_edges,f=0,g=e.length;f<g;f++){var h=this.edges[e[f]],i=d[h.p1],j=i.x,k=i.y,l=k>=c,m=d[h.p2],n=m.x,o=m.y,p=o>=c;l!=p&&(o-c)*(j-n)>=(n-b)*(k-o)==p&&(this.pipResult=!this.pipResult)}var q=a.left;q&&q.bbox.min.y<=c&&q.bbox.max.y>=c&&this.pointInPolygonRec(q,b,c);var r=a.right;r&&r.bbox.min.y<=c&&r.bbox.max.y>=c&&this.pointInPolygonRec(r,b,c)},d.prototype.pointInPolygon=function(a,b){return this.pipResult=!1,this.pointInPolygonRec(this.root,a,b),this.pipResult},e.prototype.getPointIndex=function(a,b,c){var d=this.idmap[c];if(void 0!==d)return d;var e,f=0|a*this.scale,g=0|b*this.scale,h=this.xymap[f];return void 0===h?(this.xymap[f]=h={},e=void 0):e=h[g],void 0===e&&(h[g]=e=this.pts.length,this.idmap[c]=e,this.pts.push({x:a,y:b})),e},e.prototype.snapEdges=function(){for(var a=0;a<this.edges.length;a++){var b=this.edges[a];b.p1=this.getPointIndex(b.pt1.x,b.pt1.y,b.eid1),b.p2=this.getPointIndex(b.pt2.x,b.pt2.y,b.eid2)}},e.prototype.sanitizeEdges=function(){for(var a={},b=[],c=0,d=this.edges.length;c<d;c++){var e=this.edges[c];if(e.p1!==e.p2){var f=Math.min(e.p1,e.p2)+":"+Math.max(e.p1,e.p2);!0!==a[f]&&(a[f]=!0,b.push(e))}}this.edges=b},e.prototype.stitchContours=function(){for(var a={},b=0;b<this.edges.length;b++){var c=this.edges[b];c.p1!==c.p2&&(void 0!==a[c.p1]?a[c.p1].push(c.p2):a[c.p1]=[c.p2],void 0!==a[c.p2]?a[c.p2].push(c.p1):a[c.p2]=[c.p1])}var d=[];for(var e in a)if(2!==a[e].length){g.logger.warn("Incomplete edge table");break}for(;;){var f=void 0;for(var e in a)if(a[e].length>1){f=e;break}if(!f)for(var e in a)if(a[e].length>0){f=e;break}if(!f)break;var h=-1,i=parseInt(f),j=a[f];for(d.push(i);j&&j.length;){var k=j.shift();if(k===h&&(k=j.shift()),void 0===k){delete a[i];break}d.push(k),0==j.length?delete a[i]:j[0]===h&&delete a[i],h=i,i=k,j=a[k]}d.length&&(this.contours.push(d),d=[])}for(var l=[],b=0;b<this.contours.length;b++){var m=this.contours[b];m[0]!==m[m.length-1]&&l.push(m)}if(l.length)for(var n=!0;n;){n=!1;for(var o={},p=this.contours,b=0;b<p.length;b++){var m=p[b],q=m[0],r=m[m.length-1];q!==r&&(o[q]?o[q].push(-b-1):o[q]=[-b-1],o[r]?o[r].push(b):o[r]=[b])}for(var e in o){var s=o[e];if(2==s.length){var t=void 0;if(s[0]<0&&s[1]<0){var u=-s[0]-1,v=-s[1]-1;p[v].shift(),Array.prototype.push.apply(p[u].reverse(),p[v]),t=v}if(s[0]<0&&s[1]>0){var u=-s[0]-1,v=s[1];p[v].pop(),Array.prototype.push.apply(p[v],p[u]),t=u}if(s[0]>0&&s[1]<0){var u=s[0],v=-s[1]-1;p[u].pop(),Array.prototype.push.apply(p[u],p[v]),t=v}if(s[0]>0&&s[1]>0){var u=s[0],v=s[1];p[u].pop(),Array.prototype.push.apply(p[u],p[v].reverse()),t=v}void 0!==t&&(p.splice(t,1),n=!0);break}}}},f.prototype.triangulate=function(a){try{a.triangulate()}catch(a){}},f.prototype.processResult=function(a){for(var b=0;b<a.map_.length;b++){var c=a.map_[b],d=c.points_[0],e=c.points_[1],f=c.points_[2];void 0!==d.id&&void 0!==e.id&&void 0!==f.id&&this.filterFace(d.id,e.id,f.id)}},f.prototype.pointInEdgeList=function(a,b){for(var c,d,e,f,g,h,i=this.cset.pts,j=this.cset.edges,k=!1,l=0,m=j.length;l<m;++l){var n=j[l];e=i[n.p1].x,f=i[n.p1].y,c=f>=b,g=i[n.p2].x,h=i[n.p2].y,d=h>=b,c!=d&&(h-b)*(e-g)>=(g-a)*(f-h)==d&&(k=!k)}return k},f.prototype.pointInContour=function(a,b,c){var d,e,f,g,h,i,j=!1,k=this.cset.pts;f=k[c[c.length-1]].x,g=k[c[c.length-1]].y,d=g>=b;for(var l=0,m=c.length;l<m;++l)h=k[c[l]].x,i=k[c[l]].y,e=i>=b,d!=e&&(i-b)*(f-h)>=(h-a)*(g-i)==e&&(j=!j),d=e,f=h,g=i;return j},f.prototype.pointInPolygon=function(a,b){for(var c=!1,d=0;d<this.cset.contours.length;d++)this.pointInContour(a,b,this.cset.contours[d])&&(c=!c);return c},f.prototype.filterFace=function(a,b,c){var d=this.pts[a],e=this.pts[b],f=this.pts[c],g=(d.x+e.x+f.x)/3,h=(d.y+e.y+f.y)/3;if(this.intervalTree.pointInPolygon(g,h)){var i=e.x-d.x,j=e.y-d.y,k=f.x-d.x;i*(f.y-d.y)-k*j>0?this.indices.push(a,b,c):this.indices.push(a,c,b)}},{TriangulatedSurface:f,ContourSet:e,Edge:b}}())}function init_three_intersector(){"use strict";Autodesk.Viewing.Private.Intersector||(Autodesk.Viewing.Private.Intersector=function(){function a(a){return Math.abs(a)<j}function b(b,c,d,e,f){var g=l.subVectors(d,c),h=b.normal.dot(g);if(a(h))return e.copy(c),f.copy(d),2;h=1/h;var i=-(c.dot(b.normal)*h+b.constant*h);if(i<-j||i>1+j)return 0;var k=g.multiplyScalar(i).add(c);return e.copy(k),1}function c(a,c,d,e,f,g,h,l,o){var p=a.distanceToPoint(c),q=a.distanceToPoint(d),r=a.distanceToPoint(e);if(p<-j&&q<-j&&r<-j)return null;if(p>j&&q>j&&r>j)return null;var s=Math.sign(p),t=Math.sign(q),u=Math.sign(r);if(0===s&&0===t&&0===u)return null;var v,w,x,y,z,A;if(s!==t){var B=b(a,c,d,m,n);if(2==B)return void l.push(new k(c.clone(),d.clone(),f,f,g,g,o));1==B?(x=f,y=g,v=m.clone()):i.logger.warn("Unexpected zero intersections where at least one was expected")}if(t!==u){var B=b(a,d,e,m,n);if(2==B)return void l.push(new k(d.clone(),e.clone(),g,g,h,h,o));1==B?v?m.distanceTo(v)>j&&(z=g,A=h,w=m.clone()):(x=g,y=h,v=m.clone()):i.logger.warn("Unexpected zero intersections where at least one was expected")}if(u!==s){var B=b(a,e,c,m,n);if(2==B)return void l.push(new k(e.clone(),c.clone(),h,h,f,f,o));1==B?v?m.distanceTo(v)>j&&(z=h,A=f,w=m.clone()):i.logger.warn("Unexpected single intersection point"):i.logger.warn("Unexpected zero intersections where at least one was expected")}v&&w?l.push(new k(v,w,x,y,z,A,o)):i.logger.warn("Unexpected one intersection where two were expected")}function d(a,b){o.set(b.min.x,b.min.y,b.min.z);var c=a.distanceToPoint(o),d=Math.sign(c);o.set(b.min.x,b.min.y,b.max.z);var e=a.distanceToPoint(o);return Math.sign(e)!==d||(o.set(b.min.x,b.max.y,b.min.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.min.x,b.max.y,b.max.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.min.y,b.min.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.min.y,b.max.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.max.y,b.min.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.max.y,b.max.z),e=a.distanceToPoint(o),Math.sign(e)!==d))))))}function e(a,b,d){var e=b.geometry,f=d.length,g=b.matrixWorld;p.getInverse(g),q.copy(a).applyMatrix4(p),i.VertexEnumerator.enumMeshTriangles(e,function(a,e,f,g,h,i){c(q,a,e,f,g,h,i,d,b.fragId)});for(var h=f;h<d.length;h++)d[h].pt1.applyMatrix4(g),d[h].pt2.applyMatrix4(g)}function f(a,b,c){var d=b,e=Math.sqrt(1-d*d),f=1-d,g=a.x,h=a.y,i=a.z,j=f*g,k=f*h;c.set(j*g+d,j*h-e*i,j*i+e*h,0,j*h+e*i,k*h+d,k*i-e*g,0,j*i-e*h,k*i+e*g,f*i*i+d,0,0,0,0,1)}function g(b){var c=new THREE.Vector3(0,0,1),d=b.normal.clone().cross(c);d=d.normalize();var e=c.dot(b.normal),g=new THREE.Matrix4;return a(d.x)&&a(d.y)&&a(d.z)?g.elements[14]=e*b.constant:(f(d,e,g),g.elements[14]=b.constant),g}function h(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];e.pt1.applyMatrix4(a),e.pt2.applyMatrix4(a),c.expandByPoint(e.pt1),c.expandByPoint(e.pt2)}}var i=Autodesk.Viewing.Private,j=1e-10,k=Autodesk.Viewing.Private.Triangulator.Edge,l=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,p=new THREE.Matrix4,q=new THREE.Plane;return{makePlaneBasis:g,convertToPlaneCoords:h,intersectTrianglePlane:c,intersectMeshPlane:e,intersectBoxPlane:d}}())}function init_SectionMesh(){Autodesk.Viewing.Extensions.Section.SectionMesh||(Autodesk.Viewing.Extensions.Section.SectionMesh=function(a,b,c){THREE.Mesh.call(this,a,b,!1),this.plane=c,this.planeVec=new THREE.Vector4(c.normal.x,c.normal.y,c.normal.z,c.constant),this.connectivity=[],this.outlines=[]},Autodesk.Viewing.Extensions.Section.SectionMesh.prototype=Object.create(THREE.Mesh.prototype),Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionMesh,Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var a=this.plane.normal,b=-1*this.getWorldPosition().dot(a);this.planeVec.set(a.x,a.y,a.z,b),this.plane.constant=b})}!function(a){var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.lmv_poly2tri=function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c||a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports={version:"1.3.5"}},{}],2:[function(a,b,c){"use strict";var d=function(a,b){this.point=a,this.triangle=b||null,this.next=null,this.prev=null,this.value=a.x},e=function(a,b){this.head_=a,this.tail_=b,this.search_node_=a};e.prototype.head=function(){return this.head_},e.prototype.setHead=function(a){this.head_=a},e.prototype.tail=function(){return this.tail_},e.prototype.setTail=function(a){this.tail_=a},e.prototype.search=function(){return this.search_node_},e.prototype.setSearch=function(a){this.search_node_=a},e.prototype.findSearchNode=function(){return this.search_node_},e.prototype.locateNode=function(a){var b=this.search_node_;if(a<b.value){for(;b=b.prev;)if(a>=b.value)return this.search_node_=b,b}else for(;b=b.next;)if(a<b.value)return this.search_node_=b.prev,b.prev;return null},e.prototype.locatePoint=function(a){var b=a.x,c=this.findSearchNode(b),d=c.point.x;if(b===d){if(a!==c.point)if(a===c.prev.point)c=c.prev;else{if(a!==c.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");c=c.next}}else if(b<d)for(;(c=c.prev)&&a!==c.point;);else for(;(c=c.next)&&a!==c.point;);return c&&(this.search_node_=c),c},b.exports=e,b.exports.Node=d},{}],3:[function(a,b,c){"use strict";function d(a,b){if(!a)throw new Error(b||"Assert Failed")}b.exports=d},{}],4:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b){this.x=+a||0,this.y=+b||0,this._p2t_edge_list=null};e.prototype.toString=function(){return d.toStringBase(this)},e.prototype.toJSON=function(){return{x:this.x,y:this.y}},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.set_zero=function(){return this.x=0,this.y=0,this},e.prototype.set=function(a,b){return this.x=+a||0,this.y=+b||0,this},e.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},e.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},e.prototype.mul=function(a){return this.x*=a,this.y*=a,this},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.normalize=function(){var a=this.length();return this.x/=a,this.y/=a,a},e.prototype.equals=function(a){return this.x===a.x&&this.y===a.y},e.negate=function(a){return new e(-a.x,-a.y)},e.add=function(a,b){return new e(a.x+b.x,a.y+b.y)},e.sub=function(a,b){return new e(a.x-b.x,a.y-b.y)},e.mul=function(a,b){return new e(a*b.x,a*b.y)},e.cross=function(a,b){return"number"==typeof a?"number"==typeof b?a*b:new e(-a*b.y,a*b.x):"number"==typeof b?new e(b*a.y,-b*a.x):a.x*b.y-a.y*b.x},e.toString=d.toString,e.compare=d.compare,e.cmp=d.compare,e.equals=d.equals,e.dot=function(a,b){return a.x*b.x+a.y*b.y},b.exports=e},{"./xy":11}],5:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b){this.name="PointError",this.points=b=b||[],this.message=a||"Invalid Points!";for(var c=0;c<b.length;c++)this.message+=" "+d.toString(b[c])};e.prototype=new Error,e.prototype.constructor=e,b.exports=e},{"./xy":11}],6:[function(a,b,c){(function(b){"use strict";var d=b.poly2tri;c.noConflict=function(){return b.poly2tri=d,c},c.VERSION=a("../dist/version.json").version,c.PointError=a("./pointerror"),c.Point=a("./point"),c.Triangle=a("./triangle"),c.SweepContext=a("./sweepcontext");var e=a("./sweep");c.triangulate=e.triangulate,c.sweep={Triangulate:e.triangulate}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(a,b,c){"use strict";function d(a){a.initTriangulation(),a.createAdvancingFront(),e(a),f(a)}function e(a){var b,c=a.pointCount();for(b=1;b<c;++b)for(var d=a.getPoint(b),e=g(a,d),f=d._p2t_edge_list,i=0;f&&i<f.length;++i)h(a,f[i],e)}function f(a){for(var b=a.front().head().next.triangle,c=a.front().head().next.point;!b.getConstrainedEdgeCW(c);)b=b.neighborCCW(c);a.meshClean(b)}function g(a,b){var c=a.locateNode(b),d=k(a,b,c);return b.x<=c.point.x+M&&l(a,c),m(a,d),d}function h(a,b,c){a.edge_event.constrained_edge=b,a.edge_event.right=b.p.x>b.q.x,j(c.triangle,b.p,b.q)||(u(a,b,c),i(a,b.p,b.q,c.triangle,b.q))}function i(a,b,c,d,e){if(!j(d,b,c)){var f=d.pointCCW(e),g=O(c,f,b);if(g===N.COLLINEAR)throw new I("poly2tri EdgeEvent: Collinear not supported!",[c,f,b]);var h=d.pointCW(e),k=O(c,h,b);if(k===N.COLLINEAR)throw new I("poly2tri EdgeEvent: Collinear not supported!",[c,h,b]);g===k?(d=g===N.CW?d.neighborCCW(e):d.neighborCW(e),i(a,b,c,d,e)):D(a,b,c,d,e)}}function j(a,b,c){var d=a.edgeIndex(b,c);if(-1!==d){a.markConstrainedEdgeByIndex(d);var e=a.getNeighbor(d);return e&&e.markConstrainedEdgeByPoints(b,c),!0}return!1}function k(a,b,c){var d=new J(b,c.point,c.next.point);d.markNeighbor(c.triangle),a.addToMap(d);var e=new K(b);return e.next=c.next,e.prev=c,c.next.prev=e,c.next=e,o(a,d)||a.mapTriangleToNodes(d),e}function l(a,b){var c=new J(b.prev.point,b.point,b.next.point);c.markNeighbor(b.prev.triangle),c.markNeighbor(b.triangle),a.addToMap(c),b.prev.next=b.next,b.next.prev=b.prev,o(a,c)||a.mapTriangleToNodes(c)}function m(a,b){for(var c=b.next;c.next&&!Q(c.point,c.next.point,c.prev.point);)l(a,c),c=c.next;for(c=b.prev;c.prev&&!Q(c.point,c.next.point,c.prev.point);)l(a,c),c=c.prev;b.next&&b.next.next&&n(b)&&r(a,b)}function n(a){var b=a.point.x-a.next.next.point.x,c=a.point.y-a.next.next.point.y;return H(c>=0,"unordered y"),b>=0||Math.abs(b)<c}function o(a,b){for(var c=0;c<3;++c)if(!b.delaunay_edge[c]){var d=b.getNeighbor(c);if(d){var e=b.getPoint(c),f=d.oppositePoint(b,e),g=d.index(f);if(d.constrained_edge[g]||d.delaunay_edge[g]){b.constrained_edge[c]=d.constrained_edge[g];continue}var h=p(e,b.pointCCW(e),b.pointCW(e),f);if(h){b.delaunay_edge[c]=!0,d.delaunay_edge[g]=!0,q(b,e,d,f);var i=!o(a,b);return i&&a.mapTriangleToNodes(b),i=!o(a,d),i&&a.mapTriangleToNodes(d),b.delaunay_edge[c]=!1,d.delaunay_edge[g]=!1,!0}}}return!1}function p(a,b,c,d){var e=a.x-d.x,f=a.y-d.y,g=b.x-d.x,h=b.y-d.y,i=e*h,j=g*f,k=i-j;if(k<=0)return!1;var l=c.x-d.x,m=c.y-d.y,n=l*f,o=e*m,p=n-o;return!(p<=0)&&(e*e+f*f)*(g*m-l*h)+(g*g+h*h)*p+(l*l+m*m)*k>0}function q(a,b,c,d){var e,f,g,h;e=a.neighborCCW(b),f=a.neighborCW(b),g=c.neighborCCW(d),h=c.neighborCW(d);var i,j,k,l;i=a.getConstrainedEdgeCCW(b),j=a.getConstrainedEdgeCW(b),k=c.getConstrainedEdgeCCW(d),l=c.getConstrainedEdgeCW(d);var m,n,o,p;m=a.getDelaunayEdgeCCW(b),n=a.getDelaunayEdgeCW(b),o=c.getDelaunayEdgeCCW(d),p=c.getDelaunayEdgeCW(d),a.legalize(b,d),c.legalize(d,b),c.setDelaunayEdgeCCW(b,m),a.setDelaunayEdgeCW(b,n),a.setDelaunayEdgeCCW(d,o),c.setDelaunayEdgeCW(d,p),c.setConstrainedEdgeCCW(b,i),a.setConstrainedEdgeCW(b,j),a.setConstrainedEdgeCCW(d,k),c.setConstrainedEdgeCW(d,l),a.clearNeighbors(),c.clearNeighbors(),e&&c.markNeighbor(e),f&&a.markNeighbor(f),g&&a.markNeighbor(g),h&&c.markNeighbor(h),a.markNeighbor(c)}function r(a,b){for(O(b.point,b.next.point,b.next.next.point)===N.CCW?a.basin.left_node=b.next.next:a.basin.left_node=b.next,a.basin.bottom_node=a.basin.left_node;a.basin.bottom_node.next&&a.basin.bottom_node.point.y>=a.basin.bottom_node.next.point.y;)a.basin.bottom_node=a.basin.bottom_node.next;if(a.basin.bottom_node!==a.basin.left_node){for(a.basin.right_node=a.basin.bottom_node;a.basin.right_node.next&&a.basin.right_node.point.y<a.basin.right_node.next.point.y;)a.basin.right_node=a.basin.right_node.next;a.basin.right_node!==a.basin.bottom_node&&(a.basin.width=a.basin.right_node.point.x-a.basin.left_node.point.x,a.basin.left_highest=a.basin.left_node.point.y>a.basin.right_node.point.y,s(a,a.basin.bottom_node))}}function s(a,b){if(!t(a,b)){l(a,b);if(b.prev!==a.basin.left_node||b.next!==a.basin.right_node){if(b.prev===a.basin.left_node){if(O(b.point,b.next.point,b.next.next.point)===N.CW)return;b=b.next}else if(b.next===a.basin.right_node){if(O(b.point,b.prev.point,b.prev.prev.point)===N.CCW)return;b=b.prev}else b=b.prev.point.y<b.next.point.y?b.prev:b.next;s(a,b)}}}function t(a,b){var c;return c=a.basin.left_highest?a.basin.left_node.point.y-b.point.y:a.basin.right_node.point.y-b.point.y,a.basin.width>c}function u(a,b,c){a.edge_event.right?v(a,b,c):z(a,b,c)}function v(a,b,c){for(;c.next.point.x<b.p.x;)O(b.q,c.next.point,b.p)===N.CCW?w(a,b,c):c=c.next}function w(a,b,c){c.point.x<b.p.x&&(O(c.point,c.next.point,c.next.next.point)===N.CCW?x(a,b,c):(y(a,b,c),w(a,b,c)))}function x(a,b,c){l(a,c.next),c.next.point!==b.p&&O(b.q,c.next.point,b.p)===N.CCW&&O(c.point,c.next.point,c.next.next.point)===N.CCW&&x(a,b,c)}function y(a,b,c){O(c.next.point,c.next.next.point,c.next.next.next.point)===N.CCW?x(a,b,c.next):O(b.q,c.next.next.point,b.p)===N.CCW&&y(a,b,c.next)}function z(a,b,c){for(;c.prev.point.x>b.p.x;)O(b.q,c.prev.point,b.p)===N.CW?A(a,b,c):c=c.prev}function A(a,b,c){c.point.x>b.p.x&&(O(c.point,c.prev.point,c.prev.prev.point)===N.CW?C(a,b,c):(B(a,b,c),A(a,b,c)))}function B(a,b,c){O(c.prev.point,c.prev.prev.point,c.prev.prev.prev.point)===N.CW?C(a,b,c.prev):O(b.q,c.prev.prev.point,b.p)===N.CW&&B(a,b,c.prev)}function C(a,b,c){l(a,c.prev),c.prev.point!==b.p&&O(b.q,c.prev.point,b.p)===N.CW&&O(c.point,c.prev.point,c.prev.prev.point)===N.CW&&C(a,b,c)}function D(a,b,c,d,e){var f=d.neighborAcross(e);H(f,"FLIP failed due to missing triangle!");var g=f.oppositePoint(d,e);if(d.getConstrainedEdgeAcross(e)){var h=d.index(e);throw new I("poly2tri Intersecting Constraints",[e,g,d.getPoint((h+1)%3),d.getPoint((h+2)%3)])}if(P(e,d.pointCCW(e),d.pointCW(e),g))if(q(d,e,f,g),a.mapTriangleToNodes(d),a.mapTriangleToNodes(f),e===c&&g===b)c===a.edge_event.constrained_edge.q&&b===a.edge_event.constrained_edge.p&&(d.markConstrainedEdgeByPoints(b,c),f.markConstrainedEdgeByPoints(b,c),o(a,d),o(a,f));else{var j=O(c,g,b);d=E(a,j,d,f,e,g),D(a,b,c,d,e)}else{G(a,b,c,d,f,F(b,c,f,g)),i(a,b,c,d,e)}}function E(a,b,c,d,e,f){var g;return b===N.CCW?(g=d.edgeIndex(e,f),d.delaunay_edge[g]=!0,o(a,d),d.clearDelaunayEdges(),c):(g=c.edgeIndex(e,f),c.delaunay_edge[g]=!0,o(a,c),c.clearDelaunayEdges(),d)}function F(a,b,c,d){var e=O(b,d,a);if(e===N.CW)return c.pointCCW(d);if(e===N.CCW)return c.pointCW(d);throw new I("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[b,d,a])}function G(a,b,c,d,e,f){var g=e.neighborAcross(f);H(g,"FLIP failed due to missing triangle");var h=g.oppositePoint(e,f);if(P(c,d.pointCCW(c),d.pointCW(c),h))D(a,c,h,g,h);else{G(a,b,c,d,g,F(b,c,g,h))}}var H=a("./assert"),I=a("./pointerror"),J=a("./triangle"),K=a("./advancingfront").Node,L=a("./utils"),M=L.EPSILON,N=L.Orientation,O=L.orient2d,P=L.inScanArea,Q=L.isAngleObtuse;c.triangulate=d},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(a,b,c){"use strict";var d=a("./pointerror"),e=a("./point"),f=a("./triangle"),g=a("./sweep"),h=a("./advancingfront"),i=h.Node,j=function(a,b){if(this.p=a,this.q=b,a.y>b.y)this.q=a,this.p=b;else if(a.y===b.y)if(a.x>b.x)this.q=a,this.p=b;else if(a.x===b.x)throw new d("poly2tri Invalid Edge constructor: repeated points!",[a]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},k=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};k.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var l=function(){this.constrained_edge=null,this.right=!1},m=function(a,b){b=b||{},this.triangles_=[],this.map_=[],this.points_=b.cloneArrays?a.slice(0):a,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new k,this.edge_event=new l,this.initEdges(this.points_)};m.prototype.addHole=function(a){this.initEdges(a);var b,c=a.length;for(b=0;b<c;b++)this.points_.push(a[b]);return this},m.prototype.AddHole=m.prototype.addHole,m.prototype.addHoles=function(a){var b,c=a.length;for(b=0;b<c;b++)this.initEdges(a[b]);return this.points_=this.points_.concat.apply(this.points_,a),this},m.prototype.addPoint=function(a){return this.points_.push(a),this},m.prototype.AddPoint=m.prototype.addPoint,m.prototype.addPoints=function(a){return this.points_=this.points_.concat(a),this},m.prototype.triangulate=function(){return g.triangulate(this),this},m.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},m.prototype.getTriangles=function(){return this.triangles_},m.prototype.GetTriangles=m.prototype.getTriangles,m.prototype.front=function(){return this.front_},m.prototype.pointCount=function(){return this.points_.length},m.prototype.head=function(){return this.head_},m.prototype.setHead=function(a){this.head_=a},m.prototype.tail=function(){return this.tail_},m.prototype.setTail=function(a){this.tail_=a},m.prototype.getMap=function(){return this.map_},m.prototype.initTriangulation=function(){var a,b=this.points_[0].x,c=this.points_[0].x,d=this.points_[0].y,f=this.points_[0].y,g=this.points_.length;for(a=1;a<g;a++){var h=this.points_[a];h.x>b&&(b=h.x),h.x<c&&(c=h.x),h.y>d&&(d=h.y),h.y<f&&(f=h.y)}this.pmin_=new e(c,f),this.pmax_=new e(b,d);var i=.3*(b-c),j=.3*(d-f);this.head_=new e(b+i,f-j),this.tail_=new e(c-i,f-j),this.points_.sort(e.compare)},m.prototype.initEdges=function(a,b){var c,d=a.length,e=b?a.length-1:a.length;for(c=0;c<e;++c)this.edge_list.push(new j(a[c],a[(c+1)%d]))},m.prototype.getPoint=function(a){return this.points_[a]},m.prototype.addToMap=function(a){this.map_.push(a)},m.prototype.locateNode=function(a){return this.front_.locateNode(a.x)},m.prototype.createAdvancingFront=function(){var a,b,c,d=new f(this.points_[0],this.tail_,this.head_);this.map_.push(d),a=new i(d.getPoint(1),d),b=new i(d.getPoint(0),d),c=new i(d.getPoint(2)),this.front_=new h(a,c),a.next=b,b.next=c,b.prev=a,c.prev=b},m.prototype.removeNode=function(a){},m.prototype.mapTriangleToNodes=function(a){for(var b=0;b<3;++b)if(!a.getNeighbor(b)){var c=this.front_.locatePoint(a.pointCW(a.getPoint(b)));c&&(c.triangle=a)}},m.prototype.removeFromMap=function(a){var b,c=this.map_,d=c.length;for(b=0;b<d;b++)if(c[b]===a){c.splice(b,1);break}},m.prototype.meshClean=function(a){for(var b,c,d=[a];b=d.pop();)if(!b.isInterior())for(b.setInterior(!0),this.triangles_.push(b),c=0;c<3;c++)b.constrained_edge[c]||d.push(b.getNeighbor(c))},b.exports=m},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b,c){this.points_=[a,b,c],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},f=d.toString;e.prototype.toString=function(){return"["+f(this.points_[0])+f(this.points_[1])+f(this.points_[2])+"]"},e.prototype.getPoint=function(a){return this.points_[a]},e.prototype.GetPoint=e.prototype.getPoint,e.prototype.getPoints=function(){return this.points_},e.prototype.getNeighbor=function(a){return this.neighbors_[a]},e.prototype.containsPoint=function(a){var b=this.points_;return a===b[0]||a===b[1]||a===b[2]},e.prototype.containsEdge=function(a){return this.containsPoint(a.p)&&this.containsPoint(a.q)},e.prototype.containsPoints=function(a,b){return this.containsPoint(a)&&this.containsPoint(b)},e.prototype.isInterior=function(){return this.interior_},e.prototype.setInterior=function(a){return this.interior_=a,this},e.prototype.markNeighborPointers=function(a,b,c){var d=this.points_;if(a===d[2]&&b===d[1]||a===d[1]&&b===d[2])this.neighbors_[0]=c;else if(a===d[0]&&b===d[2]||a===d[2]&&b===d[0])this.neighbors_[1]=c;else{if(!(a===d[0]&&b===d[1]||a===d[1]&&b===d[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=c}},e.prototype.markNeighbor=function(a){var b=this.points_;a.containsPoints(b[1],b[2])?(this.neighbors_[0]=a,a.markNeighborPointers(b[1],b[2],this)):a.containsPoints(b[0],b[2])?(this.neighbors_[1]=a,a.markNeighborPointers(b[0],b[2],this)):a.containsPoints(b[0],b[1])&&(this.neighbors_[2]=a,a.markNeighborPointers(b[0],b[1],this))},e.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},e.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},e.prototype.pointCW=function(a){var b=this.points_;return a===b[0]?b[2]:a===b[1]?b[0]:a===b[2]?b[1]:null},e.prototype.pointCCW=function(a){var b=this.points_;return a===b[0]?b[1]:a===b[1]?b[2]:a===b[2]?b[0]:null},e.prototype.neighborCW=function(a){return a===this.points_[0]?this.neighbors_[1]:a===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},e.prototype.neighborCCW=function(a){return a===this.points_[0]?this.neighbors_[2]:a===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},e.prototype.getConstrainedEdgeCW=function(a){return a===this.points_[0]?this.constrained_edge[1]:a===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},e.prototype.getConstrainedEdgeCCW=function(a){return a===this.points_[0]?this.constrained_edge[2]:a===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},e.prototype.getConstrainedEdgeAcross=function(a){return a===this.points_[0]?this.constrained_edge[0]:a===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},e.prototype.setConstrainedEdgeCW=function(a,b){a===this.points_[0]?this.constrained_edge[1]=b:a===this.points_[1]?this.constrained_edge[2]=b:this.constrained_edge[0]=b},e.prototype.setConstrainedEdgeCCW=function(a,b){a===this.points_[0]?this.constrained_edge[2]=b:a===this.points_[1]?this.constrained_edge[0]=b:this.constrained_edge[1]=b},e.prototype.getDelaunayEdgeCW=function(a){return a===this.points_[0]?this.delaunay_edge[1]:a===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},e.prototype.getDelaunayEdgeCCW=function(a){return a===this.points_[0]?this.delaunay_edge[2]:a===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},e.prototype.setDelaunayEdgeCW=function(a,b){a===this.points_[0]?this.delaunay_edge[1]=b:a===this.points_[1]?this.delaunay_edge[2]=b:this.delaunay_edge[0]=b},e.prototype.setDelaunayEdgeCCW=function(a,b){a===this.points_[0]?this.delaunay_edge[2]=b:a===this.points_[1]?this.delaunay_edge[0]=b:this.delaunay_edge[1]=b},e.prototype.neighborAcross=function(a){return a===this.points_[0]?this.neighbors_[0]:a===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},e.prototype.oppositePoint=function(a,b){var c=a.pointCW(b);return this.pointCW(c)},e.prototype.legalize=function(a,b){var c=this.points_;if(a===c[0])c[1]=c[0],c[0]=c[2],c[2]=b;else if(a===c[1])c[2]=c[1],c[1]=c[0],c[0]=b;else{if(a!==c[2])throw new Error("poly2tri Invalid Triangle.legalize() call");c[0]=c[2],c[2]=c[1],c[1]=b}},e.prototype.index=function(a){var b=this.points_;if(a===b[0])return 0;if(a===b[1])return 1;if(a===b[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},e.prototype.edgeIndex=function(a,b){var c=this.points_;if(a===c[0]){if(b===c[1])return 2;if(b===c[2])return 1}else if(a===c[1]){if(b===c[2])return 0;if(b===c[0])return 2}else if(a===c[2]){if(b===c[0])return 1;if(b===c[1])return 0}return-1},e.prototype.markConstrainedEdgeByIndex=function(a){this.constrained_edge[a]=!0},e.prototype.markConstrainedEdgeByEdge=function(a){this.markConstrainedEdgeByPoints(a.p,a.q)},e.prototype.markConstrainedEdgeByPoints=function(a,b){var c=this.points_;b===c[0]&&a===c[1]||b===c[1]&&a===c[0]?this.constrained_edge[2]=!0:b===c[0]&&a===c[2]||b===c[2]&&a===c[0]?this.constrained_edge[1]=!0:(b===c[1]&&a===c[2]||b===c[2]&&a===c[1])&&(this.constrained_edge[0]=!0)},b.exports=e},{"./xy":11}],10:[function(a,b,c){"use strict";function d(a,b,c){var d=(a.x-c.x)*(b.y-c.y),e=(a.y-c.y)*(b.x-c.x),f=d-e;return f>-g&&f<g?h.COLLINEAR:f>0?h.CCW:h.CW}function e(a,b,c,d){return!((a.x-b.x)*(d.y-b.y)-(d.x-b.x)*(a.y-b.y)>=-g)&&!((a.x-c.x)*(d.y-c.y)-(d.x-c.x)*(a.y-c.y)<=g)}function f(a,b,c){var d=b.x-a.x,e=b.y-a.y;return d*(c.x-a.x)+e*(c.y-a.y)<0}var g=1e-12;c.EPSILON=g;var h={CW:1,CCW:-1,COLLINEAR:0};c.Orientation=h,c.orient2d=d,c.inScanArea=e,c.isAngleObtuse=f},{}],11:[function(a,b,c){"use strict";function d(a){return"("+a.x+";"+a.y+")"}function e(a){var b=a.toString();return"[object Object]"===b?d(a):b}function f(a,b){return a.y===b.y?a.x-b.x:a.y-b.y}function g(a,b){return a.x===b.x&&a.y===b.y}b.exports={toString:e,toStringBase:d,compare:f,equals:g}},{}]},{},[6])(6)}()}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.SectionExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a,this.name="section",this.modes=["x","y","z","box"]},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionExtension;var proto=Autodesk.Viewing.Extensions.Section.SectionExtension.prototype;proto.load=function(){var a=this,b=this.viewer;if(Autodesk.Viewing.Private.injectCSS("extensions/Section/Section.min.css"),this.tool=new Autodesk.Viewing.Extensions.Section.SectionTool(b),b.toolController.registerTool(this.tool),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],b.getToolbar){b.getToolbar(!0)?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded))}this.onResetBinded=this.onReset.bind(this),b.addEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),
this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var c=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return a.enableSectionTool(!1)}}];return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,c),!0},proto.unload=function(){var a=this.viewer;return Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.destroyUI(),a.removeEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.onResetBinded=null,this.onToolbarCreatedBinded&&(a.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),a.toolController.deregisterTool(this.tool),this.tool=null,!0},proto.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var a=this.sectionStyle||"X";this.setSectionStyle(a,!0)}return this.isActive()},proto.getSectionStyle=function(){return this.sectionStyle},proto.setSectionStyle=function(a,b){if(-1===this.supportedStyles.indexOf(a))return!1;var c=this.isActive(),d=this.sectionStyle!==a||!b;return this.sectionStyle=a,c&&d?this.tool.setSection(a):c||(this.enableSectionTool(!0),d?this.tool.setSection(a):this.tool.attachControl(!0)),!0},proto.enableSectionTool=function(a){var b=this.viewer.toolController,c=this.tool.isActive();return a&&!c?(b.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(a||!c)&&(b.deactivateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},proto.onToolbarCreated=function(){this.onToolbarCreatedBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.createUI()},proto.onReset=function(){this.tool.resetSection()},proto.createUI=function(){var a=this.viewer,b=Autodesk.Viewing.UI;this.sectionToolButton=new b.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var c=a.getToolbar(!1),d=c.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(d){var e=d.getControl("toolbar-resetTool");e?d.addControl(this.sectionToolButton,{index:d.indexOf(e.getId())}):d.addControl(this.sectionToolButton,{index:0})}},proto.createSubmenu=function(a){function b(a,b){return function(){var c=a.getState(),e=function(){a instanceof f.ComboButton==!1?d.activate(b):(d.enableSectionTool(!0),d.tool.attachControl(!0))};c===f.Button.State.INACTIVE?(a.setState(f.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(e,1):e()):c===f.Button.State.ACTIVE&&(a.setState(f.Button.State.INACTIVE),d.deactivate()),d.sectionStyle=b}}function c(){var a=function(){var a=new THREE.Vector3;return function(b,c,d){return a.subVectors(b,c),a.lengthSq()<d}}(),b=new THREE.Vector3(1,0,0),f=new THREE.Vector3(0,1,0),g=new THREE.Vector3(0,0,1),h=e.autocam.getWorldRightVector(),i=e.autocam.getWorldUpVector(),j=e.autocam.getWorldFrontVector();a(i,b,1e-4)?d.sectionYButton.setIcon("adsk-icon-plane-x"):a(i,g,1e-4)?d.sectionYButton.setIcon("adsk-icon-plane-z"):d.sectionYButton.setIcon("adsk-icon-plane-y"),a(h,f,1e-4)?d.sectionXButton.setIcon("adsk-icon-plane-y"):a(h,g,1e-4)?d.sectionXButton.setIcon("adsk-icon-plane-z"):d.sectionXButton.setIcon("adsk-icon-plane-x"),a(j,b,1e-4)?d.sectionZButton.setIcon("adsk-icon-plane-x"):a(j,f,1e-4)?d.sectionZButton.setIcon("adsk-icon-plane-y"):d.sectionZButton.setIcon("adsk-icon-plane-z"),e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)}var d=this,e=this.viewer,f=Autodesk.Viewing.UI,g=this.sectionXButton=new f.Button("toolbar-sectionTool-x");g.setToolTip("Add X plane"),g.setIcon("adsk-icon-plane-x"),g.onClick=b(g,"x"),a.addControl(g);var h=this.sectionYButton=new f.Button("toolbar-sectionTool-y");h.setToolTip("Add Y plane"),h.setIcon("adsk-icon-plane-y"),h.onClick=b(h,"y"),a.addControl(h);var i=this.sectionZButton=new f.Button("toolbar-sectionTool-z");i.setToolTip("Add Z plane"),i.setIcon("adsk-icon-plane-z"),i.onClick=b(i,"z"),a.addControl(i);var j=this.sectionBoxButton=new f.Button("toolbar-sectionTool-box");j.setToolTip("Add box"),j.setIcon("adsk-icon-box"),j.onClick=b(j,"box"),a.addControl(j),e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)},proto.destroyUI=function(){var a=this.viewer,b=a.getToolbar(!1);if(b){var c=b.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(c&&this.sectionToolButton){var d=c.getControl("toolbar-inspectSubMenu");d?d.removeControl(this.sectionToolButton.getId()):c.removeControl(this.sectionToolButton.getId()),this.sectionToolButton=null}}},proto.activate=function(a){if(!this.activeStatus||this.mode!==a){switch(this.enableSectionTool(!0),a){default:case"x":this.tool.setSection("X"),this.mode="x";break;case"y":this.tool.setSection("Y"),this.mode="y";break;case"z":this.tool.setSection("Z"),this.mode="z";break;case"box":this.tool.setSection("BOX"),this.mode="box"}return this.activeStatus=!0,!0}},proto.deactivate=function(){return this.activeStatus&&(this.enableSectionTool(!1),this.activeStatus=!1),!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",Autodesk.Viewing.Extensions.Section.SectionExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.tintColor={r:1,g:1,b:0},Autodesk.Viewing.Extensions.Section.tintIntensity=.2,Autodesk.Viewing.Extensions.Section.SectionTool=function(a){function b(){G||(t=new THREE.TransformControls(v.camera,v.canvas,"transrotate"),t.addEventListener("change",d),t.setSnap(Math.PI/2,Math.PI/36),u=new THREE.TransformControls(v.camera,v.canvas,"translate"),u.addEventListener("change",d),void 0===v.overlayScenes[E]&&v.createOverlayScene(E),v.addOverlay(E,t),v.addOverlay(E,u),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,e),a.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,f),a.addEventListener(Autodesk.Viewing.HIDE_EVENT,f),a.addEventListener(Autodesk.Viewing.SHOW_EVENT,f),a.addEventListener(Autodesk.Viewing.FRAGMENTS_LOADED_EVENT,j),G=!0)}function c(){G&&(v.removeOverlay(E,t),t.removeEventListener("change",d),t=null,v.removeOverlay(E,u),u.removeEventListener("change",d),u=null,v.removeOverlayScene(E),a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,e),a.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,f),a.removeEventListener(Autodesk.Viewing.HIDE_EVENT,f),a.removeEventListener(Autodesk.Viewing.SHOW_EVENT,f),a.removeEventListener(Autodesk.Viewing.FRAGMENTS_LOADED_EVENT,j),G=!1)}function d(){v.invalidate(!1,!1,!0)}function e(){t&&t.update(),u&&u.update()}function f(){x&&1===B.length&&(l(!0),e(),i((new THREE.Plane).setComponents(B[0].x,B[0].y,B[0].z,B[0].w)))}function g(a){return a&&a.color||new THREE.Color(16777215)}function h(a,b){function c(a){p&&clearTimeout(p),p=0,i=a,q.length=0,r.length=0,l=null,s.length=0,m=-1,n=0,o=0}function d(){p=0;for(var e=performance.now()+a;performance.now()<e;){if(!g())return v.invalidate(!0,!0),void c(null);var f=q[n];0==o&&k&&delete k.dbIds[f],h(r[o],f,j,o+1>=r.length,!i||m>=i.length)}p=setTimeout(d,b)}function e(){if(i&&m<i.length)for(;++m<i.length;)if((l=i[m].getFragmentMap())&&(q.length=0,l.enumNodeChildren(i[m].getRootId(),function(a){q.push(a)},!0),q.length>0))return j=i[m],k=s.find(function(a){return a.model===j}),j;for(var a=0;a<s.length;++a)if(j=s[a].model,l=j.getFragmentMap()){q.length=0;var b;for(b in s[a].dbIds){var c=Number(b);isFinite(c)&&q.push(c)}if(q.length>0)return s.splice(0,a+1),k=null,!0}return j=null,k=null,s.length=0,!1}function f(){if(n>=q.length)return!1;for(;++n<q.length;){var a=q[n];if(!l.isNodeHidden(a)&&!l.isNodeOff(a)&&(r.length=0,l.enumNodeFragments(a,function(a){r.push(a)},!1),r.length>0))return!0}return!1}function g(){if(++o<r.length)return!0;for(o=0;;){if(f())return!0;if(!e())return!1;n=-1}}var h,i,j,k,l,m,n,o,p=0,q=[],r=[],s=[];a=a||15,b=b||0,this.start=function(a,b,e){c(a),h=e,e&&(b>=0?p=setTimeout(d,b):d())},this.loadedDbIds=function(a,c){if(h&&a&&c&&!(c.length<=0)){var e=s.find(function(b){return b.model===a});e||(e={model:a,dbIds:{}},s.push(e),a===j&&(k=e));var f=a.getFragmentList();c.forEach(function(a){var b=0|f.getDbIds(a);e.dbIds[b]=!0}),0==p&&(p=setTimeout(d,b))}}}function i(a){function b(a,b,c,d){var e=a.children.find(function(a){return a.modelId==b&&a.dbId==c});e&&(a.remove(e),e.geometry&&e.geometry.dispose(),d&&e.material&&e.material.dispose())}init_three_triangulator(),init_three_intersector();var c=v.sceneAfter.getObjectByName("section");c&&v.sceneAfter.remove(c);var d=new THREE.Object3D;d.name="section",v.sceneAfter.add(d);var e=new THREE.Object3D;d.add(e);var f=new THREE.Object3D;d.add(f);var h=Autodesk.Viewing.Private,i=h.Intersector.makePlaneBasis(a),j=(new THREE.Matrix4).getInverse(i),k=v.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0},!1,!1),l=v.matman().findMaterial(null,k);l.transparent=!0,l.depthTest=!0,l.polygonOffset=!0,l.polygonOffsetFactor=-1,l.polygonOffsetUnits=.1;var m,n=new THREE.Box3,o=v.modelQueue().getModels(),p=[];K.start(o,50,function(c,d,k,o,q){var r=k.getFragmentList();if(r.getWorldBounds(c,n),h.Intersector.intersectBoxPlane(a,n)){var s=r.getVizmesh(c);s.geometry&&!s.geometry.is2d&&!s.geometry.isLines&&s.material.cutplanes&&(m=s.material,h.Intersector.intersectMeshPlane(a,s,p))}if(o){if(p.length){var t=new THREE.Box3;h.Intersector.convertToPlaneCoords(i,p,t);var u=new h.VertexBufferBuilder(!1,8*p.length),w=g(m),x=0|.25*w.r*255.5,y=0|.25*w.g*255.5,z=0|.25*w.b*255.5,A=4278190080|z<<16|y<<8|x,B=new h.Triangulator.ContourSet(p,t);B.snapEdges(),B.sanitizeEdges(),B.stitchContours();var C;for(C=0;C<B.contours.length;C++){var D=B.contours[C];x=0|255.5*Math.random(),y=0|255.5*Math.random(),z=0|255.5*Math.random();for(var E=1;E<D.length;E++){var F=B.pts[D[E-1]],G=B.pts[D[E]];u.addSegment(F.x,F.y,G.x,G.y,0,.02,A,d,0)}}var H={mesh:u.toMesh()};h.BufferGeometryUtils.meshToGeometry(H);var I=H.geometry;I.streamingDraw=!0,I.streamingIndex=!0,q&&b(f,k.id,d,!1);var J=new THREE.Mesh(I,l);J.matrix.copy(j),J.matrixAutoUpdate=!1,J.frustumCulled=!1,J.modelId=k.id,J.dbId=d,f.add(J);var K=new h.Triangulator.TriangulatedSurface(B);if(K.indices.length){var L=new THREE.BufferGeometry,M=new Float32Array(3*K.pts.length);for(C=0;C<K.pts.length;C++)M[3*C]=K.pts[C].x,M[3*C+1]=K.pts[C].y,M[3*C+2]=0;L.addAttribute("position",new THREE.BufferAttribute(M,3));var N=m.packedNormals,O=N?new Uint16Array(2*K.pts.length):new Float32Array(3*K.pts.length);for(C=0;C<K.pts.length;C++)if(N){var P=.5*(0/Math.PI+1);O[2*C]=65535*P|0,O[2*C+1]=65535}else O[3*C]=0,O[3*C+1]=0,O[3*C+2]=1;L.addAttribute("normal",new THREE.BufferAttribute(O,N?2:3)),N&&(L.attributes.normal.bytesPerItem=2,L.attributes.normal.normalize=!0);var Q=new Uint16Array(K.indices.length);Q.set(K.indices),L.addAttribute("index",new THREE.BufferAttribute(Q,1)),L.streamingDraw=!0,L.streamingIndex=!0;var R=v.matman().cloneMaterial(m,k);R.packedNormals=N,R.cutplanes=null,R.side=THREE.FrontSide,R.depthTest=!0,R.map=null,R.bumpMap=null,R.normalMap=null,R.alphaMap=null,R.specularMap=null,R.transparent=!1,R.depthWrite=!0,R.hatchPattern=!0,R.needsUpdate=!0;var S=(m.id+2)*Math.PI*.125,T=Math.tan(S);R.hatchParams=new THREE.Vector2(T,10),R.hatchTintColor=Autodesk.Viewing.Extensions.Section.tintColor,R.hatchTintIntensity=Autodesk.Viewing.Extensions.Section.tintIntensity,null!=R.prismType&&(R.defines={},R.defines[R.prismType.toUpperCase()]="","PrismWood"==R.prismType&&(R.defines.NO_UVW="")),q&&b(e,k.id,d,!0);var U=new THREE.Mesh(L,R);U.matrix.copy(j),U.matrixAutoUpdate=!1,U.modelId=k.id,U.dbId=d,U.fragId=p.fragId,e.add(U)}}p.length=0}})}function j(a){x&&1===B.length&&K.loadedDbIds(a.model,a.getFragIds())}function k(a,b){var c,d,e=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),a.normal);if(b){var f=a.projectPoint(b.max),g=a.projectPoint(b.min),h=e.clone().inverse();f.applyQuaternion(h),g.applyQuaternion(h),d=(new THREE.Vector3).subVectors(f,g),c=new THREE.PlaneBufferGeometry(d.x,d.y)}else b=v.getVisibleBounds(),d=2*b.getBoundingSphere().radius,c=new THREE.PlaneBufferGeometry(d,d);var i=new THREE.MeshBasicMaterial({opacity:0,color:16777215,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),j=new J.SectionMesh(c,i,a),k=a.projectPoint(b.center());j.position.copy(k),j.quaternion.multiply(e);for(var l=Autodesk.Viewing.Private.LightPresets[v.currentLightPreset()].bgColorGradient,m="rgb("+(255-l[0])+","+(255-l[1])+","+(255-l[2])+")",n=new THREE.LineBasicMaterial({color:m,linewidth:1,depthTest:!1}),o=j.geometry.getAttribute("position"),p=0;p<I.length;p++){c=new THREE.Geometry,c.vertices.push((new THREE.Vector3).fromArray(o.array,I[p][0]*o.itemSize),(new THREE.Vector3).fromArray(o.array,I[p][1]*o.itemSize));var q=new THREE.Line(c,n);j.add(q),j.outlines.push(q)}return j}function l(a){m(function(b){if(b instanceof J.SectionMesh){var c,d,e,f;if(b.connectivity.length>0){var g=(new THREE.Matrix4).getInverse(b.matrixWorld);for(f=new THREE.Vector3,e=b.geometry.getAttribute("position"),c=0;c<e.length/e.itemSize;c++){var h=b.connectivity[c];null!==L(b.plane,h[0],h[1],f)&&(f.applyMatrix4(g),e.setXYZ(c,f.x,f.y,f.z))}for(e.needsUpdate=!0,b.geometry.computeBoundingBox(),b.geometry.computeBoundingSphere(),c=0;c<b.outlines.length;c++)d=b.outlines[c],d.geometry.vertices[0].fromArray(e.array,I[c][0]*e.itemSize),d.geometry.vertices[1].fromArray(e.array,I[c][1]*e.itemSize),d.geometry.verticesNeedUpdate=!0}else if(a){var i=v.getVisibleBounds(),j=2*i.getBoundingSphere().radius;for(f=b.plane.projectPoint(i.center()),b.geometry=new THREE.PlaneBufferGeometry(j,j),b.position.copy(f),e=b.geometry.getAttribute("position"),c=0;c<b.outlines.length;c++)d=b.outlines[c],d.geometry.vertices[0].fromArray(e.array,I[c][0]*e.itemSize),d.geometry.vertices[1].fromArray(e.array,I[c][1]*e.itemSize),d.geometry.verticesNeedUpdate=!0}}})}function m(a){for(var b=0;b<A.length;b++)A[b].traverse(a)}function n(){m(function(a){a instanceof J.SectionMesh&&a.update()}),1===B.length&&i((new THREE.Plane).setComponents(B[0].x,B[0].y,B[0].z,B[0].w)),v.setCutPlanes(B)}function o(a){for(var b=0;b<A.length;b++)A[b].visible=a;z!==a&&d(),z=a}function p(b){b&&B.length>0&&(1===B.length&&i((new THREE.Plane).setComponents(B[0].x,B[0].y,B[0].z,B[0].w)),a.setCutPlanes(B)),o(b)}function q(a,b){a.attach(b),a.setPosition(b.position),a.visible=!0}function r(a){v.api.navigation.getEyeVector().dot(a)>0&&a.negate();var b=v.getVisibleBounds(),c=b.center(),d=new THREE.Group,e=new THREE.Plane(a,-1*c.dot(a)),f=k(e,null);d.add(f),B.push(f.planeVec),A.push(d),v.addOverlay(E,d),q(t,f),t.showRotationGizmos(!0),C=t.getPicker(),n()}function s(){var a,b,c=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],d=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],e=new THREE.Group,f=v.getVisibleBounds(),g=f.center(),h=new THREE.Box3(f.min,g),i=[],j=[];for(a=0;a<c.length;a++){var l=new THREE.Plane(c[a],-1*g.dot(c[a]));if(i.push(l),a>2){var m=l.orthoPoint(h.max),o=l.orthoPoint(h.min),p=(new THREE.Vector3).subVectors(m,o);l.constant-=p.length()}b=k(l,h),e.add(b),j.push(b),B.push(b.planeVec)}for(a=0;a<j.length;a++){b=j[a];for(var r=d[a],s=0;s<r.length;s++){for(var w=[],x=r[s],y=0;y<x.length;y++)w.push(i[x[y]]);b.connectivity.push(w)}}A.push(e),v.addOverlay(E,e),q(t,A[0].children[0]),q(u,A[0]),t.showRotationGizmos(!1),C=t.getPicker().concat(u.getPicker()),n()}var t,u,v=a.impl,w=["section"],x=!1,y=!1,z=!0,A=[],B=[],C=[],D="",E="gizmo",F=null,G=!1,H=!0,I=[[0,1],[1,3],[3,2],[2,0]],J=Autodesk.Viewing.Extensions.Section;init_TransformGizmos(),init_SectionMesh();var K=new h,L=function(){var a=new THREE.Matrix3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h){a.set(e.normal.x,e.normal.y,e.normal.z,f.normal.x,f.normal.y,f.normal.z,g.normal.x,g.normal.y,g.normal.z);var i=a.determinant();return 0===i?null:(b.crossVectors(f.normal,g.normal).multiplyScalar(-e.constant),c.crossVectors(g.normal,e.normal).multiplyScalar(-f.constant),d.crossVectors(e.normal,f.normal).multiplyScalar(-g.constant),(h||new THREE.Vector3).copy(b).add(c).add(d).divideScalar(i))}}(),M=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Raycaster,d=v.camera;return function(e,f,g){var h=v.getCanvasBoundingClientRect(),i=(e.clientX-h.left)/h.width*2-1,j=-(e.clientY-h.top)/h.height*2+1;d.isPerspective?(a.set(i,j,.5),a.unproject(d),c.set(d.position,a.sub(d.position).normalize())):(a.set(i,j,-1),a.unproject(d),b.set(0,0,-1),c.set(a,b.transformDirection(d.matrixWorld)));var k=c.intersectObjects(f,g);return k[0]?k[0]:null}}();this.isActive=function(){return x},this.setSection=function(a){this.clearSection();var b;switch(a){case"X":b=new THREE.Vector3(1,0,0),r(b);break;case"Y":b=new THREE.Vector3(0,1,0),r(b);break;case"Z":b=new THREE.Vector3(0,0,1),r(b);break;case"BOX":s()}D=a},this.clearSection=function(){for(t&&t.detach(),u&&u.detach();B.length>0;)B.pop();for(;A.length>0;){var a=A.pop();v.removeOverlay(E,a)}K.start(null);var b=v.sceneAfter.getObjectByName("section");b&&v.sceneAfter.remove(b),v.setCutPlanes()},this.isPlaneOn=function(){return z},this.showPlane=function(a){o(a)},this.attachControl=function(a){a?(q(t,A[0].children[0]),t.highlight(),"BOX"===D&&q(u,A[0])):(t.detach(),u.detach())},this.resetSection=function(){this.setSection(D)},this.getNames=function(){return w},this.getName=function(){return w[0]},this.register=function(){},this.deregister=function(){this.clearSection(),c()},this.getPriority=function(){return 70},this.activate=function(){b(),x=!0,y=!1,H=!0,B=B||[],p(!0)},this.deactivate=function(){x=!1,y=!1,K.start(null);var a=v.sceneAfter.getObjectByName("section");a&&v.sceneAfter.remove(a),p(!1),v.setCutPlanes(),t.detach(),u.detach()},this.update=function(){return!1},this.handleSingleClick=function(a){var b=a.pointers?a.pointers[0]:a,c=M(b,A[0].children);return c&&(q(t,c.object),t.highlight(),d()),!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(a){return y=!0,!!u.onPointerDown(a)||t.onPointerDown(a)},this.handleButtonUp=function(a){return y=!1,!!u.onPointerUp(a)||t.onPointerUp(a)},this.handleMouseMove=function(a){if(y){if(u.onPointerMove(a))return n(),t.update(),!0;if(t.onPointerMove(a))return n(),l(),!0}if(u.visible=void 0!==u.object,"touch"!==a.pointerType){var b=a.pointers?a.pointers[0]:a,c=M(b,A[0].children);c&&(H=!1);var d=!!(H||c||M(b,C,!0));t.visible=d,u.visible=u.visible&&d,o(d)}return!!u.onPointerHover(a)||t.onPointerHover(a)},this.handleGesture=function(a){switch(a.type){case"dragstart":return F="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===F&&this.handleMouseMove(a);case"dragend":return"drag"===F&&(F=null,this.handleButtonUp(a,0))}return!1},this.handleBlur=function(){return!1},this.handleResize=function(){},this.handlePressHold=function(){return!0}};