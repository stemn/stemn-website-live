!function(){"use strict";var a=Autodesk.Viewing,b=a.Private,c=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),d=function(b,c){a.Extension.call(this,b,c),this.tool=null,this.name="hyperlink"};d.prototype=Object.create(a.Extension.prototype),d.prototype.constructor=d,d.prototype.load=function(){var a=this.options||{};return b.injectCSS("extensions/Hyperlink/Hyperlink.min.css"),this.tool=new c.HyperlinkTool(this.viewer,a),this.viewer.toolController.registerTool(this.tool),this.viewer.toolController.activateTool(this.tool.getName()),!0},d.prototype.unload=function(){return this.viewer.toolController.deactivateTool(this.tool.getName()),this.viewer.toolController.deregisterTool(this.tool),this.tool=null,!0},d.prototype.activate=function(){return!0},d.prototype.deactivate=function(){return!1},c.HyperlinkExtension=d,a.theExtensionManager.registerExtension("Autodesk.Hyperlink",d)}(),function(){"use strict";var a=Autodesk.Viewing,b=a.Private,c=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),d=function(c,d){a.ToolInterface.call(this),this.names=["hyperlink"];var e=this,f=-1,g=!1,h={},i={},j=null,k=null,l=null,m=null,n={},o=null,p=null,q=null;this.panel=null,this.fillColor=d.hyperlinkColor||240116,this.opacity=d.hyperlinkOpacity||.4,this.selectionFillColor=d.hyperlinkColorSelection||7376094,this.selectedOpacity=d.hyperlinkOpacitySelected||.4,this.rectanglePadding=d.hyperlinkPadding||.5;var r=function(b,d,e){j||(j=document.createElement("div"),c.container.appendChild(j),j.setAttribute("data-i18n","Ctrl + Click to preview the link"),j.textContent=a.i18n.translate("Ctrl + Click to preview the link")),j.className="hyperlink-tooltip",j.style.top=d+20+"px",j.style.left=b+20+"px",j.intersectPoint=e},s=function(){j&&(c.container.removeChild(j),j=null)},t=function(){if(j){var a=c.navigation.getCamera(),b=c.navigation.getScreenViewport(),d=(new THREE.Vector3).copy(j.intersectPoint);d.project(a);var e=Math.round((d.x+1)/2*b.width),f=Math.round((1-d.y)/2*b.height);j.style.left=e+20+"px",j.style.top=f+20+"px"}},u=function(b){c.removeEventListener(a.GEOMETRY_LOADED_EVENT,u),e.loadHyperlinks()},v=function(){e.panel&&e.panel.updatePosition(),t()};this.activate=function(b){c.model&&c.model.isLoadDone()?e.loadHyperlinks():c.addEventListener(a.GEOMETRY_LOADED_EVENT,u),c.addEventListener(a.CAMERA_CHANGE_EVENT,v)},this.deactivate=function(b){c.removeEventListener(a.CAMERA_CHANGE_EVENT,v),c.removeEventListener(a.GEOMETRY_LOADED_EVENT,u),h={},i={},s(),this.panel&&(this.panel.uninitialize(),this.panel=null),c.HyperlinkBack&&(c.HyperlinkBack.uninitialize(),c.HyperlinkBack=null),c.impl.clearOverlay("Hyperlink-bBox"),c.impl.clearOverlay("Hyperlink-bBox-select")},this.update=function(a){return!1},this.handleSingleClick=function(b,d){this.clearSelection(),this.panel&&(this.panel.uninitialize(),this.panel=null);var g=c.model.getDocumentNode(),j=null;g&&(j=g.data.viewableID);var k=new THREE.Vector2(b.canvasX,b.canvasY);if(c.model.is2d()){var l=c.impl.clientToViewport(b.canvasX,b.canvasY),m=c.impl.intersectGroundViewport(l);for(var n in h)if(h.hasOwnProperty(n)){var o=h[n],p=m.x,q=m.y;if(p>=o.bBox[0]&&p<=o.bBox[2]&&q>=o.bBox[1]&&q<=o.bBox[3]){if(o.node){var r=o.node.data.name;this.panel=new a.Extensions.Hyperlink.HyperlinkPanel(e,c,k,m,r,o.link,j,o.dbId,o.node.data,this.getThumbnail)}else this.panel=new a.Extensions.Hyperlink.HyperlinkPanel(e,c,k,m,null,o.link,j);return this.highlightSelection(o.bBoxMesh),!0}}return!1}if(c.model.is3d()){var t=c.impl.hitTest(b.canvasX,b.canvasY,!1);if(!t)return!1;if(b.ctrlKey&&i[f]){this.controller.setIsLocked(!1),s();var o=i[f];if(o.node){var r=o.node.data.name;this.panel=new a.Extensions.Hyperlink.HyperlinkPanel(e,c,k,t.intersectPoint,r,o.link,j,f,o.node.data,this.getThumbnail)}else this.panel=new a.Extensions.Hyperlink.HyperlinkPanel(e,c,k,t.intersectPoint,null,o.link,j,f);return!0}}return!1},this.handleButtonDown=function(a,b){return g=!0,!1},this.handleButtonUp=function(a,b){return g=!1,!1},this.handleMouseMove=function(a){if(!g){if(c.model&&!c.model.is2d()){var b=c.impl.hitTest(a.canvasX,a.canvasY,!1);if(b){var d=b.dbId;if(d!=f&&(f=d,s()),this.panel&&this.panel.dbId===d)return;i.hasOwnProperty(f)?i[f]&&r(a.canvasX,a.canvasY,b.intersectPoint):(i[f]=null,this.loadHyperlink3d(f,a.canvasX,a.canvasY,b.intersectPoint))}else s()}return!1}},this.getCursor=function(){return j?"pointer":null},this.loadHyperlinks=function(){var a=c.model.getData();if(l=a.stringDbIds,m=a.stringBoxes,h={},l){var b=[];k={};for(var d=0,e=l.length;d<e;++d){var f=l[d];f<1||(-1===b.indexOf(f)&&(b.push(f),k[f]=[]),k[f].push(d))}c.model.getBulkProperties(b,{propFilter:["hyperlink"]},this._onBulkProperties)}},this._onBulkProperties=function(a){var b=c.model.getDocumentNode();b&&(b=b.getRootNode());for(var d=0,e=a.length;d<e;++d){var f=a[d],g=f.dbId,i=f.properties[0].displayValue,j=null,l=null,m=b?b.search({viewableID:i}):null;if(m&&m.length&&(j=m[0]),!j&&this._isURL(i)&&(l=i),j||l)for(var n=k[g],o=0;o<n.length;++o){var p=n[o];h[p]={dbId:g,link:l,node:j},this.highlightText(p)}}}.bind(this),this._isURL=function(a){if("string"==typeof a){if("http"===a.substr(0,4).toLowerCase())return!0;var b=a.indexOf("/");-1!==b&&(a=a.substr(0,b));var c=a.split(".").length;return b>0&&c>0||-1===b&&c>1}},this.navigateToLink=function(b,d){return b?void window.open(b):d?void c.dispatchEvent({type:a.HYPERLINK_EVENT,data:{item:d}}):void 0},this.loadHyperlink3d=function(a,b,d,e){c.getProperties(a,function(f){for(var g=f.properties,h=0,j=g.length;h<j;h++){var k=g[h];if("__hyperlink__"===k.displayCategory){var l=null,m=k.displayValue,n=c.model.getDocumentNode();if(n){n=n.getRootNode();var o=n.search({viewableID:m});o&&o.length&&(l=o[0])}i[a]={link:m,node:l},r(b,d,e);break}}})},this.getHyperlinks=function(){return _linkCache},this.getThumbnail=function(a,d,e){if(n.hasOwnProperty(a))return void e(n[a]);var f={urn:c.model.getData().urn,width:200,height:200,guid:encodeURIComponent(d.guid),acmsession:c.model.getData().acmSessionId},g=function(b){var c=new FileReader;c.onload=function(b){var c=b.target.result;n[a]=c,e(c)},c.readAsDataURL(b)},h={responseType:"blob",skipAssetCallback:!0,size:f.width,guid:f.guid,acmsession:f.acmsession},i="urn:"+f.urn;b.ViewingService.getThumbnail(b.initLoadContext(),i,g,null,h)},this.highlightText=function(a){var b=this.rectanglePadding,c=m[4*a]-b,d=m[4*a+1]-b,e=m[4*a+2]+b,f=m[4*a+3]+b;h[a].bBox=[c,d,e,f],this.addRectangle(a,c,d,e,f)},this.addRectangle=function(a,b,d,e,f){var g=new THREE.Vector3(b,d,0),i=new THREE.Vector3(e,d,0),j=new THREE.Vector3(e,f,0),k=new THREE.Vector3(b,f,0),l=new THREE.Geometry;if(l.vertices.push(g),l.vertices.push(i),l.vertices.push(j),l.vertices.push(k),l.faces.push(new THREE.Face3(0,1,2)),l.faces.push(new THREE.Face3(0,3,2)),!o){var m=this.fillColor,n=this.opacity;o=new THREE.MeshBasicMaterial({color:m,opacity:n,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),c.impl.createOverlayScene("Hyperlink-bBox")}var p=h[a].bBoxMesh=new THREE.Mesh(l,o,!0);c.impl.addOverlay("Hyperlink-bBox",p)},this.highlightSelection=function(a){if(q=a,c.impl.removeOverlay("Hyperlink-bBox",a),!p){var b=this.selectionFillColor,d=this.selectedOpacity;p=new THREE.MeshBasicMaterial({color:b,opacity:d,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),c.impl.createOverlayScene("Hyperlink-bBox-select")}var e=new THREE.Mesh(a.geometry,p);c.impl.addOverlay("Hyperlink-bBox-select",e)},this.clearSelection=function(){q&&(c.impl.clearOverlay("Hyperlink-bBox-select"),c.impl.addOverlay("Hyperlink-bBox",q),q=null)}};c.HyperlinkTool=d}(),function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),b=Autodesk.Viewing,c=(Autodesk.Viewing.Extensions,Autodesk.Viewing.Private,Autodesk.Viewing.UI,function(c,d,e,f,g,h,i,j,k,l){function m(a){n.thumbnail.src=a}var n=this;this.viewer=d,this.container=document.createElement("div"),this.container.className="hyperlink-container",d.container.appendChild(this.container),this.container.style.left=e.x+"px",this.container.style.top=e.y-70+"px",this.intersectPoint=f,this.dbId=j,this.triangle=document.createElement("div"),this.triangle.classList.add("hyperlink-container-triangle"),this.container.appendChild(this.triangle),this.panel=document.createElement("div"),this.panel.classList.add("docking-panel"),this.panel.classList.add("docking-panel-container-solid-color-a"),this.panel.classList.add("hyperlink-panel"),this.container.appendChild(this.panel),this.title=document.createElement("div"),this.title.className="hyperlink-panel-title",g?this.title.textContent=g:(this.title.setAttribute("data-i18n","External Link"),this.title.textContent=b.i18n.translate("External Link")),this.panel.appendChild(this.title),k?(this.panel.classList.add("thumbnail"),this.thumbnail=document.createElement("img"),this.thumbnail.className="hyperlink-panel-thumbnail",l(j,k,m),this.panel.appendChild(this.thumbnail)):(this.panel.classList.add("link"),this.externalLink=document.createElement("div"),this.externalLink.className="hyperlink-panel-external-link",this.externalLink.textContent=h,this.panel.appendChild(this.externalLink)),this.viewButton=document.createElement("div"),this.viewButton.className="docking-panel-primary-button",this.viewButton.setAttribute("data-i18n","View"),this.viewButton.textContent=b.i18n.translate("View"),this.panel.appendChild(this.viewButton),this.viewButton.addEventListener("click",function(){n.uninitialize(),c.panel=null,d.HyperlinkBack&&(d.HyperlinkBack.uninitialize(),d.HyperlinkBack=null);var b=d.model.getDocumentNode();c.navigateToLink(h,k),k&&(d.HyperlinkBack=new a.HyperlinkBack(c,d,b))}),this.triangle.style.bottom=this.container.clientHeight-85+"px",this.boundsCheck()});c.prototype.uninitialize=function(){this.viewer.container.removeChild(this.container),this.container=null},c.prototype.boundsCheck=function(){var a=this.viewer.navigation.getScreenViewport(),b=this.container.clientWidth,c=this.container.clientHeight,d=parseInt(this.container.style.left,10),e=parseInt(this.container.style.top,10),f=d,g=e;d<0&&(f=0),e<0&&(g=0),a.width<d+b&&(f=a.width-b),a.height<e+c&&(g=a.height-c);var h=this.viewer.navigation.getEyeVector().length(),i=this.viewer.impl.clientToViewport(d,e),j=this.viewer.impl.clientToViewport(f,g);i.subVectors(i,j),this.viewer.navigation.panRelative(i.x/2,i.y/2,h),this.container.style.left=f+"px",this.container.style.top=g+"px"},c.prototype.updatePosition=function(){var a=this.viewer.navigation.getCamera(),b=this.viewer.navigation.getScreenViewport(),c=(new THREE.Vector3).copy(this.intersectPoint);c.project(a);var d=Math.round((c.x+1)/2*b.width),e=Math.round((1-c.y)/2*b.height);this.container.style.left=d+"px",this.container.style.top=e-70+"px"},a.HyperlinkPanel=c;var d=function(a,c,d){var e=this;this.viewer=c,this.container=document.createElement("div"),this.container.classList.add("docking-panel-primary-button"),this.container.classList.add("hyperlink-back"),c.container.appendChild(this.container),this.backButton=document.createElement("div"),this.backButton.className="hyperlink-back-button",this.backButton.setAttribute("data-i18n","Back"),this.backButton.textContent=b.i18n.translate("Back"),this.container.appendChild(this.backButton),this.backButton.addEventListener("click",function(){e.uninitialize(),c.HyperlinkBack=null,a.panel&&(a.panel.uninitialize(),a.panel=null),a.navigateToLink(null,d)}),this.closer=document.createElement("div"),this.closer.classList.add("docking-panel-close"),this.closer.classList.add("hyperlink-back-closer"),this.container.appendChild(this.closer),this.closer.addEventListener("click",function(){e.uninitialize(),c.HyperlinkBack=null})};d.prototype.uninitialize=function(){this.viewer.container.removeChild(this.container),this.container=null},a.HyperlinkBack=d}();