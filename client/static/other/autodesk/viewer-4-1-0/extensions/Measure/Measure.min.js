!function(){"use strict";function a(a,c){b(a,c),a.viewer.toolbar?a.createUI():(a.bindedOnToolbarCreated=a.onToolbarCreated.bind(a),a.viewer.addEventListener(d.TOOLBAR_CREATED_EVENT,a.bindedOnToolbarCreated))}function b(a,b){a.sharedMeasureConfig.units=b.getDisplayUnit(),a.sharedMeasureConfig.precision=b.is2d()?3:1,a.sharedMeasureConfig.calibrationFactor=a.options.calibrationFactor}var c=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),d=Autodesk.Viewing,e=d.UI,f=Autodesk.Viewing.MeasureCommon,g=f.MeasurementTypes.MEASUREMENT_DISTANCE,h=function(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.modes=["distance","angle","area","calibrate"],this.name="measure"};h.prototype=Object.create(Autodesk.Viewing.Extension.prototype),h.prototype.constructor=h,h.prototype.onToolbarCreated=function(){this.viewer.removeEventListener(d.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null,this.createUI()},h.prototype.load=function(){var b=this,e=this.viewer;if(this.hasUI=Autodesk.Viewing.Private.GuiViewer3D&&e instanceof Autodesk.Viewing.Private.GuiViewer3D,this.escapeHotkeyId="Autodesk.Measure.Hotkeys.Escape",!e.toolController)return!1;this.options=this.options||{};var g={};return g.onCloseCallback=function(){b.enableMeasureTool(!1)},this.sharedMeasureConfig={units:null,precision:null,calibrationFactor:null},g.snapperOptions=this.options.snapperOptions,this.forceCalibrate=this.options.forceCalibrate,this.isCalibrated=null!=this.options.calibrationFactor,this.snapper=new f.Snapper(e),e.toolController.registerTool(this.snapper),this.measureTool=new c.MeasureTool(e,g,this.sharedMeasureConfig,this.snapper),e.toolController.registerTool(this.measureTool),this.calibrationTool=new Autodesk.Viewing.Extensions.Measure.CalibrationTool(e,this.options,this.sharedMeasureConfig,this.snapper),e.toolController.registerTool(this.calibrationTool),this.magnifyingGlass=new Autodesk.Viewing.Extensions.Measure.MagnifyingGlass(e),e.toolController.registerTool(this.magnifyingGlass),this.onFinishedCalibration=function(){b.measureToolbar&&b.measureToolbar.updateSettingsPanel(),b.activateInitiator&&b.activateInitiator()},e.addEventListener("finished-calibration",this.onFinishedCalibration),this.onMeasurementChanged=function(a){var c=a.data;b.changeMeasurementType(c)},e.addEventListener(f.Events.MEASUREMENT_CHANGED_EVENT,this.onMeasurementChanged),e.model?a(this,e.model):e.addEventListener(d.MODEL_ROOT_LOADED_EVENT,function(c){a(b,c.model)},{once:!0}),!0},h.prototype.unload=function(){var a=this.viewer;return this.destroyUI(),this.bindedOnToolbarCreated&&(this.viewer.removeEventListener(d.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null),a.removeEventListener("finished-calibration",this.onFinishedCalibration),a.removeEventListener(f.Events.MEASUREMENT_CHANGED_EVENT,this.onMeasurementChanged),a.toolController.deregisterTool(this.snapper),this.snapper=null,a.toolController.deregisterTool(this.measureTool),this.measureTool=null,a.toolController.deregisterTool(this.calibrationTool),this.calibrationTool=null,a.toolController.deregisterTool(this.magnifyingGlass),this.magnifyingGlass=null,!0},h.prototype.setActive=function(a){return this.enableMeasureTool(a)},h.prototype.toggle=function(){return this.isActive()?this.enableMeasureTool(!1):this.enableMeasureTool(!0),this.isActive()},h.prototype.getMeasurement=function(a,b){var c=null;return this.measureTool.isActive()&&(c=this.measureTool.getMeasurement(a,b)),c},h.prototype.getUnitOptions=function(){return[{name:"Unknown",type:""},{name:"Decimal feet",type:"decimal-ft"},{name:"Feet and fractional inches",type:"ft"},{name:"Feet and decimal inches",type:"ft-and-decimal-in"},{name:"Decimal inches",type:"decimal-in"},{name:"Fractional inches",type:"fractional-in"},{name:"Meters",type:"m"},{name:"Centimeters",type:"cm"},{name:"Millimeters",type:"mm"},{name:"Meters and centimeters",type:"m-and-cm"}]},h.prototype.getPrecisionOptions=function(a){return a?["1","1/2","1/4","1/8","1/16","1/32","1/64"]:["0","0.1","0.01","0.001","0.0001","0.00001"]},h.prototype.getDefaultUnit=function(){return this.viewer.model.getDisplayUnit()},h.prototype.openCalibrationRequiredDialog=function(a){this.hasUI?(this.CalibrationRequiredDialog||(this.CalibrationRequiredDialog=new Autodesk.Viewing.Extensions.Measure.CalibrationRequiredDialog(this,this.viewer,"calibration-required","Calibration Required",this.options)),this.CalibrationRequiredDialog.setVisible(!0)):this.viewer.dispatchEvent({type:c.CALIBRATION_REQUIRED_EVENT}),"measure"===a?this.activateInitiator=function(){this.enableMeasureTool(!0,g),this.activateInitiator=null}:"dimension"===a&&(this.activateInitiator=function(){this.viewer.dispatchEvent({type:Autodesk.Viewing.Extensions.Markups.Core.FINISHED_CALIBRATION_FOR_DIMENSION_EVENT}),this.activateInitiator=null})},h.prototype.activate=function(a){if(!this.activeStatus||this.mode!==a){switch(this.enterMeasurementMode(),a){default:case"distance":this.enableMeasureTool(!0,f.MeasurementTypes.MEASUREMENT_DISTANCE),this.mode="distance";break;case"angle":this.enableMeasureTool(!0,f.MeasurementTypes.MEASUREMENT_ANGLE),this.mode="angle";break;case"area":this.viewer.model.is2d()?(this.enableMeasureTool(!0,f.MeasurementTypes.MEASUREMENT_AREA),this.mode="area"):console.warn("Area mode is applicable on 3D models only");break;case"calibrate":this.enableCalibrationTool(!0),this.mode="calibrate"}return this.activeStatus=!0,!0}},h.prototype.deactivate=function(){return this.activeStatus&&(this.exitMeasurementMode(),this.activeStatus=!1),!0},h.prototype.enableMeasureTool=function(a,b){if(b===f.MeasurementTypes.MEASUREMENT_AREA&&this.viewer.model&&!this.viewer.model.is2d())return!1;var d=this.viewer.toolController,e=1===this.selectedTool;return!this.viewer.model||!a&&e?(this.measureTool.isActive()&&(d.deactivateTool("measure"),this.measureToolbar&&this.measureToolbar.deactivateAllButtons()),this.selectedTool=0,!0):(this.forceCalibrate|=this.viewer.model.getData().isLeaflet,b||(b=g),a&&!e?(this.checkAndFetchTopology(d.getTool("measure")),!this.forceCalibrate||this.forceCalibrate&&this.calibrationTool.isCalibrated()||b===f.MeasurementTypes.MEASUREMENT_ANGLE?(this.calibrationTool.isActive()&&d.deactivateTool("calibration"),this.measureToolbar&&this.measureToolbar.updateSettingsPanel(),d.activateTool("measure"),this.selectedTool=1,this.changeMeasurementType(b),!0):(this.viewer.addEventListener(c.OPEN_TOOL_AFTER_CALIBRAION,function(){this.enableMeasureTool(!0)}.bind(this),{once:!0}),this.openCalibrationRequiredDialog("measure"),!1)):!(!a||!e)&&(!this.forceCalibrate||this.forceCalibrate&&this.calibrationTool.isCalibrated()||b===f.MeasurementTypes.MEASUREMENT_ANGLE?(this.changeMeasurementType(b),!0):(this.openCalibrationRequiredDialog("measure"),!1)))},h.prototype.changeMeasurementType=function(a){this.measureTool.changeMeasurementType(a),this.measureToolbar&&(this.measureToolbar.deactivateAllButtons(),this.measureToolbar.activateButtonByType(a))},h.prototype.enableCalibrationTool=function(a){var b=this.viewer.toolController,c=2==this.selectedTool;return a&&!c?(this.measureTool.isActive()&&b.deactivateTool("measure"),b.activateTool("calibration"),this.viewer.dispatchEvent({type:f.Events.UNITS_CALIBRATION_STARTS_EVENT}),this.measureToolbar&&(this.measureToolbar.deactivateAllButtons(),this.measureToolbar.activateButtonByType(f.MeasurementTypes.CALIBRATION)),this.selectedTool=2,!0):!(a||!c)&&(this.calibrationTool.isActive()&&(this.mode="",b.deactivateTool("calibration"),this.measureToolbar&&this.measureToolbar.deactivateAllButtons()),this.selectedTool=0,!0)},h.prototype.enterMeasurementMode=function(){if(!this._measurementMode){this._measurementMode=!0;for(var a=this.viewer.getToolbar(!1),b=a.container,c=b.children.length,e=0;e<c;++e)b.children[e].style.display="none";this.navigationControls=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),this.navigationControls.setVisible(!0),this.navigationControls.container.style.display="",this.measureControls=a.getControl(Autodesk.Viewing.TOOLBAR.MEASURETOOLSID),this.measureControls.setVisible(!0),this.measureControls.container.style.display="";var f=a.getControl(d.TOOLBAR.MODELTOOLSID),h=this.measurementToolbarButton.getId();this.measurementToolbarButton.index=f.indexOf(h),f.removeControl(h),this.measureToolbar.toggleVisible(),this.viewer.centerToolBar&&this.viewer.centerToolBar(),this.enableMeasureTool(!0,g)}},h.prototype.exitMeasurementMode=function(){this._measurementMode&&(this.measureToolbar.closeToolbar(),this._measurementMode=!1)},h.prototype.createUI=function(){var a=this,b=this.viewer,c=b.getToolbar(!0),f=c.getControl(d.TOOLBAR.MODELTOOLSID);this.measurementToolbarButton=new e.Button("toolbar-measurementSubmenuTool"),this.measurementToolbarButton.setToolTip("Measure"),this.measurementToolbarButton.setIcon("adsk-icon-measure"),f.measurementToolbarButton=this.measurementToolbarButton,f.addControl(this.measurementToolbarButton,{index:0}),this.measureToolbar=new Autodesk.Viewing.Extensions.Measure.MeasureToolbar(this),this.measureToolbar.init(),this.measurementToolbarButton.onClick=this.activate.bind(this);var g=[{keycodes:[d.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){if(a._measurementMode)return a.exitMeasurementMode(),!0}}];d.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,g),this.uiCreated=!0},h.prototype.checkAndFetchTopology=function(a){return this.uiCreated&&this.viewer.model.is3d()?this.viewer.modelHasTopology()?void(a&&a.setTopologyAvailable()):(a&&a.setFetchingTopology(),void this.viewer.model.fetchTopology().then(function(b){a&&a.setTopologyAvailable()}).catch(function(b){avp.logger.log(b),a&&a.setNoTopology()})):void(a&&a.setNoTopology())},h.prototype.destroyUI=function(){var a=this.viewer,b=a&&a.getToolbar&&a.getToolbar(!1);if(b){var c=b.getControl(d.TOOLBAR.MODELTOOLSID);if(c){var e=null;this.measurementToolbarButton&&(e=c.getControl("toolbar-inspectSubMenu"),e?e.removeControl(this.measurementToolbarButton.getId()):c.removeControl(this.measurementToolbarButton.getId())),this.measurementToolbarButton=null}}d.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},h.prototype.setUnits=function(a){this.measureTool.setUnits(a)},h.prototype.getUnits=function(){return this.measureTool.getUnits()},h.prototype.setPrecision=function(a){this.measureTool.setPrecision(a)},h.prototype.getPrecision=function(){return this.measureTool.getPrecision()},h.prototype.calibrate=function(a,b){this.calibrationTool.calibrate(a,b)},h.prototype.calibrateByScale=function(a,b){this.calibrationTool.calibrateByScale(a,b)},h.prototype.isCalibrationValid=function(a,b){return this.calibrationTool.isCalibrationValid(a,b)},h.prototype.getCalibrationFactor=function(){return this.calibrationTool.getCalibrationFactor()},h.prototype.showAddCalibrationLabel=function(){this.calibrationTool.showAddCalibrationLabel()},h.prototype.deleteCurrentMeasurement=function(){this.measureTool.deleteCurrentMeasurement()},c.MeasureExtension=h,d.theExtensionManager.registerExtension("Autodesk.Measure",h)}(),function(){"use strict";function a(a){this.viewer=a,this.init()}var b=(Autodesk.Viewing,Autodesk.Viewing.Extensions.Measure,Autodesk.Viewing.MeasureCommon),c=a.prototype;c.getCurrentMeasurement=function(){return this.currentMeasurement},c.selectMeasurementById=function(a){var b=this.measurementsList[a];return!!b&&(this.changeCurrentMeasurement(b),this.currentMeasurement)},c.createMeasurement=function(a){var c=this.measurementsCounter,d=new b.Measurement(a,c);return this.measurementsList[c]=d,this.measurementsCounter++,this.changeCurrentMeasurement(d),this.currentMeasurement},c.changeCurrentMeasurement=function(a){this.currentMeasurement=a,this.viewer.dispatchEvent({type:b.Events.MEASUREMENT_CHANGED_EVENT,data:a.measurementType})},c.removeCurrentMeasurement=function(){Object.keys(this.measurementsList).length>0&&delete this.measurementsList[this.currentMeasurement.id]},c.init=function(){this.reset()},c.destroy=function(){this.reset()},c.reset=function(){this.currentMeasurement=null,this.measurementsList={},this.measurementsCounter=0},Autodesk.Viewing.Extensions.Measure.MeasurementsManager=a}(),function(){"use strict";var a=Autodesk.Viewing,b=a.MeasureCommon;Autodesk.Viewing.Extensions.Measure.Indicator=function(a,b,c){this.viewer=a,this.measurement=b,this.tool=c,this.snapper=c.getSnapper(),this.materialExtensionLine=null,this.materialExtensionFace=null,this.extensionLines=[],this.extensionFaces=[],this.grayOutPlane=[],this.materialPoint=null,this.materialLine=null,this.materialAngle=null,this.materialAngleOutline=null,this.materialGreyOutPlane=null,this.materialFace=null,this.angleArc=null,this.angleOutline=[],this.showMeasureResult=!1,this.visibleLabels=[],this.overlayName="measure-indicator-overlay-"+(b.id||""),this.xAxis=this.viewer.autocam.getWorldRightVector(),this.yAxis=this.viewer.autocam.getWorldUpVector(),this.zAxis=this.viewer.autocam.getWorldFrontVector()};var c=Autodesk.Viewing.Extensions.Measure.Indicator.prototype;c.init=function(){return!1},c.updateDistance=function(){return!1},c.updateAngle=function(){return!1},c.clear=function(){return!1},c.updateLabelsPosition=function(){return!1},c.render=function(a,b){this.showMeasureResult=b,this.clear();for(var c=1;c<=Object.keys(a).length;c++)this.measurement.hasPick(c)&&this.renderPick(c);this.renderRubberband(a),this.updateLabelsPosition()},c.changeEndpointOnEditStyle=function(a,b){return!1},c.handleResize=function(){return!1},c.setNoTopology=function(){return!1},c.setFetchingTopology=function(){return!1},c.setTopologyAvailable=function(){return!1},c.clientToCanvasCoords=function(a){var b=this.viewer.impl.getCanvasBoundingClientRect(),c={};return a.hasOwnProperty("center")?(a.canvasX=c.x=a.center.x-b.left,a.canvasY=c.y=a.center.y-b.top):(a.canvasX=c.x=a.pointers[0].clientX-b.left,a.canvasY=c.y=a.pointers[0].clientY-b.top),c},c.initLabelMobileGestures=function(b,c){var d=this.viewer.toolController.getTool("magnifyingGlass");this.hammer=new Hammer.Manager(b,{recognizers:[a.GestureRecognizers.drag,a.GestureRecognizers.singletap],inputClass:a.isIE11?Hammer.PointerEventInput:Hammer.TouchInput}),this.onSingleTapBinded=function(a){var b=this.clientToCanvasCoords(a);this.snapper.onMouseDown(b),this.tool.editEndpoint(a,c,this.measurement.id)}.bind(this),this.onDragStartBinded=function(a){var b=this.clientToCanvasCoords(a);this.snapper.onMouseDown(b),this.tool.editEndpoint(a,c,this.measurement.id),this.tool.editByDrag=!0,a.type="press",d.handlePressHold(a),this.tool.handlePressHold(a),a.type="dragstart",d.handleGesture(a),this.tool.handleGesture(a)}.bind(this),this.onDragMoveBinded=function(a){var b=this.clientToCanvasCoords(a);this.snapper.onMouseDown(b),d.handleGesture(a),this.tool.handleGesture(a)}.bind(this),this.onDragEndBinded=function(a){var b=this.clientToCanvasCoords(a);this.snapper.onMouseDown(b),d.handleGesture(a),this.tool.handleGesture(a),a.type="pressup",d.handlePressHold(a),this.tool.handlePressHold(a),this.tool.handleButtonUp(a)}.bind(this),this.hammer.on("singletap",this.onSingleTapBinded),this.hammer.on("dragstart",this.onDragStartBinded),this.hammer.on("dragmove",this.onDragMoveBinded),this.hammer.on("dragend",this.onDragEndBinded)},c.clearLabelMobileGestures=function(){this.hammer&&(this.hammer.off("singletap",this.onSingleTapBinded),this.hammer.off("dragstart",this.onDragStartBinded),this.hammer.off("dragmove",this.onDragMoveBinded),this.hammer.off("dragend",this.onDragEndBinded),this.hammer=null)},c.updateVisibleLabelsArray=function(a,b){if(b)this.visibleLabels.indexOf(a)>-1||this.visibleLabels.push(a);else{var c=this.visibleLabels.indexOf(a);c>-1&&this.visibleLabels.splice(c,1)}},c.hideEndpoints=function(){for(var a in this.endpoints)if(this.endpoints.hasOwnProperty(a)){var b=this.endpoints[a];b.label&&this.hideLabel(b.label)}},c.showEndpoints=function(){for(var a in this.endpoints)if(this.endpoints.hasOwnProperty(a)){var b=this.endpoints[a];this.measurement.hasPick(a)&&b.label&&this.showLabel(b.label)}},c.hideLabel=function(a){a&&(b.safeToggle(a,"visible",!1),this.updateVisibleLabelsArray(a,!1))},c.showLabel=function(a){a&&(b.safeToggle(a,"visible",!0),this.updateVisibleLabelsArray(a,!0))},c.changeEndpointOnEditStyle=function(a,c){this.endpoints[a]&&this.endpoints[a].label&&b.safeToggle(this.endpoints[a].label,"on-edit",c)},c.changeEndpointEditableStyle=function(a,c){this.endpoints[a]&&this.endpoints[a].label&&b.safeToggle(this.endpoints[a].label,"editable",c)},c.changeAllEndpointsEditableStyle=function(a){for(var b in this.endpoints)this.endpoints.hasOwnProperty(b)&&this.changeEndpointEditableStyle(b,a)},c.changeAllEndpointsOnEditStyle=function(a){for(var b in this.endpoints)this.endpoints.hasOwnProperty(b)&&this.changeEndpointOnEditStyle(b,a)},c.hideLabelsOutsideOfView=function(){this.viewer.model&&!this.viewer.model.is2d()&&this.visibleLabels.forEach(function(a){var b=this.viewer.navigation.isPointVisible(a.point);(a.classList.contains("visible")&&!b||!a.classList.contains("visible")&&b)&&a.classList.toggle("visible",b)}.bind(this))},c.showClick=function(a){this.tool.getActivePointIndex()!==a&&this.showLabel(this.endpoints[a].label)},c.hideClick=function(a){this.endpoints[a]&&this.hideLabel(this.endpoints[a].label)},c.renderPick=function(a){this.endpoints[a]||this.createEndpoint(a),this.renderEndpointGeometry(a),this.showClick(a)},c.renderEndpointGeometry=function(a){var c=b.getSnapResultPosition(this.measurement.getPick(a),this.viewer);this.endpoints[a].position=c.clone()},c.drawEdgeAsCylinder=function(a,b,c,d,e){var f,g=[];if(1==d)for(var h=0;h<a.vertices.length;h+=2)f=this.cylinderMesh(a.vertices[h],a.vertices[h+1],b,c,e),this.setCylinderScale(f,a.vertices[h],a.vertices[h+1]),g.push(f);else for(var h=0;h<a.vertices.length-1;h++)f=this.cylinderMesh(a.vertices[h],a.vertices[h+1],b,c,e),this.setCylinderScale(f,a.vertices[h],a.vertices[h+1]),g.push(f);return g},c.drawDashedLine=function(a,b,c,d,e,f,g){for(var h=new THREE.Geometry,i=(new THREE.Vector3).subVectors(b,a),j=i.length()-d,k=i.normalize(),l=0,m=a.clone(),n=0;n<j;){var o=this.viewer.navigation.isPointVisible(m);o&&(h.vertices[l]=m.clone(),l++),m.addVectors(m,k.clone().multiplyScalar(c)),o&&(h.vertices[l]=m.clone(),l++),m.addVectors(m,k.clone().multiplyScalar(d)),n+=c+d}return i=this.drawEdgeAsCylinder(h,e,f,1,this.getNewCylinderGeometry()),this.viewer.impl.addMultipleOverlays(g,i),i},c.drawLineAsCylinder=function(a,b,c,d){var e;return 2==a.vertices.length&&(e=this.cylinderMesh(a.vertices[0],a.vertices[1],b,c,this.getNewCylinderGeometry()),this.setCylinderScale(e,a.vertices[0],a.vertices[1]),this.viewer.impl.addOverlay(d,e)),e},c.getNewCylinderGeometry=function(){return new THREE.CylinderGeometry(.1,.1,1,8,1,!0)},c.cylinderMesh=function(a,b,c,d,e){var f=(new THREE.Vector3).subVectors(b,a),g=new THREE.Matrix4;g.lookAt(a,b,(new THREE.Object3D).up),g.multiply((new THREE.Matrix4).set(d,0,0,0,0,0,d,0,0,-f.length(),0,0,0,0,0,1));var h=new THREE.Mesh(e,c);return h.applyMatrix(g),h.lmv_line_width=d,h.position.x=(b.x+a.x)/2,h.position.y=(b.y+a.y)/2,h.position.z=(b.z+a.z)/2,h},c.setCylinderScale=function(a,c,d){var e;if(c&&d){var f=b.nearestPointInPointToSegment(this.viewer.navigation.getPosition(),c,d);e=this.setScale(f)}else e=this.setScale(a.position);a.hasOwnProperty("lmv_line_width")&&(e*=a.lmv_line_width),a.scale.x=e,a.scale.z=e},c.setScale=function(a){var b=this.viewer.navigation,c=b.getCamera(),d=b.getPosition(),e=a.clone(),f=c.isPerspective?e.sub(d).length():b.getEyeVector().length(),g=b.getVerticalFov();return 2*f*Math.tan(THREE.Math.degToRad(.5*g))*5/b.getScreenViewport().height},c.alignLabelWithLine=function(a,b,c,d,e){var f=e.navigation.getCameraUpVector(),g=new THREE.Vector3(0,1,0),h=180*g.angleTo(f)/Math.PI;h=f.x>=0?h:-h;var i=null,j=b.x-c.x,k=b.y-c.y;i=b.x<c.x?180*Math.atan2(-k,-j)/Math.PI:180*Math.atan2(k,j)/Math.PI,i=-(i+h),Math.abs(i)>90&&(i+=180),a.style.transform="rotate("+i+"deg) translate(0px, "+d+"px)"},c.destroy=function(){this.materialPoint=null,this.materialFace=null,this.materialLine=null,this.materialAngle=null,a.isMobileDevice()&&this.clearLabelMobileGestures();for(var b in this.endpoints)if(this.endpoints.hasOwnProperty(b)){var c=this.endpoints[b];c.label&&(c.label.removeEventListener("mousewheel",this.viewer.toolController.mousewheel),c.label.parentNode.removeChild(c.label),c.label=null)}this.visibleLabels=[]},c.renderRubberband=function(a){switch(this.measurement.measurementType){case b.MeasurementTypes.MEASUREMENT_DISTANCE:var c=a[1],d=a[2],e=b.getSnapResultPosition(c,this.viewer),f=b.getSnapResultPosition(d,this.viewer);e&&f&&this.renderDistanceMeasurement(e,f);break;case b.MeasurementTypes.MEASUREMENT_ANGLE:this.renderAngleMeasurement(a);break;case b.MeasurementTypes.MEASUREMENT_AREA:this.renderAreaMeasurement(a)}}}(),function(){"use strict";function a(a,c,d){p.Indicator.call(this,a,c,d),this.measureTool=d,this.endpoints=[],this.lines={xyz:{axis:!1,material:b("005BCE"),className:"adsk-icon-axis-delta-xyz measure-label-axis-delta measure-label-axis-xyz"},x:{axis:!0,material:b("F12C2C"),className:"adsk-icon-axis-delta-x measure-label-axis-delta measure-label-axis-x",iconText:"X"},y:{axis:!0,material:b("0BB80B"),className:"adsk-icon-axis-delta-y measure-label-axis-delta measure-label-axis-y",iconText:"Y"},z:{axis:!0,material:b("2C2CF1"),className:"adsk-icon-axis-delta-z measure-label-axis-delta measure-label-axis-z",iconText:"Z"}},this.segments=[],this.dashedLine={},this.simple=!1,this.angleLabel={},this.areaLabel={},this.labels=[],this.isLeaflet=!1,this.topologyStatus=s,this.tmpVector=new THREE.Vector3,this.surfaceColor=new THREE.MeshBasicMaterial({color:parseInt("005BCE",16),opacity:.15,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})}function b(a){return new THREE.MeshBasicMaterial({color:parseInt(a,16),depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})}function c(a){return a.classList.contains("visible")}function d(a,b){return a.right>=b.left&&a.right<=b.right}function e(a,b){return a.left>=b.left&&a.left<=b.right}function f(a,b){return a.left<=b.left&&a.right>=b.right}function g(a,b){return a.top<b.bottom&&a.bottom>b.top}function h(a,b,c){a.style.left=parseInt(a.style.left,10)-(b.right-c.left)+"px"}function i(a,b,c){a.style.left=parseInt(a.style.left,10)+(c.right-b.left)+"px"}function j(a,b,c){a.style.top=parseInt(a.style.top,10)+(c.bottom-b.top)+"px"}function k(a,b){var c=a.querySelector(".measure-length-text");c&&(c.style.display=b?"":"none")}function l(a,b){if(a){var c=a.querySelector(".measure-length-text");c&&(c.textContent=b)}}function m(a,b){if(a){var c=a.querySelector(".measure-delta-text");c&&(c.textContent=b)}}function n(a,b,c){if(a){var d=a.querySelector(".measure-fetching-topology");d&&(d.style.display=b&&c===t?"inline-block":"none")}}var o=Autodesk.Viewing,p=Autodesk.Viewing.Extensions.Measure,q=Autodesk.Viewing.MeasureCommon;a.prototype=Object.create(p.Indicator.prototype),a.prototype.constructor=a;var r=a.prototype,s=0,t=1,u=2;r.init=function(){this.isLeaflet=this.viewer.model.getData().isLeaflet;var a;switch(this.onSelectionAreaClickedBinded=this.onSelectionAreaClicked.bind(this),this.lines.xyz.label||(a=this.lines.xyz.label=this.createMeasurementLabel(),a.addEventListener("mousewheel",this.viewer.toolController.mousewheel),a.addEventListener("click",this.onSelectionAreaClickedBinded),this.viewer.container.appendChild(a)),this.topologyStatus){case t:this.setFetchingTopology();break;case 2:this.setTopologyAvailable();break;case s:this.setNoTopology()}this.showMeasureResult=!1,this.onCameraChangeBinded=this.onCameraChange.bind(this),this.viewer.addEventListener(o.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),this.handleButtonUpBinded=this.measureTool.handleButtonUp.bind(this.measureTool),window.addEventListener("mouseup",this.handleButtonUpBinded)},r.createEndpoint=function(a){this.endpoints[a]={};var b=this.endpoints[a].label=this.createSnapResultLabel(a);this.viewer.container.appendChild(b)},r.updateLabelsPosition=function(){var a,b,d,e;for(e in this.endpoints)this.endpoints.hasOwnProperty(e)&&(d=this.endpoints[e].label,a=this.endpoints[e].position,d&&a&&c(d)&&(b=q.project(a,this.viewer),b.x=b.x-d.getBoundingClientRect().width/2,b.y=b.y-d.getBoundingClientRect().height/2,d.style.top=b.y+"px",d.style.left=b.x+"px",d.point=a,this.labels.push(d)));for(var f in this.lines)if(this.lines.hasOwnProperty(f)){var g=this.lines[f];if((d=g.label)&&g.p1&&g.p2&&c(d)){if(g.line.visible=g.visible,a={x:(g.p1.x+g.p2.x)/2,y:(g.p1.y+g.p2.y)/2,z:(g.p1.z+g.p2.z)/2},b=q.project(a,this.viewer),d.style.top=b.y-Math.floor(d.clientHeight/2)+"px",d.style.left=b.x-Math.floor(d.clientWidth/2)+"px",this.viewer.model&&this.viewer.model.is2d()){var h=g===this.lines.xyz?0:d.clientHeight,i=q.project(g.p1,this.viewer),j=q.project(g.p2,this.viewer);if(d.clientWidth>=i.distanceTo(j)-this.endpoints[1].label.clientWidth){if(g!==this.lines.xyz){this.lines.x.line.visible=!1,this.lines.y.line.visible=!1,this.viewer.impl.invalidate(!1,!1,!0);for(f in this.lines)if(this.lines.hasOwnProperty(f)&&this.lines[f]!==this.lines.xyz){var k=this.lines[f].label;k&&(k.style.opacity=0)}break}h=d.clientHeight}if(g!==this.lines.xyz){var l=new THREE.Vector3,m=new THREE.Vector3;l.subVectors(this.lines.xyz.p1,this.lines.xyz.p2).normalize(),m.subVectors(g.p1,g.p2).normalize();var n=l.cross(this.viewer.navigation.getEyeVector()).normalize(),o=n.dot(m);o<0&&(h=-h)}this.alignLabelWithLine(d,g.p1,g.p2,h,this.viewer)}d.style.opacity=1,d.point=a,this.labels.push(d)}}if(this.angleLabel&&(d=this.angleLabel.label)&&this.angleLabel.p1&&this.angleLabel.p2&&c(d)&&(a={x:(this.angleLabel.p1.x+this.angleLabel.p2.x)/2,y:(this.angleLabel.p1.y+this.angleLabel.p2.y)/2,z:(this.angleLabel.p1.z+this.angleLabel.p2.z)/2},b=q.project(a,this.viewer,5),d.style.top=b.y-Math.floor(d.clientHeight/2)+"px",d.style.left=b.x-Math.floor(d.clientWidth/2)+"px",d.point=a,this.labels.push(d)),this.areaLabel&&(d=this.areaLabel.label)&&this.areaLabel.p1&&this.areaLabel.p2&&c(d)&&(a={x:(this.areaLabel.p1.x+this.areaLabel.p2.x)/2,y:(this.areaLabel.p1.y+this.areaLabel.p2.y)/2,z:(this.areaLabel.p1.z+this.areaLabel.p2.z)/2},b=q.project(a,this.viewer),d.style.top=b.y-Math.floor(d.clientHeight/2)+"px",d.style.left=b.x-Math.floor(d.clientWidth/2)+"px",d.point=a,this.labels.push(d)),this.viewer.model&&!this.viewer.model.is2d()){var p=!1;this.labelsStacked=!1;var r,s,t=[];for(s=0;s<this.labels.length;s++)t.push({left:this.labels[s].style.left,top:this.labels[s].style.top});for(s=0;s<this.labels.length&&!p;s++)r=this.labels[s],p=this.labelsOverlapDetection(r,this.labels);if(p){for(s=0;s<this.labels.length;s++)this.labels[s].style.left=t[s].left,this.labels[s].style.top=t[s].top;for(this.stackLabels(this.labels),s=0;s<this.labels.length;s++)r=this.labels[s],this.labelsOverlapDetection(r,this.labels)}}this.labels=[]},r.labelsOverlapDetection=function(a,b){for(var c=!1,k=0;k<b.length;k++){var l=b[k],m=!1;if(a!==l){var n=a.getBoundingClientRect(),o=l.getBoundingClientRect();if(g(o,n)&&(d(o,n)?(h(l,o,n),m=!0):e(o,n)?(i(l,o,n),m=!0):f(o,n)&&(j(l,o,n),m=!0),m)){var p=b.slice(0);p.splice(p.indexOf(a),1),this.labelsOverlapDetection(l,p),l.causeStacking&&a.causeStacking&&(c=!0),l.causeStacking&&this.labelsStacked&&this.stackLabels(this.labels)}}}return c},r.stackLabels=function(a){for(var b=this.lines.xyz.label,c=1;c<a.length;c++){if(a[c].causeStacking){a[c].style.left=b.style.left;var d=a[c-1].getBoundingClientRect(),e=a[c-1]==b?4:0,f=a[c]===b?b.style.top:a[c-1].style.top;a[c].style.top=parseInt(f,10)+d.height+e+"px"}a[c].style.transform=""}this.labelsStacked=!0},r.drawXYZLine=function(a){function b(b){g.vertices=[],f.addVectors(b,i.clone().multiplyScalar(u*k)),g.vertices[0]=f.clone(),f.subVectors(b,i.clone().multiplyScalar(u*k)),g.vertices[1]=f.clone();var h=c.drawLineAsCylinder(g,a.material,3,c.overlayName);c.setCylinderScale(h,d,e),h.visible=!0,a.tips.push(h)}var c=this,d=a.p1,e=a.p2;if(d&&e){var f=new THREE.Vector3,g=a.geometry=new THREE.Geometry,h=(new THREE.Vector3).subVectors(e,d).normalize(),i=h.clone().cross(c.viewer.navigation.getEyeVector()).normalize(),j=q.nearestPointInPointToSegment(c.viewer.navigation.getPosition(),d,e),k=c.setScale(j);a.line=this.drawLineSegment(d,e,4,a.material),a.visible=!0,this.segments.push(a),c.showMeasureResult&&(a.tips=[],b(d),b(e))}},r.redrawDashedLine=function(){if(this.dashedLine.p1&&this.dashedLine.p2){this.viewer.impl.removeMultipleOverlays(this.overlayName,this.dashedLine.line);var a=this.setScale(this.dashedLine.p2),b=2*a,c=1*a;return this.dashedLine.line=this.drawDashedLine(this.dashedLine.p2,this.dashedLine.p1,b,c,this.lines.xyz.material,3,this.overlayName),this.dashedLine.line}},r.drawLineSegment=function(a,b,c,d,e){var f;if(e)this.dashedLine.p1=a,this.dashedLine.p2=b,f=this.redrawDashedLine();else{var g=new THREE.Geometry;g.vertices.push(a),g.vertices.push(b),f=this.drawLineAsCylinder(g,d,c,this.overlayName),this.setCylinderScale(f,a,b)}return f.visible=!0,f},r.drawSurface=function(a){var b=new THREE.Shape;b.moveTo(a[0].x,a[0].y);for(var c=1;c<a.length;c++)b.lineTo(a[c].x,a[c].y);b.lineTo(a[0].x,a[0].y);var d=new THREE.ShapeGeometry(b),e=new THREE.Mesh(d,this.surfaceColor);this.viewer.impl.addOverlay(this.overlayName,e)},r.drawSegmentAndPush=function(a,b,c){if(a&&b){var d=this.drawLineSegment(a,b,4,this.lines.xyz.material,c);if(!c){var e={line:d,p1:a,p2:b};this.segments.push(e)}}},r.renderAreaMeasurement=function(a){for(var b,c,d=this.measurement.countPicks(),e=[],f=1;f<d;f++)b=q.getSnapResultPosition(a[f],this.viewer),c=q.getSnapResultPosition(a[f+1],this.viewer),this.drawSegmentAndPush(b,c),e.push(b);d>2&&(b=q.getSnapResultPosition(a[1],this.viewer),this.drawSegmentAndPush(b,c,!this.measurement.closedArea),q.isEqualVectors(b,c,q.EPSILON)||e.push(c),q.isPolygonSimple(e)&&0!==this.measurement.area&&(this.drawSurface(e),this.showAreaLabel(q.getPolygonVisualCenter(e)),this.updateArea()))},r.clearAngleMeshes=function(){this.angleArc&&(this.viewer.impl.removeOverlay(this.overlayName,this.angleArc),this.angleArc=null),this.angleOutline.length>0&&(this.viewer.impl.removeMultipleOverlays(this.overlayName,this.angleOutline),this.angleOutline.length=0)},r.drawAngle=function(a,b,c,d,e,f){this.materialAngle||(this.materialAngle=new THREE.MeshPhongMaterial({color:10066329,ambient:10066329,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),this.materialAngleOutline=new THREE.MeshBasicMaterial({color:16750848,depthTest:!1,depthWrite:!1})),q.createCommonOverlay(this.viewer,this.overlayName),this.clearAngleMeshes();var g=Math.min(a.distanceTo(b),a.distanceTo(c))/4,h=new THREE.CircleGeometry(g,100,0,e*Math.PI/180),i=new THREE.Mesh(h,this.surfaceColor),j=i.geometry.vertices[0].clone();i.geometry.vertices.push(j),i.position.set(a.x,a.y,a.z);var k=i.position.clone();k.add(d),i.lookAt(k),i.updateMatrixWorld();var l=i.geometry.vertices[1].clone(),m=i.geometry.vertices[i.geometry.vertices.length-2].clone();l.applyMatrix4(i.matrixWorld),m.applyMatrix4(i.matrixWorld);var n=new THREE.Vector3,o=new THREE.Vector3,p=new THREE.Vector3,r=new THREE.Vector3;n.subVectors(l,a),o.subVectors(m,a),p.subVectors(b,a),r.subVectors(c,a);var s,t=n.angleTo(p),u=n.angleTo(r),v=o.angleTo(p),w=o.angleTo(r);s=(t<=.001&&t>=-.001||u<=.001&&u>=-.001)&&(v<=.001&&v>=-.001||w<=.001&&w>=-.001)?0:(t<=Math.PI+.001&&t>=Math.PI-.001||u<=Math.PI+.001&&u>=Math.PI-.001)&&(v<=Math.PI+.001&&v>=Math.PI-.001||w<=Math.PI+.001&&w>=Math.PI-.001)?Math.PI:t<=v+.001&&t>=v-.001||t<=w+.001&&t>=w-.001?t:u;var x=new THREE.Matrix4;x.makeRotationAxis(d,s),x.multiply(i.matrix),i.matrix=x,i.rotation.setFromRotationMatrix(i.matrix),i.updateMatrixWorld(),l=i.geometry.vertices[1].clone(),m=i.geometry.vertices[i.geometry.vertices.length-2].clone(),l.applyMatrix4(i.matrixWorld),m.applyMatrix4(i.matrixWorld),n.subVectors(l,a),o.subVectors(m,a),t=n.angleTo(p),u=n.angleTo(r),v=o.angleTo(p),w=o.angleTo(r),t>=.001&&u>=.001&&(x=new THREE.Matrix4,x.makeRotationAxis(d,2*-s),
x.multiply(i.matrix),i.matrix=x,i.rotation.setFromRotationMatrix(i.matrix));var y=new THREE.CircleGeometry(g,100,0,e*Math.PI/180);y.vertices.splice(0,1),i.updateMatrixWorld(),y.applyMatrix(i.matrixWorld),this.angleOutline=this.drawEdgeAsCylinder(y,this.lines.xyz.material,2,0,this.getNewCylinderGeometry()),this.angleArc=i,this.viewer.impl.addOverlay(this.overlayName,this.angleArc),this.viewer.impl.addMultipleOverlays(this.overlayName,this.angleOutline),f.copy(i.geometry.vertices[Math.round(i.geometry.vertices.length/2)-1]),f.applyMatrix4(i.matrixWorld);var z=new THREE.Vector3;z.subVectors(f,a).normalize(),z.multiplyScalar(g/2),f.add(z)},r.renderAngleMeasurement=function(a){for(var b,c,d=this.measurement.countPicks(),e=[],f=1;f<d;f++)b=q.getSnapResultPosition(a[f],this.viewer),c=q.getSnapResultPosition(a[f+1],this.viewer),this.drawSegmentAndPush(b,c),b&&e.push(b);if(c&&e.push(c),3===e.length&&this.measurement.angle){var g=new THREE.Vector3,h=new THREE.Vector3,i=new THREE.Vector3;h.subVectors(e[0],e[1]),i.subVectors(e[1],e[2]),g.crossVectors(h,i),g.normalize();var j=new THREE.Vector3;this.drawAngle(e[1],e[0],e[2],g,this.measurement.angle,j),this.showAngleLabel(j),this.updateAngle()}},r.createDistanceLabel=function(a){var b=a.label=this.createMeasurementLabel();if(k(b,a===this.lines.xyz),a.axis){b.className=a.className;var c=document.createElement("div");c.className="measure-label-axis-icon "+a.iconText,c.innerText=a.iconText,b.insertBefore(c,b.firstChild),o.isMobileDevice()||q.safeToggle(b,"enableTransition",!0)}return this.viewer.container.appendChild(b),b},r.renderDistanceMeasurement=function(a,b){function c(a,b,c,e,f,g,h,i){var j,k=a.line,l=a.label,m=new THREE.Vector3(b,c,e),n=new THREE.Vector3(f,g,h);if(a===d.lines.x&&n.x>m.x?(j=m.clone(),m=n.clone(),n=j.clone()):a===d.lines.y&&n.y>m.y?(j=m.clone(),m=n.clone(),n=j.clone()):a===d.lines.z&&n.z>m.z&&(j=m.clone(),m=n.clone(),n=j.clone()),a.line=null,l?d.hideLabel(l):l=d.createDistanceLabel(a),(d.isLeaflet&&a!==d.lines.z||m.distanceTo(n)>=q.EPSILON)&&i)if(a.p1=m,a.p2=n,a===d.lines.xyz)d.drawXYZLine(a),d.showLabel(l),d.updateDistance();else{k=a.line=d.drawLineSegment(m,n,2,a.material);var o=!d.simple&&d.showMeasureResult;k.visible=o,a.visible=o,o?d.showLabel(l):d.hideLabel(l)}}var d=this;c(this.lines.xyz,a.x,a.y,a.z,b.x,b.y,b.z,!0);var e=this.viewer.navigation.getAlignedUpVector(),f=Math.abs(e.x),g=Math.abs(e.y),h=Math.abs(e.z),i=function(a,b){return d.tmpVector.subVectors(a,b),d.tmpVector.normalize(),!q.isParallel(d.tmpVector,d.xAxis)&&!q.isParallel(d.tmpVector,d.yAxis)&&!q.isParallel(d.tmpVector,d.zAxis)}(a,b);h>f&&h>g?(c(this.lines.x,a.x,a.y,a.z,b.x,a.y,a.z,i),c(this.lines.y,b.x,a.y,a.z,b.x,b.y,a.z,i),c(this.lines.z,b.x,b.y,a.z,b.x,b.y,b.z,i)):g>f&&g>h?(c(this.lines.x,a.x,a.y,a.z,b.x,a.y,a.z,i),c(this.lines.z,b.x,a.y,a.z,b.x,a.y,b.z,i),c(this.lines.y,b.x,a.y,b.z,b.x,b.y,b.z,i)):(c(this.lines.y,a.x,a.y,a.z,a.x,b.y,a.z,i),c(this.lines.z,a.x,b.y,a.z,a.x,b.y,b.z,i),c(this.lines.x,a.x,b.y,b.z,b.x,b.y,b.z,i))},r.updateResults=function(){this.updateDistance(),this.updateAngle(),this.updateArea(),setTimeout(function(){this.updateLabelsPosition()}.bind(this),0)},r.updateDistance=function(){function a(a,b){a&&(a.style.width=b)}function b(a){return a?a.clientWidth:0}Object.keys(this.lines).forEach(function(b){a(this.lines[b].label,"")}.bind(this)),m(this.lines.x.label,"~ "+this.measureTool.getDistanceX(this.measurement)),m(this.lines.y.label,"~ "+this.measureTool.getDistanceY(this.measurement)),m(this.lines.z.label,"~ "+this.measureTool.getDistanceZ(this.measurement)),l(this.lines.xyz.label,"~ "+this.measureTool.getDistanceXYZ(this.measurement)),this.viewer.model&&this.viewer.model.is3d()&&setTimeout(function(){var c=Math.max(b(this.lines.x.label),b(this.lines.y.label),b(this.lines.z.label),b(this.lines.xyz.label));Object.keys(this.lines).forEach(function(b){a(this.lines[b].label,c+"px")}.bind(this))}.bind(this),0)},r.updateAngle=function(){l(this.angleLabel.label,"~ "+this.measureTool.getAngle(this.measurement))},r.updateArea=function(){l(this.areaLabel.label,"~ "+this.measureTool.getArea(this.measurement))},r.setSimple=function(a){if(this.simple!=a){this.simple=a;var b=!a;this.setLineVisible(this.lines.x,b),this.setLineVisible(this.lines.y,b),this.setLineVisible(this.lines.z,b),this.updateLabelsPosition(),this.viewer.impl.invalidate(!1,!1,!0)}},r.setLineVisible=function(a,b){a.line&&(a.line.visible=b,a.visible=b,a.label&&(b?this.showLabel(a.label):(this.hideLabel(a.label),a.label.style.opacity=0)))},r.enableLabelsTouchEvents=function(a){var b=a?"all":"none";this.lines.xyz.label&&(this.lines.xyz.label.style.pointerEvents=b),this.angleLabel.label&&(this.angleLabel.label.style.pointerEvents=b),this.areaLabel.label&&(this.areaLabel.label.style.pointerEvents=b)},r.setLabelsZIndex=function(a){for(var b in this.lines)if(this.lines.hasOwnProperty(b)){var c=this.lines[b];c.label&&(c.label.style.zIndex=a)}this.angleLabel&&this.angleLabel.label&&(this.angleLabel.label.style.zIndex=a),this.areaLabel&&this.areaLabel.label&&(this.areaLabel.label.style.zIndex=a);for(b in this.endpoints)if(this.endpoints.hasOwnProperty(b)){var d=this.endpoints[b];d.label&&(d.label.style.zIndex=a-1)}},r.focusLabels=function(){this.setLabelsZIndex(3)},r.unfocusLabels=function(){this.setLabelsZIndex(2)},r.clear=function(){var a;for(a in this.endpoints)if(this.endpoints.hasOwnProperty(a)){var b=this.endpoints[a];b.label&&this.hideLabel(b.label)}for(a in this.lines)if(this.lines.hasOwnProperty(a)){var c=this.lines[a];c.line&&(c.line.visible=!1,c.visible=!1,c.tips&&c.tips.forEach(function(a){a.visible=!1})),c.label&&(this.hideLabel(c.label),c.label.style.opacity=0,c.label.style.zIndex=2)}this.angleLabel&&this.angleLabel.label&&this.hideLabel(this.angleLabel.label),this.areaLabel&&this.areaLabel.label&&this.hideLabel(this.areaLabel.label),this.clearSelectionAreas(),this.segments=[],this.dashedLine={},this.viewer.impl.clearOverlay(this.overlayName),q.createCommonOverlay(this.viewer,this.overlayName)},r.hideClick=function(a){p.Indicator.prototype.hideClick.call(this,a);for(var b in this.lines)if(this.lines.hasOwnProperty(b)){var c=this.lines[b];c.line&&(c.line.visible=!1,c.visible=!1,c.tips&&c.tips.forEach(function(a){a.visible=!1})),c.label&&(this.hideLabel(c.label),c.label.style.opacity=0)}this.angleLabel&&this.angleLabel.label&&this.hideLabel(this.angleLabel.label),this.areaLabel&&this.areaLabel.label&&this.hideLabel(this.areaLabel.label),this.enableSelectionAreas(c.selectionArea,!1)},r.destroy=function(){var a;p.Indicator.prototype.destroy.call(this);for(a in this.lines)if(this.lines.hasOwnProperty(a)){var b=this.lines[a];b.line&&(this.viewer.impl.clearOverlay(self.overlayName),b.material=b.line=b.geometry=null),b.label&&("xyz"===a&&(b.label.addEventListener("mousewheel",this.viewer.toolController.mousewheel),b.label.removeEventListener("click",this.onSelectionAreaClickedBinded)),b.label.parentNode.removeChild(b.label),b.label=null),b.material=b.line=b.geometry=b.label=b.p1=b.p2=null}this.clearAngleMeshes(),this.angleLabel&&this.angleLabel.label&&(this.angleLabel.label.parentNode.removeChild(this.angleLabel.label),this.angleLabel.label.removeEventListener("mousewheel",this.viewer.toolController.mousewheel),this.angleLabel.label.removeEventListener("click",this.onSelectionAreaClickedBinded),this.angleLabel.label=this.angleLabel.p1=this.angleLabel.p2=null),this.areaLabel&&this.areaLabel.label&&(this.areaLabel.label.parentNode.removeChild(this.areaLabel.label),this.areaLabel.label.removeEventListener("mousewheel",this.viewer.toolController.mousewheel),this.areaLabel.label.removeEventListener("click",this.onSelectionAreaClickedBinded),this.areaLabel.label=this.areaLabel.p1=this.areaLabel.p2=null),this.viewer.impl.overlayScenes[this.overlayName]&&this.viewer.impl.removeOverlayScene(this.overlayName),this.viewer.removeEventListener(o.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),window.removeEventListener("mouseup",this.handleButtonUpBinded)},r.clearXYZLine=function(){this.viewer.impl.removeOverlay(this.overlayName,this.lines.xyz.line),this.lines.xyz.tips&&this.lines.xyz.tips.forEach(function(a){this.viewer.impl.removeOverlay(this.overlayName,a)}.bind(this))},r.updateScale=function(){var a;q.forAll(this.angleOutline,function(a){this.setCylinderScale(a)}.bind(this));for(a in this.lines)if(this.lines.hasOwnProperty(a)){var b=this.lines[a];b.line&&b!==this.lines.xyz&&this.setCylinderScale(b.line,b.p1,b.p2)}for(a in this.segments)if(this.segments.hasOwnProperty(a)){var c=this.segments[a];c.line&&this.setCylinderScale(c.line,c.p1,c.p2)}this.measurement.measurementType===q.MeasurementTypes.MEASUREMENT_DISTANCE&&this.measurement.isComplete()&&(this.clearXYZLine(),this.drawXYZLine(this.lines.xyz))},r.setNoTopology=function(){this.topologyStatus=s,this.lines.xyz.label&&(n(this.lines.xyz.label,!1,this.topologyStatus),this.lines.xyz.label.classList.remove("fetching-topology"))},r.setFetchingTopology=function(){this.topologyStatus=t,this.lines.xyz.label&&(n(this.lines.xyz.label,!0,this.topologyStatus),this.lines.xyz.label.classList.add("fetching-topology"))},r.setTopologyAvailable=function(){this.topologyStatus=2,this.lines.xyz.label&&(n(this.lines.xyz.label,!1,this.topologyStatus),this.lines.xyz.label.classList.remove("fetching-topology"))},r.createMeasurementLabel=function(){var a=document.createElement("div");a.className="measure-length";var b=document.createElement("div");b.className="measure-fetching-topology",b.style.display="none",a.appendChild(b);var c=document.createElement("div");c.className="measure-length-text",a.appendChild(c);var d=document.createElement("div");return d.className="measure-delta-text",a.appendChild(d),a.causeStacking=!0,o.isMobileDevice()||q.safeToggle(a,"enable-hover",!0),a},r.createSnapResultLabel=function(a){var b=document.createElement("div");b.className="measure-label";var c=document.createElement("div");if(c.className="measure-label-icon",b.appendChild(c),o.isMobileDevice()){this.initLabelMobileGestures(b,a,this.measureTool);var d=document.createElement("div");d.className="measure-label-hit-area",b.appendChild(d)}else b.addEventListener("mousedown",function(b){b.canvasX=b.clientX,b.canvasY=b.clientY,this.measureTool.editEndpoint(b,a,this.measurement.id)}.bind(this)),b.addEventListener("mousewheel",this.viewer.toolController.mousewheel),q.safeToggle(b,"enable-hover",!0);return b.causeStacking=!1,b},r.showAngleLabel=function(a){var b=this.angleLabel.label;b||(b=this.angleLabel.label=this.createMeasurementLabel(),this.viewer.container.appendChild(b),b.addEventListener("mousewheel",this.viewer.toolController.mousewheel),b.addEventListener("click",this.onSelectionAreaClickedBinded)),this.updateAngle(),this.showLabel(b),this.angleLabel.p1=a.clone(),this.angleLabel.p2=a.clone()},r.showAreaLabel=function(a){var b=this.areaLabel.label;b||(b=this.areaLabel.label=this.createMeasurementLabel(),this.viewer.container.appendChild(b),b.addEventListener("mousewheel",this.viewer.toolController.mousewheel),b.addEventListener("click",this.onSelectionAreaClickedBinded)),this.updateArea(),this.showLabel(b),this.areaLabel.p1=a,this.areaLabel.p2=a},r.onSelectionAreaClicked=function(){this.measureTool.selectMeasurementById(this.measurement.id)},r.createSelectionArea=function(){var a=document.createElement("div");return a.id="measurement-selection-area-"+this.measurement.id,this.viewer.container.appendChild(a),a.className="measure-selection-area",a.style.display="none",a.addEventListener("mousewheel",this.viewer.toolController.mousewheel),a.addEventListener("click",this.onSelectionAreaClickedBinded),a},r.updateSelectionArea=function(){this.segments.forEach(function(a){if(a.p1&&a.p2){var b=q.project(a.p1,this.viewer),c=q.project(a.p2,this.viewer);a.selectionArea||(a.selectionArea=this.createSelectionArea());var d=a.selectionArea,e=new THREE.Vector2;d.style.top=b.y-7.5+"px",d.style.left=b.x+"px",d.style.width=e.subVectors(b,c).length()+"px",d.style.height="15px";var f=null,g=b.x-c.x,h=b.y-c.y;f=180*Math.atan2(-h,-g)/Math.PI,d.style.transform="rotate("+f+"deg)",d.style.transformOrigin="0px 7.5px"}}.bind(this)),this.measureTool.areAllPicksSet()&&this.enableSelectionAreas(!0)},r.clearSelectionAreas=function(){this.segments.forEach(function(a){if(a.selectionArea){a.selectionArea.removeEventListener("mousewheel",this.viewer.toolController.mousewheel),a.selectionArea.removeEventListener("click",this.onSelectionAreaClickedBinded);var b=document.getElementById("measurement-selection-area-"+this.measurement.id);b&&b.parentNode.removeChild(b),a.selectionArea=null}}.bind(this))},r.enableSelectionAreas=function(a){this.segments.forEach(function(b){b.selectionArea&&(b.selectionArea.style.display=a?"block":"none")}.bind(this))},r.render=function(a,b){p.Indicator.prototype.render.call(this,a,b),this.updateSelectionArea()},r.onCameraChange=function(){this.redrawDashedLine(),this.updateSelectionArea(),this.hideLabelsOutsideOfView(),this.updateLabelsPosition()},r.handleResize=function(){this.redrawDashedLine(),this.updateSelectionArea(),this.updateLabelsPosition()},Autodesk.Viewing.Extensions.Measure.MeasureToolIndicator=a}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.MeasureTool=function(a,b,c,d){function e(){if(!E)return null;var a;return 0===x?null:(a=x===E.getMaxNumberOfPicks()+1?E.countPicks():x,E.getPick(a))}function f(){if(!E)return null;var a;return 0===x?null:(a=1===x?E.countPicks():x===E.getMaxNumberOfPicks()+1?E.countPicks()-1:x-1,E.getPick(a))}function g(){if(!E)return!1;var a;return 0!==x&&(a=1===x?E.countPicks():x===E.getMaxNumberOfPicks()+1?E.countPicks()-1:x-1,E.hasPick(a))}function h(){x=0}function i(){x=E.countPicks()+1,m(!0),E.indicator.enableSelectionAreas(!0)}function j(){return 0===x||!E}function k(b,c){if(E.hasPick(1)&&x>3&&!E.closedArea){var d=E.getPick(1),e=t.getSnapResultPosition(d,o),f=t.project(e,a),g=t.getSnapResultPosition(b,o),h=t.project(g,a);(c||h.distanceTo(f)<K)&&(G.onMouseMove(f),d.copyTo(b))}}function l(a){var b=E.computeResult(E.picks,o,G);return E.indicator.render(E.picks,y||!!a),b}function m(a){for(var b in D.measurementsList)if(D.measurementsList.hasOwnProperty(b)){var c=D.measurementsList[b];c.indicator.changeAllEndpointsEditableStyle(a),c.indicator.enableSelectionAreas(a),c.indicator.enableLabelsTouchEvents(a)}}function n(){return E.countPicks()>3}var o=a,p=["measure"],q=c,r=Autodesk.Viewing,s=Autodesk.Viewing.Extensions.Measure,t=Autodesk.Viewing.MeasureCommon,u=!1,v=!1,w=!1,x=0,y=!1,z=!1,A=null,B=null,C=!1,D=new Autodesk.Viewing.Extensions.Measure.MeasurementsManager(o),E=null,F=null,G=d,H=!1,I=[],J=null,K=25,L=[],M=[],N=t.MeasurementTypes.MEASUREMENT_DISTANCE;Autodesk.Viewing.Private.injectCSS("extensions/Measure/Measure.min.css"),this.areAllPicksSet=function(){return E&&x===E.getMaxNumberOfPicks()+1},this.register=function(){},this.deregister=function(){this.deactivate()},this.isActive=function(){return u},this.getNames=function(){return p},this.getName=function(){return p[0]},this.getPriority=function(){return 50},this.getCursor=function(){return v?null:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAKZJREFUeNrclLEKwzAQQ9+FgH/Nk7d8ViFT+6cG36IsNXgIdMg5kAoOIw8WSDoDvAEN04BdEhFjgCTR4e6klFxSIgDLSNydbdsAPgRCktRaUylFkfZ0Z2qtVTlnAfugGibwAur3JFrAxoBnYGEy1pGYmQCLLNB6Uqmw182M9eRS0yzqGo+y6D9rytSQR8vM7DKfbtHy4x+/xG8J+d4W9WAi8fxFOwYA8W0ypu2ZfcsAAAAASUVORK5CYII=), auto"},this.getCurrentMeasurementRaw=function(){return E},this.getActivePointIndex=function(){return x},this.startNewMeasurement=function(){E=D.createMeasurement(N),E.attachIndicator(o,this,s.MeasureToolIndicator),F instanceof Function&&(F(),F=null),m(!1)},this.changeMeasurementType=function(a){N=a},this.activate=function(){u=!0,D.init(),h(),v=!1,this.isEditingEndpoint=!1,this.editByDrag=!1,o.impl.pauseHighlight(!0),L=o.getIsolatedNodes(),M=o.getHiddenNodes(),o.clearSelection(),o.toolController.activateTool("snapper"),o.toolController.activateTool("magnifyingGlass"),this.onMeasurementChangedBinded=this.onMeasurementChanged.bind(this),o.addEventListener(t.Events.MEASUREMENT_CHANGED_EVENT,this.onMeasurementChangedBinded),o.addEventListener(r.CAMERA_CHANGE_EVENT,this.onCameraChange),o.addEventListener(r.ISOLATE_EVENT,this.onIsolate)},this.deactivate=function(){if(u){for(u=!1;Object.keys(D.measurementsList).length>0;)E=D.measurementsList[Object.keys(D.measurementsList)[0]],D.changeCurrentMeasurement(E),this.clearCurrentMeasurement(),E=null;G&&G.isActive()&&o.toolController.deactivateTool("snapper"),o.toolController.deactivateTool("magnifyingGlass"),o.impl.pauseHighlight(!1),L=[],M=[],D.destroy(),o.removeEventListener(r.CAMERA_CHANGE_EVENT,this.onCameraChange),o.removeEventListener(t.Events.MEASUREMENT_CHANGED_EVENT,this.onMeasurementChangedBinded),o.removeEventListener(r.ISOLATE_EVENT,this.onIsolate)}},this.update=function(){return!1},this.getUnits=function(){return q.units},this.setUnits=function(a){if(q.units!==a){q.units=a;for(var b in D.measurementsList)if(D.measurementsList.hasOwnProperty(b)){var c=D.measurementsList[b];c.indicator&&c.indicator.updateResults()}}},this.getPrecision=function(){return q.precision},this.setPrecision=function(a){if(q.precision!==a){q.precision=a;for(var b in D.measurementsList)if(D.measurementsList.hasOwnProperty(b)){var c=D.measurementsList[b];c.indicator&&c.indicator.updateResults()}}},this.getDistanceXYZ=function(a){return a||(a=E),this.getDistanceAux(a.distanceXYZ)},this.getDistanceX=function(a){return a||(a=E),this.getDistanceAux(a.distanceX)},this.getDistanceY=function(a){return a||(a=E),this.getDistanceAux(a.distanceY)},this.getDistanceZ=function(a){return a||(a=E),this.getDistanceAux(a.distanceZ)},this.getDistanceAux=function(a){if(o.model){var b=Autodesk.Viewing.Private.convertUnits(o.model.getUnitString(),q.units,q.calibrationFactor,a||0);return Autodesk.Viewing.Private.formatValueWithUnits(b,q.units,3,q.precision)}},this.getAngle=function(a){a||(a=E);var b=a.angle;return Autodesk.Viewing.Private.formatValueWithUnits(b,String.fromCharCode(176),3,q.precision)},this.getArea=function(b){if(o.model){b||(b=E);var c=Autodesk.Viewing.Private.convertUnits(a.model.getUnitString(),q.units,q.calibrationFactor,b.area,"square");return q.units?Autodesk.Viewing.Private.formatValueWithUnits(c,q.units+"^2",3,q.precision):Autodesk.Viewing.Private.formatValueWithUnits(c,null,3,q.precision)}},this.getMeasurement=function(a,b){q.units=a||q.units,q.precision=b||q.precision;var c=["Vertex","Edge","Face","Circular Arc","Curved Edge","Curved Face"];return{from:c[E.getGeometry(1).type],to:c[E.getGeometry(2).type],distance:this.getDistanceXYZ(),deltaX:this.getDistanceX(),deltaY:this.getDistanceY(),deltaZ:this.getDistanceZ(),angle:this.getAngle(),unitType:q.units,precision:q.precision}},this.clearCurrentMeasurement=function(){if(E){h();for(var a in E.picks)E.picks.hasOwnProperty(a)&&this.clearPick(a);this.updateViewportId(!0),C&&this.clearIsolate(),E.indicator.clear(),E.indicator.destroy(),E=D.removeCurrentMeasurement(),E=null}m(!0)},this.clearPick=function(a){E&&E.hasPick(a)&&(E.clearPick(a),E.indicator.hideClick(a))},this.setIsolateMeasure=function(a){C=a},this.isolateMeasurement=function(){if(E){var a=[];for(var b in E.picks)E.picks.hasOwnProperty(b)&&a.push(E.getPick(b).snapNode);o.removeEventListener(r.ISOLATE_EVENT,this.onIsolate),o.isolate(a),o.addEventListener(r.ISOLATE_EVENT,this.onIsolate)}},this.clearIsolate=function(){o.removeEventListener(r.ISOLATE_EVENT,this.onIsolate),o.showAll(),o.isolate(L),o.hide(M),o.addEventListener(r.ISOLATE_EVENT,this.onIsolate)},this.onIsolate=function(a){a.nodeIdArray.length||(L=[],M=[])},this.deselectAllMeasurements=function(){E&&!this.areAllPicksSet()&&(this.isEditingEndpoint?this.undoEditEndpoint():this.clearCurrentMeasurement());for(var a in D.measurementsList)if(D.measurementsList.hasOwnProperty(a)){var b=D.measurementsList[a];b.indicator&&(b.indicator.setSimple(!0),b.indicator.hideEndpoints(),b.indicator.unfocusLabels())}E=null},this.onMeasurementChanged=function(){this.deselectAllMeasurements(),E=D.getCurrentMeasurement(),E.isComplete()&&(E.indicator.setSimple(!1),i(),l(!0),this.updateResults())},this.selectMeasurementById=function(a){E||(E=D.selectMeasurementById(a)),E.id!==a&&(this.areAllPicksSet()||(this.isEditingEndpoint?this.undoEditEndpoint():this.clearCurrentMeasurement()),E=D.selectMeasurementById(a))},this.editEndpoint=function(a,b,c){if(E.id===c&&x===b)return E.indicator.changeEndpointOnEditStyle(b,!1),void this.undoEditEndpoint();this.selectMeasurementById(c),x=b,this.isEditingEndpoint=!0,E.indicator.changeEndpointOnEditStyle(b,!0),m(!1);for(var d in E.picks)E.picks.hasOwnProperty(d)&&(I[d]=E.getPick(d).clone());this.updateViewportId(),C&&this.clearIsolate(),r.isMobileDevice()||this._handleMouseEvent(a)},this.undoEditEndpoint=function(){E.indicator.clear();for(var a in E.picks)E.picks.hasOwnProperty(a)&&E.setPick(a,I[a].clone());E.indicator.changeEndpointOnEditStyle(x,!1),this.isEditingEndpoint=!1,this.updateViewportId(!0),i(),l(!0)},this.updateResults=function(){E.indicator.updateResults(),E.indicator.showEndpoints(),E.indicator.focusLabels(),C&&E.isComplete()&&this.isolateMeasurement()},this.deleteCurrentMeasurement=function(){this.clearCurrentMeasurement(),this.isEditingEndpoint=!1,this.editByDrag=!1,v=!1},this.deleteCurrentPick=function(){for(var a=e(),b=a.id;E.hasPick(b+1);)E.setPick(b,E.getPick(b+1)),b++;delete E.picks[b];var c=E.countPicks();if(x--,x<=0&&(x=c),this.isEditingEndpoint){if(2==c)return void this.deleteCurrentMeasurement();E.indicator.changeAllEndpointsOnEditStyle(!1),this.isEditingEndpoint=!1,this.updateViewportId(!0),i(),l()}else this._handleMouseEvent()},this.updateViewportId=function(a){if(o.model&&o.model.is2d())if(a||j())o.impl.updateViewportId(0),G.setViewportId(null);else if(!H){var b=f().viewportIndex2d||e().viewportIndex2d;o.impl.updateViewportId(b),G&&G.setViewportId(b)}},this.setNoTopology=function(){E&&E.indicator?E.indicator.setNoTopology():F=function(){E.indicator.setNoTopology()}},this.setFetchingTopology=function(){E&&E.indicator?E.indicator.setFetchingTopology():F=function(){E.indicator.setFetchingTopology()}},this.setTopologyAvailable=function(){E&&E.indicator?E.indicator.setTopologyAvailable():F=function(){E.indicator.setTopologyAvailable()}},this.getSnapper=function(){return G},this.correctPickPosition=function(){var b=e();if(!b.getGeometry()&&J&&(b.geomType=t.SnapType.SNAP_VERTEX,b.geomVertex=J,b.intersectPoint=J),g()){var c=f();if(!t.correctPerpendicularPicks(c,b,a,G)){var d=(b.id+1)%(E.countPicks()+1);if(0===d&&(d=1),d!==b.id&&E.hasPick(d)){var h=E.getPick(d);t.correctPerpendicularPicks(h,b,a,G)}}E.measurementType==t.MeasurementTypes.MEASUREMENT_AREA&&k(b)}},this._handleMouseEvent=function(a){var b=!1;if(G.isSnapped())(this.areAllPicksSet()||j())&&(this.startNewMeasurement(),C&&this.clearIsolate(),x=1),G.copyResults(e()),b=!0;else{if(a&&o.model.is2d()){var c=o.container.getBoundingClientRect(),d=a.canvasX||a.clientX-c.left,f=a.canvasY||a.clientY-c.top;d&&f&&(J=t.inverseProject({x:d,y:f},o))}if(y&&E&&!this.isEditingEndpoint&&x===E.getMaxNumberOfPicks()+1)return!0;var g=e();g&&g.clear()}if(E&&(this.correctPickPosition(),y&&this._doConsumeSingleClick(),!j())){var h=l();E.hasPick(2)&&(b&=h)}return b},this._doConsumeSingleClick=function(){if(E.measurementType===t.MeasurementTypes.MEASUREMENT_AREA&&!E.closedArea){var a=E.countPicks(),b=E.getPick(1),c=E.getPick(a);a>=3&&E.hasEqualPicks(b,c)&&(c.clear(),delete E.picks[a],E.closedArea=!0)}this.updateResults();var d=E.isComplete();this.updateViewportId(d)},this.handleButtonDown=function(a,b){return!r.isMobileDevice()&&(v=!0,0!==b||a.ctrlKey||a.metaKey||a.shiftKey||a.altKey||(y=!0,A=a.canvasX,B=a.canvasY),!1)},this.handleMouseMove=function(a){return!r.isMobileDevice()&&(a.canvasX===A&&a.canvasY===B||(y=!1),w=this.isEditingEndpoint,j()||this.areAllPicksSet()||(this.clearPick(x),this._handleMouseEvent(a)),G.indicator.render(),!1)},this.restoreMouseListeners=function(){o.toolController.getTool("gestures").controller.enableMouseButtons(!0)},this.handlePressHold=function(a){if(y=!1,r.isMobileDevice())switch(a.type){case"press":return H=!0,(this.areAllPicksSet()||j())&&(this.startNewMeasurement(),C&&this.clearIsolate(),x=1),this._handleMouseEvent(a),G.indicator.render(),!0;case"pressup":return y=!0,this.restoreMouseListeners(),z=!z,this.handleSingleClick(a),H=!1,!0}return!1},this.handleGesture=function(a){if(r.isMobileDevice()){if(y=!1,H)switch(this.clearPick(x),a.type){case"dragstart":case"dragmove":return this._handleMouseEvent(a),G.indicator.render(),!0;case"dragend":return H=!1,y=!0,this.editByDrag||(z=!z,this.handleSingleClick(a)),this.editByDrag=!1,this.restoreMouseListeners(),!0;case"pinchstart":case"pinchmove":this._handleMouseEvent(a),G.indicator.render();break;case"pinchend":return y=!0,z=!z,this.handleSingleClick(a),this.restoreMouseListeners(),!0}if(-1!==a.type.indexOf("pinch"))for(var b in D.measurementsList)if(D.measurementsList.hasOwnProperty(b)){var c=D.measurementsList[b];c.indicator.updateScale()}}return!1},this.handleButtonUp=function(a,b){return v=!1,A=null,B=null,w&&(y=!0,z=!z,this.handleSingleClick(a),w=!1),!1},this.handleSingleClick=function(a,b){return y&&(G.indicator.clearOverlays(),E&&E.indicator.changeEndpointOnEditStyle(x,!1),this._handleMouseEvent(a)?(this.updateResults(),x++):this.isEditingEndpoint?this.undoEditEndpoint():E&&E.measurementType===t.MeasurementTypes.MEASUREMENT_AREA&&n()?(k(e(),!0),this._handleMouseEvent()):this.clearCurrentMeasurement(),E&&E.isComplete()&&i(),y=!1,z=!z,this.isEditingEndpoint=!1,G.clearSnapped()),!0},this.handleDoubleClick=function(a){return!0},this.onCameraChange=function(){for(var a in D.measurementsList)if(D.measurementsList.hasOwnProperty(a)){var b=D.measurementsList[a];b.indicator.updateScale()}G.indicator.onCameraChange()},this.handleSingleTap=function(a){return z||(y=!0,G.onMouseDown({x:a.canvasX,y:a.canvasY}),this.handleSingleClick(a)),z=!z,!0},this.handleDoubleTap=function(b){if(E&&E.measurementType===t.MeasurementTypes.MEASUREMENT_AREA&&E.countPicks()>2){var c=E.getPick(1),d=t.getSnapResultPosition(c,o),e=t.project(d,a);b.canvasX=e.x,b.canvasY=e.y,y=!0,G.onMouseDown(e),this.handleSingleClick(b),z=!z}return!0},this.handleResize=function(){for(var a in D.measurementsList)if(D.measurementsList.hasOwnProperty(a)){var b=D.measurementsList[a];b.indicator&&b.indicator.handleResize()}},this.handleKeyDown=function(a,b){switch(b){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:return E&&E.measurementType===t.MeasurementTypes.MEASUREMENT_AREA&&!this.areAllPicksSet()&&E.countPicks()>2?this.deleteCurrentPick():this.deleteCurrentMeasurement(),!0}return!1}}}(),function(){"use strict";function a(a,b,c){Autodesk.Viewing.Extensions.Measure.Indicator.call(this,a,b,c),this.calibrationTool=c,this.calibrationLabel=null,this.endpoints=null,this.tmpVector=new THREE.Vector3,this.p1=null,this.p2=null,this.rubberbandDefaultMaterial=new THREE.MeshBasicMaterial({color:15249964,opacity:1,transparent:!1,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),this.rubberbandSnappedMaterial=new THREE.MeshBasicMaterial({color:23502,opacity:1,transparent:!1,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),this.rubberbandTipMaterial=new THREE.MeshBasicMaterial({color:0,opacity:1,transparent:!1,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})}function b(a,b){return a.right>=b.left&&a.right<=b.right}function c(a,b){return a.left>=b.left&&a.left<=b.right}function d(a,b){return a.left<=b.left&&a.right>=b.right}function e(a,b){return a.top<b.bottom&&a.bottom>b.top}function f(a,b,c){a.style.left=parseInt(a.style.left,10)-(b.right-c.left)+"px"}function g(a,b,c){a.style.left=parseInt(a.style.left,10)+(c.right-b.left)+"px"}function h(a,b,c){a.style.top=parseInt(a.style.top,10)+(c.bottom-b.top)+"px"}var i=Autodesk.Viewing,j=Autodesk.Viewing.MeasureCommon;a.prototype=Object.create(Autodesk.Viewing.Extensions.Measure.Indicator.prototype),a.prototype.constructor=a;var k=a.prototype;k.createEndpoint=function(a){this.endpoints[a]={},this.endpoints[a].position=null;var b=this.endpoints[a].label=document.createElement("div");b.className="calibration-endpoint",this.viewer.container.appendChild(b);var c=document.createElement("div");c.className="calibration-endpoint-text",
c.textContent=a.toString(),b.appendChild(c),i.isMobileDevice()?this.initLabelMobileGestures(b,a,this.calibrationTool):(j.safeToggle(b,"enable-hover",!0),b.addEventListener("mousedown",function(b){b.canvasX=b.clientX,b.canvasY=b.clientY,this.calibrationTool.editEndpoint(b,a)}.bind(this)),b.addEventListener("mousewheel",this.viewer.toolController.mousewheel))},k.init=function(){if(j.createCommonOverlay(this.viewer,this.overlayName),!this.calibrationLabel){this.calibrationLabel=document.createElement("div"),this.calibrationLabel.className="calibration-label",this.hideLabel(this.calibrationLabel),this.viewer.container.appendChild(this.calibrationLabel),this.calibrationLabel.addEventListener("mousewheel",this.viewer.toolController.mousewheel);var a=document.createElement("div");a.className="calibration-label-text",this.calibrationLabel.appendChild(a)}this.endpoints=[],this.handleButtonUpBinded=this.calibrationTool.handleButtonUp.bind(this.calibrationTool),window.addEventListener("mouseup",this.handleButtonUpBinded),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.viewer.addEventListener(i.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded)},k.destroy=function(){this.clear(),Autodesk.Viewing.Extensions.Measure.Indicator.prototype.destroy.call(this),this.calibrationLabel&&(this.calibrationLabel.removeEventListener("mousewheel",this.viewer.toolController.mousewheel),this.viewer.container.removeChild(this.calibrationLabel),this.calibrationLabel=null),this.viewer.impl.clearOverlay(this.overlayName),this.viewer.impl.removeOverlayScene(this.overlayName),window.removeEventListener("mouseup",this.handleButtonUpBinded),this.viewer.removeEventListener(i.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded)},k.clearRubberband=function(){this.viewer.impl.clearOverlay(this.overlayName)},k.clear=function(){this.clearRubberband(),this.hideLabel(this.calibrationLabel);for(var a in this.endpoints)this.endpoints.hasOwnProperty(a)&&(this.hideClick(a),this.endpoints[a].position=null)},k.updateLabelValue=function(a){a&&""!==a?(this.calibrationLabel.childNodes[0].setAttribute("data-i18n",a),this.calibrationLabel.childNodes[0].textContent=i.i18n.translate(a),this.showLabel(this.calibrationLabel),this.calibrationTool.render()):(this.calibrationLabel.childNodes[0].textContent=null,this.hideLabel(this.calibrationLabel))},k.changeLabelClickableMode=function(a){this.calibrationLabel.childNodes[0].style.pointerEvents=a?"all":"none"},k.showAddCalibrationLabel=function(){var a=this;this.updateLabelValue("Add Calibration"),this.changeLabelClickableMode(!0),this.calibrationTool.render(),this.calibrationLabel.addEventListener("click",function b(){a.calibrationLabel.childNodes[0].style.pointerEvents="none",a.calibrationTool.render(),a.updateLabelValue(null),a.calibrationTool.showPanel(),a.calibrationLabel.removeEventListener("click",b)})},k.updateLabelsPosition=function(){for(var a=1;a<=Object.keys(this.endpoints).length;a++)if(this.endpoints[a].position){var b=this.endpoints[a].label,c=j.project(this.endpoints[a].position,this.viewer,15);b.style.left=c.x-parseInt(b.clientWidth)/2+"px",b.style.top=c.y-parseInt(b.clientHeight)/2+"px",b.point=this.endpoints[a].position,this.labelsOverlapDetection(this.endpoints[a].label,this.endpoints)}this.hideLabelsOutsideOfView()},k.labelsOverlapDetection=function(a,i){for(var j=1;j<=Object.keys(i).length;j++){var k=i[j].label;if(a!==k){var l=a.getBoundingClientRect(),m=k.getBoundingClientRect();e(m,l)&&(b(m,l)?f(k,m,l):c(m,l)?g(k,m,l):d(m,l)&&h(k,m,l))}}},k.renderCalibrationLabel=function(){if(this.showMeasureResult&&this.calibrationLabel&&this.p1&&this.p2){var a={x:(this.p1.x+this.p2.x)/2,y:(this.p1.y+this.p2.y)/2,z:(this.p1.z+this.p2.z)/2},b=j.project(a,this.viewer);this.labelPosition=new THREE.Vector2(b.x,b.y),this.calibrationLabel.childNodes[0].textContent&&this.showLabel(this.calibrationLabel),this.calibrationLabel.style.top=this.labelPosition.y-Math.floor(this.calibrationLabel.clientHeight/2)+"px",this.calibrationLabel.style.left=this.labelPosition.x-Math.floor(this.calibrationLabel.clientWidth/2)+"px",this.calibrationLabel.point=a,this.viewer.model.is2d()&&this.alignLabelWithLine(this.calibrationLabel,this.p1,this.p2,this.calibrationLabel.clientHeight,this.viewer)}},k.drawMeasurementLineTip=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Geometry,g=this.setScale(a);d=d?-1:1;var h=this.snapper.isSnapped()&&!this.showMeasureResult?this.rubberbandSnappedMaterial:this.rubberbandTipMaterial;e.addVectors(a,c.clone().multiplyScalar(5*g)),f.vertices[0]=e.clone(),e.subVectors(a,c.clone().multiplyScalar(5*g)),f.vertices[1]=e.clone(),this.drawLineAsCylinder(f,h,1.5,this.overlayName),f.vertices[0]=a,e.subVectors(a,b.clone().multiplyScalar(5*g*d)),f.vertices[1]=e.clone(),this.drawLineAsCylinder(f,h,1.5,this.overlayName),e.addVectors(a,c.clone().multiplyScalar(3*g)),f.vertices[0]=e.clone(),e.subVectors(a,c.clone().multiplyScalar(3*g)),f.vertices[1]=e.clone(),this.drawLineAsCylinder(f,this.rubberbandDefaultMaterial,2,this.overlayName),e.addVectors(a,c.clone().multiplyScalar(3*g)),e.addVectors(e,b.clone().multiplyScalar(3*g)),f.vertices[0]=e.clone(),e.subVectors(a,c.clone().multiplyScalar(3*g)),e.subVectors(e,b.clone().multiplyScalar(3*g)),f.vertices[1]=e.clone(),this.drawLineAsCylinder(f,this.rubberbandDefaultMaterial,2,this.overlayName)},k.renderDistanceMeasurement=function(a,b){if(this.viewer.impl.clearOverlay(this.overlayName),a&&b){var c=new THREE.Geometry,d=(new THREE.Vector3).subVectors(b,a).normalize(),e=d.clone().cross(this.viewer.navigation.getEyeVector()).normalize(),f=this.setScale(a),g=2*f,h=1*f,i=(Math.abs(a.x-b.x)<=.1||Math.abs(a.y-b.y)<=.1||this.snapper.getSnapResult().isPerpendicular)&&!this.showMeasureResult?this.rubberbandSnappedMaterial:this.rubberbandDefaultMaterial;this.showMeasureResult?(c.vertices[0]=a,c.vertices[1]=b,this.drawLineAsCylinder(c,i,3,this.overlayName)):this.drawDashedLine(a,b,g,h,i,3,this.overlayName),this.drawMeasurementLineTip(a,d,e,!1),this.showMeasureResult&&this.drawMeasurementLineTip(b,d,e,!0),this.p1=a,this.p2=b,this.renderCalibrationLabel()}},k.onCameraChange=function(){this.measurement.isComplete()&&this.renderDistanceMeasurement(this.p1,this.p2),this.updateLabelsPosition()},Autodesk.Viewing.Extensions.Measure.CalibrationToolIndicator=a}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.CalibrationTool=function(a,b,c,d){function e(){switch(I){case 0:case 1:case 2:return q.getPick(I);case 3:return q.getPick(q.countPicks())}}function f(){switch(I){case 0:return null;case 1:return q.getPick(q.countPicks());case 2:case 3:return q.getPick(1)}}function g(){switch(I){case 0:return!1;case 1:return q.hasPick(q.countPicks());case 2:case 3:return q.hasPick(1)}}function h(){I=0}function i(){I=3,q.indicator.changeAllEndpointsEditableStyle(!0)}function j(){return 0===I}function k(){return 3===I}var l=Autodesk.Viewing,m=Autodesk.Viewing.Extensions.Measure,n=Autodesk.Viewing.MeasureCommon,o=["calibration"],p=a,q=new n.Measurement(n.MeasurementTypes.MEASUREMENT_DISTANCE),r=b||{},s=c,t=b.maxPrecision||5,u=null!=c.calibrationFactor,v=d,w=!1,x=!1,y=!1,z=null,A=!1,B=null,C=null,D=null,E=null,F=!1,G=[],H=null,I=0,J=!1,K=!1,L=!1,M=null,N=null,O=null,P=Autodesk.Viewing.Private.GuiViewer3D&&a instanceof Autodesk.Viewing.Private.GuiViewer3D,n=Autodesk.Viewing.MeasureCommon;m.CALIBRATION_REQUIRED_EVENT="calibration-required",m.OPEN_CALIBRATION_PANEL_EVENT="open-calibration-panel",m.CLOSE_CALIBRATION_PANEL_EVENT="close-calibration-panel",m.CLEAR_CALIBRATION_SIZE_EVENT="clear-calibration-size",this.register=function(){P&&!O&&(O=new Autodesk.Viewing.Extensions.Measure.CalibrationPanel(this,p,"calibration-panel","Calibration",r),p.addPanel(O)),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.screenSizeChangedBinded=this.screenSizeChanged.bind(this)},this.deregister=function(){this.deactivate(),O&&(p.removePanel(O),O.uninitialize(),O=null)},this.isActive=function(){return w},this.getNames=function(){return o},this.getName=function(){return o[0]},this.getPriority=function(){return 50},this.getCursor=function(){return x?null:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAYCAYAAAD+vg1LAAAAAXNSR0IArs4c6QAAAwZJREFUSA2tVEtLW0EUvjGJefoqSY0x0WBSiY+oNWiUINkU6ioLaaAlG1eudNVFoT+grgopiCkEIbUK1o0lusmurRSEWmmKG6MNtNhNosWqyU2CZPpN8cr15nFD7YHDzHnON2fOGYZhmHkw4XEW+wD4xkT4lMvl6CE0+Y2ohh+dz+cZn89HVS/5+n/d/wVMkXq9Xor2v5SBgsmymQwZHx+vOqlKpXKDXWI3eU6Tg+kqSjSh3W4/s9lsvzUajaNcAK3xY7Dyci3nd6WXSCS60dHRvMfjSRcKBfWV4SYbrVarB8p0PB5nY7HYmdVq/aDX67WlckpKKcvpOjs7X09OTvoPDw8z2Wy2Bu+imJqa+npycnJXGHOt3YRGoSyVSvvMZrNkYWFBs7GxkaoBAXFJcDJhcCW5rq5ur62trQ/EOhyOBhDT2Nj4qVKMqA31ve1yub7Rfufo/PycDA4OxpuamhqECaouhVqtfuD3+1tqa2uZQCCQDoVCWTwknVQDDvIKE1clI1ja09Ozg0cjx8fHpL+/P+50OhMU8f7+Punt7f2I5NdqXRXi9fV1z9jYWCuIWV5eziSTyWAqlXq1urqaw6AwOMiCG4lOYtEturu732xubhK0FQHSvfr6+lsog4HWPIPvIBqNErRiqCiwkkKpVFowZd8xZSQYDLImk+kJ52+xWJ4tLS3hU8yTkZGRBD2Ms4mu6Nun4XA4f3p6SoaGhuJ0+rgg/Bsmt9udYFmWzM3NZdDT05ztWsE5JV0R1AqUCfTt0fb2tjESiRRmZmaOUOcI3w9DY5mdnb03PDzMoDQ/MZFRzM20lO/E38vl8vt46UdAq0WNJWixlEwmu8B1bXioOxwjpgXJ0hMTE1og1qysrDghf+HnKtoD7c7u7i5ZXFzMGY3GF7iFuRR3dHTMr62tXWxtbZH29vZ3RYmECozu54ODAzpdP2hphHZOVigUVjChvgMDA+85fdm1q6vrrU6n+4WR9Zd1ujQ0Nzc/NBgMScSExXwZ2j5oL5Wo46UD/ZvxUemo+AdW1zJzUYr16wAAAABJRU5ErkJggg==), auto"},this.activate=function(){if(w=!0,x=!1,this.isEditingEndpoint=!1,this.editByDrag=!1,h(),p.toolController.activateTool(v.getName()),p.toolController.activateTool("magnifyingGlass"),q.indicator||q.attachIndicator(p,this,m.CalibrationToolIndicator),q.indicator.clear(),A&&D&&E){q.setPick(1,D.clone()),q.setPick(2,E.clone()),i();var a=Autodesk.Viewing.Private.UnitParser.parsePositiveNumber(B,C);q.indicator.updateLabelValue(Autodesk.Viewing.Private.formatValueWithUnits(a,C,3,s.precision)),z=q.distanceXYZ,q.indicator.changeLabelClickableMode(!1),F=!0;var b=this.render();q.indicator.changeAllEndpointsEditableStyle(!0),b&&(O&&O.setPanelValue(B),this.showPanel())}p.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),p.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.screenSizeChangedBinded)},this.deactivate=function(){w&&(w=!1,this.hidePanel(),this.updateViewportId(!0),F=!1,q.clearAllPicks(),v&&v.isActive()&&p.toolController.deactivateTool(v.getName()),p.toolController.deactivateTool("magnifyingGlass"),q.indicator&&(q.indicator.clear(),q.indicator.destroy(),q.indicator=null),p.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),p.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.screenSizeChangedBinded))},this.getActivePointIndex=function(){return I},this.setCalibrationFactor=function(a){s.calibrationFactor=a},this.getCalibrationFactor=function(){return s.calibrationFactor},this.updateLabelValue=function(a){q.indicator.updateLabelValue(a)},this.isCalibrationValid=function(a,b){var c=Autodesk.Viewing.Private.UnitParser.parsePositiveNumber(b,a);return!isNaN(c)},this.calibrate=function(a,b){var c=null,d=Autodesk.Viewing.Private.UnitParser.parsePositiveNumber(b,a);if(!isNaN(d)){var e=Autodesk.Viewing.Private.convertUnits(p.model.getUnitString(),a,1,z);if(0!==e&&!isNaN(e)){c=d/e,s.calibrationFactor=c,s.units=a;var f=p.model.is2d()?3:1,g=Autodesk.Viewing.Private.calculatePrecision(b);s.precision=Math.max(s.precision?s.precision:f,g),B=b,C=a,u=!0,A=!0,D=q.getPick(1).clone(),E=q.getPick(2).clone()}}c&&(p.getExtension("Autodesk.Measure").enableCalibrationTool(!1),p.dispatchEvent({type:"finished-calibration"}))},this.calibrateByScale=function(a,b){s.calibrationFactor=b,s.units!==a&&(s.units=a,C=a),u=!0},this.getCurrentUnits=function(){return s.units},this.hidePanel=function(){O?O.setVisible(!1):p.dispatchEvent({type:m.CLOSE_CALIBRATION_PANEL_EVENT})},this.showPanel=function(){var a=this;O?(window.setTimeout(function(){O.requestedSizeTextbox.focus()},0),O.setVisible(!0),O.updatePanelPosition(q.indicator.labelPosition,q.indicator.p1,q.indicator.p2,q.indicator.calibrationLabel.clientHeight),window.addEventListener("keyup",function b(c){"Escape"==(c.key||String.fromCharCode(c.keyCode))&&a.isActive()&&(a.hidePanel(),a.clearSize(),a.showAddCalibrationLabel(),window.removeEventListener("keyup",b))})):p.dispatchEvent({type:m.OPEN_CALIBRATION_PANEL_EVENT,data:{size:B,units:C}})},this.showAddCalibrationLabel=function(){q.indicator.showAddCalibrationLabel()},this.isCalibrated=function(){return u},this.clearSize=function(){q.indicator.updateLabelValue(null),O?O.requestedSizeTextbox.value="":p.dispatchEvent({type:m.CLEAR_CALIBRATION_SIZE_EVENT})},this.getMaxPrecision=function(){return t},this.clearMeasurement=function(){h(),this.clearPick(1),this.clearPick(2),q.indicator.clear(),this.updateViewportId(!0),this.hidePanel(),F=!1},this.clearPick=function(a){q.hasPick(a)&&(q.clearPick(a),q.indicator.hideClick(a))},this.repickEndpoint=function(a){this.clearPick(a),this.editEndpoint(null,a)},this.getSnapper=function(){return v},this._handleMouseEvent=function(a){var b=!1;if(v.isSnapped())(k()||j())&&(this.clearMeasurement(),I=1),v.copyResults(e()),b=!0;else{if(a&&p.model.is2d()){var c=p.container.getBoundingClientRect(),d=a.canvasX||a.clientX-c.left,f=a.canvasY||a.clientY-c.top;d&&f&&(H=n.inverseProject({x:d,y:f},p))}if(K&&q&&!this.isEditingEndpoint&&I===q.getMaxNumberOfPicks()+1)return!0;var g=e();g&&g.clear()}if(this.correctPickPosition(),K&&this._doConsumeSingleClick(b),!j()){var h=this.render();q.hasPick(2)&&(b&=h)}return K&&(q.isComplete()&&b?(z=q.distanceXYZ,this.clearSize(),this.showPanel(),F=!0):(this.hidePanel(),q.indicator.updateLabelValue(null),F=!1)),b},this.updateViewportId=function(b){if(p.model&&p.model.is2d())if(b||j())a.impl.updateViewportId(0),v.setViewportId(null);else if(!y){var c=f().viewportIndex2d||e().viewportIndex2d;a.impl.updateViewportId(c),v&&v.setViewportId(c)}},this._doConsumeSingleClick=function(a){this.updateViewportId(q.isComplete()),q.indicator.clear()},this.handleButtonDown=function(a,b){return!l.isMobileDevice()&&(x=!0,0!==b||a.ctrlKey||a.metaKey||a.shiftKey||a.altKey||(K=!0,M=a.canvasX,N=a.canvasY),!1)},this.handleMouseMove=function(a){return!l.isMobileDevice()&&(a.canvasX===M&&a.canvasY===N||(K=!1),J=this.isEditingEndpoint,j()||k()||(this.clearPick(I),this._handleMouseEvent(a)),v.indicator.render(),!1)},this.restoreMouseListeners=function(){p.toolController.getTool("gestures").controller.enableMouseButtons(!0)},this.handlePressHold=function(a){if(K=!1,l.isMobileDevice())switch(a.type){case"press":return y=!0,k()?this.clearMeasurement():this.clearPick(I),this._handleMouseEvent(a),v.indicator.render(),!0;case"pressup":return K=!0,this.restoreMouseListeners(),L=!L,this.handleSingleClick(a),y=!1,!0}return!1},this.correctPickPosition=function(){var b=e();if(!b.getGeometry()&&H&&(b.geomType=n.SnapType.SNAP_VERTEX,b.geomVertex=H,b.intersectPoint=H),g()){var c=f();n.correctPerpendicularPicks(c,b,a,v)}},this.render=function(){var a=q.computeResult(q.picks,p,v);return q.indicator.render(q.picks,K||F),a},this.editEndpoint=function(a,b){if(I===b)return q.indicator.changeEndpointOnEditStyle(b,!1),void this.undoEditEndpoint();I=b,this.isEditingEndpoint=!0,q.indicator.changeEndpointOnEditStyle(b,!0),q.indicator.changeAllEndpointsEditableStyle(!1);for(var c in q.picks)q.picks.hasOwnProperty(c)&&(G[c]=q.getPick(c).clone());this.updateViewportId(),this.hidePanel(),q.indicator.updateLabelValue(null),F=!1,l.isMobileDevice()||this._handleMouseEvent(a)},this.undoEditEndpoint=function(){q.indicator.clear();for(var a in q.picks)q.picks.hasOwnProperty(a)&&q.setPick(a,G[a].clone());this.updateViewportId(!0),this.isEditingEndpoint=!1,F=!0,i(),this.render()&&this.showPanel()},this.handleGesture=function(a){if(l.isMobileDevice()&&(K=!1,y))switch(this.clearPick(I),a.type){case"dragstart":case"dragmove":return this._handleMouseEvent(a),v.indicator.render(),!0;case"dragend":return y=!1,K=!0,this.editByDrag||(L=!L,this.handleSingleClick(a)),this.editByDrag=!1,this.restoreMouseListeners(),!0;case"pinchend":return K=!0,L=!L,this.handleSingleClick(a),this.restoreMouseListeners(),!0}return!1},this.handleButtonUp=function(a){return x=!1,M=null,N=null,J&&(K=!0,L=!L,this.handleSingleClick(a),J=!1),!1},this.handleSingleClick=function(a){return K&&(v.indicator.clearOverlays(),q.indicator.changeEndpointOnEditStyle(I,!1),this._handleMouseEvent(a)?(q.indicator.showEndpoints(),q.indicator.updateLabelsPosition(),I++):this.isEditingEndpoint?this.undoEditEndpoint():this.clearMeasurement(),q.isComplete()&&i(),K=!1,L=!L,this.isEditingEndpoint=!1,v.clearSnapped()),!0},this.handleDoubleClick=function(){return!0},this.handleSingleTap=function(a){return L||(K=!0,v.onMouseDown({x:a.canvasX,y:a.canvasY}),this.handleSingleClick(a)),L=!L,!0},this.handleDoubleTap=function(){return!0},this.handleResize=function(){q.indicator&&q.indicator.handleResize()},this.onCameraChange=function(){v.indicator&&v.indicator.onCameraChange()},this.screenSizeChanged=function(a){this.onCameraChange()}},function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),b=Autodesk.Viewing,c=Autodesk.Viewing.Extensions,d=Autodesk.Viewing.Private,e=Autodesk.Viewing.UI,f=Autodesk.Viewing.MeasureCommon,g=function(a,c,f,g,j){var k=this;j=j||{},j.addFooter=!1,e.DockingPanel.call(this,c.container,f,g,j),this.viewer=c,this.calibrationTool=a,this.parentContainer=c.container,this.container.style.left="0px",this.container.style.top="0px",this.container.style.resize="none",this.container.classList.add("calibration-panel"),this.addEventListener(this.closer,"click",function(a){k.setVisible(!1),k.calibrationTool.clearSize(),k.calibrationTool.showAddCalibrationLabel()}),j.heightAdjustment||(j.heightAdjustment=50),j.marginTop||(j.marginTop=0),j.left=!1,this.createScrollContainer(j),this.calibrationMenu=document.createElement("div"),this.scrollContainer.appendChild(this.calibrationMenu),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable calibration-table",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.calibrationMenu.appendChild(this.table),this.row=this.tbody.insertRow(0),this.requestedSizeTextbox=document.createElement("input"),this.requestedSizeTextbox.className="docking-panel-textbox",this.requestedSizeTextbox.type="text",this.requestedSizeTextbox.autofocus="true",this.addEventListener(this.requestedSizeTextbox,"keyup",function(a){var b=k.requestedSizeTextbox.value;""!==b&&""===b.split(".")[0]&&(k.requestedSizeTextbox.value="0"+b),k.updateLabel()}),this.addEventListener(this.requestedSizeTextbox,"keypress",function(a){var c=a.key||String.fromCharCode(a.keyCode);if("Backspace"!=c&&"ArrowLeft"!=c&&"ArrowRight"!=c){if(a.keyCode==b.KeyCode.ESCAPE)return k.setVisible(!1),k.calibrationTool.clearSize(),void k.calibrationTool.showAddCalibrationLabel();var d=k.requestedSizeTextbox.value,e=k.requestedSizeTextbox.selectionStart;if("."!=(d=[d.slice(0,e),c,d.slice(e)].join(""))){var f=k.units[k.unitList.selectedIndex].simpleInput;(!h(d)||f&&(!i(d)||Autodesk.Viewing.Private.calculatePrecision(d)>k.calibrationTool.getMaxPrecision()))&&a.preventDefault()}}});var l=this.row.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n","Define Size"),this.caption.textContent=b.i18n.translate("Define Size"),l.appendChild(this.caption),l=this.row.insertCell(1),l.appendChild(this.requestedSizeTextbox),this.units=[{name:"Feet and fractional inches",units:"ft-and-fractional-in",matches:["ft-and-fractional-in"],simpleInput:!1},{name:"Feet and decimal inches",units:"ft-and-decimal-in",matches:["ft-and-decimal-in"],simpleInput:!1},{name:"Meters",units:"m",matches:["m"],simpleInput:!0},{name:"Centimeters",units:"cm",matches:["cm"],simpleInput:!0},{name:"Millimeters",units:"mm",matches:["mm"],simpleInput:!0}];for(var m=[],n=0;n<this.units.length;++n)m.push(this.units[n].name);this.unitList=new d.OptionDropDown("Unit type",this.tbody,m,0),this.addEventListener(this.unitList,"change",function(a){k.updateLabel()});var o=document.createElement("div");o.classList.add("docking-panel-primary-button"),o.classList.add("calibration-button"),o.setAttribute("data-i18n","Set Calibration"),o.textContent=b.i18n.translate("Set Calibration"),o.addEventListener("click",function(){var a=k.unitList.selectedIndex,b=k.units[a].units;k.calibrationTool.calibrate(b,k.requestedSizeTextbox.value)},!1),this.calibrationMenu.appendChild(o)},h=function(a){return a.match(/^(\d+)/)},i=function(a){return a+="0",!isNaN(parseFloat(a))&&!isNaN(+a)&&parseFloat(a)>=0};g.prototype=Object.create(e.DockingPanel.prototype),c.ViewerPanelMixin.call(g.prototype),g.prototype.uninitialize=function(){this.viewer=null,e.DockingPanel.prototype.uninitialize.call(this)},g.prototype.findUnits=function(){var a,b,c=this.calibrationTool.getCurrentUnits();for(a=0;a<this.units.length;++a){var d=this.units[a].matches;if(d)for(b=0;b<d.length;++b)if(d[b]===c)return a}return 0},g.prototype.setPanelValue=function(a){this.unitList.setSelectedIndex(this.findUnits()),this.requestedSizeTextbox.value=a},g.prototype.updateLabel=function(){var a=this.unitList.selectedIndex,b=this.units[a].units,c=this.requestedSizeTextbox.value,d=Autodesk.Viewing.Private.UnitParser.parsePositiveNumber(c,b),e=Autodesk.Viewing.Private.formatValueWithUnits(d,b,3,Autodesk.Viewing.Private.calculatePrecision(c));""===c?this.calibrationTool.updateLabelValue(null):isNaN(d)||this.calibrationTool.updateLabelValue(e)},g.prototype.updatePanelPosition=function(a,b,c,d){var e,g,h=parseInt(this.container.getBoundingClientRect().width),i=parseInt(this.container.getBoundingClientRect().height);if(a&&b&&c){b=f.project(b,this.viewer),c=f.project(c,this.viewer);var j,k=(new THREE.Vector2).copy(b).sub(c).normalize();j=b.x<c.x?new THREE.Vector2(k.y,-k.x):new THREE.Vector2(-k.y,k.x);var l=d+Math.sqrt(Math.pow(h,2)+Math.pow(i,2))/2;j=j.multiplyScalar(l);var m=a.sub(j);e=m.x-Math.floor(h/2),g=m.y-Math.floor(i/2),(e<0||e+h>this.viewer.canvas.clientWidth||g<0||g+i>this.viewer.canvas.clientHeight)&&(e=Math.floor((this.viewer.canvas.clientWidth-h)/2),g=Math.floor((this.viewer.canvas.clientHeight-i)/2))}else e=Math.floor((this.viewer.canvas.clientWidth-h)/2),g=Math.floor((this.viewer.canvas.clientHeight-i)/2);this.container.style.left=e+"px",this.container.style.top=g+"px"};var j=function(a,c,d,f,g){var h=this;g=g||{},g.addFooter=!1,e.DockingPanel.call(this,c.container,d,f,g),this.viewer=c,this.measureExt=a,this.parentContainer=c.container,this.container.classList.add("calibration-panel"),this.container.style.width="380px",this.container.style.height="190px",g.heightAdjustment||(g.heightAdjustment=70),g.marginTop||(g.marginTop=0),g.left=!1,this.createScrollContainer(g),this.dialogBox=document.createElement("div"),this.scrollContainer.appendChild(this.dialogBox);var i=document.createElement("div");i.className="calibration-text";var j="Calibration Message";i.setAttribute("data-i18n",j),i.textContent=b.i18n.translate(j),this.dialogBox.appendChild(i);var k=document.createElement("div");k.className="calibration-buttons-wrapper",this.dialogBox.appendChild(k);var l=document.createElement("div");l.classList.add("docking-panel-secondary-button"),l.classList.add("calibration-button-left"),l.setAttribute("data-i18n","Cancel"),l.textContent=b.i18n.translate("Cancel"),l.addEventListener("click",function(){h.setVisible(!1)},!1),k.appendChild(l);var m=document.createElement("div");m.classList.add("docking-panel-primary-button"),m.classList.add("calibration-button-right"),m.setAttribute("data-i18n","Calibrate Now"),m.textContent=b.i18n.translate("Calibrate Now"),m.addEventListener("click",function(){h.measureExt.enableCalibrationTool(!0),h.setVisible(!1)},!1),k.appendChild(m)};j.prototype=Object.create(e.DockingPanel.prototype),c.ViewerPanelMixin.call(j.prototype),j.prototype.uninitialize=function(){this.viewer=null,e.DockingPanel.prototype.uninitialize.call(this)},a.CalibrationPanel=g,a.CalibrationRequiredDialog=j}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.MagnifyingGlass=function(a){var b=a,c=!1,d=["magnifyingGlass"],e=!1,f=null,g=null,h=null,i=null,j=null,k=!1;this.isActive=function(){return c},this.activate=function(){c=!0,this.updateMagnifyingGlassBinded=this.updateMagnifyingGlass.bind(this)},this.updateMagnifyingGlass=function(){if(k)f&&f.classList.remove("visible"),k=!1;else{var a=window.devicePixelRatio,c=120*a,d=a*(i-30),e=a*(j-30);f||(f=document.createElement("canvas"),f.className="magnifying-glass",f.width=c,f.height=c,f.style.width="120px",f.style.height="120px",f.getContext("2d").translate(0,c),f.getContext("2d").scale(1,-1),b.container.appendChild(f),g=new ImageData(Math.ceil(c/2),Math.ceil(c/2)),h=new Uint8Array(g.data.buffer));var l=f.getContext("2d"),m=b.canvas.getContext("webgl");m.readPixels(d,b.canvas.height-e-g.height,g.width,g.height,m.RGBA,m.UNSIGNED_BYTE,h),l.putImageData(g,0,0),l.drawImage(f,0,0,g.width,g.height,0,0,c,c),this.setGlassPosition(f,i,j,120,15),f.classList.toggle("visible",!0)}b.removeEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.updateMagnifyingGlassBinded)},this.deactivate=function(){c=!1},this.getNames=function(){return d},this.getName=function(){return d[0]},this.getPriority=function(){return 70},this.setGlassPosition=function(a,b,c,d,e){a.style.left=b-d/2+"px",a.style.top=c-d-e>0?c-d-e+"px":c+e+"px"},this.requestUpdate=function(){b.hasEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.updateMagnifyingGlassBinded)||b.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.updateMagnifyingGlassBinded)},this.drawMagnifyingGlass=function(a,c){i=a,j=c,b.impl.invalidate(!1,!1,!0),this.requestUpdate()},this.clearMagnifyingGlass=function(){k=!0,this.requestUpdate()},this.handlePressHold=function(a){if(av.isMobileDevice())switch(a.type){case"press":e=!0,this.drawMagnifyingGlass(a.canvasX,a.canvasY);break;case"pressup":this.clearMagnifyingGlass(),e=!1}return!1},this.handleGesture=function(a){if(e&&av.isMobileDevice())switch(a.type){case"dragstart":case"dragmove":this.drawMagnifyingGlass(a.canvasX,a.canvasY);break;case"dragend":this.clearMagnifyingGlass(),e=!1;break;case"pinchstart":case"pinchmove":this.drawMagnifyingGlass(a.canvasX,a.canvasY);break;case"pinchend":this.clearMagnifyingGlass()}return!1},this.handleMouseMove=function(a){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonUp=function(a,b){return!1}},function(){"use strict";function a(a){this.measureExtension=a,this.measureTool=this.measureExtension.measureTool,this.viewer=this.measureExtension.viewer,this.visible=!1,this.buttonsList=[]}var b=Autodesk.Viewing,c=Autodesk.Viewing.UI,d=Autodesk.Viewing.Private,e=Autodesk.Viewing.MeasureCommon,f=a.prototype;f.init=function(){var a=this,f=this.viewer.getToolbar(!0),g=f.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),h={};h.index=f.indexOf(g)+1,this.measureToolbar=new c.ControlGroup(Autodesk.Viewing.TOOLBAR.MEASURETOOLSID),f.addControl(this.measureToolbar,h),this.measureSimpleDistanceBtn=new c.Button("toolbar-measureTool-simple-distance"),this.measureSimpleDistanceBtn.setToolTip("Distance"),this.measureSimpleDistanceBtn.setIcon("adsk-icon-measure-distance-new"),this.measureSimpleDistanceBtn.onClick=function(){a.measureSimpleDistanceBtn.getState()!==c.Button.State.ACTIVE?a.measureExtension.activate("distance"):(a.measureTool.deselectAllMeasurements(),a.setButtonInactive(a.measureSimpleDistanceBtn))},this.measureToolbar.addControl(this.measureSimpleDistanceBtn),this.buttonsList[e.MeasurementTypes.MEASUREMENT_DISTANCE]=this.measureSimpleDistanceBtn,this.measureAngleBtn=new c.Button("toolbar-measureTool-angle"),this.measureAngleBtn.setToolTip("Angle"),this.measureAngleBtn.setIcon("adsk-icon-measure-angle-new"),this.measureAngleBtn.onClick=function(){a.measureAngleBtn.getState()!==c.Button.State.ACTIVE?a.measureExtension.activate("angle"):(a.measureTool.deselectAllMeasurements(),a.setButtonInactive(a.measureAngleBtn))},this.measureToolbar.addControl(this.measureAngleBtn),this.buttonsList[e.MeasurementTypes.MEASUREMENT_ANGLE]=this.measureAngleBtn,this.viewer.model&&this.viewer.model.is2d()&&(this.measureAreaBtn=new c.Button("toolbar-measureTool-area"),this.measureAreaBtn.setToolTip("Area"),this.measureAreaBtn.setIcon("adsk-icon-measure-area-new"),this.measureAreaBtn.onClick=function(){a.measureAreaBtn.getState()!==c.Button.State.ACTIVE?a.measureExtension.activate("area"):(a.measureTool.deselectAllMeasurements(),a.setButtonInactive(a.measureAreaBtn))},this.measureToolbar.addControl(this.measureAreaBtn),this.buttonsList[e.MeasurementTypes.MEASUREMENT_AREA]=this.measureAreaBtn),this.calibrationToolBtn=new c.Button("toolbar-calibrationTool"),this.calibrationToolBtn.setToolTip("Calibrate"),this.calibrationToolBtn.setIcon("adsk-icon-measure-calibration"),this.calibrationToolBtn.onClick=function(b){a.calibrationToolBtn.getState()!==c.Button.State.ACTIVE?a.measureExtension.activate("calibrate"):a.measureExtension.enableCalibrationTool(!1)},this.measureToolbar.addControl(this.calibrationToolBtn),this.buttonsList[e.MeasurementTypes.CALIBRATION]=this.calibrationToolBtn;var i=document.createElement("div");i.className="measure-toolbar-seperator",this.measureToolbar.container.appendChild(i),this.deleteBtn=new c.Button("toolbar-delete"),this.deleteBtn.setToolTip("Delete measurement"),this.deleteBtn.setIcon("adsk-icon-measure-trash"),this.deleteBtn.onClick=function(){a.measureExtension.deleteCurrentMeasurement()},this.measureToolbar.addControl(this.deleteBtn),this.settingsBtn=new c.Button("toolbar-settings"),this.settingsBtn.setToolTip("Measure settings"),this.settingsBtn.setIcon("adsk-icon-measure-settings"),this.settingsControlPanel=document.createElement("div"),this.settingsControlPanel.classList.add("docking-panel"),this.settingsControlPanel.classList.add("docking-panel-container-solid-color-b"),this.settingsControlPanel.classList.add("measure-settings-popup"),this.settingsControlPanel.style.display="none",this.settingsBtn.onClick=function(a){"none"==this.settingsControlPanel.style.display?(this.settingsControlPanel.style.display="block",this.setButtonActive(this.settingsBtn)):(this.settingsControlPanel.style.display="none",this.setButtonInactive(this.settingsBtn))}.bind(this),this.measureToolbar.container.appendChild(this.settingsControlPanel),this.settingsControlPanel.root=this.settingsBtn,this.measureToolbar.addControl(this.settingsBtn),this.table=document.createElement("table"),this.table.classList.add("adsk-lmv-tftable"),this.table.classList.add("calibration-table"),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.settingsControlPanel.appendChild(this.table),this.units=[{name:"Unknown",units:"",matches:[""]},{name:"Decimal feet",units:"decimal-ft",matches:["ft","decimal-ft"]},{name:"Feet and fractional inches",units:"ft-and-fractional-in",matches:["ft-and-fractional-in"]},{name:"Feet and decimal inches",units:"ft-and-decimal-in",matches:["ft-and-decimal-in"]},{name:"Decimal inches",units:"decimal-in",matches:["in","decimal-in"]},{name:"Fractional inches",units:"fractional-in",matches:["fractional-in"]},{name:"Meters",units:"m",matches:["m"]},{name:"Centimeters",units:"cm",matches:["cm"]},{name:"Millimeters",units:"mm",matches:["mm"]},{name:"Meters and centimeters",units:"m-and-cm",matches:["m-and-cm"]}];var j=this.findUnits(),k=[];b.isSafari()&&this.viewer.model.getDisplayUnit()&&this.units.shift();for(var l=0;l<this.units.length;++l)k.push(this.units[l].name);this.unitList=new d.OptionDropDown("Unit type",this.tbody,k,j),this.unitList.addEventListener("change",function(b){var c=a.unitList.selectedIndex,e=a.units[c].units;a.measureTool.setUnits(e),a.setupPrecision(),d.logger.track({category:"pref_changed",name:"measure/units",value:e})}),this.precisionList=new d.OptionDropDown("Precision",this.tbody,[],-1),this.precisionList.addEventListener("change",function(b){var c=a.precisionList.selectedIndex;a.measureTool.setPrecision(c),d.logger.track({
category:"pref_changed",name:"measure/precision",value:c})}),this.isolate=new d.OptionCheckbox("Isolate measurement",this.tbody,!1),this.isolate.addEventListener("change",function(b){var c=a.isolate.checked;a.measureTool.setIsolateMeasure(c),c?a.measureTool.isolateMeasurement():a.measureTool.clearIsolate(),d.logger.track({category:"pref_changed",name:"measure/isolate",value:c})}),this.setupPrecision(),this.updateSettingsPanel(),this.viewer.model&&this.viewer.model.is2d()&&(this.isolate.setVisibility(!1),this.settingsControlPanel.classList.add("measure-settings-popup-small")),this.measureExtension.sharedMeasureConfig.units?Autodesk.Viewing.isSafari()||this.disableUnitOption(0):this.disableUnitOption(),this.measureDoneBtn=new c.Button("toolbar-measureTool-done");var m=Autodesk.Viewing.i18n.translate("Done");this.measureDoneBtn.setToolTip(m);var n=document.createElement("label");n.textContent=m;var o=this.measureDoneBtn.container;o.appendChild(n),o.classList.add("adsk-label-button");var p=o.getElementsByClassName("adsk-button-icon");p&&p[0]&&(p[0].style.display="none"),this.measureDoneBtn.onClick=function(){this.measureExtension.exitMeasurementMode()}.bind(this),this.measureToolbar.addControl(this.measureDoneBtn),this.measureToolbar.setVisible(!1)},f.closeToolbar=function(){this.measureExtension.enableMeasureTool(!1),this.measureExtension.enableCalibrationTool(!1),this.toggleVisible();for(var a=this.viewer.getToolbar(!1),c=a.container,d=c.children.length,e=0;e<d;++e)c.children[e].style.display="";a.getControl(b.TOOLBAR.MODELTOOLSID).addControl(this.measureExtension.measurementToolbarButton,{index:this.measureExtension.measurementToolbarButton.index})},f.toggleVisible=function(){this.visible=!this.visible,this.measureToolbar.setVisible(this.visible),this.visible||(this.settingsControlPanel.style.display="none",this.setButtonInactive(this.settingsBtn))},f.setButtonActive=function(a){a.setState(c.Button.State.ACTIVE)},f.setButtonInactive=function(a){a.setState(c.Button.State.INACTIVE)},f.deactivateAllButtons=function(){for(var a in this.buttonsList)if(this.buttonsList.hasOwnProperty(a)){var b=this.buttonsList[a];this.setButtonInactive(b)}},f.activateButtonByType=function(a){this.setButtonActive(this.buttonsList[a])},f.setupPrecision=function(){for(;this.precisionList.dropdownElement.lastChild;)this.precisionList.dropdownElement.removeChild(this.precisionList.dropdownElement.lastChild);var a,b=this.measureTool.getUnits();a="ft-and-fractional-in"===b||"fractional-in"===b?["1","1/2","1/4","1/8","1/16","1/32","1/64"]:["0","0.1","0.01","0.001","0.0001","0.00001"];for(var c=0;c<a.length;++c){var d=document.createElement("option");d.value=c,d.textContent=a[c],this.precisionList.dropdownElement.appendChild(d)}var e=this.measureTool.getPrecision();a.length<=e&&(e=a.length-1,this.measureTool.setPrecision(e)),this.precisionList.dropdownElement.selectedIndex=e},f.findUnits=function(){var a,b,c=this.measureTool.getUnits();for(a=0;a<this.units.length;++a){var d=this.units[a].matches;if(d)for(b=0;b<d.length;++b)if(d[b]===c)return a}return 0},f.disableUnitOption=function(a){null!=a?(this.unitList.dropdownElement.children[a].style.display="none",b.isIE11&&(this.unitList.dropdownElement.children[a].disabled=!0,this.unitList.dropdownElement.children[a].style.visibility="hidden")):this.unitList.dropdownElement.disabled=!0},f.updateSettingsPanel=function(){this.unitList.dropdownElement.selectedIndex=this.findUnits(),this.precisionList.dropdownElement.selectedIndex=this.measureTool.getPrecision(),this.setupPrecision()},Autodesk.Viewing.Extensions.Measure.MeasureToolbar=a}();