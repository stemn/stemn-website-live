function getGlobal(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:global}function init_three_dds_loader(){THREE.DDSLoader=function(){this._parser=THREE.DDSLoader.parse},THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.DDSLoader.prototype.constructor=THREE.DDSLoader,THREE.DDSLoader.parse=function(e,t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},o=i("DXT1"),r=i("DXT3"),s=i("DXT5"),a=new Int32Array(e,0,31)
if(542327876!==a[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n
if(4&!a[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n
var l,c=a[21],d=!1
switch(c){case o:l=8,n.format=THREE.RGB_S3TC_DXT1_Format
break
case r:l=16,n.format=THREE.RGBA_S3TC_DXT3_Format
break
case s:l=16,n.format=THREE.RGBA_S3TC_DXT5_Format
break
default:if(!(32==a[22]&&16711680&a[23]&&65280&a[24]&&255&a[25]&&4278190080&a[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(c)),n
d=!0,l=64,n.format=THREE.RGBAFormat}n.mipmapCount=1,a[7]>0&&!1!==t&&(n.mipmapCount=Math.max(1,a[7])),n.isCubemap=!!(512&a[28]),n.width=a[4],n.height=a[3]
for(var u=a[1]+4,h=n.width,p=n.height,m=n.isCubemap?6:1,g=0;g<m;g++){for(var f=0;f<n.mipmapCount;f++){if(d)var v=function(e,t,i,n){for(var o=i*n*4,r=new Uint8Array(e,t,o),s=new Uint8Array(o),a=0,l=0,c=0;c<n;c++)for(var d=0;d<i;d++){var u=r[l]
l++
var h=r[l]
l++
var p=r[l]
l++
var m=r[l]
l++,s[a]=p,a++,s[a]=h,a++,s[a]=u,a++,s[a]=m,a++}return s}(e,u,h,p),E=v.length
else var E=Math.max(4,h)/4*Math.max(4,p)/4*l,v=new Uint8Array(e,u,E)
var y={data:v,width:h,height:p}
n.mipmaps.push(y),u+=E,h=Math.max(.5*h,1),p=Math.max(.5*p,1)}h=n.width,p=n.height}return n}}function init_three_pvr_loader(){THREE.PVRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this._parser=THREE.PVRLoader.parse},THREE.PVRLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.PVRLoader.prototype.constructor=THREE.PVRLoader,THREE.PVRLoader.parse=function(e,t){var i=new Uint32Array(e,0,13),n={buffer:e,header:i,loadMipmaps:t}
if(55727696===i[0])return THREE.PVRLoader._parseV3(n)
if(559044176===i[11])return THREE.PVRLoader._parseV2(n)
throw new Error("[THREE.PVRLoader] Unknown PVR format")},THREE.PVRLoader._parseV3=function(e){var t,i,n=e.header,o=n[12],r=n[2],s=n[6],a=n[7],l=(n[9],n[10]),c=n[11]
switch(r){case 0:t=2,i=THREE.RGB_PVRTC_2BPPV1_Format
break
case 1:t=2,i=THREE.RGBA_PVRTC_2BPPV1_Format
break
case 2:t=4,i=THREE.RGB_PVRTC_4BPPV1_Format
break
case 3:t=4,i=THREE.RGBA_PVRTC_4BPPV1_Format
break
default:throw new Error("pvrtc - unsupported PVR format "+r)}return e.dataPtr=52+o,e.bpp=t,e.format=i,e.width=a,e.height=s,e.numSurfaces=l,e.numMipmaps=c,e.isCubemap=6===l,THREE.PVRLoader._extract(e)},THREE.PVRLoader._parseV2=function(e){var t,i,n=e.header,o=n[0],r=n[1],s=n[2],a=n[3],l=n[4],t=(n[5],n[6]),c=(n[7],n[8],n[9],n[10]),d=(n[11],n[12]),u=255&l,h=c>0
if(25===u)i=h?THREE.RGBA_PVRTC_4BPPV1_Format:THREE.RGB_PVRTC_4BPPV1_Format,t=4
else{if(24!==u)throw new Error("pvrtc - unknown format "+u)
i=h?THREE.RGBA_PVRTC_2BPPV1_Format:THREE.RGB_PVRTC_2BPPV1_Format,t=2}return e.dataPtr=o,e.bpp=t,e.format=i,e.width=s,e.height=r,e.numSurfaces=d,e.numMipmaps=a+1,e.isCubemap=6===d,THREE.PVRLoader._extract(e)},THREE.PVRLoader._extract=function(e){var t={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},i=e.buffer,n=e.dataPtr,o=e.bpp,r=e.numSurfaces,s=0,a=0,l=0,c=0,d=0,u=0
2===o?(l=8,c=4):(l=4,c=4),a=l*c*o/8,t.mipmaps.length=e.numMipmaps*r
for(var h=0;h<e.numMipmaps;){var p=e.width>>h,m=e.height>>h
d=p/l,u=m/c,d<2&&(d=2),u<2&&(u=2),s=d*u*a
for(var g=0;g<r;g++){var f=new Uint8Array(i,n,s),v={data:f,width:p,height:m}
t.mipmaps[g*e.numMipmaps+h]=v,n+=s}h++}return t}}function trace(e){"\n"==e[e.length-1]&&(e=e.substring(0,e.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+e)}function init_three_triangulator(){"use strict"
Autodesk.Viewing.Private.Triangulator||(Autodesk.Viewing.Private.Triangulator=function(){function e(e,t,i){return i+":"+(e<t?e+":"+t:t+":"+e)}function t(t,i,n,o,r,s,a){this.pt1=t,this.pt2=i,this.p1=-1,this.p2=-1,this.eid1=e(n,o,a),this.eid2=e(r,s,a)}function i(){this.bbox=new THREE.Box2,this.left=null,this.right=null,this.node_edges=[]}function n(e,t,i){this.pts=e,this.edges=t,this.bbox=i,this.pipResult=!1}function o(e,t){this.edges=e,this.bbox=t,this.pts=[],this.idmap={},this.xymap={},this.contours=[],this.scale=1e6/this.bbox.size().length()}function r(e){this.indices=[],this.cset=e
var t=this.pts=e.pts
this.intervalTree=new n(e.pts,e.edges,e.bbox),this.intervalTree.build()
for(var i=0;i<t.length;i++)t[i].id=i
var o=new lmv_poly2tri.SweepContext([])
if(o.points_=t.slice(),e.contours)for(var r=this.cset.contours,s=0;s<r.length;s++){for(var a=r[s],l=a[0]!==a[a.length-1],c=[],d=0;d<a.length-1;d++)c.push(t[a[d]])
o.initEdges(c,l)}else for(var u=this.cset.edges,i=0;i<u.length;i++){var h=u[i]
if(h.p1!=h.p2){var p=[t[h.p1],t[h.p2]]
o.initEdges(p,!0)}}this.triangulate(o),this.processResult(o)}var s=Autodesk.Viewing.Private
return n.prototype.splitNode=function(e){if(!(e.bbox.min.y>=e.bbox.max.y||e.node_edges.length<3)){var t=.5*(e.bbox.min.y+e.bbox.max.y)
e.left=new i,e.right=new i
for(var n=this.pts,o=e.node_edges,r=[],s=new THREE.Vector2,a=0;a<o.length;a++){var l=this.edges[o[a]],c=n[l.p1].y,d=n[l.p2].y
if(c>d){var u=c
c=d,d=u}var h=null
d<t?(e.left.node_edges.push(o[a]),h=e.left.bbox):c>t?(e.right.node_edges.push(o[a]),h=e.right.bbox):r.push(o[a]),h&&(s.set(n[l.p1].x,n[l.p1].y),h.expandByPoint(s),s.set(n[l.p2].x,n[l.p2].y),h.expandByPoint(s))}e.node_edges=r,e.left.node_edges.length&&this.splitNode(e.left),e.right.node_edges.length&&this.splitNode(e.right)}},n.prototype.build=function(){this.root=new i
for(var e=this.root.node_edges,t=0;t<this.edges.length;t++)e.push(t)
this.root.bbox.copy(this.bbox),this.splitNode(this.root)},n.prototype.pointInPolygonRec=function(e,t,i){if(e.bbox.min.y<=i&&e.bbox.max.y>=i)for(var n=this.pts,o=e.node_edges,r=0,s=o.length;r<s;r++){var a=this.edges[o[r]],l=n[a.p1],c=l.x,d=l.y,u=d>=i,h=n[a.p2],p=h.x,m=h.y,g=m>=i
u!=g&&(m-i)*(c-p)>=(p-t)*(d-m)==g&&(this.pipResult=!this.pipResult)}var f=e.left
f&&f.bbox.min.y<=i&&f.bbox.max.y>=i&&this.pointInPolygonRec(f,t,i)
var v=e.right
v&&v.bbox.min.y<=i&&v.bbox.max.y>=i&&this.pointInPolygonRec(v,t,i)},n.prototype.pointInPolygon=function(e,t){return this.pipResult=!1,this.pointInPolygonRec(this.root,e,t),this.pipResult},o.prototype.getPointIndex=function(e,t,i){var n=this.idmap[i]
if(void 0!==n)return n
var o,r=0|e*this.scale,s=0|t*this.scale,a=this.xymap[r]
return void 0===a?(this.xymap[r]=a={},o=void 0):o=a[s],void 0===o&&(a[s]=o=this.pts.length,this.idmap[i]=o,this.pts.push({x:e,y:t})),o},o.prototype.snapEdges=function(){for(var e=0;e<this.edges.length;e++){var t=this.edges[e]
t.p1=this.getPointIndex(t.pt1.x,t.pt1.y,t.eid1),t.p2=this.getPointIndex(t.pt2.x,t.pt2.y,t.eid2)}},o.prototype.sanitizeEdges=function(){for(var e={},t=[],i=0,n=this.edges.length;i<n;i++){var o=this.edges[i]
if(o.p1!==o.p2){var r=Math.min(o.p1,o.p2)+":"+Math.max(o.p1,o.p2)
!0!==e[r]&&(e[r]=!0,t.push(o))}}this.edges=t},o.prototype.stitchContours=function(){for(var e={},t=0;t<this.edges.length;t++){var i=this.edges[t]
i.p1!==i.p2&&(void 0!==e[i.p1]?e[i.p1].push(i.p2):e[i.p1]=[i.p2],void 0!==e[i.p2]?e[i.p2].push(i.p1):e[i.p2]=[i.p1])}var n=[]
for(var o in e)if(2!==e[o].length){s.logger.warn("Incomplete edge table")
break}for(;;){var r=void 0
for(var o in e)if(e[o].length>1){r=o
break}if(!r)for(var o in e)if(e[o].length>0){r=o
break}if(!r)break
var a=-1,l=parseInt(r),c=e[r]
for(n.push(l);c&&c.length;){var d=c.shift()
if(d===a&&(d=c.shift()),void 0===d){delete e[l]
break}n.push(d),0==c.length?delete e[l]:c[0]===a&&delete e[l],a=l,l=d,c=e[d]}n.length&&(this.contours.push(n),n=[])}for(var u=[],t=0;t<this.contours.length;t++){var h=this.contours[t]
h[0]!==h[h.length-1]&&u.push(h)}if(u.length)for(var p=!0;p;){p=!1
for(var m={},g=this.contours,t=0;t<g.length;t++){var h=g[t],f=h[0],v=h[h.length-1]
f!==v&&(m[f]?m[f].push(-t-1):m[f]=[-t-1],m[v]?m[v].push(t):m[v]=[t])}for(var o in m){var E=m[o]
if(2==E.length){var y=void 0
if(E[0]<0&&E[1]<0){var A=-E[0]-1,T=-E[1]-1
g[T].shift(),Array.prototype.push.apply(g[A].reverse(),g[T]),y=T}if(E[0]<0&&E[1]>0){var A=-E[0]-1,T=E[1]
g[T].pop(),Array.prototype.push.apply(g[T],g[A]),y=A}if(E[0]>0&&E[1]<0){var A=E[0],T=-E[1]-1
g[A].pop(),Array.prototype.push.apply(g[A],g[T]),y=T}if(E[0]>0&&E[1]>0){var A=E[0],T=E[1]
g[A].pop(),Array.prototype.push.apply(g[A],g[T].reverse()),y=T}void 0!==y&&(g.splice(y,1),p=!0)
break}}}},r.prototype.triangulate=function(e){try{e.triangulate()}catch(e){}},r.prototype.processResult=function(e){for(var t=0;t<e.map_.length;t++){var i=e.map_[t],n=i.points_[0],o=i.points_[1],r=i.points_[2]
void 0!==n.id&&void 0!==o.id&&void 0!==r.id&&this.filterFace(n.id,o.id,r.id)}},r.prototype.pointInEdgeList=function(e,t){for(var i,n,o,r,s,a,l=this.cset.pts,c=this.cset.edges,d=!1,u=0,h=c.length;u<h;++u){var p=c[u]
o=l[p.p1].x,r=l[p.p1].y,i=r>=t,s=l[p.p2].x,a=l[p.p2].y,n=a>=t,i!=n&&(a-t)*(o-s)>=(s-e)*(r-a)==n&&(d=!d)}return d},r.prototype.pointInContour=function(e,t,i){var n,o,r,s,a,l,c=!1,d=this.cset.pts
r=d[i[i.length-1]].x,s=d[i[i.length-1]].y,n=s>=t
for(var u=0,h=i.length;u<h;++u)a=d[i[u]].x,l=d[i[u]].y,o=l>=t,n!=o&&(l-t)*(r-a)>=(a-e)*(s-l)==o&&(c=!c),n=o,r=a,s=l
return c},r.prototype.pointInPolygon=function(e,t){for(var i=!1,n=0;n<this.cset.contours.length;n++)this.pointInContour(e,t,this.cset.contours[n])&&(i=!i)
return i},r.prototype.filterFace=function(e,t,i){var n=this.pts[e],o=this.pts[t],r=this.pts[i],s=(n.x+o.x+r.x)/3,a=(n.y+o.y+r.y)/3
if(this.intervalTree.pointInPolygon(s,a)){var l=o.x-n.x,c=o.y-n.y,d=r.x-n.x
l*(r.y-n.y)-d*c>0?this.indices.push(e,t,i):this.indices.push(e,i,t)}},{TriangulatedSurface:r,ContourSet:o,Edge:t}}())}function init_three_intersector(){"use strict"
Autodesk.Viewing.Private.Intersector||(Autodesk.Viewing.Private.Intersector=function(){function e(e){return Math.abs(e)<c}function t(t,i,n,o,r){var s=u.subVectors(n,i),a=t.normal.dot(s)
if(e(a))return o.copy(i),r.copy(n),2
a=1/a
var l=-(i.dot(t.normal)*a+t.constant*a)
if(l<-c||l>1+c)return 0
var d=s.multiplyScalar(l).add(i)
return o.copy(d),1}function i(e,i,n,o,r,s,a,u,m){var g=e.distanceToPoint(i),f=e.distanceToPoint(n),v=e.distanceToPoint(o)
if(g<-c&&f<-c&&v<-c)return null
if(g>c&&f>c&&v>c)return null
var E=Math.sign(g),y=Math.sign(f),A=Math.sign(v)
if(0===E&&0===y&&0===A)return null
var T,b,w,C,S,R
if(E!==y){var x=t(e,i,n,h,p)
if(2==x)return void u.push(new d(i.clone(),n.clone(),r,r,s,s,m))
1==x?(w=r,C=s,T=h.clone()):l.logger.warn("Unexpected zero intersections where at least one was expected")}if(y!==A){var x=t(e,n,o,h,p)
if(2==x)return void u.push(new d(n.clone(),o.clone(),s,s,a,a,m))
1==x?T?h.distanceTo(T)>c&&(S=s,R=a,b=h.clone()):(w=s,C=a,T=h.clone()):l.logger.warn("Unexpected zero intersections where at least one was expected")}if(A!==E){var x=t(e,o,i,h,p)
if(2==x)return void u.push(new d(o.clone(),i.clone(),a,a,r,r,m))
1==x?T?h.distanceTo(T)>c&&(S=a,R=r,b=h.clone()):l.logger.warn("Unexpected single intersection point"):l.logger.warn("Unexpected zero intersections where at least one was expected")}T&&b?u.push(new d(T,b,w,C,S,R,m)):l.logger.warn("Unexpected one intersection where two were expected")}function n(e,t){m.set(t.min.x,t.min.y,t.min.z)
var i=e.distanceToPoint(m),n=Math.sign(i)
m.set(t.min.x,t.min.y,t.max.z)
var o=e.distanceToPoint(m)
return Math.sign(o)!==n||(m.set(t.min.x,t.max.y,t.min.z),o=e.distanceToPoint(m),Math.sign(o)!==n||(m.set(t.min.x,t.max.y,t.max.z),o=e.distanceToPoint(m),Math.sign(o)!==n||(m.set(t.max.x,t.min.y,t.min.z),o=e.distanceToPoint(m),Math.sign(o)!==n||(m.set(t.max.x,t.min.y,t.max.z),o=e.distanceToPoint(m),Math.sign(o)!==n||(m.set(t.max.x,t.max.y,t.min.z),o=e.distanceToPoint(m),Math.sign(o)!==n||(m.set(t.max.x,t.max.y,t.max.z),o=e.distanceToPoint(m),Math.sign(o)!==n))))))}function o(e,t,n){var o=t.geometry,r=n.length,s=t.matrixWorld
g.getInverse(s),f.copy(e).applyMatrix4(g),l.VertexEnumerator.enumMeshTriangles(o,function(e,o,r,s,a,l){i(f,e,o,r,s,a,l,n,t.fragId)})
for(var a=r;a<n.length;a++)n[a].pt1.applyMatrix4(s),n[a].pt2.applyMatrix4(s)}function r(e,t,i){var n=t,o=Math.sqrt(1-n*n),r=1-n,s=e.x,a=e.y,l=e.z,c=r*s,d=r*a
i.set(c*s+n,c*a-o*l,c*l+o*a,0,c*a+o*l,d*a+n,d*l-o*s,0,c*l-o*a,d*l+o*s,r*l*l+n,0,0,0,0,1)}function s(t){var i=new THREE.Vector3(0,0,1),n=t.normal.clone().cross(i)
n=n.normalize()
var o=i.dot(t.normal),s=new THREE.Matrix4
return e(n.x)&&e(n.y)&&e(n.z)?s.elements[14]=o*t.constant:(r(n,o,s),s.elements[14]=t.constant),s}function a(e,t,i){for(var n=0;n<t.length;n++){var o=t[n]
o.pt1.applyMatrix4(e),o.pt2.applyMatrix4(e),i.expandByPoint(o.pt1),i.expandByPoint(o.pt2)}}var l=Autodesk.Viewing.Private,c=1e-10,d=Autodesk.Viewing.Private.Triangulator.Edge,u=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Matrix4,f=new THREE.Plane
return{makePlaneBasis:s,convertToPlaneCoords:a,intersectTrianglePlane:i,intersectMeshPlane:o,intersectBoxPlane:n}}())}function init_SectionMesh(){Autodesk.Viewing.Extensions.Section.SectionMesh||(Autodesk.Viewing.Extensions.Section.SectionMesh=function(e,t,i){THREE.Mesh.call(this,e,t,!1),this.plane=i,this.planeVec=new THREE.Vector4(i.normal.x,i.normal.y,i.normal.z,i.constant),this.connectivity=[],this.outlines=[]},Autodesk.Viewing.Extensions.Section.SectionMesh.prototype=Object.create(THREE.Mesh.prototype),Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionMesh,Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion)
var e=this.plane.normal,t=-1*this.getWorldPosition().dot(e)
this.planeVec.set(e.x,e.y,e.z,t),this.plane.constant=t})}function init_TransformGizmos(){"use strict"
var e=function(e){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}}
e.prototype=Object.create(THREE.MeshBasicMaterial.prototype)
var t=function(e){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}}
t.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(e,t,i,n){function o(e){var t=e.normalize().clone()
t.index=c.vertices.push(t)-1
var i=s(e)/2/Math.PI+.5,n=a(e)/Math.PI+.5
return t.uv=new THREE.Vector2(i,1-n),t}function r(e,t,i){var n=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()])
c.faces.push(n),E.copy(e).add(t).add(i).divideScalar(3)
var o=s(E)
c.faceVertexUvs[0].push([l(e.uv,e,o),l(t.uv,t,o),l(i.uv,i,o)])}function s(e){return Math.atan2(e.z,-e.x)}function a(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function l(e,t,i){return i<0&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},i=i||1,n=n||0
for(var c=this,d=0,u=e.length;d<u;d+=3)o(new THREE.Vector3(e[d],e[d+1],e[d+2]))
for(var h=this.vertices,p=[],d=0,m=0,u=t.length;d<u;d+=3,m++){var g=h[t[d]],f=h[t[d+1]],v=h[t[d+2]]
p[m]=new THREE.Face3(g.index,f.index,v.index,[g.clone(),f.clone(),v.clone()])}for(var E=new THREE.Vector3,d=0,u=p.length;d<u;d++)!function(e,t){for(var i=Math.pow(2,t),n=(Math.pow(4,t),o(c.vertices[e.a])),s=o(c.vertices[e.b]),a=o(c.vertices[e.c]),l=[],d=0;d<=i;d++){l[d]=[]
for(var u=o(n.clone().lerp(a,d/i)),h=o(s.clone().lerp(a,d/i)),p=i-d,m=0;m<=p;m++)l[d][m]=0==m&&d==i?u:o(u.clone().lerp(h,m/p))}for(var d=0;d<i;d++)for(var m=0;m<2*(i-d)-1;m++){var g=Math.floor(m/2)
m%2==0?r(l[d][g+1],l[d+1][g],l[d][g]):r(l[d][g+1],l[d+1][g+1],l[d+1][g])}}(p[d],n)
for(var d=0,u=this.faceVertexUvs[0].length;d<u;d++){var y=this.faceVertexUvs[0][d],A=y[0].x,T=y[1].x,b=y[2].x,w=Math.max(A,Math.max(T,b)),C=Math.min(A,Math.min(T,b))
w>.9&&C<.1&&(A<.2&&(y[0].x+=1),T<.2&&(y[1].x+=1),b<.2&&(y[2].x+=1))}for(var d=0,u=this.vertices.length;d<u;d++)this.vertices[d].multiplyScalar(i)
this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t}
var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2]
THREE.PolyhedronGeometry.call(this,i,n,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(e,t,i,n,o){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:o},e=e||100,t=t||40,i=i||8,n=n||6,o=o||2*Math.PI
for(var r=new THREE.Vector3,s=[],a=[],l=0;l<=i;l++)for(var c=0;c<=n;c++){var d=c/n*o,u=l/i*Math.PI*2
r.x=e*Math.cos(d),r.y=e*Math.sin(d)
var h=new THREE.Vector3
h.x=(e+t*Math.cos(u))*Math.cos(d),h.y=(e+t*Math.cos(u))*Math.sin(d),h.z=t*Math.sin(u),this.vertices.push(h),s.push(new THREE.Vector2(c/n,l/i)),a.push(h.clone().sub(r).normalize())}for(var l=1;l<=i;l++)for(var c=1;c<=n;c++){var p=(n+1)*l+c-1,m=(n+1)*(l-1)+c-1,g=(n+1)*(l-1)+c,f=(n+1)*l+c,v=new THREE.Face3(p,m,f,[a[p].clone(),a[m].clone(),a[f].clone()])
this.faces.push(v),this.faceVertexUvs[0].push([s[p].clone(),s[m].clone(),s[f].clone()]),v=new THREE.Face3(m,g,f,[a[m].clone(),a[g].clone(),a[f].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([s[m].clone(),s[g].clone(),s[f].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype))
var i=function(e,t,i){var n=new THREE.Geometry
i=i||1
for(var o=0;o<=64*i;++o)"x"==t&&n.vertices.push(new THREE.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(e)),"y"==t&&n.vertices.push(new THREE.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(e)),"z"==t&&n.vertices.push(new THREE.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(e))
return n},n=function(e,t,i,n,o,r){var s=new THREE.Geometry,a=new THREE.Mesh(new THREE.CylinderGeometry(e,t,i,n,o,r))
return a.position.y=.5,a.updateMatrix(),s.merge(a.geometry,a.matrix),s},o=function(e){var t=new THREE.Geometry
return"X"===e?t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===e?t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===e&&t.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),t}
THREE.TransformGizmo=function(){var e=this
this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers)
var e=new THREE.PlaneBufferGeometry(50,50,2,2),t=new THREE.MeshBasicMaterial({wireframe:!0})
t.side=THREE.DoubleSide
var i={XY:new THREE.Mesh(e,t),YZ:new THREE.Mesh(e,t),XZ:new THREE.Mesh(e,t),XYZE:new THREE.Mesh(e,t)}
this.activePlane=i.XYZE,i.YZ.rotation.set(0,Math.PI/2,0),i.XZ.rotation.set(-Math.PI/2,0,0)
for(var n in i)i[n].name=n,this.planes.add(i[n]),this.planes[n]=i[n],i[n].visible=!1
this.setupGizmos(),this.activeMode="",this.traverse(function(e){if(e instanceof THREE.Mesh){e.updateMatrix()
var t=new THREE.Geometry
e.geometry instanceof THREE.BufferGeometry&&(e.geometry=(new THREE.Geometry).fromBufferGeometry(e.geometry)),t.merge(e.geometry,e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}})},this.hide=function(){this.traverse(function(e){e.visible=!1})},this.show=function(){this.traverse(function(t){t.visible=!0,t.parent!=e.pickers&&t.parent!=e.hemiPicker||(t.visible=!1),t.parent==e.planes&&(t.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(e){this.traverse(function(t){t.material&&t.material.highlight&&(t.name==e?t.material.highlight(!0):t.material.highlight(!1))})},this.setupGizmos=function(){var e=function(e,t){for(var i in e)for(var n=e[i].length;n--;){var o=e[i][n][0],r=e[i][n][1],s=e[i][n][2],a=e[i][n][3]
o.name=i,r&&o.position.set(r[0],r[1],r[2]),s&&o.rotation.set(s[0],s[1],s[2]),a&&(o.visble=a),t.add(o)}}
this.setHandlePickerGizmos(),e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),e(this.highlightGizmos,this.highlights),e(this.hemiPickerGizmos,this.hemiPicker),e(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(e,t){var i=new THREE.Vector3(0,0,0),n=new THREE.Vector3(0,1,0),o=new THREE.Matrix4
this.traverse(function(r){r.name&&(-1!=r.name.search("E")?r.quaternion.setFromRotationMatrix(o.lookAt(t,i,n)):-1==r.name.search("X")&&-1==r.name.search("Y")&&-1==r.name.search("Z")||r.quaternion.setFromEuler(e))})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var i=n(0,.05,.2,12,1,!1),r=o("X"),s=o("Y"),a=o("Z")
this.handleGizmos={X:[[new THREE.Mesh(i,new e({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(r,new t({color:15805484}))]],Y:[[new THREE.Mesh(i,new e({color:768011})),[0,.5,0]],[new THREE.Line(s,new t({color:768011}))]],Z:[[new THREE.Mesh(i,new e({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new t({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new e({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new e({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new e({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new e({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new e({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(e,t){var i=new THREE.Matrix4
t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),"XY"==e&&(this.activePlane=this.planes.XY),"YZ"==e&&(this.activePlane=this.planes.YZ),"XZ"==e&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(i(1,"x",.5),new t({color:16711680}))]],RY:[[new THREE.Line(i(1,"y",.5),new t({color:65280}))]],RZ:[[new THREE.Line(i(1,"z",.5),new t({color:255}))]],RE:[[new THREE.Line(i(1.25,"z",1),new t({color:65535}))]],RXYZE:[[new THREE.Line(i(1,"z",1),new t({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new e({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new e({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new e({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(e){"RE"==e&&(this.activePlane=this.planes.XYZE),"RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(e,t){THREE.TransformGizmo.prototype.update.apply(this,arguments)
var i=new THREE.Matrix4,n=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),a=new THREE.Vector3(0,0,1),l=new THREE.Quaternion,c=new THREE.Quaternion,d=new THREE.Quaternion,u=t.clone()
n.copy(this.planes.XY.rotation),o.setFromEuler(n),i.makeRotationFromQuaternion(o).getInverse(i),u.applyMatrix4(i),this.traverse(function(e){o.setFromEuler(n),"RX"==e.name&&(l.setFromAxisAngle(r,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RY"==e.name&&(c.setFromAxisAngle(s,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RZ"==e.name&&(d.setFromAxisAngle(a,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,d),e.quaternion.copy(o))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this)
var t=this
this.setHandlePickerGizmos=function(){var t=n(0,.05,.2,12,1,!1);(new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0))
this.handleGizmos={Z:[[new THREE.Mesh(t,new e({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new e({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new e({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new e({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new e({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new e({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new e({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new e({color:255})),null,null,!1]]}},this.setActivePlane=function(e,t){if("translate"==this.activeMode){var i=new THREE.Matrix4
t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY))
this.hide(),this.show()},this.update=function(e,t){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments)
else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments)
var i=new THREE.Matrix4,n=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),s=new THREE.Vector3(0,1,0),a=new THREE.Vector3(0,0,1),l=new THREE.Quaternion,c=new THREE.Quaternion,d=new THREE.Quaternion,u=t.clone()
n.copy(this.planes.XY.rotation),o.setFromEuler(n),i.makeRotationFromQuaternion(o).getInverse(i),u.applyMatrix4(i),this.traverse(function(e){o.setFromEuler(n),"RX"==e.name&&(l.setFromAxisAngle(r,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RY"==e.name&&(c.setFromAxisAngle(s,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RZ"==e.name&&(d.setFromAxisAngle(a,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,d),e.quaternion.copy(o))})}},this.show=function(){this.traverse(function(e){(null==t.parent||t.parent.useAllPickers||e.parent!=t.handles)&&(e.visible=!0),e.material&&(e.material.opacity=e.material.oldOpacity),e.parent!=t.pickers&&e.parent!=t.hemiPicker&&e.parent!=t.subPickers||(e.visible=!1),e.parent!=t.planes&&e.parent!=t.highlights||(e.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(e){this.traverse(function(i){i.material&&i.material.highlight&&(i.name==e?(i.parent!=t.highlights&&i.parent!=t.handles||(i.visible=!0),i.material.highlight(!0)):(i.material.highlight(!1),i.material.opacity=.1))})},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var i=n(.125,.125,.125),r=o("X"),s=o("Y"),a=o("Z")
this.handleGizmos={X:[[new THREE.Mesh(i,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(r,new t({color:16711680}))]],Y:[[new THREE.Mesh(i,new e({color:65280})),[0,.5,0]],[new THREE.Line(s,new t({color:65280}))]],Z:[[new THREE.Mesh(i,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(a,new t({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new e({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new e({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(e,t){var i=new THREE.Matrix4
t.applyMatrix4(i.getInverse(i.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(e,t,i){function n(i,n){var o=t.getBoundingClientRect(),r=(i.clientX-o.left)/o.width*2-1,s=-(i.clientY-o.top)/o.height*2+1
e.isPerspective?(v.set(r,s,.5),v.unproject(e),f.set(e.position,v.sub(e.position).normalize())):(v.set(r,s,-1),v.unproject(e),E.set(0,0,-1),f.set(v,E.transformDirection(e.matrixWorld)))
var a=f.intersectObjects(n,!0)
return!!a[0]&&a[0]}switch(THREE.Object3D.call(this),t=void 0!==t?t:document,this.gizmo={},i){case"translate":this.gizmo[i]=new THREE.TransformGizmoTranslate
break
case"rotate":this.gizmo[i]=new THREE.TransformGizmoRotate
break
case"transrotate":this.gizmo[i]=new THREE.TransformGizmoTranslateRotate
break
case"scale":this.gizmo[i]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[i]),this.gizmo[i].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===i){var o=new THREE.Geometry
o.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1))
var r=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1})
this.startLine=new THREE.Line(o,r)
var o=new THREE.Geometry,r=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1})
o.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(o,r)
var o=new THREE.Geometry,r=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1})
o.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(o,r)
var s=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"))
s.magFilter=s.minFilter=THREE.NearestFilter
var o=new THREE.CircleGeometry(.1,32),r=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:s})
this.centerMark=new THREE.Mesh(o,r),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={}
var s=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"))
s.magFilter=s.minFilter=THREE.NearestFilter
var r=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:s}),a=.25
this.ticks.RX=new THREE.Object3D
var o=new THREE.PlaneBufferGeometry(.12,a),l=new THREE.Mesh(o,r)
l.position.set(0,0,-1.275),l.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(l),l=l.clone(),l.position.set(0,1.275,0),l.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(l),l=l.clone(),l.position.set(0,0,1.275),l.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(l),l=l.clone(),l.position.set(0,-1.275,0),l.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(l),this.ticks.RY=new THREE.Object3D,l=l.clone(),l.position.set(0,0,-1.275),l.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(l),l=l.clone(),l.position.set(-1.275,0,0),l.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(l),l=l.clone(),l.position.set(0,0,1.275),l.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(l),l=l.clone(),l.position.set(1.275,0,0),l.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(l)}var c=this,d=!1,u=i,h={type:"change"},p={type:"mouseDown"},m={type:"mouseUp",mode:u},g={type:"objectChange"},f=new THREE.Raycaster,v=new THREE.Vector3,E=new THREE.Vector3,y=new THREE.Vector3,A=new THREE.Vector3,T=new THREE.Vector3,b=new THREE.Vector3,w=1,C=new THREE.Matrix4,S=new THREE.Vector3,R=new THREE.Matrix4,x=new THREE.Vector3,P=new THREE.Quaternion,k=new THREE.Vector3,M=new THREE.Vector3,V=new THREE.Vector3,I=new THREE.Quaternion,L=new THREE.Quaternion,D=new THREE.Quaternion,N=new THREE.Quaternion,_=new THREE.Quaternion,O=new THREE.Vector3,H=new THREE.Vector3,B=new THREE.Matrix4,F=new THREE.Matrix4,G=new THREE.Vector3,z=new THREE.Vector3,U=new THREE.Euler,W=new THREE.Matrix4,j=new THREE.Vector3
new THREE.Euler
this.attach=function(e){c.object=e,this.gizmo[u].show(),c.update(),c.updateUnitVectors()},this.detach=function(e){c.object=void 0,this.axis=null,this.gizmo[u].hide()},this.setMode=function(e){u=e||u,"scale"==u&&(c.space="local"),this.gizmo[u].show(),this.update(),c.dispatchEvent(h)},this.getPicker=function(){return c.gizmo[u].hemiPicker.children},this.setPosition=function(e){this.object.position.copy(e),this.update()},this.setNormal=function(e){P.setFromUnitVectors(this.normal,e),this.unitX.applyQuaternion(P),this.unitY.applyQuaternion(P),this.unitZ.applyQuaternion(P),this.normal.copy(e),this.object&&this.object.quaternion.multiply(P),this.update()},this.setSnap=function(e,t){c.snap=e,c.snapDelta=t},this.setSize=function(e){c.size=e,this.update(),c.dispatchEvent(h)},this.setSpace=function(e){c.space=e,this.update(),c.dispatchEvent(h)},this.update=function(i){if(void 0!==c.object){c.object.updateMatrixWorld(),z.setFromMatrixPosition(c.object.matrixWorld),U.setFromRotationMatrix(R.extractRotation(c.object.matrixWorld)),e.updateMatrixWorld(),j.setFromMatrixPosition(e.matrixWorld),this.position.copy(z),this.quaternion.setFromEuler(U),this.normal.set(0,0,1),this.normal.applyEuler(U)
var n
if(e.isPerspective){var o=z.distanceTo(j)
n=2*Math.tan(e.fov*Math.PI/360)*o}else n=e.top-e.bottom
var r=t.getBoundingClientRect()
w=100*n/r.height,this.scale.set(w,w,w),i&&this.gizmo[u].highlight(c.axis)}},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(U),this.unitY.applyEuler(U),this.unitZ.applyEuler(U)},this.showRotationGizmos=function(e){for(var t=this.gizmo[u].handles.children,i=0;i<t.length;i++){var n=t[i]
n.visible=!0,-1!==n.name.search("R")&&(n.visible=e)}this.useAllPickers=e},this.highlight=function(){this.gizmo[u].highlight(this.axis||"Z")},this.onPointerHover=function(e){if(void 0===c.object||!0===d)return!1
var t=e.pointers?e.pointers[0]:e,i=n(t,c.useAllPickers?c.gizmo[u].pickers.children:c.gizmo[u].subPickers.children),o=null,r=""
return i&&(o=i.object.name,r=-1!=o.search("R")?"rotate":"translate"),c.axis!==o&&(c.axis=o,c.gizmo[u].activeMode=r,c.update(!0),c.dispatchEvent(h)),null===c.axis&&c.gizmo[u].show(),!!i},this.onPointerDown=function(t){if(void 0===c.object||!0===d)return!1
var i=t.pointers?t.pointers[0]:t
if("touch"===t.pointerType){var o=n(i,c.useAllPickers?c.gizmo[u].pickers.children:c.gizmo[u].subPickers.children),r=null,s=""
o&&(r=o.object.name,s=-1!=r.search("R")?"rotate":"translate"),c.axis!==r&&(c.axis=r,c.gizmo[u].activeMode=s)}var o=null
if((0===i.button||void 0===i.button)&&(o=n(i,c.useAllPickers?c.gizmo[u].pickers.children:c.gizmo[u].subPickers.children))){c.dispatchEvent(p),c.axis=o.object.name,c.update(),S.copy(e.position).sub(z).normalize(),c.gizmo[u].setActivePlane(c.axis,S)
var a=n(i,[c.gizmo[u].activePlane])
if(a&&A.copy(a.point),O.copy(c.object.position),H.copy(c.object.scale),B.extractRotation(c.object.matrix),W.extractRotation(c.object.matrixWorld),c.object.parent?(F.extractRotation(c.object.parent.matrixWorld),G.setFromMatrixScale(R.getInverse(c.object.parent.matrixWorld))):(F.extractRotation(c.object.matrixWorld),G.setFromMatrixScale(R.getInverse(c.object.matrixWorld))),"transrotate"===u&&"rotate"===c.gizmo[u].activeMode){c.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(c.matrixWorld),c.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(c.matrixWorld),c.startLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.startLine)
var l=c.object.geometry.getAttribute("position"),h=(new THREE.Vector3).fromAttribute(l,0).applyMatrix4(c.object.matrixWorld),m=(new THREE.Vector3).fromAttribute(l,1).applyMatrix4(c.object.matrixWorld),g=(new THREE.Vector3).fromAttribute(l,2).applyMatrix4(c.object.matrixWorld),f=(new THREE.Vector3).fromAttribute(l,3).applyMatrix4(c.object.matrixWorld)
if("RX"===c.axis){h.lerp(g,.5),m.lerp(f,.5)
var v=h.distanceTo(m)
c.centerLine.material.dashSize=v/15,c.centerLine.material.gapSize=v/30,c.centerLine.geometry.vertices[0].copy(h),c.centerLine.geometry.vertices[1].copy(m)}else{h.lerp(m,.5),g.lerp(f,.5)
var v=h.distanceTo(g)
c.centerLine.material.dashSize=v/15,c.centerLine.material.gapSize=v/30,c.centerLine.geometry.vertices[0].copy(h),c.centerLine.geometry.vertices[1].copy(g)}c.centerLine.geometry.computeLineDistances(),c.centerLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.centerLine),c.ticks[c.axis].position.copy(c.position),c.ticks[c.axis].quaternion.copy(c.quaternion),c.ticks[c.axis].scale.copy(c.scale),c.parent.add(c.ticks[c.axis])}}return d=!0,!!o},this.onPointerMove=function(e){if(void 0===c.object||null===c.axis||!1===d)return!1
var t=e.pointers?e.pointers[0]:e,i=n(t,[c.gizmo[u].activePlane])
i&&y.copy(i.point)
var o=c.gizmo[u].activeMode
if("translate"==o)y.sub(A),y.multiply(G),"local"==c.space&&(y.applyMatrix4(R.getInverse(W)),k.copy(this.unitX),M.copy(this.unitY),V.copy(this.unitZ),x.set(0,0,0),-1!=c.axis.search("X")&&(k.multiplyScalar(y.dot(this.unitX)),x.add(k)),-1!=c.axis.search("Y")&&(M.multiplyScalar(y.dot(this.unitY)),x.add(M)),-1!=c.axis.search("Z")&&(V.multiplyScalar(y.dot(this.unitZ)),x.add(V)),y.copy(x),y.applyMatrix4(B),c.object.position.copy(O),c.object.position.add(y)),"world"!=c.space&&-1==c.axis.search("XYZ")||(k.copy(this.unitX),M.copy(this.unitY),V.copy(this.unitZ),x.set(0,0,0),-1!=c.axis.search("X")&&(k.multiplyScalar(y.dot(this.unitX)),x.add(k)),-1!=c.axis.search("Y")&&(M.multiplyScalar(y.dot(this.unitY)),x.add(M)),-1!=c.axis.search("Z")&&(V.multiplyScalar(y.dot(this.unitZ)),x.add(V)),y.copy(x),y.applyMatrix4(R.getInverse(F)),c.object.position.copy(O),c.object.position.add(y))
else if("scale"==o)y.sub(A),y.multiply(G),"local"==c.space&&("XYZ"==c.axis?(w=1+y.y/50,c.object.scale.x=H.x*w,c.object.scale.y=H.y*w,c.object.scale.z=H.z*w):(y.applyMatrix4(R.getInverse(W)),"X"==c.axis&&(c.object.scale.x=H.x*(1+y.x/50)),"Y"==c.axis&&(c.object.scale.y=H.y*(1+y.y/50)),"Z"==c.axis&&(c.object.scale.z=H.z*(1+y.z/50))))
else if("rotate"==o){if(y.sub(z),y.multiply(G),x.copy(A).sub(z),x.multiply(G),"RE"==c.axis){y.applyMatrix4(R.getInverse(C)),x.applyMatrix4(R.getInverse(C)),T.set(Math.atan2(y.z,y.y),Math.atan2(y.x,y.z),Math.atan2(y.y,y.x)),b.set(Math.atan2(x.z,x.y),Math.atan2(x.x,x.z),Math.atan2(x.y,x.x)),P.setFromRotationMatrix(R.getInverse(F))
var r=T.z-b.z
if(null!==c.snap){var s=Math.round(r/c.snap)*c.snap
Math.abs(s-r)<c.snapDelta&&(r=s)}_.setFromAxisAngle(S,r),I.setFromRotationMatrix(W),P.multiplyQuaternions(P,_),P.multiplyQuaternions(P,I),c.object.quaternion.copy(P)}else if("RXYZE"==c.axis){var a=y.clone().cross(x).normalize()
P.setFromRotationMatrix(R.getInverse(F))
var l=-y.clone().angleTo(x)
if(null!==c.snap){var s=Math.round(l/c.snap)*c.snap
Math.abs(s-l)<c.snapDelta&&(l=s)}L.setFromAxisAngle(a,l),I.setFromRotationMatrix(W),P.multiplyQuaternions(P,L),P.multiplyQuaternions(P,I),c.object.quaternion.copy(P)}else if("local"==c.space){y.applyMatrix4(R.getInverse(W)),x.applyMatrix4(R.getInverse(W))
var p=y.dot(this.unitX),m=y.dot(this.unitY),f=y.dot(this.unitZ),v=x.dot(this.unitX),E=x.dot(this.unitY),U=x.dot(this.unitZ)
T.set(Math.atan2(f,m),Math.atan2(p,f),Math.atan2(m,p)),b.set(Math.atan2(U,E),Math.atan2(v,U),Math.atan2(E,v))
var j=T.x-b.x,Y=T.y-b.y,r=T.z-b.z
if(null!==c.snap){if(-1!=c.axis.search("X")){var s=Math.round(j/c.snap)*c.snap
Math.abs(s-j)<c.snapDelta&&(j=s)}if(-1!=c.axis.search("Y")){var s=Math.round(Y/c.snap)*c.snap
Math.abs(s-Y)<c.snapDelta&&(Y=s)}if(-1!=c.axis.search("Z")){var s=Math.round(r/c.snap)*c.snap
Math.abs(s-r)<c.snapDelta&&(r=s)}}L.setFromAxisAngle(this.unitX,j),D.setFromAxisAngle(this.unitY,Y),N.setFromAxisAngle(this.unitZ,r),I.setFromRotationMatrix(B),"RX"==c.axis&&I.multiplyQuaternions(I,L),"RY"==c.axis&&I.multiplyQuaternions(I,D),"RZ"==c.axis&&I.multiplyQuaternions(I,N),c.object.quaternion.copy(I)}else if("world"==c.space){var p=y.dot(this.unitX),m=y.dot(this.unitY),f=y.dot(this.unitZ),v=x.dot(this.unitX),E=x.dot(this.unitY),U=x.dot(this.unitZ)
T.set(Math.atan2(f,m),Math.atan2(p,f),Math.atan2(m,p)),b.set(Math.atan2(U,E),Math.atan2(v,U),Math.atan2(E,v)),P.setFromRotationMatrix(R.getInverse(F))
var j=T.x-b.x,Y=T.y-b.y,r=T.z-b.z
if(null!==c.snap){if(-1!=c.axis.search("X")){var s=Math.round(j/c.snap)*c.snap
Math.abs(s-j)<c.snapDelta&&(j=s)}if(-1!=c.axis.search("Y")){var s=Math.round(Y/c.snap)*c.snap
Math.abs(s-Y)<c.snapDelta&&(Y=s)}if(-1!=c.axis.search("Z")){var s=Math.round(r/c.snap)*c.snap
Math.abs(s-r)<c.snapDelta&&(r=s)}}L.setFromAxisAngle(this.unitX,j),D.setFromAxisAngle(this.unitY,Y),N.setFromAxisAngle(this.unitZ,r),I.setFromRotationMatrix(W),"RX"==c.axis&&P.multiplyQuaternions(P,L),"RY"==c.axis&&P.multiplyQuaternions(P,D),"RZ"==c.axis&&P.multiplyQuaternions(P,N),P.multiplyQuaternions(P,I),c.object.quaternion.copy(P)}"transrotate"===u&&(c.add(c.endLine),c.add(c.centerMark))}return c.object.matrixAutoUpdate=!0,c.update(!0),c.dispatchEvent(h),c.dispatchEvent(g),!!i},this.onPointerUp=function(e){return d&&null!==c.axis&&(m.mode=u,c.dispatchEvent(m)),d=!1,this.gizmo[u].show(),this.updateUnitVectors(),"transrotate"===u&&"rotate"===this.gizmo[u].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}!function(){function e(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:global}function t(t){for(var i=e(),n=t.split("."),o=0;o<n.length;++o)i[n[o]]=i[n[o]]||{},i=i[n[o]]
return i}t("Autodesk.Viewing.Private"),t("Autodesk.Viewing.Extensions"),t("Autodesk.Viewing.Shaders"),t("Autodesk.Viewing.UI"),t("Autodesk.LMVTK"),Autodesk.Viewing.getGlobal=e,Autodesk.Viewing.AutodeskNamespace=t,e().AutodeskNamespace=t}(),Autodesk.Viewing.Private.initializeLegacyNamespaces=function(e){var t=Autodesk.Viewing,i=t.Shaders,n=t.Private
n.InstanceTreeStorage=WGS.InstanceTreeStorage,n.InstanceTreeAccess=WGS.InstanceTreeAccess,n.BVHBuilder=WGS.BVHBuilder,n.NodeArray=WGS.NodeArray,e||(i.PackDepthShaderChunk=WGS.PackDepthShaderChunk,i.TonemapShaderChunk=WGS.TonemapShaderChunk,i.OrderedDitheringShaderChunk=WGS.OrderedDitheringShaderChunk,i.CutPlanesUniforms=WGS.CutPlanesUniforms,i.CutPlanesShaderChunk=WGS.CutPlanesShaderChunk,i.PackNormalsShaderChunk=WGS.PackNormalsShaderChunk,i.HatchPatternShaderChunk=WGS.HatchPatternShaderChunk,i.EnvSamplingShaderChunk=WGS.EnvSamplingShaderChunk,i.IdUniforms=WGS.IdUniforms,i.IdFragmentDeclaration=WGS.IdFragmentDeclaration,i.IdOutputShaderChunk=WGS.IdOutputShaderChunk,i.FinalOutputShaderChunk=WGS.FinalOutputShaderChunk,i.ThemingUniform=WGS.ThemingUniform,i.ThemingFragmentDeclaration=WGS.ThemingFragmentDeclaration,i.ThemingFragmentShaderChunk=WGS.ThemingFragmentShaderChunk,i.BackgroundShader=WGS.BackgroundShader,i.BlendShader=WGS.BlendShader,i.CelShader=WGS.CelShader,i.CopyShader=WGS.CopyShader,i.FXAAShader=WGS.FXAAShader,i.SAOBlurShader=WGS.SAOBlurShader,i.SAOMinifyFirstShader=WGS.SAOMinifyFirstShader,i.SAOMinifyShader=WGS.SAOMinifyShader,i.SAOShader=WGS.SAOShader,i.NormalsShader=WGS.NormalsShader,i.EdgeShader=WGS.EdgeShader,i.LineShader=WGS.LineShader,n.LineStyleDefs=WGS.LineStyleDefs,n.CreateLinePatternTexture=WGS.CreateLinePatternTexture,n.FloatToHalf=WGS.FloatToHalf,n.HalfToFloat=WGS.HalfToFloat,n.IntToHalf=WGS.IntToHalf,n.HalfToInt=WGS.HalfToInt,n.HalfTest=WGS.HalfTest,i.createShaderMaterial=WGS.createShaderMaterial,i.setMacro=WGS.setMacro,i.removeMacro=WGS.removeMacro,i.LmvShaderPass=WGS.ShaderPass,i.GaussianPass=WGS.GaussianPass,i.GroundShadow=WGS.GroundShadow,i.createGroundShape=WGS.createGroundShape,i.setGroundShapeTransform=WGS.setGroundShapeTransform,i.GroundReflection=WGS.GroundReflection,n.FireflyWebGLShader=WGS.WebGLShader,n.PrismMaps=WGS.PrismMaps,n.GetPrismMapChunk=WGS.GetPrismMapChunk,n.FireflyWebGLProgram=WGS.WebGLProgram,i.ShadowMapCommonUniforms=WGS.ShadowMapCommonUniforms,i.ShadowMapUniforms=WGS.ShadowMapUniforms,i.ShadowMapDeclareCommonUniforms=WGS.ShadowMapDeclareCommonUniforms,i.ShadowMapVertexDeclaration=WGS.ShadowMapVertexDeclaration,i.ShadowMapVertexShaderChunk=WGS.ShadowMapVertexShaderChunk,i.ShadowMapFragmentDeclaration=WGS.ShadowMapFragmentDeclaration,i.FireflyPhongShader=WGS.PhongShader,i.PrismShader=WGS.PrismShader,i.GetPrismMapUniforms=WGS.GetPrismMapUniforms,i.GetPrismMapSampleChunk=WGS.GetPrismMapSampleChunk,i.GetPrismMapUniformChunk=WGS.GetPrismMapUniformChunk,i.AverageOfFloat3=WGS.AverageOfFloat3,n.createPrismMaterial=WGS.createPrismMaterial,n.clonePrismMaterial=WGS.clonePrismMaterial,n.ShadowMapShader=WGS.ShadowMapShader,n.GroundShadowShader=WGS.GroundShadowShader,n.ShadowMapOverrideMaterials=WGS.ShadowMapOverrideMaterials,n.SHADOWMAP_NEEDS_UPDATE=WGS.SHADOWMAP_NEEDS_UPDATE,n.SHADOWMAP_INCOMPLETE=WGS.SHADOWMAP_INCOMPLETE,n.SHADOWMAP_VALID=WGS.SHADOWMAP_VALID,n.ShadowConfig=WGS.ShadowConfig,n.ShadowRender=WGS.ShadowRender,n.ShadowMaps=WGS.ShadowMaps,n.FrustumIntersector=WGS.FrustumIntersector,n.OUTSIDE=WGS.OUTSIDE,n.INTERSECTS=WGS.INTERSECTS,n.CONTAINS=WGS.CONTAINS,n.VBIntersector=WGS.VBIntersector,n.VertexEnumerator=WGS.VertexEnumerator,n.GPU_MEMORY_LIMIT=WGS.GPU_MEMORY_LIMIT,n.GPU_OBJECT_LIMIT=WGS.GPU_OBJECT_LIMIT,n.PAGEOUT_SUCCESS=WGS.PAGEOUT_SUCCESS,n.PAGEOUT_FAIL=WGS.PAGEOUT_FAIL,n.PAGEOUT_NONE=WGS.PAGEOUT_NONE,n.GeometryList=WGS.GeometryList,n.MESH_VISIBLE=WGS.MESH_VISIBLE,n.MESH_HIGHLIGHTED=WGS.MESH_HIGHLIGHTED,n.MESH_HIDE=WGS.MESH_HIDE,n.MESH_ISLINE=WGS.MESH_ISLINE,n.MESH_ISWIDELINE=WGS.MESH_ISWIDELINE,n.MESH_ISPOINT=WGS.MESH_ISPOINT,n.MESH_MOVED=WGS.MESH_MOVED,n.MESH_TRAVERSED=WGS.MESH_TRAVERSED,n.MESH_DRAWN=WGS.MESH_DRAWN,n.MESH_RENDERFLAG=WGS.MESH_RENDERFLAG,n.FragmentPointer=WGS.FragmentPointer,n.FragmentList=WGS.FragmentList,n.RENDER_NORMAL=WGS.RENDER_NORMAL,n.RENDER_HIGHLIGHTED=WGS.RENDER_HIGHLIGHTED,n.RENDER_HIDDEN=WGS.RENDER_HIDDEN,n.RENDER_SHADOWMAP=WGS.RENDER_SHADOWMAP,n.RENDER_FINISHED=WGS.RENDER_FINISHED,n.GROUND_UNFINISHED=WGS.GROUND_UNFINISHED,n.GROUND_FINISHED=WGS.GROUND_FINISHED,n.GROUND_RENDERED=WGS.GROUND_RENDERED,n.RenderBatch=WGS.RenderBatch,t.rescueFromPolymer=WGS.rescueFromPolymer,n.FireflyWebGLRenderer=WGS.WebGLRenderer,n.ModelIteratorLinear=WGS.ModelIteratorLinear,n.ModelIteratorBVH=WGS.ModelIteratorBVH,n.BufferGeometryUtils=WGS.BufferGeometry,n.RenderScene=WGS.RenderScene,n.SortedList=WGS.SortedList,n.ModelIteratorTexQuad=WGS.ModelIteratorTexQuad,n.TexQuadConfig=WGS.TexQuadConfig,n.InstanceTree=WGS.InstanceTree,t.SelectionMode=WGS.SelectionMode,n.MaterialConverter=WGS.MaterialConverter)}
var av=Autodesk.Viewing,avp=av.Private
av.getGlobal=getGlobal
var isBrowser=av.isBrowser="undefined"!=typeof navigator,isIE11=av.isIE11=isBrowser&&!!navigator.userAgent.match(/Edge|Trident\/7\./)
"undefined"!=typeof window&&isIE11&&function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0}
var i=document.createEvent("CustomEvent")
return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.CustomEvent.prototype,window.CustomEvent=e}(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){if(!t||t>this.byteLength?t=this.byteLength:t<0&&(t=this.byteLength+t)<0&&(t=0),e<0&&(e=this.byteLength+e)<0&&(e=0),t<=e)return new ArrayBuffer
for(var i=t-e,n=new Uint8Array(this,e,i),o=new Uint8Array(i),r=0;r<i;r++)o[r]=n[r]
return o.buffer}),function(){Math.log2=Math.log2||function(e){return Math.log(e)/Math.LN2}}(),"undefined"!=typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)
var launchFullscreen=av.launchFullscreen=function(e,t){e.requestFullscreen?e.requestFullscreen(t):e.mozRequestFullScreen?e.mozRequestFullScreen(t):e.webkitRequestFullscreen?e.webkitRequestFullscreen(t):e.msRequestFullscreen&&e.msRequestFullscreen(t)},exitFullscreen=av.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},inFullscreen=av.inFullscreen=function(){return"webkitIsFullScreen"in document?!!document.webkitIsFullScreen:"fullscreenElement"in document?!!document.fullscreenElement:"mozFullScreenElement"in document?!!document.mozFullScreenElement:"msFullscreenElement"in document?!!document.msFullscreenElement:!!document.querySelector(".viewer-fill-browser")},fullscreenElement=av.fullscreenElement=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},isFullscreenAvailable=av.isFullscreenAvailable=function(e){return e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen},getAndroidVersion=av.getAndroidVersion=function(e){e=e||navigator.userAgent
var t=e.match(/Android\s([0-9\.]*)/)
return!!t&&t[1]},isTouchDevice=av.isTouchDevice=function(){return"undefined"!=typeof window&&"ontouchstart"in window}
av.isIOSDevice=function(){return!!isBrowser&&/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())},av.isAndroidDevice=function(){return!!isBrowser&&-1!==navigator.userAgent.toLowerCase().indexOf("android")},av.isMobileDevice=function(){return!!isBrowser&&(av.isIOSDevice()||av.isAndroidDevice())},av.isSafari=function(){if(!isBrowser)return!1
var e=navigator.userAgent.toLowerCase()
return-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")},av.isFirefox=function(){return!!isBrowser&&-1!==navigator.userAgent.toLowerCase().indexOf("firefox")},av.isChrome=function(){return!!isBrowser&&-1!==navigator.userAgent.toLowerCase().indexOf("chrome")},av.isMac=function(){return!!isBrowser&&-1!==navigator.userAgent.toLowerCase().indexOf("mac os")},av.isWindows=function(){if(!isBrowser)return!1
var e=navigator.userAgent.toLowerCase()
return-1!==e.indexOf("win32")||-1!==e.indexOf("windows")},av.ObjectAssign=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])
return e},avp.disableTouchSafari=function(e){var t=window.hasOwnProperty("pageXOffset")?window.pageXOffset:document.documentElement.scrollLeft,i=window.hasOwnProperty("pageYOffset")?window.pageYOffset:document.documentElement.scrollTop,n=document.elementFromPoint(e.pageX-t,e.pageY-i)
return!n||"CANVAS"!==n.nodeName||(!!n.getAttribute(!0)||(e.preventDefault(),!1))},avp.disableDocumentTouchSafari=function(){av.isMobileDevice()&&av.isSafari()&&(document.documentElement.addEventListener("touchstart",avp.disableTouchSafari,!0),document.documentElement.addEventListener("touchmove",avp.disableTouchSafari,!0),document.documentElement.addEventListener("touchcanceled",avp.disableTouchSafari,!0),document.documentElement.addEventListener("touchend",avp.disableTouchSafari,!0))},avp.enableDocumentTouchSafari=function(){av.isMobileDevice()&&av.isSafari()&&(document.documentElement.removeEventListener("touchstart",avp.disableTouchSafari,!0),document.documentElement.removeEventListener("touchmove",avp.disableTouchSafari,!0),document.documentElement.removeEventListener("touchcanceled",avp.disableTouchSafari,!0),document.documentElement.removeEventListener("touchend",avp.disableTouchSafari,!0))}
var detectWebGL=av.detectWebGL=function(){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=!1,n=0;n<4;n++)try{if(i=e.getContext(t[n]),(i=rescueFromPolymer(i))&&"function"==typeof i.getParameter)return 1}catch(e){}return 0}return-1},touchStartToClick=av.touchStartToClick=function(e){e.target.className.indexOf("fullscreen")>-1||e.target.className.indexOf("webvr")>-1||(e.preventDefault(),e.stopPropagation(),e.target.click())}
!function(){var e=getGlobal()
e.performance||(e.performance=Date)}(),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},String.prototype.repeat=String.prototype.repeat||function(e){if(e<1)return""
for(var t="",i=this.valueOf();e>1;)1&e&&(t+=i),e>>=1,i+=i
return t+i},Array.prototype.fill=Array.prototype.fill||function(e,t,i){t=void 0===t?0:t,i=void 0===i?this.length:i
for(var n=t;n<i;++n)this[n]=e},Int32Array.prototype.lastIndexOf=Int32Array.prototype.lastIndexOf||function(e,t){return Array.prototype.lastIndexOf.call(this,e,t)},Array.prototype.find=Array.prototype.find||function(e,t){for(var i=this.length,n=0;n<i;++n){var o=this[n]
if(e.call(t,o,n,this))return o}}
var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private
if(avp.BUILD_LMV_WORKER_URL="lmvworker.js",avp.LMV_WORKER_URL=avp.BUILD_LMV_WORKER_URL,avp.ENABLE_DEBUG=avp.ENABLE_DEBUG||!1,avp.ENABLE_INLINE_WORKER=!0,function(){"use strict"
function e(){this.adp=null,this.runtimeStats={},this.level=-1,this.setLevel(n.LogLevels.ERROR)}function t(){return"undefined"!=typeof window?encodeURI(window.location.href):""}var i=Autodesk.Viewing,n=Autodesk.Viewing.Private
n.LogLevels={DEBUG:5,LOG:4,INFO:3,WARNING:2,ERROR:1,NONE:0},e.prototype.initialize=function(e){if(e.eventCallback&&(this.callback=e.eventCallback),this.sessionId=e.sessionId,!this.sessionId){var o=Date.now()+""
this.sessionId=parseFloat((1e4*Math.random()|0)+""+o.substring(4))}var r=e.logLevel||e.loglevel
"number"==typeof r&&this.level!==r&&this.setLevel(r),this.environmentInfo={touch:i.isTouchDevice(),env:n.env,referer:t(),version:LMV_VIEWER_VERSION,patch:LMV_VIEWER_PATCH,build_type:LMV_BUILD_TYPE}
var s={category:"viewer_start",touch:this.environmentInfo.touch,env:this.environmentInfo.env,referer:this.environmentInfo.referer,version:this.environmentInfo.version,patch:this.environmentInfo.patch,build_type:this.environmentInfo.build_type}
this.track(s)
var a=this
this.interval=setInterval(function(){a.reportRuntimeStats()},6e4)},e.prototype.shutdown=function(){clearInterval(this.interval),this.interval=void 0},e.prototype.track=function(e){if(this.updateRuntimeStats(e),!n.offline&&this.sessionId){e.timestamp=Date.now(),e.sessionId=this.sessionId
var t=this.logToADP(e)
this.callback&&this.callback(e,{adp:t})}},e.prototype.logToADP=function(e){if(!this.adp)return!1
var i="",n=""
switch(e.category){case"tool_changed":case"pref_changed":i="CLICK_OPERATION",n=e.category+"/"+e.name
break
case"screen_mode":i="CLICK_OPERATION",n="pref_changed/"+e.category
break
case"metadata_load_stats":i="DOCUMENT_START",n="stats",e.full_url=t()
break
case"model_load_stats":i="DOCUMENT_FULL",n="stats"
break
case"error":i="BACKGROUND_CALL",n="error"}return!!i&&(this.adp.trackEvent(i,{operation:{id:e.sessionId,type:n,stage:"",status:"C",meta:e}}),!0)},e.prototype.updateRuntimeStats=function(e){if(e.hasOwnProperty("aggregate"))switch(e.aggregate){case"count":this.runtimeStats[e.name]>0?this.runtimeStats[e.name]++:this.runtimeStats[e.name]=1,this.runtimeStats._nonempty=!0
break
case"last":this.runtimeStats[e.name]=e.value,this.runtimeStats._nonempty=!0
break
default:this.warn("unknown log aggregate type")}},e.prototype.reportRuntimeStats=function(){this.runtimeStats._nonempty&&(delete this.runtimeStats._nonempty,this.adp&&this.adp.trackEvent("BACKGROUND_CALL",{operation:{id:this.sessionId,type:"stats",stage:"",status:"C",meta:this.runtimeStats}}),this.runtimeStats.category="misc_stats",this.track(this.runtimeStats),this.runtimeStats={})},e.prototype.setLevel=function(e){if(this.level!==e){this.level=e
var t=function(){},i=n.LogLevels,o=this,r=function(){if(o.callback){var e=Array.prototype.slice.call(arguments).join(" ")
o.callback({category:"error",message:e},{adp:!1})}console.error.apply(console,arguments)}
this.debug=e>=i.DEBUG?console.log.bind(console):t,this.log=e>=i.LOG?console.log.bind(console):t,this.info=e>=i.INFO?console.info.bind(console):t,this.warn=e>=i.WARNING?console.warn.bind(console):t,this.error=e>=i.ERROR?r:t}},Autodesk.Viewing.Private.logger=new e}(),"undefined"!=typeof window&&function(e,t,i,n){"use strict"
function o(e,t,i){return setTimeout(d(e,i),t)}function r(e,t,i){return!!Array.isArray(e)&&(s(e,i[t],i),!0)}function s(e,t,i){var o
if(e)if(e.forEach)e.forEach(t,i)
else if(e.length!==n)for(o=0;o<e.length;)t.call(i,e[o],o,e),o++
else for(o in e)e.hasOwnProperty(o)&&t.call(i,e[o],o,e)}function a(e,t,i){for(var o=Object.keys(t),r=0;r<o.length;)(!i||i&&e[o[r]]===n)&&(e[o[r]]=t[o[r]]),r++
return e}function l(e,t){return a(e,t,!0)}function c(e,t,i){var n,o=t.prototype
n=e.prototype=Object.create(o),n.constructor=e,n._super=o,i&&a(n,i)}function d(e,t){return function(){return e.apply(t,arguments)}}function u(e,t){return typeof e==de?e.apply(t?t[0]||n:n,t):e}function h(e,t){return e===n?t:e}function p(e,t,i){s(v(t),function(t){e.addEventListener(t,i,!1)})}function m(e,t,i){s(v(t),function(t){e.removeEventListener(t,i,!1)})}function g(e,t){for(;e;){if(e==t)return!0
e=e.parentNode}return!1}function f(e,t){return e.indexOf(t)>-1}function v(e){return e.trim().split(/\s+/g)}function E(e,t,i){if(e.indexOf&&!i)return e.indexOf(t)
for(var n=0;n<e.length;){if(i&&e[n][i]==t||!i&&e[n]===t)return n
n++}return-1}function y(e){return Array.prototype.slice.call(e,0)}function A(e,t,i){for(var n=[],o=[],r=0;r<e.length;){var s=t?e[r][t]:e[r]
E(o,s)<0&&n.push(e[r]),o[r]=s,r++}return i&&(n=t?n.sort(function(e,i){return e[t]>i[t]}):n.sort()),n}function T(e,t){for(var i,o,r=t[0].toUpperCase()+t.slice(1),s=0;s<le.length;){if(i=le[s],(o=i?i+r:t)in e)return o
s++}return n}function b(){return me++}function w(e){var t=e.ownerDocument
return t.defaultView||t.parentWindow}function C(e,t){var i=this
this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){u(e.options.enable,[e])&&i.handler(t)},this.init()}function S(e){var t=e.options.inputClass
return new(t||(ve?B:Ee?z:fe?W:H))(e,R)}function R(e,t,i){var n=i.pointers.length,o=i.changedPointers.length,r=t&be&&n-o==0,s=t&(Ce|Se)&&n-o==0
i.isFirst=!!r,i.isFinal=!!s,r&&(e.session={}),i.eventType=t,x(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function x(e,t){var i=e.session,n=t.pointers,o=n.length
i.firstInput||(i.firstInput=M(t)),o>1&&!i.firstMultiple?i.firstMultiple=M(t):1===o&&(i.firstMultiple=!1)
var r=i.firstInput,s=i.firstMultiple,a=s?s.center:r.center,l=t.center=V(n)
t.timeStamp=pe(),t.deltaTime=t.timeStamp-r.timeStamp,t.angle=N(a,l),t.distance=D(a,l),P(i,t),t.offsetDirection=L(t.deltaX,t.deltaY),t.scale=s?O(s.pointers,n):1,t.rotation=s?_(s.pointers,n):0,k(i,t)
var c=e.element
g(t.srcEvent.target,c)&&(c=t.srcEvent.target),t.target=c}function P(e,t){var i=t.center,n=e.offsetDelta||{},o=e.prevDelta||{},r=e.prevInput||{};(t.eventType===be||r.eventType===Ce)&&(o=e.prevDelta={x:r.deltaX||0,y:r.deltaY||0},n=e.offsetDelta={x:i.x,y:i.y}),t.deltaX=o.x+(i.x-n.x),t.deltaY=o.y+(i.y-n.y)}function k(e,t){var i,o,r,s,a=e.lastInterval||t,l=t.timeStamp-a.timeStamp
if(t.eventType!=Se&&(l>Te||a.velocity===n)){var c=a.deltaX-t.deltaX,d=a.deltaY-t.deltaY,u=I(l,c,d)
o=u.x,r=u.y,i=he(u.x)>he(u.y)?u.x:u.y,s=L(c,d),e.lastInterval=t}else i=a.velocity,o=a.velocityX,r=a.velocityY,s=a.direction
t.velocity=i,t.velocityX=o,t.velocityY=r,t.direction=s}function M(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:ue(e.pointers[i].clientX),clientY:ue(e.pointers[i].clientY)},i++
return{timeStamp:pe(),pointers:t,center:V(t),deltaX:e.deltaX,deltaY:e.deltaY}}function V(e){var t=e.length
if(1===t)return{x:ue(e[0].clientX),y:ue(e[0].clientY)}
for(var i=0,n=0,o=0;t>o;)i+=e[o].clientX,n+=e[o].clientY,o++
return{x:ue(i/t),y:ue(n/t)}}function I(e,t,i){return{x:t/e||0,y:i/e||0}}function L(e,t){return e===t?Re:he(e)>=he(t)?e>0?xe:Pe:t>0?ke:Me}function D(e,t,i){i||(i=De)
var n=t[i[0]]-e[i[0]],o=t[i[1]]-e[i[1]]
return Math.sqrt(n*n+o*o)}function N(e,t,i){i||(i=De)
var n=t[i[0]]-e[i[0]],o=t[i[1]]-e[i[1]]
return 180*Math.atan2(o,n)/Math.PI}function _(e,t){return N(t[1],t[0],Ne)-N(e[1],e[0],Ne)}function O(e,t){return D(t[0],t[1],Ne)/D(e[0],e[1],Ne)}function H(){this.evEl=Oe,this.evWin=He,this.allow=!0,this.pressed=!1,C.apply(this,arguments)}function B(){this.evEl=Ge,this.evWin=ze,C.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function F(){this.evTarget=We,this.evWin=je,this.started=!1,C.apply(this,arguments)}function G(e,t){var i=y(e.touches),n=y(e.changedTouches)
return t&(Ce|Se)&&(i=A(i.concat(n),"identifier",!0)),[i,n]}function z(){this.evTarget=Xe,this.targetIds={},C.apply(this,arguments)}function U(e,t){var i=y(e.touches),n=this.targetIds
if(t&(be|we)&&1===i.length)return n[i[0].identifier]=!0,[i,i]
var o,r,s=y(e.changedTouches),a=[],l=this.target
if(r=i.filter(function(e){return g(e.target,l)}),t===be)for(o=0;o<r.length;)n[r[o].identifier]=!0,o++
for(o=0;o<s.length;)n[s[o].identifier]&&a.push(s[o]),t&(Ce|Se)&&delete n[s[o].identifier],o++
return a.length?[A(r.concat(a),"identifier",!0),a]:void 0}function W(){C.apply(this,arguments)
var e=d(this.handler,this)
this.touch=new z(this.manager,e),this.mouse=new H(this.manager,e)}function j(e,t){this.manager=e,this.set(t)}function Y(e){if(f(e,$e))return $e
var t=f(e,et),i=f(e,tt)
return t&&i?et+" "+tt:t||i?t?et:tt:f(e,Je)?Je:Qe}function X(e){this.id=b(),this.manager=null,this.options=l(e||{},this.defaults),this.options.enable=h(this.options.enable,!0),this.state=it,this.simultaneous={},this.requireFail=[]}function q(e){return e&at?"cancel":e&rt?"end":e&ot?"move":e&nt?"start":""}function K(e){return e==Me?"down":e==ke?"up":e==xe?"left":e==Pe?"right":""}function Z(e,t){var i=t.manager
return i?i.get(e):e}function Q(){X.apply(this,arguments)}function J(){Q.apply(this,arguments),this.pX=null,this.pY=null}function $(){Q.apply(this,arguments)}function ee(){X.apply(this,arguments),this._timer=null,this._input=null}function te(){Q.apply(this,arguments)}function ie(){Q.apply(this,arguments)}function ne(){X.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function oe(e,t){return t=t||{},t.recognizers=h(t.recognizers,oe.defaults.preset),new re(e,t)}function re(e,t){t=t||{},this.options=l(t,oe.defaults),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.element=e,this.input=S(this),this.touchAction=new j(this,this.options.touchAction),se(this,!0),s(t.recognizers,function(e){var t=this.add(new e[0](e[1]))
e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function se(e,t){var i=e.element
s(e.options.cssProps,function(e,n){i.style[T(i.style,n)]=t?e:""})}function ae(e,i){var n=t.createEvent("Event")
n.initEvent(e,!0,!0),n.gesture=i,i.target.dispatchEvent(n)}var le=["","webkit","moz","MS","ms","o"],ce=t.createElement("div"),de="function",ue=Math.round,he=Math.abs,pe=Date.now,me=1,ge=/mobile|tablet|ip(ad|hone|od)|android/i,fe="ontouchstart"in e,ve=T(e,"PointerEvent")!==n,Ee=fe&&ge.test(navigator.userAgent),ye="touch",Ae="mouse",Te=25,be=1,we=2,Ce=4,Se=8,Re=1,xe=2,Pe=4,ke=8,Me=16,Ve=xe|Pe,Ie=ke|Me,Le=Ve|Ie,De=["x","y"],Ne=["clientX","clientY"]
C.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(w(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(w(this.element),this.evWin,this.domHandler)}}
var _e={mousedown:be,mousemove:we,mouseup:Ce},Oe="mousedown",He="mousemove mouseup"
c(H,C,{handler:function(e){var t=_e[e.type]
t&be&&0===e.button&&(this.pressed=!0),t&we&&1!==e.which&&(t=Ce),this.pressed&&this.allow&&(t&Ce&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:Ae,srcEvent:e}))}})
var Be={pointerdown:be,pointermove:we,pointerup:Ce,pointercancel:Se,pointerout:Se},Fe={2:ye,3:"pen",4:Ae,5:"kinect"},Ge="pointerdown",ze="pointermove pointerup pointercancel"
e.MSPointerEvent&&(Ge="MSPointerDown",ze="MSPointerMove MSPointerUp MSPointerCancel"),c(B,C,{handler:function(e){var t=this.store,i=!1,n=e.type.toLowerCase().replace("ms",""),o=Be[n],r=Fe[e.pointerType]||e.pointerType,s=r==ye,a=E(t,e.pointerId,"pointerId")
o&be&&(0===e.button||s)?0>a&&(t.push(e),a=t.length-1):o&(Ce|Se)&&(i=!0),0>a||(t[a]=e,this.callback(this.manager,o,{pointers:t,changedPointers:[e],pointerType:r,srcEvent:e}),i&&t.splice(a,1))}})
var Ue={touchstart:be,touchmove:we,touchend:Ce,touchcancel:Se},We="touchstart",je="touchstart touchmove touchend touchcancel"
c(F,C,{handler:function(e){var t=Ue[e.type]
if(t===be&&(this.started=!0),this.started){var i=G.call(this,e,t)
t&(Ce|Se)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:ye,srcEvent:e})}}})
var Ye={touchstart:be,touchmove:we,touchend:Ce,touchcancel:Se},Xe="touchstart touchmove touchend touchcancel"
c(z,C,{handler:function(e){var t=Ye[e.type],i=U.call(this,e,t)
i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:ye,srcEvent:e})}}),c(W,C,{handler:function(e,t,i){var n=i.pointerType==ye,o=i.pointerType==Ae
if(n)this.mouse.allow=!1
else if(o&&!this.mouse.allow)return
t&(Ce|Se)&&(this.mouse.allow=!0),this.callback(e,t,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}})
var qe=T(ce.style,"touchAction"),Ke=qe!==n,Ze="compute",Qe="auto",Je="manipulation",$e="none",et="pan-x",tt="pan-y"
j.prototype={set:function(e){e==Ze&&(e=this.compute()),Ke&&(this.manager.element.style[qe]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[]
return s(this.manager.recognizers,function(t){u(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),Y(e.join(" "))},preventDefaults:function(e){if(!Ke){var t=e.srcEvent,i=e.offsetDirection
if(this.manager.session.prevented)return void t.preventDefault()
var n=this.actions,o=f(n,$e),r=f(n,tt),s=f(n,et)
return o||r&&i&Ve||s&&i&Ie?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}}
var it=1,nt=2,ot=4,rt=8,st=rt,at=16
X.prototype={defaults:{},set:function(e){return a(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(r(e,"recognizeWith",this))return this
var t=this.simultaneous
return e=Z(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return r(e,"dropRecognizeWith",this)?this:(e=Z(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(r(e,"requireFailure",this))return this
var t=this.requireFail
return e=Z(e,this),-1===E(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(r(e,"dropRequireFailure",this))return this
e=Z(e,this)
var t=E(this.requireFail,e)
return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){i.manager.emit(i.options.event+(t?q(n):""),e)}var i=this,n=this.state
rt>n&&t(!0),t(),n>=rt&&t(!0)},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=32)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|it)))return!1
e++}return!0},recognize:function(e){var t=a({},e)
return u(this.options.enable,[this,t])?(this.state&(st|at|32)&&(this.state=it),this.state=this.process(t),void(this.state&(nt|ot|rt|at)&&this.tryEmit(t))):(this.reset(),void(this.state=32))},process:function(){},getTouchAction:function(){},reset:function(){}},c(Q,X,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers
return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,n=t&(nt|ot),o=this.attrTest(e)
return n&&(i&Se||!o)?t|at:n||o?i&Ce?t|rt:t&nt?t|ot:nt:32}}),c(J,Q,{defaults:{event:"pan",threshold:10,pointers:1,direction:Le},getTouchAction:function(){var e=this.options.direction,t=[]
return e&Ve&&t.push(tt),e&Ie&&t.push(et),t},directionTest:function(e){var t=this.options,i=!0,n=e.distance,o=e.direction,r=e.deltaX,s=e.deltaY
return o&t.direction||(t.direction&Ve?(o=0===r?Re:0>r?xe:Pe,i=r!=this.pX,n=Math.abs(e.deltaX)):(o=0===s?Re:0>s?ke:Me,i=s!=this.pY,n=Math.abs(e.deltaY))),e.direction=o,i&&n>t.threshold&&o&t.direction},attrTest:function(e){return Q.prototype.attrTest.call(this,e)&&(this.state&nt||!(this.state&nt)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY
var t=K(e.direction)
t&&this.manager.emit(this.options.event+t,e),this._super.emit.call(this,e)}}),c($,Q,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[$e]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&nt)},emit:function(e){if(this._super.emit.call(this,e),1!==e.scale){var t=e.scale<1?"in":"out"
this.manager.emit(this.options.event+t,e)}}}),c(ee,X,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[Qe]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,r=e.deltaTime>t.time
if(this._input=e,!n||!i||e.eventType&(Ce|Se)&&!r)this.reset()
else if(e.eventType&be)this.reset(),this._timer=o(function(){this.state=st,this.tryEmit()},t.time,this)
else if(e.eventType&Ce)return st
return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===st&&(e&&e.eventType&Ce?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=pe(),this.manager.emit(this.options.event,this._input)))}}),c(te,Q,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[$e]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&nt)}}),c(ie,Q,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ve|Ie,pointers:1},getTouchAction:function(){return J.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction
return i&(Ve|Ie)?t=e.velocity:i&Ve?t=e.velocityX:i&Ie&&(t=e.velocityY),this._super.attrTest.call(this,e)&&i&e.direction&&e.distance>this.options.threshold&&he(t)>this.options.velocity&&e.eventType&Ce},emit:function(e){var t=K(e.direction)
t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),c(ne,X,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Je]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,r=e.deltaTime<t.time
if(this.reset(),e.eventType&be&&0===this.count)return this.failTimeout()
if(n&&r&&i){if(e.eventType!=Ce)return this.failTimeout()
var s=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||D(this.pCenter,e.center)<t.posThreshold
this.pTime=e.timeStamp,this.pCenter=e.center,a&&s?this.count+=1:this.count=1,this._input=e
if(0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=o(function(){this.state=st,this.tryEmit()},t.interval,this),nt):st}return 32},failTimeout:function(){return this._timer=o(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==st&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),oe.VERSION="2.0.4",oe.defaults={domEvents:!1,touchAction:Ze,enable:!0,inputTarget:null,inputClass:null,preset:[[te,{enable:!1}],[$,{enable:!1},["rotate"]],[ie,{direction:Ve}],[J,{direction:Ve},["swipe"]],[ne],[ne,{event:"doubletap",taps:2},["tap"]],[ee]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}}
re.prototype={set:function(e){return a(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session
if(!t.stopped){this.touchAction.preventDefaults(e)
var i,n=this.recognizers,o=t.curRecognizer;(!o||o&&o.state&st)&&(o=t.curRecognizer=null)
for(var r=0;r<n.length;)i=n[r],2===t.stopped||o&&i!=o&&!i.canRecognizeWith(o)?i.reset():i.recognize(e),!o&&i.state&(nt|ot|rt)&&(o=t.curRecognizer=i),r++}},get:function(e){if(e instanceof X)return e
for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i]
return null},add:function(e){if(r(e,"add",this))return this
var t=this.get(e.options.event)
return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(r(e,"remove",this))return this
var t=this.recognizers
return e=this.get(e),t.splice(E(t,e),1),this.touchAction.update(),this},on:function(e,t){var i=this.handlers
return s(v(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this},off:function(e,t){var i=this.handlers
return s(v(e),function(e){t?i[e].splice(E(i[e],t),1):delete i[e]}),this},emit:function(e,t){this.options.domEvents&&ae(e,t)
var i=this.handlers[e]&&this.handlers[e].slice()
if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()}
for(var n=0;n<i.length;)i[n](t),n++}},destroy:function(){this.element&&se(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},a(oe,{INPUT_START:be,INPUT_MOVE:we,INPUT_END:Ce,INPUT_CANCEL:Se,STATE_POSSIBLE:it,STATE_BEGAN:nt,STATE_CHANGED:ot,STATE_ENDED:rt,STATE_RECOGNIZED:st,STATE_CANCELLED:at,STATE_FAILED:32,DIRECTION_NONE:Re,DIRECTION_LEFT:xe,DIRECTION_RIGHT:Pe,DIRECTION_UP:ke,DIRECTION_DOWN:Me,DIRECTION_HORIZONTAL:Ve,DIRECTION_VERTICAL:Ie,DIRECTION_ALL:Le,Manager:re,Input:C,TouchAction:j,TouchInput:z,MouseInput:H,PointerEventInput:B,TouchMouseInput:W,SingleTouchInput:F,Recognizer:X,AttrRecognizer:Q,Tap:ne,Pan:J,Swipe:ie,Pinch:$,Rotate:te,Press:ee,on:p,off:m,each:s,merge:l,extend:a,inherit:c,bindFn:d,prefixed:T}),"undefined"!=typeof module&&module.exports,e.Hammer=oe}(window,document),LmvMatrix4=function(e){this.elements=e?new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},LmvMatrix4.prototype={constructor:LmvMatrix4,set:function(e,t,i,n,o,r,s,a,l,c,d,u,h,p,m,g){var f=this.elements
return f[0]=e,f[4]=t,f[8]=i,f[12]=n,f[1]=o,f[5]=r,f[9]=s,f[13]=a,f[2]=l,f[6]=c,f[10]=d,f[14]=u,f[3]=h,f[7]=p,f[11]=m,f[15]=g,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,o=e.z,r=e.w,s=i+i,a=n+n,l=o+o,c=i*s,d=i*a,u=i*l,h=n*a,p=n*l,m=o*l,g=r*s,f=r*a,v=r*l
return t[0]=1-(h+m),t[4]=d-v,t[8]=u+f,t[1]=d+v,t[5]=1-(c+m),t[9]=p-g,t[2]=u-f,t[6]=p+g,t[10]=1-(c+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},multiply:function(e){return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,o=this.elements,r=i[0],s=i[4],a=i[8],l=i[12],c=i[1],d=i[5],u=i[9],h=i[13],p=i[2],m=i[6],g=i[10],f=i[14],v=i[3],E=i[7],y=i[11],A=i[15],T=n[0],b=n[4],w=n[8],C=n[12],S=n[1],R=n[5],x=n[9],P=n[13],k=n[2],M=n[6],V=n[10],I=n[14],L=n[3],D=n[7],N=n[11],_=n[15]
return o[0]=r*T+s*S+a*k+l*L,o[4]=r*b+s*R+a*M+l*D,o[8]=r*w+s*x+a*V+l*N,o[12]=r*C+s*P+a*I+l*_,o[1]=c*T+d*S+u*k+h*L,o[5]=c*b+d*R+u*M+h*D,o[9]=c*w+d*x+u*V+h*N,o[13]=c*C+d*P+u*I+h*_,o[2]=p*T+m*S+g*k+f*L,o[6]=p*b+m*R+g*M+f*D,o[10]=p*w+m*x+g*V+f*N,o[14]=p*C+m*P+g*I+f*_,o[3]=v*T+E*S+y*k+A*L,o[7]=v*b+E*R+y*M+A*D,o[11]=v*w+E*x+y*V+A*N,o[15]=v*C+E*P+y*I+A*_,this},multiplyToArray:function(e,t,i){var n=this.elements
return this.multiplyMatrices(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements
return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],o=e[12],r=e[1],s=e[5],a=e[9],l=e[13],c=e[2],d=e[6],u=e[10],h=e[14]
return e[3]*(+o*a*d-n*l*d-o*s*u+i*l*u+n*s*h-i*a*h)+e[7]*(+t*a*h-t*l*u+o*r*u-n*r*h+n*l*c-o*a*c)+e[11]*(+t*l*d-t*s*h-o*r*d+i*r*h+o*s*c-i*l*c)+e[15]*(-n*s*c-t*a*d+t*s*u+n*r*d-i*r*u+i*a*c)},transpose:function(){var e,t=this.elements
return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements
return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},setPosition:function(e){var t=this.elements
return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,o=n[0],r=n[4],s=n[8],a=n[12],l=n[1],c=n[5],d=n[9],u=n[13],h=n[2],p=n[6],m=n[10],g=n[14],f=n[3],v=n[7],E=n[11],y=n[15]
i[0]=d*g*v-u*m*v+u*p*E-c*g*E-d*p*y+c*m*y,i[4]=a*m*v-s*g*v-a*p*E+r*g*E+s*p*y-r*m*y,i[8]=s*u*v-a*d*v+a*c*E-r*u*E-s*c*y+r*d*y,i[12]=a*d*p-s*u*p-a*c*m+r*u*m+s*c*g-r*d*g,i[1]=u*m*f-d*g*f-u*h*E+l*g*E+d*h*y-l*m*y,i[5]=s*g*f-a*m*f+a*h*E-o*g*E-s*h*y+o*m*y,i[9]=a*d*f-s*u*f-a*l*E+o*u*E+s*l*y-o*d*y,i[13]=s*u*h-a*d*h+a*l*m-o*u*m-s*l*g+o*d*g,i[2]=c*g*f-u*p*f+u*h*v-l*g*v-c*h*y+l*p*y,i[6]=a*p*f-r*g*f-a*h*v+o*g*v+r*h*y-o*p*y,i[10]=r*u*f-a*c*f+a*l*v-o*u*v-r*l*y+o*c*y,i[14]=a*c*h-r*u*h-a*l*p+o*u*p+r*l*g-o*c*g,i[3]=d*p*f-c*m*f-d*h*v+l*m*v+c*h*E-l*p*E,i[7]=r*m*f-s*p*f+s*h*v-o*m*v-r*h*E+o*p*E,i[11]=s*c*f-r*d*f-s*l*v+o*d*v+r*l*E-o*c*E,i[15]=r*d*h-s*c*h+s*l*p-o*d*p-r*l*m+o*c*m
var A=o*i[0]+l*i[4]+h*i[8]+f*i[12]
if(0==A){var T="Matrix4.getInverse(): can't invert matrix, determinant is 0"
if(t)throw new Error(T)
return console.warn(T),this.identity(),this}return this.multiplyScalar(1/A),this},scale:function(e){var t=this.elements,i=e.x,n=e.y,o=e.z
return t[0]*=i,t[4]*=n,t[8]*=o,t[1]*=i,t[5]*=n,t[9]*=o,t[2]*=i,t[6]*=n,t[10]*=o,t[3]*=i,t[7]*=n,t[11]*=o,this},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e)
return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e)
return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e)
return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),o=1-i,r=e.x,s=e.y,a=e.z,l=o*r,c=o*s
return this.set(l*r+i,l*s-n*a,l*a+n*s,0,l*s+n*a,c*s+i,c*a-n*r,0,l*a-n*s,c*a+n*r,o*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},transformPoint:function(e){var t=e.x,i=e.y,n=e.z,o=this.elements
return e.x=o[0]*t+o[4]*i+o[8]*n+o[12],e.y=o[1]*t+o[5]*i+o[9]*n+o[13],e.z=o[2]*t+o[6]*i+o[10]*n+o[14],e},transformDirection:function(e){var t=e.x,i=e.y,n=e.z,o=this.elements
e.x=o[0]*t+o[4]*i+o[8]*n,e.y=o[1]*t+o[5]*i+o[9]*n,e.z=o[2]*t+o[6]*i+o[10]*n
var r=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)
if(r>0){var s=1/r
e.x*=s,e.y*=s,e.z*=s}return e},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements
return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return new LmvMatrix4(this.elements instanceof Float64Array).fromArray(this.elements)}},function(e){var t
"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.lmv_poly2tri=function(){return function e(t,i,n){function o(s,a){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require
if(!a&&l)return l(s,!0)
if(r)return r(s,!0)
throw new Error("Cannot find module '"+s+"'")}var c=i[s]={exports:{}}
t[s][0].call(c.exports,function(e){var i=t[s][1][e]
return o(i||e)},c,c.exports,e,t,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s])
return o}({1:[function(e,t,i){t.exports={version:"1.3.5"}},{}],2:[function(e,t,i){"use strict"
var n=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x},o=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e}
o.prototype.head=function(){return this.head_},o.prototype.setHead=function(e){this.head_=e},o.prototype.tail=function(){return this.tail_},o.prototype.setTail=function(e){this.tail_=e},o.prototype.search=function(){return this.search_node_},o.prototype.setSearch=function(e){this.search_node_=e},o.prototype.findSearchNode=function(){return this.search_node_},o.prototype.locateNode=function(e){var t=this.search_node_
if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev
return null},o.prototype.locatePoint=function(e){var t=e.x,i=this.findSearchNode(t),n=i.point.x
if(t===n){if(e!==i.point)if(e===i.prev.point)i=i.prev
else{if(e!==i.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call")
i=i.next}}else if(t<n)for(;(i=i.prev)&&e!==i.point;);else for(;(i=i.next)&&e!==i.point;);return i&&(this.search_node_=i),i},t.exports=o,t.exports.Node=n},{}],3:[function(e,t,i){"use strict"
function n(e,t){if(!e)throw new Error(t||"Assert Failed")}t.exports=n},{}],4:[function(e,t,i){"use strict"
var n=e("./xy"),o=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null}
o.prototype.toString=function(){return n.toStringBase(this)},o.prototype.toJSON=function(){return{x:this.x,y:this.y}},o.prototype.clone=function(){return new o(this.x,this.y)},o.prototype.set_zero=function(){return this.x=0,this.y=0,this},o.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},o.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},o.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},o.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},o.prototype.mul=function(e){return this.x*=e,this.y*=e,this},o.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},o.prototype.normalize=function(){var e=this.length()
return this.x/=e,this.y/=e,e},o.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},o.negate=function(e){return new o(-e.x,-e.y)},o.add=function(e,t){return new o(e.x+t.x,e.y+t.y)},o.sub=function(e,t){return new o(e.x-t.x,e.y-t.y)},o.mul=function(e,t){return new o(e*t.x,e*t.y)},o.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new o(-e*t.y,e*t.x):"number"==typeof t?new o(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},o.toString=n.toString,o.compare=n.compare,o.cmp=n.compare,o.equals=n.equals,o.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=o},{"./xy":11}],5:[function(e,t,i){"use strict"
var n=e("./xy"),o=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!"
for(var i=0;i<t.length;i++)this.message+=" "+n.toString(t[i])}
o.prototype=new Error,o.prototype.constructor=o,t.exports=o},{"./xy":11}],6:[function(e,t,i){(function(t){"use strict"
var n=t.poly2tri
i.noConflict=function(){return t.poly2tri=n,i},i.VERSION=e("../dist/version.json").version,i.PointError=e("./pointerror"),i.Point=e("./point"),i.Triangle=e("./triangle"),i.SweepContext=e("./sweepcontext")
var o=e("./sweep")
i.triangulate=o.triangulate,i.sweep={Triangulate:o.triangulate}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,i){"use strict"
function n(e){e.initTriangulation(),e.createAdvancingFront(),o(e),r(e)}function o(e){var t,i=e.pointCount()
for(t=1;t<i;++t)for(var n=e.getPoint(t),o=s(e,n),r=n._p2t_edge_list,l=0;r&&l<r.length;++l)a(e,r[l],o)}function r(e){for(var t=e.front().head().next.triangle,i=e.front().head().next.point;!t.getConstrainedEdgeCW(i);)t=t.neighborCCW(i)
e.meshClean(t)}function s(e,t){var i=e.locateNode(t),n=d(e,t,i)
return t.x<=i.point.x+H&&u(e,i),h(e,n),n}function a(e,t,i){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,c(i.triangle,t.p,t.q)||(A(e,t,i),l(e,t.p,t.q,i.triangle,t.q))}function l(e,t,i,n,o){if(!c(n,t,i)){var r=n.pointCCW(o),s=F(i,r,t)
if(s===B.COLLINEAR)throw new D("poly2tri EdgeEvent: Collinear not supported!",[i,r,t])
var a=n.pointCW(o),d=F(i,a,t)
if(d===B.COLLINEAR)throw new D("poly2tri EdgeEvent: Collinear not supported!",[i,a,t])
s===d?(n=s===B.CW?n.neighborCCW(o):n.neighborCW(o),l(e,t,i,n,o)):k(e,t,i,n,o)}}function c(e,t,i){var n=e.edgeIndex(t,i)
if(-1!==n){e.markConstrainedEdgeByIndex(n)
var o=e.getNeighbor(n)
return o&&o.markConstrainedEdgeByPoints(t,i),!0}return!1}function d(e,t,i){var n=new N(t,i.point,i.next.point)
n.markNeighbor(i.triangle),e.addToMap(n)
var o=new _(t)
return o.next=i.next,o.prev=i,i.next.prev=o,i.next=o,m(e,n)||e.mapTriangleToNodes(n),o}function u(e,t){var i=new N(t.prev.point,t.point,t.next.point)
i.markNeighbor(t.prev.triangle),i.markNeighbor(t.triangle),e.addToMap(i),t.prev.next=t.next,t.next.prev=t.prev,m(e,i)||e.mapTriangleToNodes(i)}function h(e,t){for(var i=t.next;i.next&&!z(i.point,i.next.point,i.prev.point);)u(e,i),i=i.next
for(i=t.prev;i.prev&&!z(i.point,i.next.point,i.prev.point);)u(e,i),i=i.prev
t.next&&t.next.next&&p(t)&&v(e,t)}function p(e){var t=e.point.x-e.next.next.point.x,i=e.point.y-e.next.next.point.y
return L(i>=0,"unordered y"),t>=0||Math.abs(t)<i}function m(e,t){for(var i=0;i<3;++i)if(!t.delaunay_edge[i]){var n=t.getNeighbor(i)
if(n){var o=t.getPoint(i),r=n.oppositePoint(t,o),s=n.index(r)
if(n.constrained_edge[s]||n.delaunay_edge[s]){t.constrained_edge[i]=n.constrained_edge[s]
continue}var a=g(o,t.pointCCW(o),t.pointCW(o),r)
if(a){t.delaunay_edge[i]=!0,n.delaunay_edge[s]=!0,f(t,o,n,r)
var l=!m(e,t)
return l&&e.mapTriangleToNodes(t),l=!m(e,n),l&&e.mapTriangleToNodes(n),t.delaunay_edge[i]=!1,n.delaunay_edge[s]=!1,!0}}}return!1}function g(e,t,i,n){var o=e.x-n.x,r=e.y-n.y,s=t.x-n.x,a=t.y-n.y,l=o*a,c=s*r,d=l-c
if(d<=0)return!1
var u=i.x-n.x,h=i.y-n.y,p=u*r,m=o*h,g=p-m
return!(g<=0)&&(o*o+r*r)*(s*h-u*a)+(s*s+a*a)*g+(u*u+h*h)*d>0}function f(e,t,i,n){var o,r,s,a
o=e.neighborCCW(t),r=e.neighborCW(t),s=i.neighborCCW(n),a=i.neighborCW(n)
var l,c,d,u
l=e.getConstrainedEdgeCCW(t),c=e.getConstrainedEdgeCW(t),d=i.getConstrainedEdgeCCW(n),u=i.getConstrainedEdgeCW(n)
var h,p,m,g
h=e.getDelaunayEdgeCCW(t),p=e.getDelaunayEdgeCW(t),m=i.getDelaunayEdgeCCW(n),g=i.getDelaunayEdgeCW(n),e.legalize(t,n),i.legalize(n,t),i.setDelaunayEdgeCCW(t,h),e.setDelaunayEdgeCW(t,p),e.setDelaunayEdgeCCW(n,m),i.setDelaunayEdgeCW(n,g),i.setConstrainedEdgeCCW(t,l),e.setConstrainedEdgeCW(t,c),e.setConstrainedEdgeCCW(n,d),i.setConstrainedEdgeCW(n,u),e.clearNeighbors(),i.clearNeighbors(),o&&i.markNeighbor(o),r&&e.markNeighbor(r),s&&e.markNeighbor(s),a&&i.markNeighbor(a),e.markNeighbor(i)}function v(e,t){for(F(t.point,t.next.point,t.next.next.point)===B.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next
if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next
e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,E(e,e.basin.bottom_node))}}function E(e,t){if(!y(e,t)){u(e,t)
if(t.prev!==e.basin.left_node||t.next!==e.basin.right_node){if(t.prev===e.basin.left_node){if(F(t.point,t.next.point,t.next.next.point)===B.CW)return
t=t.next}else if(t.next===e.basin.right_node){if(F(t.point,t.prev.point,t.prev.prev.point)===B.CCW)return
t=t.prev}else t=t.prev.point.y<t.next.point.y?t.prev:t.next
E(e,t)}}}function y(e,t){var i
return i=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>i}function A(e,t,i){e.edge_event.right?T(e,t,i):S(e,t,i)}function T(e,t,i){for(;i.next.point.x<t.p.x;)F(t.q,i.next.point,t.p)===B.CCW?b(e,t,i):i=i.next}function b(e,t,i){i.point.x<t.p.x&&(F(i.point,i.next.point,i.next.next.point)===B.CCW?w(e,t,i):(C(e,t,i),b(e,t,i)))}function w(e,t,i){u(e,i.next),i.next.point!==t.p&&F(t.q,i.next.point,t.p)===B.CCW&&F(i.point,i.next.point,i.next.next.point)===B.CCW&&w(e,t,i)}function C(e,t,i){F(i.next.point,i.next.next.point,i.next.next.next.point)===B.CCW?w(e,t,i.next):F(t.q,i.next.next.point,t.p)===B.CCW&&C(e,t,i.next)}function S(e,t,i){for(;i.prev.point.x>t.p.x;)F(t.q,i.prev.point,t.p)===B.CW?R(e,t,i):i=i.prev}function R(e,t,i){i.point.x>t.p.x&&(F(i.point,i.prev.point,i.prev.prev.point)===B.CW?P(e,t,i):(x(e,t,i),R(e,t,i)))}function x(e,t,i){F(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)===B.CW?P(e,t,i.prev):F(t.q,i.prev.prev.point,t.p)===B.CW&&x(e,t,i.prev)}function P(e,t,i){u(e,i.prev),i.prev.point!==t.p&&F(t.q,i.prev.point,t.p)===B.CW&&F(i.point,i.prev.point,i.prev.prev.point)===B.CW&&P(e,t,i)}function k(e,t,i,n,o){var r=n.neighborAcross(o)
L(r,"FLIP failed due to missing triangle!")
var s=r.oppositePoint(n,o)
if(n.getConstrainedEdgeAcross(o)){var a=n.index(o)
throw new D("poly2tri Intersecting Constraints",[o,s,n.getPoint((a+1)%3),n.getPoint((a+2)%3)])}if(G(o,n.pointCCW(o),n.pointCW(o),s))if(f(n,o,r,s),e.mapTriangleToNodes(n),e.mapTriangleToNodes(r),o===i&&s===t)i===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(n.markConstrainedEdgeByPoints(t,i),r.markConstrainedEdgeByPoints(t,i),m(e,n),m(e,r))
else{var c=F(i,s,t)
n=M(e,c,n,r,o,s),k(e,t,i,n,o)}else{I(e,t,i,n,r,V(t,i,r,s)),l(e,t,i,n,o)}}function M(e,t,i,n,o,r){var s
return t===B.CCW?(s=n.edgeIndex(o,r),n.delaunay_edge[s]=!0,m(e,n),n.clearDelaunayEdges(),i):(s=i.edgeIndex(o,r),i.delaunay_edge[s]=!0,m(e,i),i.clearDelaunayEdges(),n)}function V(e,t,i,n){var o=F(t,n,e)
if(o===B.CW)return i.pointCCW(n)
if(o===B.CCW)return i.pointCW(n)
throw new D("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,n,e])}function I(e,t,i,n,o,r){var s=o.neighborAcross(r)
L(s,"FLIP failed due to missing triangle")
var a=s.oppositePoint(o,r)
if(G(i,n.pointCCW(i),n.pointCW(i),a))k(e,i,a,s,a)
else{I(e,t,i,n,s,V(t,i,s,a))}}var L=e("./assert"),D=e("./pointerror"),N=e("./triangle"),_=e("./advancingfront").Node,O=e("./utils"),H=O.EPSILON,B=O.Orientation,F=O.orient2d,G=O.inScanArea,z=O.isAngleObtuse
i.triangulate=n},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,i){"use strict"
var n=e("./pointerror"),o=e("./point"),r=e("./triangle"),s=e("./sweep"),a=e("./advancingfront"),l=a.Node,c=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t
else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t
else if(e.x===t.x)throw new n("poly2tri Invalid Edge constructor: repeated points!",[e])
this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},d=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1}
d.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1}
var u=function(){this.constrained_edge=null,this.right=!1},h=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new d,this.edge_event=new u,this.initEdges(this.points_)}
h.prototype.addHole=function(e){this.initEdges(e)
var t,i=e.length
for(t=0;t<i;t++)this.points_.push(e[t])
return this},h.prototype.AddHole=h.prototype.addHole,h.prototype.addHoles=function(e){var t,i=e.length
for(t=0;t<i;t++)this.initEdges(e[t])
return this.points_=this.points_.concat.apply(this.points_,e),this},h.prototype.addPoint=function(e){return this.points_.push(e),this},h.prototype.AddPoint=h.prototype.addPoint,h.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},h.prototype.triangulate=function(){return s.triangulate(this),this},h.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},h.prototype.getTriangles=function(){return this.triangles_},h.prototype.GetTriangles=h.prototype.getTriangles,h.prototype.front=function(){return this.front_},h.prototype.pointCount=function(){return this.points_.length},h.prototype.head=function(){return this.head_},h.prototype.setHead=function(e){this.head_=e},h.prototype.tail=function(){return this.tail_},h.prototype.setTail=function(e){this.tail_=e},h.prototype.getMap=function(){return this.map_},h.prototype.initTriangulation=function(){var e,t=this.points_[0].x,i=this.points_[0].x,n=this.points_[0].y,r=this.points_[0].y,s=this.points_.length
for(e=1;e<s;e++){var a=this.points_[e]
a.x>t&&(t=a.x),a.x<i&&(i=a.x),a.y>n&&(n=a.y),a.y<r&&(r=a.y)}this.pmin_=new o(i,r),this.pmax_=new o(t,n)
var l=.3*(t-i),c=.3*(n-r)
this.head_=new o(t+l,r-c),this.tail_=new o(i-l,r-c),this.points_.sort(o.compare)},h.prototype.initEdges=function(e,t){var i,n=e.length,o=t?e.length-1:e.length
for(i=0;i<o;++i)this.edge_list.push(new c(e[i],e[(i+1)%n]))},h.prototype.getPoint=function(e){return this.points_[e]},h.prototype.addToMap=function(e){this.map_.push(e)},h.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},h.prototype.createAdvancingFront=function(){var e,t,i,n=new r(this.points_[0],this.tail_,this.head_)
this.map_.push(n),e=new l(n.getPoint(1),n),t=new l(n.getPoint(0),n),i=new l(n.getPoint(2)),this.front_=new a(e,i),e.next=t,t.next=i,t.prev=e,i.prev=t},h.prototype.removeNode=function(e){},h.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var i=this.front_.locatePoint(e.pointCW(e.getPoint(t)))
i&&(i.triangle=e)}},h.prototype.removeFromMap=function(e){var t,i=this.map_,n=i.length
for(t=0;t<n;t++)if(i[t]===e){i.splice(t,1)
break}},h.prototype.meshClean=function(e){for(var t,i,n=[e];t=n.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),i=0;i<3;i++)t.constrained_edge[i]||n.push(t.getNeighbor(i))},t.exports=h},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,i){"use strict"
var n=e("./xy"),o=function(e,t,i){this.points_=[e,t,i],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},r=n.toString
o.prototype.toString=function(){return"["+r(this.points_[0])+r(this.points_[1])+r(this.points_[2])+"]"},o.prototype.getPoint=function(e){return this.points_[e]},o.prototype.GetPoint=o.prototype.getPoint,o.prototype.getPoints=function(){return this.points_},o.prototype.getNeighbor=function(e){return this.neighbors_[e]},o.prototype.containsPoint=function(e){var t=this.points_
return e===t[0]||e===t[1]||e===t[2]},o.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},o.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},o.prototype.isInterior=function(){return this.interior_},o.prototype.setInterior=function(e){return this.interior_=e,this},o.prototype.markNeighborPointers=function(e,t,i){var n=this.points_
if(e===n[2]&&t===n[1]||e===n[1]&&t===n[2])this.neighbors_[0]=i
else if(e===n[0]&&t===n[2]||e===n[2]&&t===n[0])this.neighbors_[1]=i
else{if(!(e===n[0]&&t===n[1]||e===n[1]&&t===n[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call")
this.neighbors_[2]=i}},o.prototype.markNeighbor=function(e){var t=this.points_
e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},o.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},o.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},o.prototype.pointCW=function(e){var t=this.points_
return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},o.prototype.pointCCW=function(e){var t=this.points_
return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},o.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},o.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},o.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},o.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},o.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},o.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},o.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},o.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},o.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},o.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},o.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},o.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},o.prototype.oppositePoint=function(e,t){var i=e.pointCW(t)
return this.pointCW(i)},o.prototype.legalize=function(e,t){var i=this.points_
if(e===i[0])i[1]=i[0],i[0]=i[2],i[2]=t
else if(e===i[1])i[2]=i[1],i[1]=i[0],i[0]=t
else{if(e!==i[2])throw new Error("poly2tri Invalid Triangle.legalize() call")
i[0]=i[2],i[2]=i[1],i[1]=t}},o.prototype.index=function(e){var t=this.points_
if(e===t[0])return 0
if(e===t[1])return 1
if(e===t[2])return 2
throw new Error("poly2tri Invalid Triangle.index() call")},o.prototype.edgeIndex=function(e,t){var i=this.points_
if(e===i[0]){if(t===i[1])return 2
if(t===i[2])return 1}else if(e===i[1]){if(t===i[2])return 0
if(t===i[0])return 2}else if(e===i[2]){if(t===i[0])return 1
if(t===i[1])return 0}return-1},o.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},o.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},o.prototype.markConstrainedEdgeByPoints=function(e,t){var i=this.points_
t===i[0]&&e===i[1]||t===i[1]&&e===i[0]?this.constrained_edge[2]=!0:t===i[0]&&e===i[2]||t===i[2]&&e===i[0]?this.constrained_edge[1]=!0:(t===i[1]&&e===i[2]||t===i[2]&&e===i[1])&&(this.constrained_edge[0]=!0)},t.exports=o},{"./xy":11}],10:[function(e,t,i){"use strict"
function n(e,t,i){var n=(e.x-i.x)*(t.y-i.y),o=(e.y-i.y)*(t.x-i.x),r=n-o
return r>-s&&r<s?a.COLLINEAR:r>0?a.CCW:a.CW}function o(e,t,i,n){return!((e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)>=-s)&&!((e.x-i.x)*(n.y-i.y)-(n.x-i.x)*(e.y-i.y)<=s)}function r(e,t,i){var n=t.x-e.x,o=t.y-e.y
return n*(i.x-e.x)+o*(i.y-e.y)<0}var s=1e-12
i.EPSILON=s
var a={CW:1,CCW:-1,COLLINEAR:0}
i.Orientation=a,i.orient2d=n,i.inScanArea=o,i.isAngleObtuse=r},{}],11:[function(e,t,i){"use strict"
function n(e){return"("+e.x+";"+e.y+")"}function o(e){var t=e.toString()
return"[object Object]"===t?n(e):t}function r(e,t){return e.y===t.y?e.x-t.x:e.y-t.y}function s(e,t){return e.x===t.x&&e.y===t.y}t.exports={toString:o,toStringBase:n,compare:r,equals:s}},{}]},{},[6])(6)}()}(),function(){"use strict"
var e=Autodesk.Viewing
e.EventDispatcher=function(){},e.EventDispatcher.prototype={constructor:e.EventDispatcher,apply:function(t){t.addEventListener=e.EventDispatcher.prototype.addEventListener,t.hasEventListener=e.EventDispatcher.prototype.hasEventListener,t.removeEventListener=e.EventDispatcher.prototype.removeEventListener,t.fireEvent=e.EventDispatcher.prototype.fireEvent,t.dispatchEvent=e.EventDispatcher.prototype.fireEvent},addEventListener:function(e,t){e&&(void 0===this.listeners&&(this.listeners={}),void 0===this.listeners[e]&&(this.listeners[e]=[]),this.listeners[e].push(t))},hasEventListener:function(e,t){if(!e)return!1
if(void 0===this.listeners)return!1
var i=this.listeners
return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(e&&(void 0===this.listeners&&(this.listeners={}),this.listeners[e]instanceof Array))for(var i=this.listeners[e],n=0,o=i.length;n<o;n++)if(i[n]===t){i.splice(n,1)
break}},fireEvent:function(e){if(void 0===this.listeners&&(this.listeners={}),"string"==typeof e&&(e={type:e}),!e.target)try{e.target=this}catch(e){}if(!e.type)throw new Error("event type unknown.")
if(this.listeners[e.type]instanceof Array)for(var t=this.listeners[e.type].slice(),i=0;i<t.length;i++)t[i].call(this,e)}}}(),function(){"use strict"
function e(){}var t=Autodesk.Viewing.Private,i=function(){if("undefined"==typeof window)return!1
try{var e="lmv_viewer_test_localStorage",t=window.localStorage
return!!t&&(t.setItem(e,"1"),t.removeItem(e),!0)}catch(e){return!1}}()
e.prototype.getItem=function(e){return i?window.localStorage.getItem(e):null},e.prototype.setItem=function(e,n){if(i)try{window.localStorage.setItem(e,n)}catch(e){t.logger.debug("avp.LocalStorage: Failed to setItem()")}},e.prototype.removeItem=function(e){i&&window.localStorage.removeItem(e)},e.prototype.isSupported=function(){return i},Autodesk.Viewing.Private.LocalStorage=new e}(),Autodesk.Viewing.FileLoader=function(e){this.viewer=e},Autodesk.Viewing.FileLoader.prototype.constructor=Autodesk.Viewing.FileLoader,Autodesk.Viewing.FileLoader.prototype.loadFile=function(e,t,i,n){return!1},Autodesk.Viewing.FileLoader.prototype.is3d=function(){return!1},function(){"use strict"
var e=function(){function e(e,t,i){return!o[e]&&(o[e]={loader:i,extensions:t},!0)}function t(e){return o[e]?o[e].loader:null}function i(e){return!!o[e]&&(delete o[e],!0)}function n(e){e=e?e.toLowerCase():""
for(var t in o){var i=o[t]
if(i)for(var n=0;n<i.extensions.length;n++)if(i.extensions[n].toLowerCase()===e)return i.loader}return null}var o={}
return{registerFileLoader:e,getFileLoader:t,getFileLoaderForExtension:n,unregisterFileLoader:i}}
Autodesk.Viewing.FileLoaderManager=new e}(),function(){"use strict"
function e(e){for(var t=0;t<r.length;++t)document.addEventListener(r[t],e,!1)}function t(e){for(var t=0;t<r.length;++t)document.removeEventListener(r[t],e,!1)}function i(t){this.viewer=t,this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this),this.getMode()===n.ScreenMode.kFullScreen&&e(this.bindFullscreenEventListener)}var n=Autodesk.Viewing,o=n.Private,r=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"]
n.ScreenMode={kNormal:0,kFullBrowser:1,kFullScreen:2},n.ScreenModeDelegate=i,i.prototype.uninitialize=function(){t(this.bindFullscreenEventListener),this.viewer=null},i.prototype.isModeSupported=function(e){return!0},i.prototype.setMode=function(e){var t=this.getMode()
return!(e===t||!this.isModeSupported(e))&&(this.doScreenModeChange(t,e),this.onScreenModeChanged(t,e),!0)},i.prototype.getMode=function(){throw"Implement getMode() in derived class"},i.prototype.getNextMode=function(){var e,t=this.getMode(),i=n.ScreenMode
return t===i.kNormal&&this.isModeSupported(i.kFullBrowser)?e=i.kFullBrowser:t===i.kNormal&&this.isModeSupported(i.kFullScreen)?e=i.kFullScreen:t===i.kFullBrowser&&this.isModeSupported(i.kFullScreen)?e=i.kFullScreen:t===i.kFullBrowser&&this.isModeSupported(i.kNormal)?e=i.kNormal:t===i.kFullScreen&&this.isModeSupported(i.kNormal)?e=i.kNormal:t===i.kFullScreen&&this.isModeSupported(i.kFullBrowser)&&(e=i.kFullBrowser),e},i.prototype.getEscapeMode=function(){return this.getMode()!==n.ScreenMode.kNormal?n.ScreenMode.kNormal:void 0},i.prototype.fullscreenEventListener=function(){if(n.inFullscreen())this.viewer.resize()
else{var e=n.ScreenMode
this.doScreenModeChange(e.kFullScreen,e.kNormal),this.onScreenModeChanged(e.kFullScreen,e.kNormal)}},i.prototype.doScreenModeChange=function(e,t){throw"Implement doScreenModeChange() in derived class"},i.prototype.onScreenModeChanged=function(i,o){i===n.ScreenMode.kFullScreen?t(this.bindFullscreenEventListener):o===n.ScreenMode.kFullScreen&&e(this.bindFullscreenEventListener),this.viewer.resize(),this.viewer.fireEvent({type:n.FULLSCREEN_MODE_EVENT,mode:o})},n.AppScreenModeDelegate=function(e){n.ScreenModeDelegate.call(this,e)},n.AppScreenModeDelegate.prototype=Object.create(n.ScreenModeDelegate.prototype),n.AppScreenModeDelegate.prototype.constructor=n.AppScreenModeDelegate,n.AppScreenModeDelegate.prototype.isModeSupported=function(e){return e!==n.ScreenMode.kFullBrowser},n.AppScreenModeDelegate.prototype.getMode=function(){return n.inFullscreen()?n.ScreenMode.kFullScreen:n.ScreenMode.kNormal},n.AppScreenModeDelegate.prototype.doScreenModeChange=function(e,t){var i=this.viewer.container
t===n.ScreenMode.kNormal?(i.classList.remove("viewer-fill-browser"),n.exitFullscreen()):t===n.ScreenMode.kFullScreen&&(i.classList.add("viewer-fill-browser"),n.launchFullscreen(i))},n.ApplicationScreenModeDelegate=n.AppScreenModeDelegate,n.NullScreenModeDelegate=function(e){n.ScreenModeDelegate.call(this,e)},n.NullScreenModeDelegate.prototype=Object.create(n.ScreenModeDelegate.prototype),n.NullScreenModeDelegate.prototype.constructor=n.ScreenModeDelegate,n.NullScreenModeDelegate.prototype.isModeSupported=function(e){return!1},n.NullScreenModeDelegate.prototype.getMode=function(){return n.ScreenMode.kNormal},n.ScreenModeMixin=function(){},n.ScreenModeMixin.prototype={setScreenModeDelegate:function(e){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.screenModeDelegateClass=e||(null===e?n.NullScreenModeDelegate:n.AppScreenModeDelegate)},getScreenModeDelegate:function(){return this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this)),this.screenModeDelegate},isScreenModeSupported:function(e){return this.getScreenModeDelegate().isModeSupported(e)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(e){var t={category:"screen_mode",value:e}
return o.logger.track(t),this.getScreenModeDelegate().setMode(e)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var e=this.getScreenModeDelegate().getNextMode()
return void 0!==e&&this.setScreenMode(e)},escapeScreenMode:function(){var e=this.getScreenModeDelegate().getEscapeMode()
return void 0!==e&&this.setScreenMode(e)},apply:function(e){var t=n.ScreenModeMixin.prototype
e.setScreenModeDelegate=t.setScreenModeDelegate,e.getScreenModeDelegate=t.getScreenModeDelegate,e.isScreenModeSupported=t.isScreenModeSupported,e.canChangeScreenMode=t.canChangeScreenMode,e.setScreenMode=t.setScreenMode,e.getScreenMode=t.getScreenMode,e.nextScreenMode=t.nextScreenMode,e.escapeScreenMode=t.escapeScreenMode}}}(),function(){"use strict"
var e=Autodesk.Viewing,t=e.Private,i={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in"}
e.ModelUnits=i
var n=function(e){WGS.RenderModel.call(this),this.myData=e,this.topology=null,this.topologyPromise=null,this.svfUUID=null,this.defaultCameraHash=null
var i="Autodesk.Viewing.Private.HomeViewPFs."
this.getInstanceTree=function(){return this.myData?this.myData.instanceTree:null},this.getFragmentMap=function(){return this.myData?this.myData.instanceTree||this.myData.fragmentMap:null},this.getBoundingBox=function(){return this.myData?this.myData.bbox:null},this.is2d=function(){return!(!this.myData||!this.myData.is2d)},this.is3d=function(){return!(this.myData&&this.myData.is2d)},this.getFastLoadList=function(){if(this.svfUUID||!t.LocalStorage.isSupported())return JSON.parse(t.LocalStorage.getItem(i+this.svfUUID))},this.setFastLoadList=function(e,n){if(t.LocalStorage.isSupported()&&!t.LocalStorage.getItem(i+this.svfUUID)){var o=this.getDefaultCamera()
n.position.x+n.position.z==o.position.x+o.position.z&&t.LocalStorage.setItem(i+this.svfUUID,JSON.stringify(e))}}}
e.EventDispatcher.prototype.apply(n.prototype),n.prototype.constructor=n,n.prototype.setData=function(e){this.myData=e},n.prototype.getData=function(){return this.myData},n.prototype.setUUID=function(e){this.svfUUID=btoa(t.pathToURL(e))},n.prototype.getDocumentNode=function(){return this.myData.loadOptions?this.myData.loadOptions.bubbleNode||null:null},n.prototype.getRoot=function(){return this.myData&&this.myData.instanceTree?this.myData.instanceTree.root:null},n.prototype.getRootId=function(){if(this.myData){if(this.myData.instanceTree)return this.myData.instanceTree.getRootId()
if(this.myData.fragmentMap)return this.myData.fragmentMap.getRootId()}return 0},n.prototype.getUnitData=function(e){var t={unitString:null,unitScale:1}
switch(e){case"meter":case"meters":case"m":return t.unitString=i.METER,t.unitScale=1,t
case"foot":case"feet":case"ft":return t.unitString=i.FOOT,t.unitScale=.3048,t
case"feet and inches":case"inch":case"inches":case"in":return t.unitString=i.INCH,t.unitScale=.0254,t
case"centimeter":case"centimeters":case"cm":return t.unitString=i.CENTIMETER,t.unitScale=.01,t
case"millimeter":case"millimeters":case"mm":return t.unitString=i.MILLIMETER,t.unitScale=.001,t
default:return t}},n.prototype.getUnitScale=function(){var e
return e=this.is2d()?this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.overriddenUnits?this.myData.overriddenUnits:this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null),e&&(e=e.toLowerCase()),this.getUnitData(e).unitScale},n.prototype.getUnitString=function(){var e
return e=this.is2d()?this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.overriddenUnits?this.myData.overriddenUnits:this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null),e&&(e=e.toLowerCase()),this.getUnitData(e).unitString},n.prototype.getDisplayUnit=function(){var e
return e=this.is2d()?this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.scalingUnit?this.myData.scalingUnit:this.getMetadata("distance unit","value",null),e&&(e=e.toLowerCase()),this.getUnitData(e).unitString},n.prototype.getMetadata=function(e,t,i){if(this.myData){var n=this.myData.metadata
if(n){var o=n[e]
if(void 0!==o){if(!t)return o
var r=o[t]
if(void 0!==r)return r}}}return i},n.prototype.getDefaultCamera=function(){var e=this.myData
if(!e)return null
var t=null,i=e.cameras?e.cameras.length:0
if(0<i){var n=this.getMetadata("default camera","index",null)
if(null!==n&&e.cameras[n])t=e.cameras[n]
else{for(var o=0;o<i;o++){var r=e.cameras[o]
if(r.isPerspective){t=r
break}}t||(t=e.cameras[0])}}return t},n.prototype.isAEC=function(){return!!this.myData.loadOptions.isAEC},n.prototype.getUpVector=function(){return this.getMetadata("world up vector","XYZ",null)},n.prototype.geomPolyCount=function(){var e=this.getGeometryList()
return e?e.geomPolyCount:null},n.prototype.instancePolyCount=function(){var e=this.getGeometryList()
return e?e.instancePolyCount:null},n.prototype.getLayersRoot=function(){return this.is2d()?this.myData?this.myData.layersRoot:null:(t.logger.warn("Autodesk.Viewing.Model.getLayersRoot is not yet implemented for 3D"),null)},n.prototype.isLoadDone=function(){return!(!this.myData||!this.myData.loadDone)},n.prototype.isObjectTreeCreated=function(){return!!this.myData.instanceTree},n.prototype.getPropertyDb=function(){return this.myData&&this.myData.propDbLoader},n.prototype.getProperties=function(e,t,i){var n=this.getPropertyDb()
if(!n||e<=0)return void(i&&i())
n.getProperties(e,t,i)},n.prototype.getBulkProperties=function(e,t,i,n){Array.isArray(t)&&(t={propFilter:t}),t=t||{}
var o=t.propFilter||null,r=t.ignoreHidden||!1,s=this.getPropertyDb()
if(!s)return void(n&&n())
s.getBulkProperties(e,o,i,n,r)},n.prototype.getExternalIdMapping=function(e,t){var i=this.getPropertyDb()
if(!i)return void(t&&t())
i.getExternalIdMapping(e,t)},n.prototype.getObjectTree=function(e,t){var i=this.getPropertyDb()
if(!i)return void(t&&t())
i.getObjectTree(e,t)},n.prototype.isObjectTreeLoaded=function(){var e=this.getPropertyDb()
return!!e&&e.isObjectTreeLoaded()},n.prototype.search=function(e,t,i,n,o){var r=this.getPropertyDb()
if(!r)return void(i&&i())
r.searchProperties(e,n,t,i,o)}
var o=function(e){var t=e
if(Math.abs(t[0])<.001)if(Math.abs(t[4])>.001)for(var i=0;i<4;i++){var n=t[i]
t[i]=t[i+4],t[i+4]=n}else for(var i=0;i<4;i++){var n=t[i]
t[i]=t[i+8],t[i+8]=n}if(Math.abs(t[5])<.001)for(var i=4;i<8;i++){var n=t[i]
t[i]=t[i+4],t[i+4]=n}},r=function(e,t,i,n){var o,r,s,a,l,c,d=!1
s=n[i[i.length-1]].x,a=n[i[i.length-1]].y,o=a>=t
for(var u=0,h=i.length;u<h;++u)l=n[i[u]].x,c=n[i[u]].y,r=c>=t,o!=r&&(c-t)*(s-l)>=(l-e)*(a-c)==r&&(d=!d),o=r,s=l,a=c
return d}
n.prototype.pointInPolygon=function(e,t,i,n){for(var o=!1,s=0;s<i.length;s++)r(e,t,i[s],n)&&(o=!o)
return o},n.prototype.getPageToModelTransform=function(e){if(this.myData.pageToModelTransform)return this.myData.pageToModelTransform
var t=this.myData,i=t.metadata,n=i.page_dimensions,r=t.viewports[e]
if(!r)return new THREE.Matrix4
t.viewportTransforms||(t.viewportTransforms=new Array(t.viewports.length))
var s=t.viewportTransforms[e]
if(s)return s
var a=new LmvMatrix4(!0).set(n.logical_width/n.page_width,0,0,n.logical_offset_x,0,n.logical_height/n.page_height,0,n.logical_offset_y,0,0,1,0,0,0,0,1),l=r.transform.slice()
o(l)
var c=new LmvMatrix4(!0)
c.elements.set(l)
var d=new LmvMatrix4(!0)
return d.getInverse(c),d.multiply(a),t.viewportTransforms[e]=d,d},n.prototype.pageToModel=function(e,t,i){var n=this.getPageToModelTransform(i),o=(new THREE.Vector3).set(e.x,e.y,0).applyMatrix4(n),r=(new THREE.Vector3).set(t.x,t.y,0).applyMatrix4(n)
e.x=o.x,e.y=o.y,t.x=r.x,t.y=r.y},n.prototype.pointInClip=function(e,t){for(var i=this.myData.clips,n=[],o=1;o<i.length;o++)if(o!==t){for(var r=[],s=[],a=i[o].contourCounts,l=i[o].points,c=0,d=[],u=0;u<a.length;u++){for(var h=0;h<a[u];h++)r.push(c),c++
s.push(r),r=[]}for(var u=0;u<l.length;u+=2){var p={x:l[u],y:l[u+1]}
d.push(p)}var m=this.pointInPolygon(e.x,e.y,s,d)
m&&n.push(o)}return n},n.prototype.getClip=function(e){for(var t=this.myData.clips,i=[],n=[],o=t[e].contourCounts,r=t[e].points,s=0,a=[],l=0;l<o.length;l++){for(var c=0;c<o[l];c++)i.push(s),s++
n.push(i),i=[]}for(var l=0;l<r.length;l+=2){var d={x:r[l],y:r[l+1]}
a.push(d)}return{contours:n,points:a}},n.prototype.getTopoIndex=function(e){if(this.myData&&this.myData.fragments){var t=this.myData.fragments.topoIndexes
if(t)return t[e]}},n.prototype.getTopology=function(e){return this.topology?this.topology[e]:null},n.prototype.hasTopology=function(){return!!this.topology},n.prototype.fetchTopology=function(t){if(this.topology)return Promise.resolve(this.topology)
if(!this.myData.topologyPath)return Promise.reject({error:"no-topology"})
var i=t||(e.isMobileDevice()?20:100)
if(this.myData.topologySizeMB>i)return Promise.reject({error:"topology-too-big",limitMB:i,topologyMB:this.myData.topologySizeMB})
if(!this.topologyPromise){var n=this
this.topologyPromise=new Promise(function(e,t){n.loader.fetchTopologyFile(n.myData.topologyPath,function(i){i&&i.topology?(n.topology=i.topology,e(i.topology)):t(i)})})}return this.topologyPromise},n.prototype.hasGeometry=function(){return!!this.myData&&(!!this.myData.isLeaflet||this.myData.fragments.length>0)},e.Model=n}(),function(){"use strict"
function e(e){var t=e.split("/")
if(0==t.length)return e
for(var i=[],n=0;n<t.length;++n){var o=t[n]
"."!==o&&(".."===o&&i.length?i.pop():i.push(o))}return 0==i.length?"":i.join("/")}function t(e,t){for(var i=e.length-t,n=new ArrayBuffer(i),o=new Uint8Array(n,0),r=0,s=t;r<i;r++,s++)o[r]=255&e.charCodeAt(s)
return o}function i(e,t){return-1===t.indexOf("file://")&&(-1!==t.indexOf("://")||(!!e||void 0))}function n(e,t,i,n){function o(e){if("json"==n.responseType)try{return JSON.parse(e.toString("utf8"))}catch(e){i(e)}return e}0===e.indexOf("file://")&&(e=e.substr(7)),require("fs").readFile(e,function(r,s){r?i(0,0,{httpStatusText:r,url:e}):31==s[0]&&139==s[1]?require("zlib").gunzip(s,null,function(r,s){r?i(0,0,{httpStatusText:r,url:e}):(s=o(s),n.ondata&&n.ondata(s),t(s))}):(s=o(s),n.ondata&&n.ondata(s),t(s))})}function o(e,t){t.hasOwnProperty("asynchronous")?t.asynchronous||s.logger.warn("LMV: Sync XHR used. Performance warning."):t.asynchronous=!0,t.hasOwnProperty("responseType")||(t.responseType="arraybuffer"),t.hasOwnProperty("withCredentials")||(t.withCredentials=!!e.auth),t.headers=e.headers,t.queryParams=e.queryParams,t.endpoint=e.endpoint}var r=Autodesk.Viewing,s=r.Private
s.inWorkerThread="undefined"!=typeof self&&"undefined"==typeof window
var a
"undefined"!=typeof XMLHttpRequest?a=XMLHttpRequest:(a=require("xhr2"),a.prototype._restrictedHeaders.cookie=!1)
var l={},c=!1
l.simplifyPath=e,l.OSS_PREFIX="urn:adsk.objects:os.object:",l.getDirectOSSUrl=function(t,i){var n=i.indexOf(l.OSS_PREFIX)
if(-1!==n){var o=i.substr(n+l.OSS_PREFIX.length),s=o.substr(0,o.indexOf("/")),a=o.substr(o.indexOf("/")+1)
return a=e(a),r.makeOssPath(t,s,a)}},l.generateUrl=function(t,n,o){if(r.isNodeJS&&!i(t,o))return o
o=e(o)
var s=o.indexOf("urn:"),a=o.indexOf("?");-1!=s&&(o=-1!==a?o.slice(0,s)+encodeURIComponent(o.slice(s,a))+o.slice(a):o.slice(0,s)+encodeURIComponent(o.slice(s)))
var c=l.getDirectOSSUrl(t,o)
if(c)return c
if(0!==decodeURIComponent(o).indexOf("urn:"))return o
switch("items"!==n&&(o=o.substr(6)),n){case"items":return r.getItemApi(t,o)
case"bubbles":return r.getManifestApi(t,o)
case"thumbnails":return r.getThumbnailApi(t,o)}},l.rawGet=function(e,o,d,u,h,p){function m(e){h&&h(f.status,f.statusText,{url:d})}function g(e){if(200===f.status)if(f.response&&f.response instanceof ArrayBuffer){var t=new Uint8Array(f.response)
if(!p.skipDecompress&&31==t[0]&&139==t[1]){c||(c=!0,s.logger.warn("An LMV resource ("+d+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."))
try{t=new Zlib.Gunzip(t).decompress()}catch(e){h(r.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:d,exception:e.toString(),stack:e.stack})}}u(t)}else u(f.response||f.responseText)
else m(e)}var p=p||{}
if(d=l.generateUrl(e,o,d),r.isNodeJS&&!i(e,d))return void n(d,u,h,p)
p.queryParams&&(d=d+"?"+p.queryParams)
var f=new a
try{var v=!p.hasOwnProperty("asynchronous")||p.asynchronous
if(f.open(p.noBody?"HEAD":"GET",d,v),p.hasOwnProperty("responseType")&&(f.responseType=p.responseType),f.withCredentials=!0,p.hasOwnProperty("withCredentials")&&(f.withCredentials=p.withCredentials),p.headers)for(var E in p.headers)f.setRequestHeader(E,p.headers[E]),"authorization"===E.toLocaleLowerCase()&&(f.withCredentials=!1)
v&&(f.onload=g,f.onerror=m,f.ontimeout=m,p.ondata&&(f.overrideMimeType("text/plain; charset=x-user-defined"),p._dlProgress={streamOffset:0,counter:0},f.onreadystatechange=function(){if(f.readyState>2){var e=f.responseText
if(p._dlProgress.streamOffset>=e.length)return
var i=t(e,p._dlProgress.streamOffset)
p._dlProgress.streamOffset=e.length,p.ondata(i)}})),f.send(),p.skipAssetCallback||(s.inWorkerThread?self.postMessage({assetRequest:[d,p.headers,null]}):s.assets.push([d,p.headers,null])),v||g()}catch(e){h(f.status,f.statusText,{url:d,exception:e})}},l.defaultFailureCallback=function(e,t,i){403==e?this.raiseError(r.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:i.url,httpStatus:e,httpStatusText:t}):404==e?this.raiseError(r.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:i.url,httpStatus:e,httpStatusText:t}):e>=500&&e<600?this.raiseError(r.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:i.url,httpStatus:e,httpStatusText:t}):i.exception?this.raiseError(r.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:i.url,exception:i.exception.toString(),stack:i.exception.stack}):this.raiseError(r.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:i.url,httpStatus:e,httpStatusText:t,data:i})},l.getItem=function(e,t,i,n,r){r=r||{},o(e,r),l.rawGet(e.endpoint,"items",t,i,n,r)},l.getManifest=function(e,t,i,n,r){r=r||{},r.hasOwnProperty("responseType")||(r.responseType="json"),o(e,r),l.rawGet(e.endpoint,"bubbles",t,i,n,r)},l.getThumbnail=function(e,t,i,n,r){r=r||{},o(e,r)
var s=r.queryParams||"",a=[]
if(-1===s.indexOf("guid=")&&a.push("guid="+encodeURIComponent(r.guid)),-1===s.indexOf("role=")){var c=r.role||"rendered"
a.push("role="+c)}if(-1===s.indexOf("width=")){var d=r.size||400
a.push("width="+d)}if(-1===s.indexOf("height=")){var d=r.size||400
a.push("height="+d)}-1===s.indexOf("acmsession=")&&r.acmsession&&a.push("acmsession="+r.acmsession)
var u=a.join("&")
r.queryParams?r.queryParams=r.queryParams+"&"+u:r.queryParams=u,l.rawGet(e.endpoint,"thumbnails",t,i,n,r)},l.getACMSession=function(e,t,i,n){var o,r={}
for(var s in t)"oauth2AccessToken"===s?o=t[s]:-1!==s.indexOf("x-ads-acm")&&(r[s]=t[s])
r.application="autodesk"
var a=new XMLHttpRequest
a.open("POST",e+"/oss-ext/v2/acmsessions",!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer "+o),a.responseType="json",a.onload=function(){if(200===a.status&&a.response){var e="string"==typeof a.response?JSON.parse(a.response):a.response
e&&e.acmsession?i(e.acmsession):n(a.status,"Can't get acm session from response.")}else n(a.status)},a.onerror=n,a.ontimeout=n,a.send(JSON.stringify(r)),delete r.application},s.ViewingService=l}(),"undefined"!=typeof window){var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null
if(navigator.mozGetUserMedia)webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]),RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),createIceServer=function(e,t,i){var n=null,o=e.split(":")
if(0===o[0].indexOf("stun"))n={url:e}
else if(0===o[0].indexOf("turn")&&(-1!==e.indexOf("transport=udp")||-1===e.indexOf("?transport"))){var r=e.split("?")
n={url:r[0],credential:i,username:t}}return n},attachMediaStream=function(e,t){console.log("Attaching media stream"),e.mozSrcObject=t,e.play()},reattachMediaStream=function(e,t){console.log("Reattaching media stream"),e.mozSrcObject=t.mozSrcObject,e.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]}
else if(navigator.webkitGetUserMedia){var match=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)
webrtcDetectedBrowser="chrome",webrtcDetectedVersion=match?parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2]):40,createIceServer=function(e,t,i){var n=null,o=e.split(":")
if(0===o[0].indexOf("stun"))n={url:e}
else if(0===o[0].indexOf("turn"))if(webrtcDetectedVersion<28){var r=e.split("turn:")
n={url:"turn:"+t+"@"+r[1],credential:i}}else n={url:e,credential:i,username:t}
return n},RTCPeerConnection=webkitRTCPeerConnection,getUserMedia=navigator.webkitGetUserMedia.bind(navigator),attachMediaStream=function(e,t){void 0!==e.srcObject?e.srcObject=t:void 0!==e.mozSrcObject?e.mozSrcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):console.log("Error attaching stream to element.")},reattachMediaStream=function(e,t){e.src=t.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})}else console.log("Browser does not appear to be WebRTC-capable")}!function(){"use strict"
function e(e,t){function o(){return i.config.userName&&i.config.userName.length?i.config.userName:g?g.slice(0,5):"Unknown"}function r(e){switch(e.type){case"txt":c(e)
break
case"joinok":l(e)
break
case"join_error":break
case"sessionId":i.logger.info("Connect successful, your id is: "+e.id),g=e.id
break
case"joined":e.userStatus="joined",s(e)
break
case"left":e.userStatus="left",a(e)
break
case"camera":case"pointer":break
default:i.logger.log(e)}var t=e.roomId,n={type:m[e.type],data:e,channelId:t}
A.dispatchEvent(n)}function s(e){if(e.user.name&&e.user.name.length||(e.user.name=e.user.id.slice(0,5)),e.roomId){var t=y[e.roomId]
t?(t.users.push(e.user),i.logger.info(e.user+" joined room "+e.roomId)):i.logger.warn("Channel "+e.roomId+" does not exist for socket "+g)}}function a(e){i.logger.info(e.user+" left room "+e.room)
for(var t in y){for(var n=y[t].users,o=-1,r=0;r<n.length;r++)if(n[r].id==e.user){o=r
break}-1!=o&&n.splice(o,1),delete y[t].userSet[e.user]}}function l(e){var t=y[e.roomId]
i.logger.info("joined channel "+e.roomId),e.users&&e.users.length?t.users=e.users:t.users=[]
for(var n=0;n<t.users.length;n++)t.users[n].name&&t.users[n].name.length||(t.users[n].name=t.users[n].id.slice(0,5))
var r=o(),s=Autodesk.Viewing.i18n.translate("you"),a={id:g,name:r+" ("+s+")",isSelf:!0,status:0}
t.userSet[g]||(t.users.push(a),t.userSet[g]=a),0!=a.id.indexOf(r)&&A.sendChatMessage("/nick "+r,e.roomId)}function c(e){if(0==e.msg.indexOf("/nick ")){var t=A.getUserById(e.from,e.roomId),i=e.msg.slice(6)
if(i.length&&(t.name=i,t.id==g)){var n=Autodesk.Viewing.i18n.translate("you")
t.name+=" ("+n+")"}A.dispatchEvent({type:"userListChange",data:e,channelId:e.roomId})}}function d(e){v<f.length?(i.logger.info("Connect failed, trying another server..."),p.disconnect(),p=null,v++,A.connect(A.sessionID)):A.dispatchEvent({type:"socketError",data:e})}function u(e){A.dispatchEvent({type:"socketError",data:e})}function h(e){v=0
for(var t in E)A.join(t)}var p,m={camera:"cameraChange",pointer:"pointerMove",joystick:"joystick",state:"viewerState",txt:"chatReceived",joinok:"userListChange",sessionId:"connectSucceeded",joined:"userListChange",left:"userListChange",private:"privateMessage",join_error:"socketError"},g=null,f=Array.isArray(e)?e:[e],v=0,E={},y={},A=this
this.connect=function(e){if(!p)return void 0!==window.WebSocket&&(n||(n="undefined"!=typeof lmv_io?lmv_io:io),this.sessionID=e,p=n.connect(f[v]+"?sessionID="+e,{path:t,forceNew:!0}),p.on("connect",h),p.on("message",r),p.on("connect_error",d),p.on("error",u),!0)},this.join=function(e){if(!p||!p.connected)return void(E[e]=1)
delete E[e],y[e]={id:e,users:[],userSet:{}},p.emit("join",{roomId:e,name:o()})},this.disconnect=function(){p&&(p.disconnect(),p=null,y={},g=null)},this.sendMessage=function(e,t,i){var n={type:e,from:g,msg:t,roomId:i}
p.emit("message",n)},this.sendPrivateMessage=function(e,t){var i={type:"private",target:e,from:g,msg:t}
p.emit("message",i)},this.sendChatMessage=function(e,t){var i={type:"txt",from:g,msg:e,roomId:t}
p.emit("message",i),r(i)},this.getUserById=function(e,t){for(var i=y[t].users,n=0;n<i.length;n++)if(i[n].id==e)return i[n]
return null},this.getLocalId=function(){return g},this.getChannelInfo=function(e){return y[e]},this.isConnected=function(){return p}}var t=Autodesk.Viewing,i=t.Private
i.config={userName:""},i.setUserName=function(e){i.config.userName=e}
var n
e.prototype.constructor=e,t.EventDispatcher.prototype.apply(e.prototype)
var o={}
e.GetInstance=function(e,t){e||(e=i.EnvironmentConfigurations[i.env].LMV.RTC),Array.isArray(e)||(e=[e])
var n=o[e[0]]
return n||(n=new i.MessageClient(e,t),o[e[0]]=n,n)},Autodesk.Viewing.Private.MessageClient=e}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var t=Autodesk.Viewing,i=t.Private
i.P2PClient=function(n){function o(e){try{u=new RTCPeerConnection(A),u.onicecandidate=function(e){e.candidate?v.sendPrivateMessage(h,{type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):i.logger.log("End of candidates.")},u.ondatachannel=function(e){i.logger.log("Data channel added."),g=e.channel,g.onmessage=l,f.dispatchEvent({type:"dataChannelAdded",data:e.channel})},u.onaddstream=function(e){i.logger.log("Remote stream added."),m=e.stream,f.dispatchEvent({type:"remoteStreamAdded",data:e.stream})},u.onremovestream=function(e){i.logger.log("Remote stream removed. Event: ",e),m=null,f.dispatchEvent({type:"remoteStreamRemoved",data:e.stream})},e&&(g=u.createDataChannel("sendDataChannel",{reliable:!1,ordered:!1}),g.onmessage=l)}catch(e){return i.logger.error("Failed to create PeerConnection, exception: "+e.message,t.errorCodeString(t.ErrorCodes.NETWORK_FAILURE)),void alert("Cannot create RTCPeerConnection object.")}}function r(n){i.logger.error("createOffer() error: ",e,t.errorCodeString(t.ErrorCodes.UNKNOWN_FAILURE))}function s(e){if(u.setLocalDescription(e),v.sendPrivateMessage(h,e),y.length){for(var t=0;t<y.length;t++)u.addIceCandidate(y[t])
y=[]}}function a(e){for(var t=e.split("\n"),i=!1,n=!1,o=!1,r=0;r<t.length;r++)0==t[r].indexOf("a=mid:data")&&(i=!0),0==t[r].indexOf("a=mid:video")&&(o=!0),0==t[r].indexOf("a=mid:audio")&&(n=!0)
return i&&!o&&!n}function l(e){var t=JSON.parse(e.data)
switch(t.type){case"camera":f.dispatchEvent({type:"cameraChange",data:t})
break
case"joystick":f.dispatchEvent({type:"joystick",data:t})
break
case"state":f.dispatchEvent({type:"viewerState",data:t})}}function c(e){var t=e.data.msg
if(i.logger.debug("Client received message:"+JSON.stringify(t)),"offer"!=t.type||E)if("answer"===t.type&&E)u.setRemoteDescription(new RTCSessionDescription(t))
else if("candidate"===t.type){var n=new RTCIceCandidate({sdpMLineIndex:t.label,candidate:t.candidate})
E?u.addIceCandidate(n):y.push(n)}else"bye"===t&&E&&(f.dispatchEvent({type:"remoteHangup",data:null}),i.logger.info("Session terminated."),d())
else i.logger.log("Received offer. Accepting."),f.receiveCall(e.data)}function d(){E=!1,u.close(),u=null,p=null,m=null,h=null}var u,h,p,m,g,f=this,v=n,E=!1,y=[],A={iceServers:[{url:"stun:stun.l.google.com:19302"}]},T={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},b={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}}
v.addEventListener("privateMessage",c),this.hangup=function(){i.logger.log("Hanging up."),E&&(v.sendPrivateMessage(h,"bye"),d())},this.initUserMedia=function(e){function n(t){i.logger.log("Adding local stream."),e&&e(t),f.dispatchEvent({type:"localStreamAdded",data:t})}function o(e){i.logger.error("getUserMedia error: ",e,t.errorCodeString(t.ErrorCodes.NETWORK_SERVER_ERROR))}var r={video:!0,audio:!0}
window.getUserMedia(r,n,o),i.logger.log("Getting user media with constraints",r)},this.callUser=function(e,t){if(h)return void i.logger.warn("Already in a call. Ignoring call request.")
h=e,i.logger.info("Calling user "+h),t?(o(!0),E=!0,i.logger.log("Sending data channel offer to peer"),u.createOffer(s,r)):this.initUserMedia(function(e){p=e,E||void 0===p||(o(!1),u.addStream(p),E=!0,i.logger.log("Sending audio/video offer to peer"),u.createOffer(s,r))})},this.receiveCall=function(e){(h=e.from)||(h=e.senderId),a(e.msg.sdp)?(o(!0),E=!0,u.setRemoteDescription(new RTCSessionDescription(e.msg)),i.logger.log("Sending data-only answer to peer."),u.createAnswer(s,null,b)):this.initUserMedia(function(t){p=t,E||void 0===p||(o(!1),u.addStream(p),E=!0),u.setRemoteDescription(new RTCSessionDescription(e.msg)),i.logger.log("Sending audio+video answer to peer."),u.createAnswer(s,null,T)})},this.getCurrentCallTarget=function(){return h},this.dataChannel=function(){return g}},i.P2PClient.prototype.constructor=i.P2PClient,Autodesk.Viewing.EventDispatcher.prototype.apply(i.P2PClient.prototype)}(),function(){var e=Autodesk.Viewing.Private
Autodesk.Viewing.Private.LiveReviewClient=function(e){this.viewer=e,this.messageClient=null,this.presenceChannelId=null,this.p2p=null,this.viewtx=null,this.interceptor=null},Autodesk.Viewing.Private.LiveReviewClient.prototype.destroy=function(){this.leaveLiveReviewSession()},Autodesk.Viewing.Private.LiveReviewClient.prototype.joinLiveReviewSession=function(t){this.messageClient||(this.messageClient=e.MessageClient.GetInstance()),this.presenceChannelId||(this.presenceChannelId=window.location.host),this.messageClient.isConnected()||this.messageClient.connect(t),this.viewtx||(this.viewtx=new e.ViewTransceiver(this.messageClient)),this.viewtx.channelId=t,this.viewtx.attach(this.viewer),this.p2p||(this.p2p=new e.P2PClient(this.messageClient)),this.messageClient.join(this.viewtx.channelId),this.interceptor||(this.interceptor=new e.InteractionInterceptor(this.viewtx)),this.viewer.toolController.registerTool(this.interceptor),this.viewer.toolController.activateTool(this.interceptor.getName())},Autodesk.Viewing.Private.LiveReviewClient.prototype.leaveLiveReviewSession=function(){this.p2p&&this.p2p.hangup(),this.viewtx&&this.viewtx.detach(this.viewer),this.messageClient&&this.messageClient.disconnect(),this.interceptor&&this.viewer.toolController.deactivateTool(this.interceptor.getName()),this.p2p=null,this.viewtx=null,this.messageClient=null,this.interceptor=null}
var t=Autodesk.Viewing,e=t.Private
e.InteractionInterceptor=function(e){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(e){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(t){return e.takeControl(),!1},this.handleButtonDown=function(t,i){return e.takeControl(),!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(t){return e.updatePointer(t),!1},this.handleGesture=function(t){return e.takeControl(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}},e.ViewTransceiver=function(i){function n(e){g=!0
var t=JSON.parse(e.data.msg)
b.restoreState(t),m.impl.invalidate(!0,!1,!0),g=!1}function o(e){return Math.round(1e3*e)/1e3}function r(e){for(var t=0;t<e.length;t++)e[t]=o(e[t])}function s(e){var t=e.data.msg
!0===t[1]||v||(t[0]!=h&&(h=t[0],e.data.lastInControl=t[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:e.data})),f=!1,m.navigation.setView((new THREE.Vector3).set(t[2],t[3],t[4]),(new THREE.Vector3).set(t[5],t[6],t[7])),m.navigation.setCameraUpVector((new THREE.Vector3).set(t[8],t[9],t[10])))}function a(e){if(f||v){var t=e.camera,n=[t.position.x,t.position.y,t.position.z,t.target.x,t.target.y,t.target.z,t.up.x,t.up.y,t.up.z]
r(n),n.unshift(v),n.unshift(i.getLocalId()),E.sendMessage("camera",n,p.channelId),h!=n[0]&&(h=n[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:{lastInControl:h}}))}}function l(e,t,i){e&&!A&&(A=document.createElement("div"),A.classList.add("collabPointer")),e&&!T?(m.container.appendChild(A),T=!0):!e&&T&&(m.container.removeChild(A),T=!1),e&&(A.style.left=t-6+"px",A.style.top=i-6+"px")}function c(e){if(!f&&!v){var t=e.data.msg
y.origin.set(t[1],t[2],t[3]),y.direction.set(t[4],t[5],t[6])
var i=y.at(m.getCamera().near)
i.project(m.getCamera()),i=m.impl.viewportToClient(i.x,i.y),l(!0,i.x,i.y)}}function d(e){if(f){var t=m.impl.clientToViewport(e.canvasX,e.canvasY)
m.impl.viewportToRay(t,y)
var n=[y.origin.x,y.origin.y,y.origin.z,y.direction.x,y.direction.y,y.direction.z]
r(n),n.unshift(i.getLocalId()),E.sendMessage("pointer",n,p.channelId)}}function u(e){if(!g){var t=b.getState(w)
i.sendMessage("state",JSON.stringify(t),p.channelId)}}var h,p=this,m=this.viewer=null,g=!1,f=!1,v=!1,E=this.client=i,y=new THREE.Ray,A=null,T=!1
this.channelId=null
var b,w={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}}
this.takeControl=function(){f=!0,l(!1)},this.updatePointer=function(e){d(e)},this.connectCamera=function(e){v=!e},this.attach=function(i,o){m&&this.detach(),this.viewer=m=i,b=new e.ViewerState(m),E.addEventListener("cameraChange",s),E.addEventListener("pointerMove",c),m.hasEventListener(t.CAMERA_CHANGE_EVENT,a)||m.addEventListener(t.CAMERA_CHANGE_EVENT,a),o||(E.addEventListener("viewerState",n),m.hasEventListener(t.SELECTION_CHANGED_EVENT,u)||(m.addEventListener(t.SELECTION_CHANGED_EVENT,u),m.addEventListener(t.ISOLATE_EVENT,u),m.addEventListener(t.HIDE_EVENT,u),m.addEventListener(t.SHOW_EVENT,u),m.addEventListener(t.EXPLODE_CHANGE_EVENT,u),m.addEventListener(t.LAYER_VISIBILITY_CHANGED_EVENT,u),m.addEventListener(t.CUTPLANES_CHANGE_EVENT,u)))},this.detach=function(){l(!1),E&&(E.removeEventListener("cameraChange",s),E.removeEventListener("viewerState",n)),m&&(m.removeEventListener(t.CAMERA_CHANGE_EVENT,a),m.removeEventListener(t.SELECTION_CHANGED_EVENT,u),m.removeEventListener(t.ISOLATE_EVENT,u),m.removeEventListener(t.HIDE_EVENT,u),m.removeEventListener(t.SHOW_EVENT,u),m.removeEventListener(t.EXPLODE_CHANGE_EVENT,u),m.removeEventListener(t.LAYER_VISIBILITY_CHANGED_EVENT,u),m.removeEventListener(t.CUTPLANES_CHANGE_EVENT,u),this.viewer=m=null,b=null)}},e.ViewTransceiver.prototype.constructor=e.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(e.ViewTransceiver.prototype)}()
var avp=Autodesk.Viewing.Private
avp.Autocam=avp.Autocam||function(e,t){function i(t){A=!0,e.target.copy(f.center),e.pivot.copy(f.pivot),e.worldup?e.worldup.copy(f.sceneUpDirection):e.up.copy(f.sceneUpDirection),f.cameraChangedCallback&&f.cameraChangedCallback(t),A=!1}function n(e,t){var i=e.clone()
return Math.abs(i.clone().dot(t))<Number.MIN_VALUE?(i.normalize(),i):(i=o(e,t),i.length()<Number.MIN_VALUE&&(i=r(t)),i.normalize(),i)}function o(e,t){t.normalize()
var i=e.clone().dot(t),n=t.clone().multiplyScalar(i)
return n=e.clone().sub(n)}function r(e){for(var t=new THREE.Vector3(0,0,0),i=[new THREE.Vector3(0,1,0),new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,1,1),new THREE.Vector3(1,0,1),new THREE.Vector3(1,1,0),new THREE.Vector3(1,1,1)],n=0;n<7;n++)if(Math.abs(i[n].dot(e))<Number.MIN_VALUE){t=i[n]
break}return t}function s(e,t){var i=new THREE.Vector2(0,0)
return i.x=e/window.innerWidth,i.y=t/window.innerHeight,i}function a(t){t.y=Math.abs(t.y-window.innerHeight)
var i,n,o=e.position,r=f.center,s=r.clone().sub(o),a=e.up,l=s.clone().cross(a),c=s.clone().length(),d=c*Math.tan(THREE.Math.degToRad(e.leftFov)),u=c*Math.tan(THREE.Math.degToRad(e.rightFov)),h=c*Math.tan(THREE.Math.degToRad(e.topFov)),p=c*Math.tan(THREE.Math.degToRad(e.bottomFov)),m=d+u,g=h+p,v=t.x*m/window.innerWidth,E=v-d,y=t.y*g/window.innerHeight,A=y-p
return a=a.clone().normalize().clone().multiplyScalar(A),l=l.clone().normalize().clone().multiplyScalar(E),f.ortho?(i=o.clone().add(l).clone().add(a),n=s):(i=o,n=s.clone().add(a).clone().add(l)),{rayO:i,rayD:n}}function l(e,t,i){var n,o,r,s
n=o=r=s=0
var a=0,l=null,c=null,d=f.snapOrbitDeadZone,u=f.orbitMultiplier
return"h"==e?(n=f.snapOrbitThresholdH,o=f.snapOrbitAccelerationAX,r=f.snapOrbitAccelerationBX,s=1-f.snapOrbitAccelerationPointX,c=f.lockDeltaX,l=f.lockedX):(n=f.snapOrbitThresholdV,o=f.snapOrbitAccelerationAY,r=f.snapOrbitAccelerationBY,s=1-f.snapOrbitAccelerationPointY,c=f.lockDeltaY,l=f.lockedY),l?(c+=i,c<-d?(a=(c+d)*u*1/r,l=!1):c>d&&(a=(c-d)*u*1/r,l=!1)):(a=Math.abs(t)>n?i*u:Math.abs(t)>s*n?i*t>0?i*u*o:i*u*1/o:i*t>0?i*u*r:i*u*1/r)*t>0&&Math.abs(a)>Math.abs(t)&&(this.lockDeltaX=this.lockDeltaY=0,l=!0,a=t),a}function c(){return f.combined}function d(e,t){var i=!1,n=window.innerWidth,o=e.x%n,r=window.innerHeight,s=e.y%r,a=o>0?o-t.x:n+o-t.x,l=s>0?s-t.y:r+s-t.y
return Math.abs(a)<30&&Math.abs(l)<30&&(i=!0),i}function u(e,t,i){i.x=(e.x-t.x)/window.innerWidth,e.x=t.x+(e.x-t.x)%window.innerWidth,i.y=(e.y-t.y)/window.innerHeight,e.y=t.y+(e.y-t.y)%window.innerHeight}function h(e,t,i){if(!F||!e){if(e){var n=new THREE.Vector2,o=t.x,r=t.y
u(t,i,n),H=window.innerWidth*n.x,B=window.innerHeight*n.y,o<i.x?o-=60:o+=60,r<i.y?r-=60:r+=60}F=e}}function p(e,t,i){if(0===t)return 0
var n=e,o=f.saveEye.clone().sub(worldUp.clone().multiplyScalar(i+n)),r=f.saveEye.clone().sub(worldUp.clone().multiplyScalar(i)),s=0,a=(f.maxSceneBound-f.minSceneBound)/1e3
f.topLimit&&t>0?(s=f.maxSceneBound-a,f.topLimit=!1):f.bottomLimit&&t<0?(s=f.minSceneBound+a,f.bottomLimit=!1):s=o.dot(worldUp)
var l=r.dot(worldUp)
return s<f.minSceneBound?l<f.minSceneBound&&(f.bottomLimit=!0,n=0):s>f.maxSceneBound&&l>f.maxSceneBound&&(f.topLimit=!0,n=0),n}function m(e){var t=Math.pow(e,2)
e<0&&(t=-t)
var i=s(0,t),n=f.maxSceneBound-f.minSceneBound,o=.01*n
i.y*=o
var r=f.userHeightSpeed*i.y
return r=p(r,e,f.m_amount)}function g(e){var t=f.sceneFrontDirection.clone().cross(f.sceneUpDirection),i=Math.abs(Math.abs(e.dot(f.sceneUpDirection))-1),n=Math.abs(Math.abs(e.dot(f.sceneFrontDirection))-1),o=Math.abs(Math.abs(e.dot(t))-1)
return i<1e-5||n<1e-5||o<1e-5}var f=this,v=null,E=null,A=!1
this.cube=null,this.camera=e,this.renderer="WEBGL",this.startState={},this.navApi=t,this.orthographicFaces=!1,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.canvas=null
var T,b=Date.now(),w=!1
this.dtor=function(){this.cube=null,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.canvas=null},this.showPivot=function(e){this.pivotDisplayCallback&&this.pivotDisplayCallback(e)},this.setWorldUpVector=function(e){A||e&&e.lengthSq()>0&&!e.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(e),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.cube&&requestAnimationFrame(this.cube.render))},this.getWorldUpVector=function(){return this.sceneUpDirection.clone()},this.getWorldRightVector=function(){var e=this.sceneUpDirection.clone()
return Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},this.getWorldFrontVector=function(){return this.getWorldUpVector().cross(this.getWorldRightVector()).normalize()},this.goToView=function(e){if(this.navApi.isActionEnabled("gotoview")){var t={position:e.position.clone(),up:e.up.clone(),center:e.center.clone(),pivot:e.pivot.clone(),fov:e.fov,worldUp:e.worldUp.clone(),isOrtho:e.isOrtho}
f.elapsedTime=0,this.animateTransition(t)}},this.getCurrentView=function(){return{position:e.position.clone(),up:e.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:e.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:!1===e.isPerspective}},this.setCurrentViewAsHome=function(e){e?(this.navApi.setRequestFitToView(!0),w=!0):this.homeVector=this.getCurrentView()},this.setHomeViewFrom=function(e){var t=e.pivot?e.pivot:this.center,i=e.target?e.target:this.pivot,n=e.worldup?e.worldup:this.sceneUpDirection
this.homeVector={position:e.position.clone(),up:e.up.clone(),center:i.clone(),pivot:t.clone(),fov:e.fov,worldUp:n.clone(),isOrtho:!1===e.isPerspective},this.originalHomeVector={position:e.position.clone(),up:e.up.clone(),center:i.clone(),pivot:t.clone(),fov:e.fov,worldUp:n.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:!1===e.isPerspective}},this.toPerspective=function(){e.isPerspective||(e.toPerspective(),i(!1))},this.toOrthographic=function(){e.isPerspective&&(e.toOrthographic(),i(!1))},this.setOrthographicFaces=function(e){this.orthographicFaces=e},this.goHome=function(){this.navApi.isActionEnabled("gotoview")&&(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))},this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position),this.homeVector.up.copy(this.originalHomeVector.up),this.homeVector.center.copy(this.originalHomeVector.center),this.homeVector.pivot.copy(this.originalHomeVector.pivot),this.homeVector.fov=this.originalHomeVector.fov,this.homeVector.worldUp.copy(this.originalHomeVector.worldUp),this.homeVector.isOrtho=this.originalHomeVector.isOrtho,this.goHome()},this.getView=function(){return this.center.clone().sub(e.position)},this.setCameraUp=function(t){var i=this.dir.clone(),n=i.cross(t).normalize()
0===n.lengthSq()&&(i.copy(this.dir),t.z>t.y?i.y+=1e-4:i.z+=1e-4,n=i.cross(t).normalize()),e.up.copy(n).cross(this.dir).normalize()},function e(){requestAnimationFrame(e)
var t=Date.now()
T=t-b,b=t}(),this.ortho=!1,this.center=e.target?e.target.clone():new THREE.Vector3(0,0,0),this.pivot=e.pivot?e.pivot.clone():this.center.clone(),this.sceneUpDirection=e.worldup?e.worldup.clone():e.up.clone(),this.sceneFrontDirection=this.getWorldFrontVector(),this.dir=this.getView(),this.setCameraUp(e.up),this.saveCenter=this.center.clone(),this.savePivot=this.pivot.clone(),this.saveEye=e.position.clone(),this.saveUp=e.up.clone()
var C,S,R,P
this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),this.setHomeViewFrom(e)
var k,M,V=new THREE.Quaternion,I=new THREE.Quaternion,L=new THREE.Quaternion,D=new THREE.Quaternion
this.userPanSpeed=.5,this.userLookSpeed=2,this.userHeightSpeed=5,this.walkMultiplier=1,this.userZoomSpeed=1.015,this.orbitMultiplier=5,this.currentlyAnimating=!1,e.keepSceneUpright=!0,this.preserveOrbitUpDirection=!0,this.alignOrbitUpDirection=!0,this.constrainOrbitHorizontal=!1,this.constrainOrbitVertical=!1,this.doCustomOrbit=!1,this.snapOrbitDeadZone=.045,this.snapOrbitThresholdH=this.snapOrbitThresholdV=THREE.Math.degToRad(15),this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5,this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2,this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5,this.alignDirTable=new Array(26),this.alignDirTable[0]=new THREE.Vector3(-1,0,0),this.alignDirTable[1]=new THREE.Vector3(1,0,0),this.alignDirTable[2]=new THREE.Vector3(0,-1,0),this.alignDirTable[3]=new THREE.Vector3(0,1,0),this.alignDirTable[4]=new THREE.Vector3(0,0,-1),this.alignDirTable[5]=new THREE.Vector3(0,0,1),this.alignDirTable[6]=new THREE.Vector3(-1,-1,0),this.alignDirTable[7]=new THREE.Vector3(-1,1,0),this.alignDirTable[8]=new THREE.Vector3(1,-1,0),this.alignDirTable[9]=new THREE.Vector3(1,1,0),this.alignDirTable[10]=new THREE.Vector3(0,-1,-1),this.alignDirTable[11]=new THREE.Vector3(0,-1,1),this.alignDirTable[12]=new THREE.Vector3(0,1,-1),this.alignDirTable[13]=new THREE.Vector3(0,1,1),this.alignDirTable[14]=new THREE.Vector3(-1,0,-1),this.alignDirTable[15]=new THREE.Vector3(1,0,-1),this.alignDirTable[16]=new THREE.Vector3(-1,0,1),this.alignDirTable[17]=new THREE.Vector3(1,0,1),this.alignDirTable[18]=new THREE.Vector3(-1,-1,-1),this.alignDirTable[19]=new THREE.Vector3(-1,-1,1),this.alignDirTable[20]=new THREE.Vector3(-1,1,-1),this.alignDirTable[21]=new THREE.Vector3(-1,1,1),this.alignDirTable[22]=new THREE.Vector3(1,-1,-1),this.alignDirTable[23]=new THREE.Vector3(1,-1,1),this.alignDirTable[24]=new THREE.Vector3(1,1,-1),this.alignDirTable[25]=new THREE.Vector3(1,1,1),this.combined=!1,this.useSnap=!1,this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new THREE.Vector3(0,0,0),this.topLimit=!1,this.bottomLimit=!1,this.minSceneBound=0,this.maxSceneBound=0
var N={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1}
this.shotParams=N
var _,O
this.zoomDelta=new THREE.Vector2
var H,B,F,G=0,z=new THREE.Vector3,U=new THREE.Vector3
this.rewindParams={history:[],startTime:void 0,thumbnailSize:56,thumbnailGapSize:12,maxHistorySize:25,snappingEnabled:!0,timelineIndex:0,timelineIndexSlide:0,open:!1,openLocation:new THREE.Vector2(0,0),openBracket:new THREE.Vector2(0,0),openBracketA:new THREE.Vector2(0,0),openBracketB:new THREE.Vector2(0,0),openLocationOrigin:new THREE.Vector2(0,0),locationOffset:new THREE.Vector2(0,0),snapOffset:new THREE.Vector2(0,0),slideOffset:new THREE.Vector2(0,0),snapped:!0,resetWeights:!1,recordEnabled:!1,elementIsRecording:!1},this.viewCubeMenuOpen=!1,this.menuSize=new THREE.Vector2(0,0),this.menuOrigin=new THREE.Vector2(0,0),e.lookAt(this.center),this.setCube=function(e){this.cube=e},this.loadObject=function(e,t,i){loader=new THREE.JSONLoader,loader.load(e,function(e,n){var o=new THREE.MeshPhongMaterial(n)
mesh=new THREE.Mesh(e,o),mesh.scale=t,mesh.position.copy(i),mesh.geometry.computeBoundingBox()
var r=mesh.geometry.boundingBox.clone()
U.set(r.max.x,r.max.y,r.max.z),z.set(r.min.x,r.min.y,r.min.z),U.multiply(t),z.multiply(t),scene.add(mesh),objects.push(mesh)})},this.sync=function(t){t.isPerspective!==e.isPerspective&&(t.isPerspective?e.toPerspective():(e.toOrthographic(),t.saveFov&&(e.saveFov=t.saveFov))),e.fov=t.fov,e.position.copy(t.position),t.target&&(this.center.copy(t.target),e.target.copy(t.target)),t.pivot&&(this.pivot.copy(t.pivot),e.pivot.copy(t.pivot)),this.dir.copy(this.center).sub(e.position),this.setCameraUp(t.up)
var i=t.worldup?t.worldup:t.up
i.distanceToSquared(this.sceneUpDirection)>1e-4&&this.setWorldUpVector(i),w&&!this.navApi.getTransitionActive()&&(w=!1,this.setCurrentViewAsHome(!1)),this.cube&&requestAnimationFrame(this.cube.render)},this.refresh=function(){this.cube&&this.cube.refreshCube()},THREE.Box2.prototype.setCenter=function(e){var t=new THREE.Vector2(Math.abs(this.max.x-this.min.x)/2,Math.abs(this.max.y-this.min.y)/2)
return this.min.copy(e).sub(t),this.max.copy(e).add(t),this},THREE.Box2.prototype.getIcon2DCoords=function(e,t){var i=this.center
t.set((e.x-i.x)/(this.size().x/2),(e.y-i.y)/(this.size().y/2))},THREE.Matrix3.prototype.makeRotationFromQuaternion=function(e){var t=this.elements,i=e.x,n=e.y,o=e.z,r=e.w,s=i+i,a=n+n,l=o+o,c=i*s,d=i*a,u=i*l,h=n*a,p=n*l,m=o*l,g=r*s,f=r*a,v=r*l
return t[0]=1-(h+m),t[3]=d-v,t[6]=u+f,t[1]=d+v,t[4]=1-(c+m),t[7]=p-g,t[2]=u-f,t[5]=p+g,t[8]=1-(c+h),this},THREE.Quaternion.prototype.setFromRotationMatrix3=function(e){var t,i=e.elements,n=i[0],o=i[3],r=i[6],s=i[1],a=i[4],l=i[7],c=i[2],d=i[5],u=i[8],h=n+a+u
return h>0?(t=.5/Math.sqrt(h+1),this.w=.25/t,this.x=(d-l)*t,this.y=(r-c)*t,this.z=(s-o)*t):n>a&&n>u?(t=2*Math.sqrt(1+n-a-u),this.w=(d-l)/t,this.x=.25*t,this.y=(o+s)/t,this.z=(r+c)/t):a>u?(t=2*Math.sqrt(1+a-n-u),this.w=(r-c)/t,this.x=(o+s)/t,this.y=.25*t,this.z=(l+d)/t):(t=2*Math.sqrt(1+u-n-a),this.w=(s-o)/t,this.x=(r+c)/t,this.y=(l+d)/t,this.z=.25*t),this},THREE.Quaternion.prototype.rotate=function(e){var t=(new THREE.Matrix4).makeRotationFromQuaternion(this),i=t.elements,n=(new THREE.Matrix3).set(i[0],i[1],i[2],i[4],i[5],i[6],i[8],i[9],i[10])
return e.applyMatrix3(n)},THREE.Vector3.prototype.findAngleWith=function(e,t){var i=0,n=this.clone().normalize().clone().dot(e.clone().normalize()),o=this.clone().cross(e).clone().normalize()
if(o.clone().length()<Number.MIN_VALUE)i=n>0?0:180
else{t=o.clone().dot(t.clone().normalize())>0?o:-o
var r=(new THREE.Quaternion).setFromAxisAngle(t,90*THREE.Math.degToRad)
r=r.clone().rotate(e).clone().normalize().clone().dot(this),i=Math.acos(n)*THREE.Math.radToDeg,Math.abs(i-90)<Number.MIN_VALUE&&(i=90),(i<90&&n*r>0||i>90&&n*r<0||90==i&&r>0)&&(i*=-1)}return i=THREE.Math.degToRad(i)},"contains"in String.prototype||(String.prototype.contains=function(e,t){return-1!==String.prototype.indexOf.call(this,e,t)}),Math.linearClamp=function(e,t,i){return e<=t?0:e>=i?1:(e-t)/(i-t)},Math.easeClamp=function(e,t,i){if(e<=t)return 0
if(e>=i)return 1
var n=(e-t)/(i-t)
return.5*(Math.sin((n-.5)*Math.PI)+1)},Math.linearInterp=function(e,t,i){return t*(1-e)+i*e},Math.equalityClamp=function(e,t,i){return e<=t?t:e>=i?i:e},Math.round2=function(e){return Math.round(100*e)/100},Math.round1=function(e){return Math.round(10*e)/10},this.animateTransition=function(t){if(t){var n=!1,o=0
if(this.setCameraOrtho(t.isOrtho),f.elapsedTime>=N.duration)return o=1,f.center.copy(t.center),f.pivot.copy(t.pivot),e.position.copy(t.position),e.up.copy(t.up),e.target.copy(t.center),t.isOrtho||(e.fov=t.fov),e.dirty=!0,n=!t.worldUp.equals(this.sceneUpDirection),n&&this.setWorldUpVector(t.worldUp),this.currentlyAnimating=!1,i(n),this.showPivot(!1),this.cube&&requestAnimationFrame(this.cube.render),this.addHistoryElement(),void this.navApi.setTransitionActive(!1)
this.currentlyAnimating=!0,this.showPivot(!0),this.navApi.setTransitionActive(!0)
var r=N.destinationPercent
o=Math.easeClamp(f.elapsedTime/N.duration,0,r)
var s=1-o
f.elapsedTime+=T/500
var a=f.center.clone().multiplyScalar(s).add(t.center.clone().multiplyScalar(o)),l=e.position.clone().multiplyScalar(s).add(t.position.clone().multiplyScalar(o)),c=e.up.clone().multiplyScalar(s).add(t.up.clone().multiplyScalar(o)),d=e.pivot.clone().multiplyScalar(s).add(t.pivot.clone().multiplyScalar(o)),u=this.sceneUpDirection.clone().multiplyScalar(s).add(t.worldUp.clone().multiplyScalar(o)),h=e.fov*s+t.fov*o
f.center.copy(a),f.pivot.copy(d),e.position.copy(l),e.up.copy(c),e.target.copy(a),t.isOrtho||(e.fov=h),e.dirty=!0,n=u.distanceToSquared(this.sceneUpDirection)>1e-4,n&&this.setWorldUpVector(u),e.lookAt(f.center),i(n),this.cube&&requestAnimationFrame(this.cube.render),requestAnimationFrame(function(){f.animateTransition(t)})}},this.sphericallyInterpolateTransition=function(t){var n,o,r,s=0
if(this.currentlyAnimating=!0,this.navApi.setTransitionActive(!0),f.elapsedTime>=N.duration)s=1,this.currentlyAnimating=!1
else{var a=N.destinationPercent
s=Math.easeClamp(f.elapsedTime/N.duration,0,a),f.elapsedTime+=T/500}if(1===s)o=O.position,n=O.center,r=O.up
else{var l=new THREE.Matrix3,c=V.clone()
c.slerp(I,s),l.makeRotationFromQuaternion(c)
var d=Math.linearInterp(s,k,M),u=l.elements
n=_.center.clone().multiplyScalar(1-s).add(O.center.clone().multiplyScalar(s)),o=n.clone().sub(new THREE.Vector3(u[0],u[1],u[2]).multiplyScalar(d)),r=new THREE.Vector3(u[3],u[4],u[5])}f.center.copy(n),e.position.copy(o),e.up.copy(r),f.navApi.getUsePivotAlways()||f.pivot.copy(n),e.lookAt(f.center),!0===this.currentlyAnimating?(this.showPivot(!0),requestAnimationFrame(function(){f.sphericallyInterpolateTransition(t)})):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.addHistoryElement(),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),t&&t()),i(!1),this.cube&&requestAnimationFrame(this.cube.render)},this.getOrientation=function(){if(this.cube){var t=Math.round1(e.up.x),i=Math.round1(e.up.y),n=Math.round1(e.up.z),o=this.sceneFrontDirection.clone(),r=this.sceneUpDirection.clone(),s=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize()
o.x=Math.round1(o.x),o.y=Math.round1(o.y),o.z=Math.round1(o.z),r.x=Math.round1(r.x),r.y=Math.round1(r.y),r.z=Math.round1(r.z),s.x=Math.round1(s.x),s.y=Math.round1(s.y),s.z=Math.round1(s.z)
var a=s.clone().multiplyScalar(-1),l=r.clone().multiplyScalar(-1),c=o.clone().multiplyScalar(-1)
switch(this.cube.currentFace){case"front":if(r.x==t&&r.y==i&&r.z==n)return"up"
if(l.x==t&&l.y==i&&l.z==n)return"down"
if(s.x==t&&s.y==i&&s.z==n)return"right"
if(a.x==t&&a.y==i&&a.z==n)return"left"
break
case"right":if(r.x==t&&r.y==i&&r.z==n)return"up"
if(l.x==t&&l.y==i&&l.z==n)return"down"
if(c.x==t&&c.y==i&&c.z==n)return"left"
if(o.x==t&&o.y==i&&o.z==n)return"right"
break
case"left":if(r.x==t&&r.y==i&&r.z==n)return"up"
if(l.x==t&&l.y==i&&l.z==n)return"down"
if(o.x==t&&o.y==i&&o.z==n)return"left"
if(c.x==t&&c.y==i&&c.z==n)return"right"
break
case"back":if(r.x==t&&r.y==i&&r.z==n)return"up"
if(l.x==t&&l.y==i&&l.z==n)return"down"
if(a.x==t&&a.y==i&&a.z==n)return"right"
if(s.x==t&&s.y==i&&s.z==n)return"left"
break
case"top":if(c.x==t&&c.y==i&&c.z==n)return"down"
if(o.x==t&&o.y==i&&o.z==n)return"up"
if(s.x==t&&s.y==i&&s.z==n)return"right"
if(a.x==t&&a.y==i&&a.z==n)return"left"
break
case"bottom":if(o.x==t&&o.y==i&&o.z==n)return"down"
if(c.x==t&&c.y==i&&c.z==n)return"up"
if(s.x==t&&s.y==i&&s.z==n)return"right"
if(a.x==t&&a.y==i&&a.z==n)return"left"}}},this.setCameraOrtho=function(t){t&&e.isPerspective&&e.toOrthographic(),t||e.isPerspective||e.toPerspective()},this.resetOrientation=function(){this.setCameraOrtho(this.originalHomeVector.isOrtho),this.sceneUpDirection.copy(this.originalHomeVector.worldUp),this.sceneFrontDirection.copy(this.originalHomeVector.worldFront),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.setCameraUp(this.sceneUpDirection),i(!0)},this.setCurrentViewAsFront=function(){this.cube&&(this.cube.currentFace="front"),this.sceneUpDirection.copy(e.up.clone()),this.sceneFrontDirection.copy(this.getView()).normalize(),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.orthographicFaces&&this.setCameraOrtho(!0),i(!0)},this.setCurrentViewAsTop=function(){this.cube&&(this.cube.currentFace="top"),this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize(),this.sceneFrontDirection.copy(e.up),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),i(!0)},this.calculateCubeTransform=function(t){var i=this.sceneUpDirection.clone(),n=this.sceneFrontDirection.clone(),o=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize()
_=e.clone(),_.center=f.center.clone(),_.pivot=f.pivot.clone(),O=e.clone(),O.center=f.center.clone(),O.pivot=f.pivot.clone()
var r=new THREE.Vector3(0,0,0)
t.contains("back")&&(r=r.add(n)),t.contains("front")&&(r=r.sub(n)),t.contains("top")&&(r=r.add(i)),t.contains("bottom")&&(r=r.sub(i)),t.contains("right")&&(r=r.add(o)),t.contains("left")&&(r=r.sub(o))
var s=i,a=r.clone().normalize()
if(1-Math.abs(a.dot(i))<Number.MIN_VALUE)for(var l=this.getView().normalize(),c=[n.clone(),n.clone().negate(),o.clone(),o.clone().negate()],d=a.dot(i)>0?1:-1,u=l.clone().add(e.up.clone().multiplyScalar(d)).normalize(),h=-2,p=0;p<4;p++){var m=u.dot(c[p])
m>h&&(h=m,s=c[p].multiplyScalar(d))}M=k=this.getView().length(),O.position.copy(O.center.clone().add(r.multiplyScalar(M/r.length()))),O.up.copy(s)
var g=_.center.clone().sub(_.position).normalize(),v=g.clone().cross(_.up).normalize(),E=v.clone().cross(g).normalize(),y=new THREE.Matrix3
y.set(g.x,E.x,v.x,g.y,E.y,v.y,g.z,E.z,v.z),V.setFromRotationMatrix3(y),g=O.center.clone().sub(O.position).normalize(),v=g.clone().cross(O.up).normalize(),E=v.clone().cross(g).normalize(),y.set(g.x,E.x,v.x,g.y,E.y,v.y,g.z,E.z,v.z),L.setFromAxisAngle(g,0),D.setFromAxisAngle(E,0),I.setFromRotationMatrix3(y),I.multiply(L).multiply(D).normalize()},this.centerShot=function(t){_&&!t||(f.elapsedTime=0,_=O=e.clone(),_.center=f.center)
var n=f.pivot.clone(),o=n.clone().sub(_.position),r=_.center.clone().sub(_.position).normalize(),s=_.up.clone(),a=r.clone().cross(s).normalize()
s=a.clone().cross(r).normalize()
var l=a.clone().multiplyScalar(a.dot(o)),c=s.clone().multiplyScalar(s.dot(o)),d=l.clone().add(c)
O.position.copy(_.position.clone().add(d)),O.center=n,O.pivot=n
var u=0
if(f.elapsedTime>=N.duration)u=1
else{var h=N.destinationPercent
u=Math.easeClamp(f.elapsedTime/N.duration,0,h),f.elapsedTime+=T/2e3}var p=e.position.clone().multiplyScalar(1-u).add(O.position.clone().multiplyScalar(u)),m=f.center.clone().multiplyScalar(1-u).add(O.center.clone().multiplyScalar(u)),g=f.pivot.clone().multiplyScalar(1-u).add(O.pivot.clone().multiplyScalar(u))
e.position.copy(p),f.center.copy(m),f.pivot.copy(g),e.lookAt(f.center),i(!1),1===u?this.addHistoryElement():requestAnimationFrame(function(){f.centerShot(!1)})},this.levelShot=function(){var t=this.getView(),i=t.length(),n=this.sceneUpDirection.clone(),o=e.up.clone().normalize(),r=t.normalize(),s=r.dot(n)
if(1-Math.abs(s)>Number.MIN_VALUE){var a=r.clone().cross(n)
r=n.clone().cross(a),r.normalize()}else r=o.clone()
r.multiplyScalar(i)
var l={center:r.add(e.position),up:n,position:e.position,pivot:f.center.clone().add(r),fov:e.fov,worldUp:n}
f.elapsedTime=0,f.animateTransition(l)},this.fitToWindow=function(){var t=this.getView(),i=e.up.clone()
t.normalize(),i.normalize(),O=e.clone(),O.center=f.center,i=n(i,t),i.normalize(),O.up.copy(i)
var o=t.clone().cross(i)
o.normalize()
var r=z.clone(),s=U.clone(),a=[r,s],l=new THREE.Vector3(s.x-r.x,s.y-r.y,s.z-r.z)
a[2]=new THREE.Vector3(s.x,r.y,s.z),a[3]=new THREE.Vector3(s.x,r.y,r.z),a[4]=new THREE.Vector3(s.x,s.y,r.z),a[5]=new THREE.Vector3(r.x,s.y,s.z),a[6]=new THREE.Vector3(r.x,s.y,r.z),a[7]=new THREE.Vector3(r.x,r.y,s.z)
for(var c=0;c<8;c++){var d=a[c].clone().sub(e.position)
a[c].setX(d.clone().dot(o)),a[c].setY(d.clone().dot(i)),a[c].setZ(d.clone().dot(t))}var u,h,p,m,g=THREE.Math.degToRad(e.topFov),v=THREE.Math.degToRad(e.bottomFov),E=THREE.Math.degToRad(e.leftFov),y=THREE.Math.degToRad(e.rightFov)
u=E>=0?Number.MAX_VALUE:Number.MIN_VALUE,h=y>=0?Number.MAX_VALUE:Number.MIN_VALUE,p=g>=0?Number.MAX_VALUE:Number.MIN_VALUE,m=v>=0?Number.MAX_VALUE:Number.MIN_VALUE
for(var A=1/Math.tan(y),T=-1/Math.tan(E),b=1/Math.tan(g),w=-1/Math.tan(v),C=0;C<8;C++){var S=a[C].clone(),R=S.z-T*S.x
u=E>=0?Math.min(u,R):Math.max(u,R),R=S.z-A*S.x,h=y>=0?Math.min(h,R):Math.max(h,R),R=S.z-b*S.y,p=g>=0?Math.min(p,R):Math.max(p,R),R=S.z-w*S.y,m=v>=0?Math.min(m,R):Math.max(m,R)}var x=(h-u)/(T-A),P=T*x+u,k=(m-p)/(b-w),M=b*k+p,V=0
if(P<=M){var I=(g-v)/2
if(Math.abs(I)>Number.MIN_VALUE){var L=1/Math.tan(I)
k=k-M/L+P/L}V=P}else{var D=(y-E)/2
if(Math.abs(D)>Number.MIN_VALUE){var N=1/Math.tan(D)
x=x-P/N+M/N}V=M}var _=new THREE.Vector3(x,k,V),H=o.clone().multiplyScalar(_.x),B=i.clone().multiplyScalar(_.y),F=t.clone().multiplyScalar(_.z)
_=H.clone().add(B.clone().add(F)),O.position.add(_)
var G=l.clone().sub(O.position).dot(t)
O.center=O.position.clone().add(t.multiplyScalar(G)),O.pivot=l.clone()
var W={center:O.center,up:O.up,position:O.position,pivot:O.pivot,fov:e.fov,worldUp:f.sceneUpDirection.clone()}
f.elapsedTime=0,f.animateTransition(W)},this.updatePivotPosition=function(t){var i,n,o=new THREE.Vector3(t.x/window.innerWidth*2-1,-t.y/window.innerHeight*2+1,.5)
if(o=o.unproject(e),i=new THREE.Raycaster(e.position,o.sub(e.position).normalize()),n=i.intersectObjects(objects),"zoom"==f.mode)if(void 0!==n[0]){var r=n[0].point
f.pivot.copy(r)}else{var s=a(t)
f.pivot.copy(s.rayO.clone().add(s.rayD))}else if(void 0!==n[0]){wheel.cursorImage("pivot")
var r=n[0].point
f.isMouseDown||f.pivot.copy(r)}else wheel.cursorImage("SWInvalidArea")},this.onDrawHeight=function(t,i,n,o,r){var s=new THREE.Vector3(0,1,0),a=e.position.clone().dot(s),l=Math.linearClamp(a,f.minSceneBound,f.maxSceneBound),c=l-.5
E&&(E.find("img#updownImageA").remove(),E.prepend('<img src="'+r+'SWheighthandleA.png" id="updownImageA" style="position:fixed; z-index:9999; top:'+(n-86*c)+"px; left:"+i+'px;"/>'),o||E.prepend('<img src="'+r+'SWheighthandleI.png" id="updownImageI" style="position:fixed; z-index:9998; top:'+(n-86*c)+"px; left:"+i+'px;"/>'))},this.drawDropdownMenu=function(e,t,i,n,o,r,s){var a=0
if(v)r.appendChild(v)
else{v=document.createElement("div"),v.className="dropDownMenu",v.style.top="100px",v.style.left="-400px"
for(var l=0,c=0,d=0;d<e.length;d++){var u
if(null===e[d])u=document.createElement("li"),u.style.height="1px",l+=1,u.style.backgroundColor="#E0E0E0"
else{var h=Autodesk.Viewing.i18n.translate(e[d])
if(c=h.length>c?h.length:c,i[d]){u=document.createElement("div")
var p=document.createElement("input"),m=document.createElement("label")
p.type="radio",p.className="dropDownMenuCheck",m.innerHTML=h,m.className="dropDownMenuCheckText",u.appendChild(p),u.appendChild(m),u.className="dropDownMenuCheckbox"}else u=document.createElement("li"),u.textContent=h,u.className=t[d]?"dropDownMenuItem":"dropDownMenuItemDisabled"
u.id="menuItem"+a,a++,l+=25,u.setAttribute("data-i18n",e[d])}v.appendChild(u)}r.appendChild(v),v.style.minWidth=Math.max(256,7.4*c)+"px"
var g=v.getBoundingClientRect().width
this.menuSize.x=g,this.menuSize.y=l}a=0
for(var d=0;d<e.length;d++)if(null!==e[d]){if(i[d]){var f="menuItem"+a,E=document.getElementById(f)
E&&(E.children[0].checked=i[d]())}a++}var y=o-15,A=n+1,T=this.canvas.getBoundingClientRect()
A+this.menuSize.x>T.right&&(A=n-this.menuSize.x-1),y+this.menuSize.y>T.bottom&&(y=T.bottom-this.menuSize.y),y-=s.y,A-=s.x,v.style.top=y+"px",v.style.left=A+"px",this.menuOrigin.x=A,this.menuOrigin.y=y},this.removeDropdownMenu=function(e){e.removeChild(v)},this.isFaceView=function(){return g(this.center.clone().sub(e.position).normalize())&&g(e.up)},this.startInteraction=function(e,t){this.startCursor=new THREE.Vector2(e,t),this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),saveUp:this.camera.up.clone()},this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new THREE.Vector3(0,0,0),this.navApi.setTransitionActive(!0)},this.orbit=function(t,n,o,r){if(this.navApi.isActionEnabled("orbit")&&!0!==this.currentlyAnimating){var a="wheel"
if(f.orthographicFaces&&!e.isPerspective&&(e.toPerspective(),r&&r.saveEye.copy(this.camera.position)),r&&(a="cube"),"cube"==a?(this.saveCenter.copy(r.saveCenter),this.saveEye.copy(r.saveEye),this.savePivot.copy(r.savePivot),this.saveUp.copy(r.saveUp),this.useSnap=!0,this.doCustomOrbit=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(e.position),this.saveUp.copy(e.up),this.useSnap=!1,this.doCustomOrbit=!1),c()&&void 0==S&&(S=this.saveCenter.clone(),C=this.saveEye.clone(),P=this.savePivot.clone(),R=this.saveUp.clone()),this.preserveOrbitUpDirection){var d=s(t.x-n.x,t.y-n.y),u=s(o.x,o.y),h=this.sceneUpDirection.clone(),p=this.sceneFrontDirection.clone(),m=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),g=c()?P:this.savePivot,v=c()?C:this.saveEye,E=c()?S:this.saveCenter,y=c()?R:this.saveUp,A=g.clone().sub(v).normalize(),T=E.clone().sub(v).normalize(),b=T.clone().cross(y),w=v.clone().sub(g).length(),x=v.clone().sub(E).length(),k=A.clone().multiplyScalar(-1),M=T.clone().multiplyScalar(-1),V=b,I=y.clone()
if(!this.constrainOrbitHorizontal){h.dot(this.saveUp)<-.009&&(d.x=-d.x,u.x=-u.x)
var L=0
L=c()?u.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+l("h",0,-u.x):d.x*this.orbitMultiplier,this.lastSnapRotateX=L
var D=(new THREE.Quaternion).setFromAxisAngle(h,-L)
k.applyQuaternion(D),M.applyQuaternion(D),V.applyQuaternion(D),I.applyQuaternion(D)}if(!this.constrainOrbitVertical){var N=p.clone().multiplyScalar(p.dot(V)),_=m.clone().multiplyScalar(m.dot(V)),O=N.clone().add(_)
O.clone().normalize()
var H=0
if(c())H=u.y*this.orbitMultiplier
else{var B=l("v",0,u.y)
H=this.useSnap?this.lastSnapRotateY+B:d.y*this.orbitMultiplier}var F=(new THREE.Quaternion).setFromAxisAngle(O,-H)
if(this.navApi.getOrbitPastWorldPoles())k.applyQuaternion(F).normalize(),M.applyQuaternion(F).normalize(),I.applyQuaternion(F).normalize()
else{var G=I.clone()
G.applyQuaternion(F).normalize()
if(h.dot(G)<0){var z=M.clone()
z.applyQuaternion(F).normalize()
var U=z.angleTo(h)
Math.abs(U)>.5*Math.PI&&(U-=U>0?Math.PI:-Math.PI),H-=U,F.setFromAxisAngle(O,-H),k.applyQuaternion(F).normalize(),M.applyQuaternion(F).normalize(),I.applyQuaternion(F).normalize()}else k.applyQuaternion(F).normalize(),M.applyQuaternion(F).normalize(),I.applyQuaternion(F).normalize()}this.lastSnapRotateY=H}var W=k.multiplyScalar(w).add(g)
e.position.copy(W),e.up.copy(I),this.center.copy(W),this.center.sub(M.multiplyScalar(x)),c()&&(S.copy(this.center),C.copy(e.position),P.copy(this.pivot),R.copy(e.up))}e.lookAt(this.center),i(!1)}},this.endInteraction=function(){this.navApi.setTransitionActive(!1)},this.look=function(t){if(this.navApi.isActionEnabled("walk")){var n=s(t.x,t.y),o=this.userLookSpeed,r=this.getView(),a=e.up,l=r.clone().cross(a).normalize(),c=this.sceneUpDirection.clone(),d=n.clone()
d.x*=Math.PI,d.y*=Math.PI/e.aspect,d.multiplyScalar(o)
var u=(new THREE.Quaternion).setFromAxisAngle(l,-d.y)
if(e.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var h=a.clone()
if(h.applyQuaternion(u).normalize(),h.dot(c)<0){var p=r.clone()
p.applyQuaternion(u)
var m=p.angleTo(c)
Math.abs(m)>.5*Math.PI&&(m-=m>0?Math.PI:-Math.PI),d.y-=m,u.setFromAxisAngle(l,-d.y)}}r=u.clone().rotate(r),a=u.clone().rotate(a),a.normalize()
var g=e.keepSceneUpright?c:a,f=(new THREE.Quaternion).setFromAxisAngle(g,-d.x)
r=f.clone().rotate(r),a=f.clone().rotate(a),this.center.copy(r.add(e.position)),e.up.copy(a),e.lookAt(this.center),i(!1)}},this.pan=function(t){if(this.navApi.isActionEnabled("pan")){t=s(t.x,t.y)
var n=this.getView(),o=e.up.clone().cross(n),r=n.clone().cross(o)
o.normalize(),r.normalize(),n.normalize()
var a=this.pivot.clone().sub(e.position),l=n.clone().dot(a),c=l*(Math.tan(THREE.Math.degToRad(e.leftFov))+Math.tan(THREE.Math.degToRad(e.rightFov))),d=l*(Math.tan(THREE.Math.degToRad(e.topFov))+Math.tan(THREE.Math.degToRad(e.bottomFov))),u=t.x*Math.abs(c),h=t.y*Math.abs(d),p=new THREE.Vector3,m=o.clone().multiplyScalar(u),g=r.clone().multiplyScalar(h)
p=m.clone().add(g).clone().multiplyScalar(this.userPanSpeed),e.position.add(p),this.center.add(p),e.lookAt(this.center),i(!1)}},this.zoom=function(t){if(this.navApi.isActionEnabled("zoom")){var n=this.userZoomSpeed,o=Number.MAX_VALUE,r=t.x+t.y,s=Math.pow(n,r),a=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(s)),l=a.clone().add(f.D.clone().multiplyScalar(f.D.clone().dot(this.pivot.clone().sub(a).clone())))
if(!(s>=o)){if(r>0){Math.pow(n,r-0)
if(r<0)return void(G=0)
e.position.copy(a),this.center.copy(l)
var c=a.clone().sub(this.saveEye).dot(f.D)
c>o?(e.position.copy(this.saveEye.sub(f.D).clone().multiplyScalar(o)),G=o>0?-1:0):G=-c/o}else e.position.copy(a),this.center.copy(l)
e.lookAt(this.center),i(!1)}}},this.walk=function(t,n,o,r,a){if(this.navApi.isActionEnabled("walk")){var l=this.sceneUpDirection.clone(),c=this.sceneFrontDirection.clone(),u=this.sceneFrontDirection.clone().cross(this.sceneUpDirection)
d(t,n)?(wheel.cursorImage("SWWalk"),h(!0,t,n),x=n.x,y=n.y):h(!1,t,n),x=t.x,y=t.y
var p=s(x-n.x,y-n.y),m=-p.x,g=-p.y,f=m<0?-1:1,v=g<0?-1:1,E=Math.abs(m),A=Math.abs(g),T=new THREE.Vector2(30,30)
T=s(T.x,T.y),E=d(t,n)?0:Math.abs(m)-T.x,A=d(t,n)?0:Math.abs(g)-T.y
E/=.25,A/=.25,E=E<1?Math.easeClamp(E,0,1):Math.pow(E,1),A=A<1?Math.easeClamp(A,0,1):Math.pow(A,1)
var b=E>0?E*f:0,w=A>0?A*v:0,C=this.getView(),S=C.length()
C.normalize()
C.clone().cross(e.up).normalize()
var R=u.clone().multiplyScalar(u.clone().dot(C)),P=c.clone().multiplyScalar(c.clone().dot(C)),k=P.clone().add(R)
k=k.clone().length()>Number.MIN_VALUE?k.normalize():e.up
var M=w*(1*this.walkMultiplier),V=k,I=Math.cos(.65)
1!=I&&(l.clone().dot(e.up)<-Number.MIN_VALUE&&l.clone().dot(C)<-I||l.clone().dot(e.up)>Number.MIN_VALUE&&l.clone().dot(C)>I)&&(V=-V)
var L=-b*this.walkMultiplier*.05,D=e.up;(l.clone().dot(e.up)<-Number.MIN_VALUE||Math.abs(l.clone().dot(e.up))<Number.MIN_VALUE&&l.clone().dot(C)>Number.MIN_VALUE)&&(L=-L),D=l
var N=(new THREE.Quaternion).setFromAxisAngle(D,L)
N.normalize(),C=N.clone().rotate(C),C.normalize(),e.up.copy(N.clone().rotate(e.up)),e.up.normalize(),e.position.add(V.clone().multiplyScalar(M)),this.center.copy(e.position.clone().add(C.clone().multiplyScalar(S))),V=l,V.normalize(),0===M&&(M=.01),e.lookAt(this.center),i(!1)}},this.updown=function(t){if(!this.navApi.getIsLocked()){var n=t,o=m(n)
f.m_amount+=o
var r=new THREE.Vector3(0,1,0),s=f.saveEye.clone().sub(r.clone().multiplyScalar(f.m_amount)),a=s.clone().dot(r)
e.position.copy(s),a<f.minSceneBound&&e.position.add(r.clone().multiplyScalar(f.minSceneBound-a)),a>f.maxSceneBound&&e.position.add(r.clone().multiplyScalar(f.maxSceneBound-a)),this.center.copy(e.position.clone().add(f.saveCenter.clone().sub(f.saveEye))),e.lookAt(this.center),i(!1)}},this.addHistoryElement=function(){},this.addIntermediateHistoryElement=function(){this.rewindParams.snapped?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.slideOffset.x>0?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex+1),this.addHistoryElement()},this.clearHistory=function(){this.rewindParams.history.length=0,this.rewindParams.timelineIndex=0,this.rewindParams.timelineIndexSlide=0,this.rewindParams.resetWeights=!0},this.openTimeline=function(e){this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights&&(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=this.rewindParams.snappingEnabled),0===this.rewindParams.history.length&&this.addHistoryElement()
for(var t=0;t<this.rewindParams.history.length;t++){var i=t-this.rewindParams.timelineIndex,n=this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize
this.rewindParams.history[t].thumbnailBounds.setCenter(new THREE.Vector2(e.x+i*n,e.y).add(this.rewindParams.slideOffset)),this.rewindParams.resetWeights&&(this.rewindParams.history[t].weight=t==this.rewindParams.timelineIndex?1:0)}this.rewindParams.resetWeights&&(this.rewindParams.resetWeights=!1)
var n=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize)
if(this.rewindParams.open=!0,this.rewindParams.openLocation=e.clone(),this.rewindParams.openLocationOrigin=e.clone(),this.rewindParams.openBracket=e.clone(),this.rewindParams.openBracketA=new THREE.Vector2(n,e.y),this.rewindParams.openBracketB=new THREE.Vector2(window.innerWidth-n,e.y),this.rewindParams.openBracketA.x>this.rewindParams.openBracketB.x){var o=this.rewindParams.openBracketA.x
this.rewindParams.openBracketA.x=this.rewindParams.openBracketB.x,this.rewindParams.openBracketB.x=o}this.rewindParams.locationOffset=new THREE.Vector2(0,0),this.rewindParams.snapOffset=new THREE.Vector2(0,0)},this.slideTimeline=function(e){if(this.rewindParams.open&&0!==this.rewindParams.history.length){var t=e.clone().add(this.rewindParams.locationOffset),i=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),n=i,o=window.innerWidth-i,r=this.rewindParams.history[0].thumbnailBounds.center().x,s=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x,a=0
if(t.x<this.rewindParams.openBracketA.x){a=t.x-this.rewindParams.openBracketA.x
var l=r-a
n<l&&(a=Math.min(a+(l-n),0))}if(t.x>this.rewindParams.openBracketB.x){a=t.x-this.rewindParams.openBracketB.x
var c=s-a
o>c&&(a=Math.max(a+(c-o),0))}this.rewindParams.openLocation.x+=a,this.rewindParams.openBracketA.x+=a,this.rewindParams.openBracketB.x+=a,this.rewindParams.openBracket.x=t.x-(this.rewindParams.openLocation.x-this.rewindParams.openLocationOrigin.x)
var d=new THREE.Vector2(-a,0),u=t.clone().sub(this.rewindParams.openLocation.clone().sub(this.rewindParams.openLocationOrigin))
d.x+=this.rewindParams.snapOffset.x,this.rewindParams.snapOffset.x=0
var h=!1
if(this.rewindParams.snappingEnabled)for(var p=0;p<this.rewindParams.history.length;p++){var m=this.rewindParams.history[p].thumbnailBounds.center().add(d)
if(Math.abs(m.x-u.x)<4||this.rewindParams.snapped&&Math.abs(m.x-u.x)<16){h=!0,0!==a?(this.rewindParams.snapOffset.x=m.x-u.x,d.x-=this.rewindParams.snapOffset.x):this.rewindParams.openBracket.x+=m.x-u.x,u.x=m.x
break}}this.rewindParams.snapped=h
for(var g=-1,f=0,v=0;v<this.rewindParams.history.length;v++){var E=this.rewindParams.history[v].thumbnailBounds.clone()
if(this.rewindParams.history[v].thumbnailBounds.setCenter(this.rewindParams.history[v].thumbnailBounds.center().add(d)),this.rewindParams.history[v].thumbnail){var y=this.rewindParams.history[v].thumbnailBounds.center().x-this.rewindParams.thumbnailSize/2
$("#rewindFrame"+v).css("left",y),$("#rewindBorder"+v).css("left",y-4)}var A=new THREE.Vector2(2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize))
E.setFromCenterAndSize(E.center(),A)
var T=new THREE.Vector2(0,0)
E.getIcon2DCoords(u,T)
var b=1-Math.abs(Math.equalityClamp(T.x,-1,1))
this.rewindParams.history[v].weight=b,0===v&&u.x<E.center().x&&(this.rewindParams.history[v].weight=1),v===this.rewindParams.history.length-1&&u.x>E.center().x&&(this.rewindParams.history[v].weight=1),f+=this.rewindParams.history[v].weight,this.rewindParams.history[v].weight>g&&(g=this.rewindParams.history[v].weight,this.rewindParams.snappingEnabled&&1==this.rewindParams.history[v].weight?(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=!0):this.rewindParams.slideOffset.x=this.rewindParams.history[v].thumbnailBounds.center().x-u.x,this.rewindParams.timelineIndexSlide=v)}for(var w=0;w<this.rewindParams.history.length;w++)this.rewindParams.history[w].weight=this.rewindParams.history[w].weight/f
var C=this.rewindParams.history[0].thumbnailBounds.center().x,S=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x
this.rewindParams.openBracket.x<C?(this.rewindParams.locationOffset.x+=C-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=C):this.rewindParams.openBracket.x>S&&(this.rewindParams.locationOffset.x+=S-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=S)}},this.shiftBackOneElement=function(){0!==this.rewindParams.history.length&&(this.rewindParams.timelineIndex>0||0!==this.rewindParams.slideOffset.x)&&((this.rewindParams.snapped||this.rewindParams.slideOffset.x>0)&&this.rewindParams.timelineIndex--,this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights=!0,f.elapsedTime=0,this.animateToRewindIndex())},this.animateToRewindIndex=function(){var t=this.rewindParams.timelineIndex,n=0
if(f.elapsedTime>=N.duration)n=1
else{var o=N.destinationPercent
n=Math.easeClamp(f.elapsedTime/N.duration,0,o),f.elapsedTime+=T/500}f.center.copy(f.center.clone().multiplyScalar(1-n).clone().add(this.rewindParams.history[t].camera.center.clone().multiplyScalar(n))),e.position.copy(e.position.clone().multiplyScalar(1-n).clone().add(this.rewindParams.history[t].camera.position.clone().multiplyScalar(n))),e.up.copy(this.rewindParams.history[t].camera.up),f.pivot.copy(f.center),e.lookAt(f.center),i(!1),this.cube&&requestAnimationFrame(this.cube.render),1!==n&&requestAnimationFrame(function(){f.animateToRewindIndex()})},this.closeTimeline=function(){this.rewindParams.timelineIndex!=this.rewindParams.timelineIndexSlide&&(this.rewindParams.timelineIndex=this.rewindParams.timelineIndexSlide),this.rewindParams.open=!1},this.getInterpolatedCamera=function(){var t=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4)
t.center=new THREE.Vector3(0,0,0),t.pivot=new THREE.Vector3(0,0,0),t.leftFov=0,t.rightFov=0,t.topFov=0,t.bottomFov=0,t.up.set(0,0,0)
for(var n=0;n<this.rewindParams.history.length;n++){var o=this.rewindParams.history[n].camera,r=this.rewindParams.history[n].weight
t.center.add(o.center.clone().multiplyScalar(r)),t.position.add(o.position.clone().multiplyScalar(r)),t.up.add(o.up.clone().multiplyScalar(r)),t.rotation.add(o.rotation.clone().multiplyScalar(r)),t.pivot.add(o.pivot.clone().multiplyScalar(r)),t.leftFov+=o.leftFov*r,t.rightFov+=o.rightFov*r,t.topFov+=o.topFov*r,t.bottomFov+=o.bottomFov*r}e.position.copy(t.position),e.up.copy(t.up),e.rotation=t.rotation,e.leftFov=t.leftFov,e.rightFov=t.rightFov,e.topFov=t.topFov,e.bottomFov=t.bottomFov,f.center.copy(t.center),f.pivot.copy(t.pivot),e.lookAt(f.center),e.up.normalize(),i(!1)}}
var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private
avp.Autocam.ViewCube=function(e,t,i,n,o){function r(e,t){var i={}
return 0===e.type.indexOf("touch")?e.touches.length>0?(i.clientX=e.touches[0].clientX,i.clientY=e.touches[0].clientY,i.pageX=e.touches[0].pageX,i.pageY=e.touches[0].pageY,i.screenX=e.touches[0].screenX,i.screenY=e.touches[0].screenY,i.movementX=i.screenX-t.prevX,i.movementY=i.screenY-t.prevY,i.which=a.navApi.getUseLeftHandedInput()?3:1):i=t.prevCoords:(i.clientX=e.clientX,i.clientY=e.clientY,i.pageX=e.pageX,i.pageY=e.pageY,i.screenX=e.screenX,i.screenY=e.screenY,i.which=e.which,j?(i.movementX=e.movementX||e.mozMovementX||e.webkitMovementX||0,i.movementY=e.movementY||e.mozMovementY||e.webkitMovementY||0):(i.movementX=i.screenX-t.prevX,i.movementY=i.screenY-t.prevY)),t.prevX=i.screenX,t.prevY=i.screenY,t.prevCoords=i,i}var s=this,a=t,l=t.camera
t.setCube(this),s.currentFace="front",s.showTriad=o&&o.showTriad
var c,d,u,h,p,m,g,f=["top,front","top right","top,left","top,back","bottom,front","bottom,right","bottom,left","bottom,back","left,front","front,right","right,back","back,left"],v=["front,top,right","back,top,right","front,top,left","back,top,left","front,bottom,right","back,bottom,right","front,bottom,left","back,bottom,left"],E=["Go Home",null,"Orthographic","Perspective","Perspective with Ortho Faces",null,"Set current view as Home","Focus and set as Home","Reset Home",null,"Set current view as Front","Set current view as Top","Reset orientation"],y=[!0,null,!0,!0,!0,null,!0,!0,!0,null,!0,!0,!0],A=[null,null,function(){return!a.orthographicFaces&&!l.isPerspective},function(){return!a.orthographicFaces&&l.isPerspective},function(){return a.orthographicFaces},null,null,null,null,null,null,null,null],T=[]
s.pcam=new THREE.PerspectiveCamera(45,1,1,2e3),s.ocam=new THREE.OrthographicCamera(-265,265,265,-265,-1e3,1e3),s.ocam.fov=s.pcam.fov,s.ocam.aspect=s.pcam.aspect,s.camera=l.isPerspective?s.pcam:s.ocam,s.camera.position.copy(l.position),s.center=new THREE.Vector3(0,0,0),s.camera.lookAt(s.center)
var b,w,C,S,R,x,P,k,M,V,I,L,D=[],N=[],_=[],O=[],H=[],B=null,F=null,G=null,z=0,U=0,W=!0,j=!1,Y=!1,X=!1,q=-1!=navigator.userAgent.search("Chrome"),K=-1!=navigator.platform.search("Win32"),Z=!1,Q=!1,J=[]
this.width=0,this.height=0,this.animSpeed=500,this.animate=!0,this.compass=!1,this.viewScaleFactorCompass=1.5,this.viewScale=1,this.draggable=!0,this.wantHomeButton=!1,this.wantRollArrows=!0,this.wantContextMenu=!0,this.inactiveOpacity=.5
var $=function(e){var t=e.getBoundingClientRect()
return{x:t.left,y:t.top,w:t.width,h:t.height}},ee=function(e){e.preventDefault(),e.stopPropagation(),Y=document.pointerLockElement===i||document.mozPointerLockElement===i||document.webkitPointerLockElement===i},te=function(e,t){var i=e/2,n={x:16711680,y:65280,z:255},o=new THREE.Matrix4,r=new THREE.Matrix4
if(1===t.z){var s=new THREE.Vector3(0,1,0)
r.makeRotationAxis(s,Math.PI/2),s.set(1,1,1).normalize(),r.multiply(o.makeRotationAxis(s,2*-Math.PI/3))}var a=new THREE.PlaneBufferGeometry(50,50),l=function(e,t){var i=document.createElement("canvas")
i.width=i.height=128
var n=i.getContext("2d")
n.font="128px Arial",n.fillStyle="rgba(255,255,255,1)",n.textAlign="center",n.textBaseline="middle",n.fillText(e,i.width/2,i.height/2)
var o=new THREE.Texture(i)
return o.needsUpdate=!0,new THREE.Mesh(a,new THREE.MeshBasicMaterial({map:o,side:THREE.DoubleSide,transparent:!0,color:t,depthWrite:!1,depthTest:!0}))}
p=new THREE.Scene
var c=new THREE.BoxGeometry(e,10,10),d=new THREE.Mesh(c,new THREE.MeshBasicMaterial({color:n.x,shading:THREE.SmoothShading})),u=new THREE.Mesh(c,new THREE.MeshBasicMaterial({color:n.y,shading:THREE.SmoothShading})),h=new THREE.Mesh(c,new THREE.MeshBasicMaterial({color:n.z,shading:THREE.SmoothShading}))
d.applyMatrix(o.makeTranslation(5,-i,-i)),u.applyMatrix(o.makeRotationZ(Math.PI/2)),u.applyMatrix(o.makeTranslation(-i,5,-i)),h.applyMatrix(o.makeRotationY(Math.PI/2)),h.applyMatrix(o.makeTranslation(-i,-i,5)),d.applyMatrix(r),u.applyMatrix(r),h.applyMatrix(r),p.add(d),p.add(u),p.add(h)
var m=l("X",n.x),g=l("Y",n.y),f=l("Z",n.z),v=-(50+i)/2-20,E=i+50
m.position.set(E,v,v),g.position.set(v,E,v),f.position.set(v,v,E),m.position.applyMatrix4(r),g.position.applyMatrix4(r),f.position.applyMatrix4(r),T.push(m),T.push(g),T.push(f),p.add(m),p.add(g),p.add(f)},ie=function(){a.navApi.isActionEnabled("orbit")&&(i.style.opacity="1.0",Q=!1),requestAnimationFrame(s.render)},ne=function(e){if(Q||a.viewCubeMenuOpen||!a.navApi.isActionEnabled("orbit"))a.navApi.isActionEnabled("orbit")&&(i.style.opacity=1)
else{var t=Math.max(4*Math.abs((e.clientX-L.x)/L.w-.5)-1,0),n=Math.max(4*Math.abs((e.clientY-L.y)/L.h-.5)-1,0),o=Math.max(0,Math.min(Math.sqrt(t*t+n*n),1))
i.style.opacity=1-o*(1-s.inactiveOpacity)}},oe=function(){a.viewCubeMenuOpen||(i.style.opacity=s.inactiveOpacity,Q=!0,requestAnimationFrame(s.render))},re=function(e){var t=new Image,i=av.getUseCredentials()&&(-1===e.indexOf("://")||-1!==e.indexOf(window.location.host))
t.crossOrigin=i?"use-credentials":"anonymous"
var n=new THREE.Texture(t)
return t.onload=function(){n.needsUpdate=!0,++U>=11&&requestAnimationFrame(s.render)},t.src=e,n},se=function(){var e,t=[],i=[]
t[0]=ve(0,0),t[1]=ve(0,Math.PI/2),t[2]=ve(0,-Math.PI/2),t[3]=ve(0,Math.PI),t[4]=ve(Math.PI/2,0),t[5]=ve(Math.PI/2,Math.PI/2),t[6]=ve(Math.PI/2,-Math.PI/2),t[7]=ve(Math.PI/2,Math.PI),i[0]=fe(0,0,0),i[1]=fe(0,Math.PI/2,0),i[2]=fe(0,-Math.PI/2,0),i[3]=fe(0,Math.PI,0),i[4]=fe(Math.PI/2,0,0),i[5]=fe(Math.PI/2,Math.PI/2,0),i[6]=fe(Math.PI/2,-Math.PI/2,0),i[7]=fe(Math.PI/2,Math.PI,0),i[8]=fe(0,0,Math.PI/2),i[9]=fe(0,0,-Math.PI/2),i[10]=fe(-Math.PI/2,0,-Math.PI/2),i[11]=fe(-Math.PI,0,-Math.PI/2),D.push(ge(0,0)),D[0].name="front",_.push(D[0]),H.push(D[0]),u.add(D[0]),D.push(ge(0,Math.PI/2)),D[1].name="right",_.push(D[1]),H.push(D[1]),u.add(D[1]),D.push(ge(0,Math.PI)),D[2].name="back",_.push(D[2]),H.push(D[2]),u.add(D[2]),D.push(ge(0,-Math.PI/2)),D[3].name="left",_.push(D[3]),H.push(D[3]),u.add(D[3]),D.push(ge(Math.PI/2,0)),D[4].name="bottom",_.push(D[4]),H.push(D[4]),u.add(D[4]),D.push(ge(-Math.PI/2,0)),D[5].name="top",_.push(D[5]),H.push(D[5]),u.add(D[5]),e=D.length
var n
for(n=0;n<t.length;n++)D.push(t[n]),D[e+n].name=v[n],u.add(D[e+n]),_.push(D[e+n]),H.push(D[e+n])
for(e=D.length,n=0;n<i.length;n++)D.push(i[n]),D[e+n].name=f[n],u.add(D[e+n]),_.push(D[e+n]),H.push(D[e+n])},ae=function(e,t,i){var n,o=new THREE.Vector3
if("PerspectiveCamera"===t.type)o.copy(e),o=o.unproject(t),n=new THREE.Raycaster(t.position,o.sub(t.position).normalize())
else{var r=new THREE.Vector3
r.copy(e),r=r.unproject(t),o.copy(t.position.negate()),r.sub(o),n=new THREE.Raycaster(r,o.normalize())}return n.intersectObjects(i)},le=function(e,t){var i=e.clientX-t.x,n=e.clientY-t.y
return i=i/t.w*2-1,n=(t.h-n)/t.h*2-1,new THREE.Vector3(i,n,.5)},ce=function(e){if(e.preventDefault(),e.stopPropagation(),a.navApi.isActionEnabled("orbit")&&!a.currentlyAnimating){var t=r(e,s)
L=$(i),i.removeEventListener("mousemove",pe,!1),document.addEventListener("mouseup",he,!1),document.addEventListener("touchend",he,!1),a.navApi.getUsePivotAlways()||(a.pivot.copy(a.center),a.navApi.setPivotPoint(a.center),a.navApi.setPivotSetFlag(!1)),a.startInteraction(t.pageX,t.pageY)
var n,o
0==a.rewindParams.history.length&&a.addHistoryElement(),a.rewindParams.snapped&&a.rewindParams.timelineIndex+1==a.rewindParams.history.length||a.addIntermediateHistoryElement()
var l=a.navApi.getUseLeftHandedInput()?1:3
if(t.which!==l){if(s.animSpeed<=0)return void avp.logger.error("animSpeed cannot be 0 or less, use ViewCube.animate flag to turn on and off animation",av.errorCodeString(av.ErrorCodes.VIEWER_INTERNAL_ERROR))
o=le(t,L),n=ae(o,s.camera,H),n.length>0&&(Ae(),s.draggable&&(document.addEventListener("mousemove",de,!1),document.addEventListener("touchmove",de,!1),j&&(i.requestPointerLock(),X=q&&K)))}}},de=function(e){if(e.preventDefault(),e.stopPropagation(),s.animSpeed<=0)return document.removeEventListener("mousemove",de,!1),document.removeEventListener("touchmove",de,!1),void avp.logger.error("animSpeed cannot be 0 or less",av.errorCodeString(av.ErrorCodes.VIEWER_INTERNAL_ERROR))
if(!a.currentlyAnimating){var t=r(e,s)
if(j&&X&&(X=!1,t.movementX=t.movementY=0),Y&&(t.movementX>300||t.movementY>300)&&(t.movementX=0,t.movementY=0),t.movementX===t.movementY&&0===t.movementX)return void(a.currentlyAnimating=!1)
W=!1,Z=!0,a.showPivot(!0),a.currentCursor=new THREE.Vector2(t.pageX,t.pageY),a.orbit(a.currentCursor,a.startCursor,new THREE.Vector3(-t.movementX,t.movementY,0),a.startState),s.camera.lookAt(s.center),requestAnimationFrame(s.render)}},ue=function(e){e||(document.removeEventListener("mouseup",he,!1),document.removeEventListener("touchend",he,!1)),document.removeEventListener("mousemove",de,!1),document.removeEventListener("touchmove",de,!1),i.addEventListener("mousemove",pe,!1),Y&&document.exitPointerLock()},he=function(e){e.preventDefault(),e.stopPropagation()
var t,n,o
if(a.currentlyAnimating||Z)return a.endInteraction(),a.showPivot(!1),Z=!1,void ue(!1)
var c=r(e,s)
if(a.viewCubeMenuOpen){var d=c.clientX-L.x,u=c.clientY-L.y
if(a.menuOrigin.x<=d&&d<=a.menuOrigin.x+a.menuSize.x&&a.menuOrigin.y<=u&&u<=a.menuOrigin.y+a.menuSize.y){var h=Math.floor((u-5-a.menuOrigin.y)/25),p=function(e){avp.logger.track({name:"navigation/"+e,aggregate:"count"})}
switch(h){case 0:p("home"),a.goHome()
break
case 1:p("setortho"),a.setOrthographicFaces(!1),a.toOrthographic(),s.camera=s.ocam
break
case 2:p("setpersp"),a.setOrthographicFaces(!1),a.toPerspective(),s.camera=s.pcam
break
case 3:a.setOrthographicFaces(!0),W?(a.toOrthographic(),s.camera=s.ocam):(a.toPerspective(),s.camera=s.pcam)
break
case 4:p("sethome"),a.setCurrentViewAsHome(!1)
break
case 5:p("focushome"),a.setCurrentViewAsHome(!0)
break
case 6:p("resethome"),a.resetHome()
break
case 7:p("setfront"),a.setCurrentViewAsFront()
break
case 8:p("settop"),a.setCurrentViewAsTop()
break
case 9:a.resetOrientation()}}return a.viewCubeMenuOpen=!1,a.removeDropdownMenu(i),(c.clientX<L.x||c.clientX>L.w+L.x||c.clientY<L.y||c.clientY>L.h+L.y)&&oe(),s.mouseMoveSave&&s.processMouseMove(s.mouseMoveSave),a.endInteraction(),void ue(!1)}var m=a.navApi.getUseLeftHandedInput()?1:3
if(c.which===m)return a.viewCubeMenuOpen=!0,a.drawDropdownMenu(E,y,A,c.clientX,c.clientY,i,L),void ue(!0)
var f=le(c,L)
if(t=ae(f,s.camera,H),n=ae(f,g,N),o=ae(f,g,O),n.length>0&&W){var v=a.getOrientation()
switch(s.currentFace){case"front":switch(v){case"up":n[0].object===N[0]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[1]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[2]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[3]&&(a.calculateCubeTransform("left"),s.currentFace="left")
break
case"right":n[0].object===N[0]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[1]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[2]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[3]&&(a.calculateCubeTransform("top"),s.currentFace="top")
break
case"down":n[0].object===N[0]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[1]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[2]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[3]&&(a.calculateCubeTransform("right"),s.currentFace="right")
break
case"left":n[0].object===N[0]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[1]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[2]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[3]&&(a.calculateCubeTransform("bottom"),s.currentFace="bottom")}break
case"right":switch(v){case"up":n[0].object===N[0]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[1]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[2]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[3]&&(a.calculateCubeTransform("front"),s.currentFace="front")
break
case"right":n[0].object===N[0]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[1]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[2]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[3]&&(a.calculateCubeTransform("top"),s.currentFace="top")
break
case"down":n[0].object===N[0]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[1]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[2]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[3]&&(a.calculateCubeTransform("back"),s.currentFace="back")
break
case"left":n[0].object===N[0]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[1]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[2]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[3]&&(a.calculateCubeTransform("bottom"),s.currentFace="bottom")}break
case"left":switch(v){case"up":n[0].object===N[0]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[1]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[2]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[3]&&(a.calculateCubeTransform("back"),s.currentFace="back")
break
case"right":n[0].object===N[0]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[1]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[2]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[3]&&(a.calculateCubeTransform("top"),s.currentFace="top")
break
case"down":n[0].object===N[0]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[1]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[2]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[3]&&(a.calculateCubeTransform("front"),s.currentFace="front")
break
case"left":n[0].object===N[0]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[1]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[2]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[3]&&(a.calculateCubeTransform("bottom"),s.currentFace="bottom")}break
case"back":switch(v){case"up":n[0].object===N[0]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[1]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[2]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[3]&&(a.calculateCubeTransform("right"),s.currentFace="right")
break
case"right":n[0].object===N[0]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[1]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[2]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[3]&&(a.calculateCubeTransform("top"),s.currentFace="top")
break
case"down":n[0].object===N[0]?(a.calculateCubeTransform("bottom"),s.currentFace="bottom"):n[0].object===N[1]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[2]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[3]&&(a.calculateCubeTransform("left"),s.currentFace="left")
break
case"left":n[0].object===N[0]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[1]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[2]?(a.calculateCubeTransform("top"),s.currentFace="top"):n[0].object===N[3]&&(a.calculateCubeTransform("bottom"),s.currentFace="bottom")}break
case"top":switch(v){case"up":n[0].object===N[0]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[1]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[2]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[3]&&(a.calculateCubeTransform("left"),s.currentFace="left")
break
case"right":n[0].object===N[0]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[1]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[2]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[3]&&(a.calculateCubeTransform("back"),s.currentFace="back")
break
case"down":n[0].object===N[0]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[1]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[2]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[3]&&(a.calculateCubeTransform("right"),s.currentFace="right")
break
case"left":n[0].object===N[0]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[1]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[2]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[3]&&(a.calculateCubeTransform("front"),s.currentFace="front")}break
case"bottom":switch(v){case"up":n[0].object===N[0]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[1]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[2]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[3]&&(a.calculateCubeTransform("left"),s.currentFace="left")
break
case"right":n[0].object===N[0]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[1]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[2]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[3]&&(a.calculateCubeTransform("front"),s.currentFace="front")
break
case"down":n[0].object===N[0]?(a.calculateCubeTransform("back"),s.currentFace="back"):n[0].object===N[1]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[2]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[3]&&(a.calculateCubeTransform("right"),s.currentFace="right")
break
case"left":n[0].object===N[0]?(a.calculateCubeTransform("left"),s.currentFace="left"):n[0].object===N[1]?(a.calculateCubeTransform("right"),s.currentFace="right"):n[0].object===N[2]?(a.calculateCubeTransform("front"),s.currentFace="front"):n[0].object===N[3]&&(a.calculateCubeTransform("back"),s.currentFace="back")}}a.elapsedTime=0,a.sphericallyInterpolateTransition()}if(o.length>0){if(a.elapsedTime=0,s.wantHomeButton&&o[0].object===O[V])return a.goHome(),void ue(!1)
if(s.wantContextMenu&&o[0].object===O[I])return a.viewCubeMenuOpen=!0,a.drawDropdownMenu(E,y,A,c.clientX,c.clientY,i,L),void ue(!0)
if(s.wantRollArrows&&W&&(o[0].object===O[P]||o[0].object===O[k])){var T=o[0].object===O[k],b={center:a.center.clone(),position:l.position.clone(),pivot:l.pivot.clone(),fov:l.fov,worldUp:a.sceneUpDirection.clone(),isOrtho:!1===l.isPerspective},w=a.center.clone().sub(l.position).normalize()
T?b.up=l.up.clone().cross(w):(b.up=l.up.clone().multiplyScalar(-1),b.up.cross(w)),b.up.normalize(),a.elapsedTime=0,a.animateTransition(b)}}if(t.length>0){var C=t[0].object.name
s.mouseMoveSave=e,s.cubeRotateTo(C)}ue(!1)}
this.cubeRotateTo=function(e){s.currentFace=e,a.orthographicFaces&&-1!==s.currentFace.indexOf(",")&&a.setCameraOrtho(!1),a.calculateCubeTransform(s.currentFace),a.elapsedTime=0,a.sphericallyInterpolateTransition(function(){s.mouseMoveSave&&s.processMouseMove(s.mouseMoveSave)})},this.processMouseMove=function(e){var t,i,n
if(a.viewCubeMenuOpen||a.currentlyAnimating)return void(s.mouseMoveSave=e)
s.mouseMoveSave=null
var o=r(e,s),l=le(o,L)
if(t=ae(l,s.camera,_),i=ae(l,g,N),n=ae(l,g,O),B&&!Z&&(B.material.color.setHex(14540253),B=null,requestAnimationFrame(s.render)),i.length>0&&!Z){B=i[0].object
for(var c=x.children.length;--c>=0;)if(B===N[c]){B=x.children[c],B.material.color.setHex(45055)
break}requestAnimationFrame(s.render)}F&&!Z&&(F.material.opacity=0,F=null,requestAnimationFrame(s.render)),t.length>0&&!Z&&(F=t[0].object,F.material.opacity=.3,requestAnimationFrame(s.render)),n.length>0&&!Z?G!==n[0].object&&(s.wantHomeButton&&n[0].object===O[V]?(G=n[0].object,O[V].material.map=J[0]):s.wantRollArrows&&n[0].object===O[P]?(G=n[0].object,O[M].material.map=J[1]):s.wantRollArrows&&n[0].object===O[k]?(G=n[0].object,O[M].material.map=J[2]):s.wantContextMenu&&n[0].object===O[I]?(G=n[0].object,O[I].material.map=J[6]):s.wantHomeButton&&G===O[V]?(G=null,O[V].material.map=J[3]):!s.wantRollArrows||G!==O[P]&&G!==O[k]&&G!==O[M]?s.wantContextMenu&&G===O[I]&&(G=null,O[I].material.map=J[5]):(G=null,O[M].material.map=J[4]),requestAnimationFrame(s.render)):null===G||Z||(s.wantHomeButton&&G===O[V]?(G=null,O[V].material.map=J[3]):!s.wantRollArrows||G!==O[P]&&G!==O[k]&&G!==O[M]?s.wantContextMenu&&G===O[I]&&(G=null,O[I].material.map=J[5]):(G=null,O[M].material.map=J[4]),requestAnimationFrame(s.render))}
var pe=function(e){a.navApi.isActionEnabled("orbit")&&s.processMouseMove(e)},me=function(){L=$(i),s.width=i.offsetWidth,s.height=i.offsetHeight,s.pcam.aspect=s.ocam.aspect=s.width/s.height,s.pcam.updateProjectionMatrix(),s.ocam.updateProjectionMatrix(),s.camera.topFov=s.camera.bottomFov=s.camera.fov/2,s.camera.leftFov=s.camera.rightFov=s.camera.aspect*s.camera.fov/2,s.pcam.aspect=s.ocam.aspect=s.camera.aspect,s.pcam.topFov=s.ocam.topFov=s.camera.topFov,s.pcam.bottomFov=s.ocam.bottomFov=s.camera.bottomFov,s.pcam.leftFov=s.ocam.leftFov=s.camera.leftFov,s.pcam.rightFov=s.ocam.rightFov=s.camera.rightFov,s.renderer.setSize(s.width,s.height),requestAnimationFrame(s.render)},ge=function(e,t){var i,n=new THREE.Geometry,o=new THREE.Vector3(0,0,0),r=new THREE.Vector3(60,-60,105),s=new THREE.Vector3(60,60,105),a=new THREE.Vector3(-60,60,105),l=new THREE.Vector3(-60,-60,105)
return n.vertices.push(o),n.vertices.push(r),n.vertices.push(s),n.vertices.push(a),n.vertices.push(l),n.faces.push(new THREE.Face3(1,2,3)),n.faces.push(new THREE.Face3(1,3,4)),n.applyMatrix((new THREE.Matrix4).makeRotationX(e)),n.applyMatrix((new THREE.Matrix4).makeRotationY(t)),n.computeFaceNormals(),n.computeVertexNormals(),i=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new THREE.Mesh(n,i)},fe=function(e,t,i){var n,o=new THREE.Geometry,r=new THREE.Vector3(60,105,105),s=new THREE.Vector3(-60,105,105),a=new THREE.Vector3(-60,60,105),l=new THREE.Vector3(60,60,105),c=new THREE.Vector3(60,105,60),d=new THREE.Vector3(-60,105,60),u=new THREE.Vector3(-60,105,105),h=new THREE.Vector3(60,105,105)
return o.vertices.push(r),o.vertices.push(s),o.vertices.push(a),o.vertices.push(l),o.vertices.push(c),o.vertices.push(d),o.vertices.push(u),o.vertices.push(h),o.faces.push(new THREE.Face3(0,1,2)),o.faces.push(new THREE.Face3(0,2,3)),o.faces.push(new THREE.Face3(4,5,6)),o.faces.push(new THREE.Face3(4,6,7)),o.applyMatrix((new THREE.Matrix4).makeRotationX(e)),o.applyMatrix((new THREE.Matrix4).makeRotationY(t)),o.applyMatrix((new THREE.Matrix4).makeRotationZ(i)),o.computeFaceNormals(),o.computeVertexNormals(),n=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new THREE.Mesh(o,n)},ve=function(e,t){var i,n=new THREE.Geometry,o=new THREE.Vector3(105,105,105),r=new THREE.Vector3(60,105,105),s=new THREE.Vector3(60,60,105),a=new THREE.Vector3(105,60,105),l=new THREE.Vector3(105,105,60),c=new THREE.Vector3(105,105,105),d=new THREE.Vector3(105,60,105),u=new THREE.Vector3(105,60,60),h=new THREE.Vector3(105,105,105),p=new THREE.Vector3(105,105,60),m=new THREE.Vector3(60,105,60),g=new THREE.Vector3(60,105,105)
return n.vertices.push(o),n.vertices.push(r),n.vertices.push(s),n.vertices.push(a),n.vertices.push(l),n.vertices.push(c),n.vertices.push(d),n.vertices.push(u),n.vertices.push(h),n.vertices.push(p),n.vertices.push(m),n.vertices.push(g),n.faces.push(new THREE.Face3(0,1,2)),n.faces.push(new THREE.Face3(0,2,3)),n.faces.push(new THREE.Face3(4,5,6)),n.faces.push(new THREE.Face3(4,6,7)),n.faces.push(new THREE.Face3(8,9,10)),n.faces.push(new THREE.Face3(8,10,11)),n.applyMatrix((new THREE.Matrix4).makeRotationX(e)),n.applyMatrix((new THREE.Matrix4).makeRotationY(t)),n.computeFaceNormals(),n.computeVertexNormals(),i=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new THREE.Mesh(n,i)},Ee=function(e){var t=a.cubeFront.clone(),i=a.sceneUpDirection.clone(),n=t.clone().cross(i)
i.copy(n).cross(t),t.normalize(),i.normalize(),n.normalize()
var o=new THREE.Vector3(t.x,i.x,n.x).multiplyScalar(e.x)
return o.add(new THREE.Vector3(t.y,i.y,n.y).multiplyScalar(e.y)),o.add(new THREE.Vector3(t.z,i.z,n.z).multiplyScalar(e.z)),o}
this.render=function(){s.camera=l.isPerspective?s.pcam:s.ocam
var e=s.compass?s.viewScaleFactorCompass*s.viewScale:s.viewScale,t=a.center.clone().sub(l.position).normalize(),i=l.up.normalize(),n=new THREE.Matrix4
t=Ee(t),i=Ee(i),s.camera.position.copy(t),s.camera.position.multiplyScalar(-e/s.camera.position.length()),s.camera.up=i.normalize(),s.camera.lookAt(s.center),ye()
var o=s.renderer
if(o){for(var r=0;r<T.length;r++)n.lookAt(s.camera.position,T[r].position,s.camera.up),T[r].setRotationFromMatrix(n)
o.clear(),o.render(c,s.camera),o.render(d,s.camera),o.render(h,s.camera),s.renderTriad&&o.render(p,s.camera),o.render(u,s.camera),o.render(m,g)}}
var ye=function(){W=a.isFaceView(),!W||Q||a.currentlyAnimating?Ae():Te(),Q?be():we(),Q?Ce():Se()},Ae=function(){m.remove(x),O[M].material.opacity=0,O[I].material.opacity=0},Te=function(){m.add(x)
var e=s.wantRollArrows?1:0
O[M].material.opacity=e,O[I].material.opacity=e},be=function(){R.material.opacity=av.isMobileDevice()?1:0},we=function(){R.material.opacity=s.wantContextMenu?1:0},Ce=function(){C.material.opacity=0},Se=function(){C.material.opacity=s.wantHomeButton?1:0}
this.refreshCube=function(){me()},this.setSize=function(e,t){if(s.width=e,s.height=t,i.children.length>1)for(var n=1;n<i.children.length;n++)i.children[n].style.bottom=(s.height/5).toString()+"px"
me()},this.useTransparency=function(e){Q=e,e?(i.onmouseover=ie,i.onmousemove=ne,i.onmouseout=oe,oe()):(i.onmouseover=null,i.onmouseout=null,i.onmousemove=null,i.style.opacity="1.0")},this.showTriad=function(e){e!==s.renderTriad&&(s.renderTriad=e,requestAnimationFrame(s.render))},this.dtor=function(){this.renderer=null},function(){var e=i.getBoundingClientRect()
s.width=e.width,s.height=e.height,L=$(i),g=new THREE.PerspectiveCamera(70,s.height/s.width,1,1e4),g.position.set(0,0,500),c=new THREE.Scene,d=new THREE.Scene,u=new THREE.Scene,h=new THREE.Scene,m=new THREE.Scene,W=!0,z=200,s.viewScale=3.5*z
var o=THREE.LinearFilter,r=Autodesk.Viewing.Private.getResourceUrl,l="res/textures/",p=n||l,f=(new THREE.DDSLoader).load(r(p+"VCcrossRGBA8small.dds"))
f.minFilter=f.maxFilter=o
var v=THREE.ShaderLib.cube,E=Autodesk.Viewing.Shaders.createShaderMaterial(v)
E.depthWrite=!1,E.uniforms.tCube.value=f
var y=new THREE.BoxGeometry(z,z,z,4,4,4),A=new THREE.BoxGeometry(z+1,z+1,z+1,4,4,4)
b=new THREE.Mesh(y,E),b.position.set(0,0,0),d.add(b)
var T=re(r(l+"VCedge1.png"))
T.minFilter=T.maxFilter=o,w=new THREE.Mesh(A,new THREE.MeshBasicMaterial({map:T,overdraw:!1,transparent:!0,shading:THREE.SmoothShading})),w.position.set(0,0,0),h.add(w),te(z+20,t.getWorldUpVector())
var D=z,_=new THREE.Geometry,H=new THREE.Vector3(-30,0,0),B=new THREE.Vector3(30,0,0),F=new THREE.Vector3(0,-30,0)
_.vertices.push(H),_.vertices.push(B),_.vertices.push(F),_.faces.push(new THREE.Face3(1,0,2)),_.computeFaceNormals()
var G=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),U=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),Y=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),X=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),q=new THREE.PlaneBufferGeometry(.5*z,.3*z,2,2),K=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),Z=new THREE.Mesh(_,G),Q=new THREE.Mesh(q,K)
Z.position.set(0,D,0),Q.position.set(0,.9*D,.1)
var ie=new THREE.Mesh(_,U),ne=new THREE.Mesh(q,K)
ie.position.set(0,-D,0),ne.position.set(0,.9*-D,.1),ie.rotation.z+=Math.PI,ne.rotation.z+=Math.PI
var oe=new THREE.Mesh(_,Y),ae=new THREE.Mesh(q,K)
oe.position.set(D,0,0),ae.position.set(.9*D,0,.1),oe.rotation.z-=Math.PI/2,ae.rotation.z-=Math.PI/2
var le=new THREE.Mesh(_,X),de=new THREE.Mesh(q,K)
le.position.set(-D,0,0),de.position.set(.9*-D,0,.1),le.rotation.z+=Math.PI/2,de.rotation.z+=Math.PI/2,x=new THREE.Object3D,x.position.set(0,0,0),x.add(Z),x.add(ie),x.add(oe),x.add(le),m.add(Q),m.add(ne),m.add(ae),m.add(de),m.add(x),N.push(Q),N.push(ne),N.push(ae),N.push(de)
var ue=new THREE.PlaneBufferGeometry(z/3,z/3,2,2),he=new THREE.MeshBasicMaterial({map:re(r(l+"VChome.png")),transparent:!0,shading:THREE.FlatShading})
C=new THREE.Mesh(ue,he),C.position.set(-z,z,0),V=O.length,m.add(C),O.push(C)
var me=new THREE.PlaneBufferGeometry(1.5*z,1.5*z,2,2),ge=new THREE.MeshBasicMaterial({map:re(r(l+"VCarrows.png")),shading:THREE.FlatShading,transparent:!0}),fe=new THREE.Mesh(me,ge)
fe.position.set(.5*z+20,.5*z+20,0)
var ve=new THREE.PlaneBufferGeometry(.6*z,.45*z,2,2),Ee=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),ye=new THREE.Mesh(ve,Ee)
ye.position.set(.5*z+20,z+20,.1)
var Ae=new THREE.PlaneBufferGeometry(.45*z,.6*z,2,2),Te=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),be=new THREE.Mesh(Ae,Te)
be.position.set(z+20,.5*z+20,.1),m.add(fe),m.add(ye),m.add(be),P=O.length,O.push(ye),k=O.length,O.push(be),M=O.length,O.push(fe)
var we=new THREE.PlaneBufferGeometry(z/2.3,z/2.3,2,2),Ce=new THREE.MeshBasicMaterial({map:re(r(l+"VCcontext.png")),transparent:!0,shading:THREE.FlatShading})
R=new THREE.Mesh(we,Ce),R.position.set(z,-z,0),I=O.length,m.add(R),O.push(R)
var Se=new THREE.Geometry
Se.vertices.push(new THREE.Vector3(0,0,0)),Se.vertices.push(new THREE.Vector3(-z/2,-z/2-20,-z/2)),Se.vertices.push(new THREE.Vector3(z/2,-z/2-20,-z/2)),Se.vertices.push(new THREE.Vector3(z/2,-z/2-20,z/2)),Se.vertices.push(new THREE.Vector3(-z/2,-z/2-20,z/2)),Se.faces.push(new THREE.Face3(4,3,2)),Se.faces.push(new THREE.Face3(4,2,1))
var Re
Re=new THREE.MeshBasicMaterial({color:0,transparent:!0,opacity:.5}),S=new THREE.Mesh(Se,Re),c.add(S),se(),"CANVAS"===a.renderer.toUpperCase()?s.renderer=new THREE.CanvasRenderer:"WEBGL"===a.renderer.toUpperCase()?s.renderer=new avp.FireflyWebGLRenderer({alpha:!0,antialias:!1}):(avp.logger.warn("Incorrect use of Autocam.renderer property"),s.renderer=new THREE.CanvasRenderer),s.useTransparency(!0),s.setSize(s.width,s.height),s.camera.topFov=s.camera.bottomFov=s.camera.fov/2,s.camera.leftFov=s.camera.rightFov=s.camera.aspect*s.camera.fov/2,s.pcam.topFov=s.ocam.topFov=s.camera.topFov,s.pcam.bottomFov=s.ocam.bottomFov=s.camera.bottomFov,s.pcam.leftFov=s.ocam.leftFov=s.camera.leftFov,s.pcam.rightFov=s.ocam.rightFov=s.camera.rightFov,s.renderer.autoClear=!1,s.renderer.setSize(s.width,s.height),s.renderer.sortObjects=!1,i.appendChild(s.renderer.domElement),i.addEventListener("touchstart",ce,!1),i.addEventListener("mousedown",ce,!1),i.addEventListener("mousemove",pe,!1),j=!1,j&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,i.requestPointerLock=i.requestPointerLock||i.mozRequestPointerLock||i.webkitRequestPointerLock,document.addEventListener("pointerlockchange",ee,!1),document.addEventListener("mozpointerlockchange",ee,!1),document.addEventListener("webkitpointerlockchange",ee,!1)),J.push(re(r(l+"VChomeS.png"))),J.push(re(r(l+"VCarrowsS0.png"))),J.push(re(r(l+"VCarrowsS1.png"))),J.push(re(r(l+"VChome.png"))),J.push(re(r(l+"VCarrows.png"))),J.push(re(r(l+"VCcontext.png"))),J.push(re(r(l+"VCcontextS.png")))}()},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.KeyCode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,SEMICOLONMOZ:59,EQUALSMOZ:61,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,LCOMMAND:91,RCOMMAND:93,PLUS:107,PLUSMOZ:171,DASHMOZ:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DASHMOZNEW:173,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222,COMMANDMOZ:224},Autodesk.Viewing.ToolController=function(e,t,i,n,o){function r(e,i){return t.navigation.getUseLeftHandedInput()&&0===e||c&&1===e||l&&!u&&0===e&&i.ctrlKey}var s=Autodesk.Viewing,a=Autodesk.Viewing.Private
this.domElement=t.canvasWrap,this.selector=e.selector,this.autocam=i,this.lastClickX=-1,this.lastClickY=-1,this.scrollInputEnabled=!0
var l=-1!=navigator.userAgent.search("Mac OS"),c=-1!=navigator.userAgent.search("Firefox"),d=-1!==navigator.userAgent.search("Chrome"),u=-1!==navigator.userAgent.search("Safari")&&!d,h={},p=[],m=!1,g=-1,f=-1,v=!1,E=null,y=void 0,A=!1,T={},b=this,w=Autodesk.Viewing.KeyCode
this.__registerToolByName=function(e,t){h[t]=e},this.registerTool=function(e){var t=e.getNames()
if(!t||0==t.length)return a.logger.warn("Cannot register tool with no name."),!1
for(var i=!1,o=0;o<t.length;++o)"default"!==t[o]&&(this.__registerToolByName(e,t[o]),i=!0)
return e.utilities=n,e.controller=this,e.register&&e.register(),i},this.deregisterTool=function(e){this.deactivateTool(e.getName())
var t=e.getNames()
if(!t||0==t.length)return!1
for(var i=t.length;--i>=0;)this.__deregisterToolName(t[i])
return e.deregister&&e.deregister(),e.utilities=null,e.controller=null,!0},this.__deregisterToolName=function(e){e in h&&(!function(e){for(var t=p.length;--t>=0;)p[t].activeName===e&&(h[e].deactivate(e),p.splice(t,1))}(e),delete h[e])},this.getTool=function(e){return h[e]},this.getActiveToolName=function(){var e=p.length
return e>0?p[e-1].activeName:"default"},this.getActiveTool=function(){var e=p.length
return e>0?p[e-1]:h.default},this.isToolActivated=function(e){for(var t=0;t<p.length;t++)if(p[t].activeName===e)return!0
return!1},this.setToolActiveName=function(e){var t=h[e]
t&&(t.activeName=e)},this.activateTool=function(i){if(m)return!1
var n=h[i]
if(n){void 0===n.count&&(n.count=0)
var o=null
p.length&&"intercept"===p[p.length-1].activeName&&(o=p.pop())
for(var r=0;r<p.length;r++)p[r]===n&&n.count++
return n.activeName=i,0===n.count&&(n.count++,p.push(n)),n.activate(i,t),o&&p.push(o),t.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:i,tool:n,active:!0}),e.track({category:"tool_changed",name:i}),!0}return a.logger.warn("activateTool not found: "+i),!1},this.deactivateTool=function(e){if(m)return!1
for(var i=p.length;--i>=0;)if(p[i].activeName===e)return 1===h[e].count&&p.splice(i,1),h[e].count--,h[e].deactivate(e),t.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:e,tool:p[i],active:!1}),!0
return a.logger.warn("deactivateTool not found: "+e),!1},this.getToolNames=function(){return Object.keys(h)},this.setDefaultTool=function(e){var t=this.getDefaultTool()
return!(!e||e===t)&&(this.__registerToolByName(e,"default"),t&&t.deactivate("default"),e.activate("default"),!0)},this.getDefaultTool=function(){return h.default},this.setDefaultTool(o),this.setIsLocked=function(e){var t=m
return m=!!e,t},this.getIsLocked=function(){return m},this.__checkCursor=function(){for(var e=null,i=p.length;--i>=0;){var n=p[i]
if(n.getCursor&&(e=n.getCursor()))break}e||(e="auto"),E!=e&&(t.canvas.style.cursor=e,E=e)},this.update=function(e){this.__checkCursor()
var i=!1
n&&n.update()&&(i=!0)
for(var o=p.length;--o>=0;){var r=p[o]
r.update&&r.update(e)&&(i=!0)}if(t.navigation.getCamera().dirty?(t.navigation.updateCamera(),i=!0,this.cameraUpdated=!0):this.cameraUpdated=!1,i)t.navigation.updateCamera(),this.moveDelay=Date.now()+150
else if(0!==this.moveDelay){var s=this.moveDelay-Date.now()
s>0?i=!0:this.moveDelay=0}return i},this.__clientToCanvasCoords=function(t,i,n){var o=e.canvas.getBoundingClientRect(),r=o.width,s=o.height,a=t.clientX-o.left,l=t.clientY-o.top
t.canvasX=a,t.canvasY=l,t.normalizedX=a/r*2-1,t.normalizedY=(s-l)/s*2-1,i&&i.set(a/r,l/s,0),n&&n.set(a,l)},this.__invokeStack=function(e,t,i){for(var n=p.length;--n>=0;){var o=p[n]
if(o[e]&&o[e](t,i))return!0}var r=this.getDefaultTool()
return!(!r[e]||!r[e](t,i))},this.distributeEvent=function(e,t,i){return this.__invokeStack(e,t,i)},this.handleResize=function(){t.navigation.setScreenViewport(t.container.getBoundingClientRect())
for(var e=p.length;--e>=0;){var i=p[e]
i.handleResize&&i.handleResize()}},this.handleSingleClick=function(e){var t=this.applyButtonMappings(e)
this.lastClickX=e.clientX,this.lastClickY=e.clientY,this.__invokeStack("handleSingleClick",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleDoubleClick=function(e){var t=this.applyButtonMappings(e)
this.__invokeStack("handleDoubleClick",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleSingleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleSingleTap",e)&&(e.preventDefault(),e.stopPropagation())},this.handleDoubleTap=function(e){this.lastClickX=e.canvasX,this.lastClickY=e.canvasY,this.__invokeStack("handleDoubleTap",e)&&(e.preventDefault(),e.stopPropagation())},this.handleWheelInput=function(e,t){this.__invokeStack("handleWheelInput",e)&&(t.preventDefault(),t.stopPropagation())},this.applyButtonMappings=function(e){var i=e.button
return"buttons"in e&&(e.firefoxSpoof?i=0:!v||1&e.buttons?2===i&&1&e.buttons&&(i=0,e.firefoxSpoof=v=!0):(e.firefoxSpoof=!0,v=!1,i=0)),t.navigation.getUseLeftHandedInput()&&(i=0===i?2:2===i?0:i),i},this.applyKeyMappings=function(e,t){switch(e.keyCode){case w.LCOMMAND:case w.RCOMMAND:case w.COMMANDMOZ:return l&&e.metaKey&&e.shiftKey?null:w.CONTROL
case w.SHIFT:return t&&l&&e.metaKey?null:w.SHIFT
case w.EQUALSMOZ:return w.EQUALS
case w.DASHMOZNEW:case w.DASHMOZ:return w.DASH}return e.keyCode},this.handleKeyDown=function(e){var t=this.applyKeyMappings(e,!0)
t&&this.__invokeStack("handleKeyDown",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleKeyUp=function(e){var t=this.applyKeyMappings(e,!0)
t&&this.__invokeStack("handleKeyUp",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleButtonDown=function(e,t){this.__invokeStack("handleButtonDown",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleButtonUp=function(e,t){this.__invokeStack("handleButtonUp",e,t)&&(e.preventDefault(),e.stopPropagation())},this.handleMouseMove=function(e){this.__invokeStack("handleMouseMove",e)&&(e.preventDefault(),e.stopPropagation())},this.handleBlur=function(e){this.__invokeStack("handleBlur",e)&&(e.preventDefault(),e.stopPropagation())},this.keydown=function(e){if(!(!b.domElement.contains(y)||document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLSelectElement)){if(document.activeElement){var t=document.activeElement.getAttribute("contenteditable")
if("true"===t||""===t)return}l&&e.metaKey&&e.keyCode!=w.LCOMMAND&&e.keyCode!=w.RCOMMAND||b.handleKeyDown(e)}},this.keyup=function(e){l&&e.metaKey&&e.keyCode!=w.LCOMMAND&&e.keyCode!=w.RCOMMAND||b.handleKeyUp(e)},this.mousedown=function(e){function t(e){b.applyButtonMappings(e)===i&&(document.removeEventListener("mouseup",t),b.mouseup(e))}s.isIE11&&s.inFullscreen()||document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),b.__clientToCanvasCoords(e)
var i=b.applyButtonMappings(e)
if(b.handleButtonDown(e,i),g=e.canvasX,f=e.canvasY,r(i,e)){var n=T,o=void 0!==n.time&&e.timeStamp-n.time<500,a=void 0!==n.x&&void 0!==n.y&&Math.abs(n.x-e.canvasX)<=2&&Math.abs(n.y-e.canvasY)<=2;(!o||!a||n.clickCount&&2<=n.clickCount)&&(n.clickCount=0),n.clickCount?1===n.clickCount&&(n.clickCount=2):(n.clickCount=1,n.x=e.canvasX,n.y=e.canvasY,n.time=e.timeStamp)}document.addEventListener("mouseup",t,!1),b.registerWindowMouseMove()},this.mousemove=function(e){b.__clientToCanvasCoords(e)
var t=g-e.canvasX,i=f-e.canvasY;(Math.abs(t)>2||Math.abs(i)>2)&&(g=-1,f=-1),b.handleMouseMove(e)},this.mouseup=function(e){b.__clientToCanvasCoords(e)
var t=b.applyButtonMappings(e)
b.handleButtonUp(e,t)
var i=g-e.canvasX,n=f-e.canvasY
if(g=-1,f=-1,Math.abs(i)<=2&&Math.abs(n)<=2&&b.handleSingleClick(e),r(t,e)){var o=T
2===o.clickCount&&(b.handleDoubleClick(e),o.clickCount=0,o.x=void 0,o.y=void 0,o.time=void 0)}b.unregisterWindowMouseMove()},this.doubleclick=function(e){b.__clientToCanvasCoords(e),g=e.canvasX,f=e.canvasY,b.handleDoubleClick(e)},this.mousewheel=function(e){if(b.scrollInputEnabled){var t=0
e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail),b.handleWheelInput(t,e)}},this.blur=function(e){b.handleBlur(e)},this.mouseover=function(e){y=e.target},this.registerWindowMouseMove=function(){window.addEventListener("mousemove",b.mousemove),window.addEventListener("mouseover",b.mouseover),b.domElement.removeEventListener("mousemove",b.mousemove),b.domElement.removeEventListener("mouseover",b.mouseover)},this.unregisterWindowMouseMove=function(){window.removeEventListener("mousemove",b.mousemove),window.removeEventListener("mouseover",b.mouseover),b.domElement.addEventListener("mousemove",b.mousemove),b.domElement.addEventListener("mouseover",b.mouseover)},this.enableMouseButtons=function(e){e&&!A?(this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("dblclick",this.doubleclick),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mouseover",this.mouseover)):!e&&A&&(this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover))
var t=A
return A=e,t},this.enableMouseButtons(!0),this.domElement.addEventListener("mousewheel",this.mousewheel,!1),this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1),window.addEventListener("keydown",this.keydown,!1),window.addEventListener("keyup",this.keyup,!1),window.addEventListener("blur",this.blur,!1),this.uninitialize=function(){for(A&&(this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover),window.removeEventListener("mousemove",b.mousemove),window.removeEventListener("mouseover",b.mouseover)),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup),window.removeEventListener("blur",this.blur),this.domElement=null,this.selector=null,this.autocam=null;p.length>0;)this.deactivateTool(p[p.length-1].activeName)
h=null,p=null,b=null,n=null,t=null,e=null,y=null},this.set2DMode=function(e){},this.setAutocam=function(e){},this.syncCamera=function(){},this.recordHomeView=function(){var e=t.navigation.getCamera()
i.sync(e),i.setHomeViewFrom(e)},this.setMouseWheelInputEnabled=function(e){this.scrollInputEnabled=e}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.ViewingUtilities=function(e,t,i){function n(e){var t=.6,i=0,n=new THREE.SphereGeometry(1),o=new THREE.MeshPhongMaterial({color:32512,ambient:32512,opacity:t,transparent:!0}),r=new THREE.Mesh(n,o),s=e,a=1
s.createOverlayScene("pivot"),r.visible=!1,this.shown=function(){return r.visible},this.show=function(e,n,l){r.scale.x=n*a,r.scale.y=n*a,r.scale.z=n*a,r.position.set(e.x,e.y,e.z),o.opacity=t,r.visible=!0,s.addOverlay("pivot",r),s.invalidate(!1,!1,!0),i=l?Date.now()+500:0},this.hide=function(){r.visible&&(r.visible=!1,s.removeOverlay("pivot",r),s.invalidate(!1,!1,!0),i=0)},this.fade=function(){if(i>0){var e=i-Date.now()
if(e<=0)return this.hide(),!0
var n=e/500*t
return o.opacity=n,!0}return!1},this.fading=function(){return i>0},this.setSize=function(e){a=e},this.setColor=function(e,i){o.color=new THREE.Color(e),void 0!==i&&(t=i,o.opacity=t)}}function o(e,t,i){var n=t.clone().sub(e)
if(0===n.lengthSq())return n.copy(i)
var o=n.clone().cross(i)
return 0===o.lengthSq()&&(i.z>i.y?n.y-=1e-4:n.z-=1e-4,o.crossVectors(n,i)),o.cross(n).normalize()}this.autocam=t,this.viewerImpl=e
var r=i.getCamera(),s={},a={},l=new n(this.viewerImpl)
this.transitionView=function(e,n,s,a,l,c,d){l=l||i.getWorldUpVector()
var u=c?o(e,n,l):a
u||(u=r.up),d=d||n
var h={position:e,center:n,pivot:d,fov:s,up:u,worldUp:l,isOrtho:!1===r.isPerspective}
t.goToView(h)},this.goHome=function(){this.viewerImpl.track({name:"navigation/home",aggregate:"count"}),t.goHome()},this.getHitPoint=function(e,t){t=1-t,e=2*e-1,t=2*t-1
var i=new THREE.Vector3(e,t,1),n=this.viewerImpl.hitTestViewport(i,!1)
return n?n.intersectPoint:null},this.activatePivot=function(e){if(this.viewerImpl.model&&!this.viewerImpl.model.is2d()){var t=r.isPerspective?i.getPivotPlaneDistance():i.getEyeVector().length(),n=i.getVerticalFov(),o=2*t*Math.tan(THREE.Math.degToRad(.5*n)),s=i.getScreenViewport(),a=window.devicePixelRatio||1,c=5*o/(s.height*a)
l.show(i.getPivotPoint(),c,e)}},this.pivotActive=function(e,t){if(e=e&&!i.getIs2D(),t=t||!1,!e&&l.shown())return void l.hide()
e&&this.activatePivot(t)},this.pivotUpdate=function(){l.shown()&&l.fade()&&this.viewerImpl.invalidate(!1,!1,!0)},this.setPivotPoint=function(e,t,n){i.setPivotPoint(e),t||i.setTarget(e),n&&i.setPivotSetFlag(!0),this.setTemporaryPivot(null),i.getIs2D()||l.shown()&&this.activatePivot(l.fading())},this.savePivot=function(e){e||(e="default"),s[e]=i.getPivotPoint(),a[e]=i.getPivotSetFlag()},this.restorePivot=function(e){if(e||(e="default"),s[e]){var t=a[e]
this.setPivotPoint(s[e],!0,t),t||i.setPivotSetFlag(!1),delete s[e],delete a[e]}},this.setTemporaryPivot=function(e){if(e){var t=i.getPivotPoint(),n=i.getPivotSetFlag()
this.setPivotPoint(e,!0,n),s.TEMP=t,a.TEMP=n}else delete s.TEMP,delete a.TEMP},this.removeTemporaryPivot=function(){this.restorePivot("TEMP")},this.setPivotSize=function(e){l.setSize(e)},this.setPivotColor=function(e,t){l.setColor(e,t)},this.getBoundingBox=function(e){return this.viewerImpl.getFitBounds(e)},this.fitToView=function(e){this.viewerImpl.track({name:"navigation/fit",aggregate:"count"}),this.viewerImpl.fitToView(this.viewerImpl.api.getSelection()),this.activatePivot(!0)},this.update=function(){i.getRequestFitToView()&&!i.getTransitionActive()&&(i.setRequestFitToView(!1),this.fitToView()),i.getRequestHomeView()&&!i.getTransitionActive()&&(i.setRequestHomeView(!1),this.goHome())
var e=i.getRequestTransition()
return e&&!i.getTransitionActive()&&(i.setRequestTransition(!1),this.transitionView(e.position,e.coi,e.fov,e.up,e.worldUp,e.reorient,e.pivot)),!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.DefaultHandler=function(e,t,i){this.clickConfig=null,this.getNames=function(){return["default"]},this.getName=function(){return this.getNames()[0]},this.setClickBehavior=function(e){this.clickConfig=e},this.getClickBehavior=function(){return this.clickConfig},this.activate=function(e){},this.deactivate=function(e){},this.handleAction=function(t,n){for(var o=0;o<t.length;++o)switch(t[o]){case"selectOnly":e.selector&&n&&e.selector.setSelection([n.dbId],n.model)
break
case"deselectAll":e.selector&&e.selector.setSelection([])
break
case"selectToggle":e.selector&&n&&e.selector.toggleSelection(n.dbId,n.model)
break
case"isolate":n&&e.isolate(n.dbId)
break
case"showAll":e.showAll()
break
case"setCOI":n&&n.intersectPoint&&(i.setPivotPoint(n.intersectPoint,!0,!0),i.pivotActive(!0,!0))
break
case"hide":n&&e.hide(n.dbId)
break
case"show":n&&e.show(n.dbId)
break
case"toggleVisibility":n&&e.toggleVisibility(n.dbId)
break
case"focus":e.selector&&(n?e.selector.setSelection([n.dbId],n.model):e.selector.setSelection([]),i.fitToView())}},this.handleSingleClick=function(t,n){var o=t.ctrlKey||t.metaKey,r=t.shiftKey,s=t.altKey
if(0===n){var a=new THREE.Vector3(t.normalizedX,t.normalizedY,1),l=e.hitTestViewport(a,!1),c="click"
o&&(c+="Ctrl"),r&&(c+="Shift"),s&&(c+="Alt")
var d=l?"onObject":"offObject"
if(this.clickConfig&&this.clickConfig[c]&&this.clickConfig[c][d])return this.handleAction(this.clickConfig[c][d],l),!0}else if(1===n&&r&&!s&&!o){var a=new THREE.Vector3(t.normalizedX,t.normalizedY,1),l=e.hitTestViewport(a,!1)
if(l&&l.intersectPoint)return i.setPivotPoint(l.intersectPoint,!0,!0),i.pivotActive(!0,!0),!0}return!1},this.handleDoubleClick=function(n,o){if(e.selector&&0===o){var r=new THREE.Vector3(n.normalizedX,n.normalizedY,1),s=e.hitTestViewport(r,!1)
return s?e.selector.setSelection([s.dbId],s.model):e.selector.clearSelection(),i.fitToView(),!0}return 1===o&&(t.fitBounds(!1,i.getBoundingBox(!0)),t.setPivotSetFlag(!1),!0)},this.handleSingleTap=function(i){if(i.clientX=i.pointers[0].clientX,i.clientY=i.pointers[0].clientY,e.api.triggerSingleTapCallback(i),i.hasOwnProperty("pointers")&&2===i.pointers.length)return t.setRequestHomeView(!0),!0
if(e.selector){var n=new THREE.Vector3(i.normalizedX,i.normalizedY,1),o=e.hitTestViewport(n,!1)
return o?(e.selector.setSelection([o.dbId],o.model),e.api.triggerSelectionChanged([o.dbId])):(e.selector.clearSelection(),e.api.triggerSelectionChanged(null)),!0}return!1},this.handleDoubleTap=function(t){t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerDoubleTapCallback(t)
var n=this.handleSingleTap(t,0)
return i.fitToView(),n},this.handlePressHold=function(t){return"press"===t.type&&(t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,e.api.triggerContextMenu(t))}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.GestureRecognizers={singletap:[Hammer.Tap,{event:"singletap",threshold:7,time:400}],singletap2:[Hammer.Tap,{event:"singletap2",pointers:2,threshold:7,time:400}],press:[Hammer.Press,{event:"press",time:500,threshold:50}],doubletap:[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],doubletap2:[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],drag:[Hammer.Pan,{event:"drag",pointers:1}],drag3:[Hammer.Pan,{event:"drag3",pointers:3,threshold:15}],pan:[Hammer.Pan,{event:"pan",pointers:2,threshold:20}],pinch:[Hammer.Pinch,{event:"pinch",pointers:2,enable:!0,threshold:.05}],rotate:[Hammer.Rotate,{event:"rotate",pointers:2,enable:!0,threshold:7}]},Autodesk.Viewing.GestureHandler=function(e){var t=Autodesk.Viewing,i=e.navigation,n=["gestures"],o=this,r=!0,s=!0,a=null,l=!1,c=t.isTouchDevice()
i.setIsTouchDevice(c),c&&(a=new Hammer.Manager(e.canvasWrap,{recognizers:[t.GestureRecognizers.drag,t.GestureRecognizers.doubletap,t.GestureRecognizers.doubletap2,t.GestureRecognizers.singletap,t.GestureRecognizers.singletap2,t.GestureRecognizers.press,t.GestureRecognizers.drag3,t.GestureRecognizers.pan,t.GestureRecognizers.pinch,t.GestureRecognizers.rotate],inputClass:Hammer.TouchInput}),a.get("pinch").recognizeWith([a.get("drag")]),e.canvasWrap.addEventListener("touchstart",this.onTouchStart,!1)),this.onTouchStart=function(e){e.preventDefault()},this.getNames=function(){return n},this.getName=function(){return n[0]},this.isActive=function(){return l},this.__clientToCanvasCoords=function(t){var i,n,o=e.impl.canvas.getBoundingClientRect(),r=o.width,s=o.height
t.hasOwnProperty("center")?(i=t.center.x-o.left,n=t.center.y-o.top):(i=t.pointers[0].clientX-o.left,n=t.pointers[0].clientY-o.top),t.canvasX=i,t.canvasY=n,t.normalizedX=i/r*2-1,t.normalizedY=(s-n)/s*2-1},this.distributeGesture=function(e){o.__clientToCanvasCoords(e),o.controller.distributeEvent("handleGesture",e)&&e.preventDefault(),function(e,t){return-1!==e.indexOf(t,e.length-t.length)}(e.type,"end")&&o.controller.enableMouseButtons(r)},this.onSingleTap=function(e){o.__clientToCanvasCoords(e),o.controller.distributeEvent("handleSingleTap",e)&&e.preventDefault()},this.onDoubleTap=function(e){o.__clientToCanvasCoords(e),o.controller.distributeEvent("handleDoubleTap",e)&&e.preventDefault()},this.onPressHold=function(e){o.__clientToCanvasCoords(e),"press"===e.type?r=o.controller.enableMouseButtons(!1):o.controller.enableMouseButtons(r),o.controller.distributeEvent("handlePressHold",e)&&e.preventDefault()},this.activate=function(e){a&&!l&&(a.on("dragstart dragmove dragend",this.distributeGesture),a.on("singletap",this.onSingleTap),a.on("singletap2",this.onSingleTap),a.on("doubletap",this.onDoubleTap),a.on("doubletap2",this.onDoubleTap),a.on("press pressup",this.onPressHold),a.on("drag3start drag3move drag3end",this.distributeGesture),s&&(a.on("panstart panmove panend",this.distributeGesture),a.on("pinchstart pinchmove pinchend",this.distributeGesture),a.on("rotatestart rotatemove rotateend",this.distributeGesture)),a.get("doubletap2").recognizeWith("doubletap"),a.get("singletap2").recognizeWith("singletap"),a.get("singletap").requireFailure("doubletap")),l=!0},this.deactivate=function(e){a&&l&&(a.off("dragstart dragmove dragend",this.distributeGesture),a.off("singletap",this.onSingleTap),a.off("singletap2",this.onSingleTap),a.off("doubletap",this.onDoubleTap),a.off("doubletap2",this.onDoubleTap),a.off("press pressup",this.onPressHold),a.off("drag3start drag3move drag3end",this.distributeGesture),s&&(a.off("panstart panmove panend",this.distributeGesture),a.off("pinchstart pinchmove pinchend",this.distributeGesture),a.off("rotatestart rotatemove rotateend",this.distributeGesture))),l=!1},this.update=function(){return!1},this.handleBlur=function(e){return!1},this.disableTwoFingerSwipe=function(){s=!1,a&&(a.remove(Hammer.Pan),a.remove(Hammer.Pinch),a.remove(Hammer.Rotate),a.off("panstart panmove panend",this.distributeGesture),a.off("pinchstart pinchmove pinchend",this.distributeGesture),a.off("rotatestart rotatemove rotateend",this.distributeGesture))}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.OrbitDollyPanTool=function(e,t){function i(){var e=ne
return _===N&&!e.SHIFT&&!(e.ALT^e.CONTROL)||_===N&&e.SHIFT&&e.CONTROL||_===D&&!e.SHIFT&&!e.CONTROL||_===D&&e.ALT||_===D&&e.CONTROL&&!e.ALT||_===L&&e.SHIFT&&!e.CONTROL&&!e.ALT||"pan"===T&&_!==D&&!e.ALT&&!("pinch"===b)||e.SPACE}function n(){var e=ne
return _===N&&e.SHIFT&&!e.ALT&&!e.CONTROL||_===N&&e.ALT&&!e.SHIFT&&!e.CONTROL||"dolly"===T&&!e.ALT&&!("pinch"===b)}function o(){var e=ne
return!(e.CONTROL||e.ALT||e.SHIFT||_!==N&&_!==D)}function r(){return f.getPivotPoint().sub(f.getPosition()).dot(f.getEyeVector())<=0}function s(e,t){var i={left:0,top:0,width:window.innerWidth,height:window.innerHeight}
Z.set((e-.5*i.width-i.left)/(.5*i.width),(.5*i.height+i.top-t)/(.5*i.height),0)
var n=Z.length()
return $?n<Math.SQRT1_2?Z.z=Math.sqrt(1-n*n):Z.z=.5/n:n>1?Z.normalize():Z.z=Math.sqrt(1-n*n),Y.copy(v.position).sub(v.pivot),q.copy(v.up).setLength(Z.y),q.add(K.copy(v.up).cross(Y).setLength(Z.x)),q.add(Y.setLength(Z.z)),q}function a(){if(f.isActionEnabled("orbit")){Y.subVectors(v.position,v.pivot),X.subVectors(v.position,v.target)
var e=X.length()
X.normalize()
var t=Math.acos(W.dot(j)/W.length()/j.length())
t&&(t*=m,Q.crossVectors(W,j).normalize(),J.setFromAxisAngle(Q,-t),Y.applyQuaternion(J),v.up.applyQuaternion(J),j.applyQuaternion(J),X.applyQuaternion(J),ee?W.copy(j):(J.setFromAxisAngle(Q,t*(te-1)),W.applyQuaternion(J))),v.position.addVectors(v.pivot,Y),v.target.subVectors(v.position,X.multiplyScalar(e)),v.dirty=!0}}function l(e,t){return-1!==e.indexOf(t,e.length-t.length)}function c(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,i=e.pointers[1].clientY-e.pointers[0].clientY
return Math.sqrt(t*t+i*i)}var d,u,h,p=(Autodesk.Viewing.Private,this),m=2,g=-1!=navigator.userAgent.search("Mac OS"),f=t.navigation,v=f.getCamera(),E=["orbit","freeorbit","dolly","pan"],y=E[0],A=[y],T=y,b=null,w=1,C=1,S=0,R=0,x=0,P=0,k=!1,M=null,V=!1,I={SHIFT:16,CONTROL:17,ALT:18,SPACE:32,PAGEUP:33,PAGEDOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,ZERO:48,EQUALS:187,DASH:189},L=0,D=1,N=2,_=-5,O=new THREE.Vector3,H=new THREE.Vector3,B=new THREE.Vector2,F=new THREE.Vector2,G=new THREE.Vector2,z=new THREE.Vector2,U=new THREE.Vector3,W=new THREE.Vector3,j=new THREE.Vector3,Y=new THREE.Vector3,X=new THREE.Vector3,q=new THREE.Vector3,K=new THREE.Vector3,Z=new THREE.Vector3,Q=new THREE.Vector3,J=new THREE.Quaternion,$=!1,ee=!0,te=.2,ie=[!1,!1,!1,!1,!1,!1],ne={SHIFT:0,ALT:0,CONTROL:0,SPACE:0},oe=function(t){e.renderer().rolloverObjectViewport(0,0,[0])},re=1,se=5,ae=.025
this.getNames=function(){return E},this.getName=function(){return E[0]},this.activate=function(t){A.push(t),T=t,e.canvas.addEventListener("mouseout",oe)},this.deactivate=function(t){var i=A.length-1
i>0&&A[i]===t&&(A.pop(),T=A[i-1]),0===A.length&&e.canvas.removeEventListener("mouseout",oe)},this.adjustDollyLookSpeed=function(e){0===e?(ae=.025,se=5):(ae*=e>0?1.1:.9,se*=e>0?1.1:.9,ae<1e-6&&(ae=1e-6),se<1e-6&&(se=1e-6))},this.getDollySpeed=function(e){var t=f.getEyeVector(),i=f.getPosition(),n=e.clone().sub(i).dot(t.normalize()),o=n*ae
return Math.abs(o)<.01?o<0?-.01:.01:o},this.getLookSpeed=function(){return se},this.coiIsActive=function(){return f.getPivotSetFlag()&&f.isPointVisible(f.getPivotPoint())},this.adjustSpeed=function(e){this.adjustDollyLookSpeed(e),this.utilities.autocam&&(this.utilities.autocam.orbitMultiplier=this.getLookSpeed())},this.getTriggeredMode=function(){return _===D&&ne.SHIFT?A[1]:n()||0!==U.z?o()?"pan":"dolly":i()?"pan":"pan"===b||"pinch"===b?"dollypan":T},this.initTracking=function(e,t){var i
if(v.isPerspective){i=.5*(v.near+v.far)
var n=this.utilities.getHitPoint(e,t),o=f.getPosition()
if(n&&n.sub){var r=n.sub(o),s=f.getEyeVector().normalize()
i=Math.abs(s.dot(r))}else{if(f.getPivotSetFlag()&&f.isPointVisible(f.getPivotPoint())){var a=f.getPivotPlaneDistance()
a>1e-5&&(i=a)}}}else i=f.getEyeVector().length()
re=i},this.initOrbit=function(){this.utilities.setTemporaryPivot(r()?f.getTarget():null)},this.getActiveMode=function(){return y},this.getCursor=function(){switch(y){case"freeorbit":case"orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto"
case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto"
case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null},this.getMotionDelta=function(e,t){var i=f&&f.getReverseZoomDirection()?-1.5:1.5
g&&(i*=-1),ie[0]&&(H.x+=.01,G.x+=20),ie[1]&&(H.x-=.01,G.x-=20),ie[2]&&(H.y+=.01,G.y+=20),ie[3]&&(H.y-=.01,G.y-=20),ie[4]&&(H.z+=i),ie[5]&&(H.z-=i)
var n=H.x-O.x,o=H.y-O.y,r=H.z-O.z
Math.abs(n)<.001&&(n=0),Math.abs(o)<.001&&(o=0),Math.abs(r)<.001&&(r=0),e.set(n,o,r),t&&t.set(G.x-F.x,G.y-F.y)},this.stepMotionDelta=function(e,t){t?(O.x+=.6*e.x,O.y+=.6*e.y,O.z+=.6*e.z):O.copy(H),F.copy(G)},this.getFitBounds=function(){return this.utilities.viewerImpl.zoomBoundsChanged&&(h=this.utilities.viewerImpl.getVisibleBounds(!0),this.utilities.viewerImpl.zoomBoundsChanged=!1),h},this.update=function(){var e,i=!1,n=!1
this.getMotionDelta(U,z)
var o=U.x,r=U.y,s=U.z
if(k||this.checkInteractionMode(),k=_>-1,k&&this.controller.setIsLocked(!0),0!==o||0!==r||0!==s){switch(y){case"orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(z.x=-z.x,M&&this.utilities.autocam.orbit(G,M,z.multiplyScalar(m),this.utilities.autocam.startState))
break
case"freeorbit":a()
break
case"dolly":var l,c,h
s*=.6,_>=L?(r=-r,s=Math.abs(o)>Math.abs(r)?o:r,f.getReverseZoomDirection()&&(s*=-1),s*=100,o=0,r=0,c=h=.5):(e=f.getScreenViewport(),d&&u?(c=d/e.width,h=u/e.height):c=h=.5),l=!f.getIs2D()&&f.getZoomTowardsPivot()?this.coiIsActive()?f.getPivotPoint():f.getWorldPoint(.5,.5):f.getWorldPoint(c,h),f.dollyFromPoint(s*this.getDollySpeed(l),l,this.getFitBounds())
break
case"pan":f.panRelative(-o,r,re)
break
case"dollypan":0===o&&0===r||f.panRelative(-o,r,re),e=f.getScreenViewport(),c=d/e.width,h=u/e.height,l=f.getWorldPoint(c,h)
var p=f.getPosition(),g=f.getIs2D()?p.sub(l).length():re,A=S/R-1,T=A*g
f.dollyFromPoint(T,l,this.getFitBounds())
var P=new THREE.Vector3,I=new THREE.Quaternion,D=f.getCameraUpVector(),N=P.copy(v.position).sub(v.target).normalize()
I.setFromAxisAngle(N,1.2*x),D.applyQuaternion(I),f.getIs2D()||f.setCameraUpVector(D),S=R,C=w,re=g+T}n=!0}return this.stepMotionDelta(U,"pan"!==y&&"dollypan"!==y),-1===_&&Math.abs(s)<1e-5&&(this.interactionEnd(-1),i=!0,n=!0),(ne.SHIFT||ne.ALT)&&-1!==E.indexOf(t.getActiveNavigationTool())&&(n=!0),!V&&(i||_>-5)&&(_>-1&&(O.copy(H),this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),_=-5,k&&this.controller.setIsLocked(!1),k=!1,M=null,b=null),n?this.utilities.pivotActive(f.getPivotSetFlag(),_<=-1):this.utilities.pivotUpdate(),v.dirty},this.checkInteractionMode=function(){var e=this.getTriggeredMode()
e!==y&&("pan"===(y=e)&&_>-1||"dollypan"===y)&&this.initTracking(O.x,O.y)},this.interactionStart=function(e,t){(t||e>_)&&(_=e,V=!0,e>-1&&("pan"===y&&this.initTracking(O.x,O.y),"orbit"===y&&this.initOrbit()),this.utilities.pivotActive(f.getPivotSetFlag(),-1===e),this.utilities.autocam&&(this.utilities.autocam.sync(v),this.utilities.autocam.startInteraction(F.x,F.y),M=F.clone()))},this.interactionCheck=function(){(ie[0]||ie[1]||ie[2]||ie[3]||ie[4]||ie[5]||ne.SHIFT||ne.CONTROL||ne.ALT||ne.SPACE)&&this.interactionStart(-4,!0)},this.interactionEnd=function(e){e===_&&(-1!==e&&this.utilities.pivotActive(!1),V=!1)},this.handleWheelInput=function(t){if(this.isDragging)return!1
if(f.getIs2D()){var i=f.getScreenViewport(),n=e.intersectGround(d+i.width,u+i.height)
this.utilities.setPivotPoint(n,!0,!0)}return f.getReverseZoomDirection()&&(t*=-1),H.z+=t,0!=t&&this.interactionStart(-1),!0},this.resetKeys=function(){this.autoMove(-1,!1),ne.SHIFT=0,ne.CONTROL=0,ne.ALT=0,ne.SPACE=0},this.autoMove=function(e,t){t&&this.isDragging||(e<0?ie[0]=ie[1]=ie[2]=ie[3]=ie[4]=ie[5]=t:ie[e]=t,t||this.interactionEnd(-4),this.interactionCheck())},this.updateModifierState=function(e){ne.CONTROL=g&&e.metaKey||e.ctrlKey?1:0,ne.SHIFT=e.shiftKey?1:0,ne.ALT=e.altKey?1:0},this.handleKeyDown=function(e,t){this.updateModifierState(e)
var i=!1
switch(t){case I.EQUALS:this.adjustSpeed(1),i=!0
break
case I.DASH:this.adjustSpeed(-1),i=!0
break
case I.ZERO:this.adjustSpeed(0),i=!0
break
case I.LEFT:this.autoMove(0,!0),i=!0
break
case I.RIGHT:this.autoMove(1,!0),i=!0
break
case I.PAGEUP:this.autoMove(2,!0),i=!0
break
case I.PAGEDOWN:this.autoMove(3,!0),i=!0
break
case I.UP:this.autoMove(4,!0),i=!0
break
case I.DOWN:this.autoMove(5,!0),i=!0
break
default:return!1}return this.isDragging||this.interactionStart(-4),i},this.handleKeyUp=function(e,t){this.updateModifierState(e)
var i=!1
switch(t){case I.LEFT:this.autoMove(0,!1),i=!0
break
case I.RIGHT:this.autoMove(1,!1),i=!0
break
case I.PAGEUP:this.autoMove(2,!1),i=!0
break
case I.PAGEDOWN:this.autoMove(3,!1),i=!0
break
case I.UP:this.autoMove(4,!1),i=!0
break
case I.DOWN:this.autoMove(5,!1),i=!0
break
default:return!1}return i&&(this.interactionEnd(-4),V||this.interactionCheck()),i},this.handleDollyPan=function(e){d=e.canvasX,u=e.canvasY
var t=f.getScreenViewport()
G.x=d,G.y=u,H.x=G.x/t.width,H.y=G.y/t.height,R=c(e)
var i=THREE.Math.degToRad(e.rotation)
x=i-P,Math.abs(x)>1&&(x=0),P=i,l(e.type,"start")&&(S=R,C=1,x=0,P=i),w=e.scale},this.handleGesture=function(e){switch(e.type){case"dragstart":return b="drag",this.handleButtonDown(e,0)
case"dragmove":return"drag"!==b&&(this.handleButtonDown(e,0),b="drag"),this.handleMouseMove(e)
case"dragend":return"drag"===b&&(this.handleButtonUp(e,0),b=null,!0)
case"panstart":return b="pan",this.handlePanStart(e),this.handleDollyPan(e),!0
case"panmove":return"pan"!==b&&(b="pan",this.handlePanStart(e)),this.handleDollyPan(e)
case"panend":return"pan"===b&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0)
case"pinchstart":return this.isDragging=!0,b="pinch",O.x=.5*(e.normalizedX+1),O.y=1-.5*(e.normalizedY+1),B.set(e.canvasX,e.canvasY),F.set(e.canvasX,e.canvasY),k=!1,this.interactionStart(3),this.handleDollyPan(e),!0
case"pinchmove":return"pinch"===b&&this.handleDollyPan(e)
case"pinchend":return"pinch"===b&&(this.isDragging=!1,this.handleDollyPan(e),this.interactionEnd(3),!0)}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),O.x=.5*(e.normalizedX+1),O.y=1-.5*(e.normalizedY+1),F.set(e.canvasX,e.canvasY),H.copy(O),G.copy(F),W.copy(s(e.canvasX,e.canvasY)),j.copy(W),d=e.canvasX,u=e.canvasY,this.isDragging=!0,this.interactionStart(t),!0},this.handlePanStart=function(e){return this.isDragging=!0,O.x=.5*(e.normalizedX+1),O.y=1-.5*(e.normalizedY+1),B.set(e.canvasX,e.canvasY),F.set(e.canvasX,e.canvasY),this.interactionStart(3),!0},this.handleButtonUp=function(e,t){return this.updateModifierState(e),H.x=.5*(e.normalizedX+1),H.y=1-.5*(e.normalizedY+1),G.set(e.canvasX,e.canvasY),j.copy(s(e.canvasX,e.canvasY)),W.copy(j),d=e.canvasX,u=e.canvasY,this.interactionEnd(t),this.isDragging=!1,!0},this.handleMouseMove=function(t){return this.updateModifierState(t),this.isDragging?(H.x=.5*(t.normalizedX+1),H.y=1-.5*(t.normalizedY+1),G.set(t.canvasX,t.canvasY),j.copy(s(t.canvasX,t.canvasY)),d=t.canvasX,u=t.canvasY,!0):(O.x=.5*(t.normalizedX+1),O.y=1-.5*(t.normalizedY+1),F.set(t.canvasX,t.canvasY),H.x=O.x,H.y=O.y,G.copy(F),d=t.canvasX,u=t.canvasY,t.target===e.canvas&&e.rolloverObject(d,u),!1)},this.handleBlur=function(e){this.resetKeys(),this.interactionEnd(_)},t.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,function(e){p.handleBlur(e)})},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.HotGestureTool=function(e){var t=(navigator.userAgent.search("Mac OS"),e.navigation),i=(t.getCamera(),["hottouch"]),n={SHIFT:0,ALT:0,CONTROL:0},o=null,r=null,s=!1,a=!1,l=null,c={SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,LCOMMAND:91,RCOMMAND:93,COMMANDMOZ:224}
this.getNames=function(){return i},this.getName=function(){return i[0]},this.activate=function(e){},this.deactivate=function(e){},this.__checkStart=function(){l&&(this.controller.distributeEvent("handleGesture",l),l=null)},this.update=function(){if(this.controller.getIsLocked())return!1
var t=e.getActiveNavigationTool(),i=!1===s&&!0===a,n=!0===s&&!1===a
if(i||n){var l=i?"worldup":"fov"
if(t===l)return!1
if(t===o)return e.setActiveNavigationTool(l),o=l,this.__checkStart(),!1
r=t,e.setActiveNavigationTool(l),o=l,this.__checkStart()}else o&&(e.setActiveNavigationTool(r),o=null,r=null)
return!1},this.resetKeys=function(){n.SHIFT=0,n.CONTROL=0,n.ALT=0},this.updateModifierState=function(e){n.CONTROL=e.ctrlKey?1:0,n.SHIFT=e.shiftKey?1:0,n.ALT=e.altKey?1:0},this.handleGesture=function(t){if(t===l)return!1
switch(t.type){case"drag3start":e.navigation.isActionEnabled("fov")&&(l=t,s=!0)
break
case"drag3move":break
case"drag3end":s=!1
break
case"rotatestart":e.navigation.isActionEnabled("roll")&&(l=t,a=!0)
break
case"rotatemove":break
case"rotateend":a=!1}return!1},this.handleKeyDown=function(e,t){switch(this.updateModifierState(e),t){case c.SHIFT:n.SHIFT=1
break
case c.CONTROL:n.CONTROL=1
break
case c.ALT:n.ALT=1}return!1},this.handleKeyUp=function(e,t){switch(this.updateModifierState(e),t){case c.SHIFT:n.SHIFT=0
break
case c.CONTROL:n.CONTROL=0
break
case c.ALT:n.ALT=0}return!1},this.handleButtonDown=function(e,t){return this.updateModifierState(e),!1},this.handleButtonUp=function(e,t){return this.updateModifierState(e),!1},this.handleMouseMove=function(e){return this.updateModifierState(e),!1},this.handleBlur=function(e){return this.resetKeys(),!1}},AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.HotkeyManager=function(){function e(){return g}function t(){return g[0]}function i(e,t){return e-t}function n(e,t,n){if(d.some(function(t){return t.id===e}))return!1
for(var o=0;o<t.length;o++)d.push({id:e,keys:t[o].keycodes.sort(i).join(),onPress:t[o].onPress,onRelease:t[o].onRelease,options:n||{}})
return!0}function o(e){for(var t=!1,i=d.length-1;i>=0;i--)d[i].id===e&&(d.splice(i,1),t=!0)
return t}function r(){var e,t,i=u.join()
for(t=0;t<p.length;)e=p[t],e.keys===i?p.splice(t,1):t++
for(t=0;t<h.length;)e=h[t],e.keys!==i?h.splice(t,1):t++}function s(e,t){if(-1===u.indexOf(t)){for(var i=u.join(),n=u.slice(0),o=0;o<u.length&&u[o]<t;)o++
u.splice(o,0,t)
var s=u.join(),a=u.slice(0)
r()
var l,c=[],m=[]
for(o=d.length-1;o>=0;o--)l=d[o],l.keys===i&&l.onRelease?c.unshift(l):l.keys===s&&l.onPress&&m.unshift(l)
for(o=c.length-1;o>=0&&(l=c[o],!l.onRelease(n));o--)l.options.tryUntilSuccess&&p.unshift(l)
for(o=m.length-1;o>=0&&(l=m[o],!l.onPress(a));o--)l.options.tryUntilSuccess&&h.unshift(l)}}function a(e,t){var i=u.join(),n=u.slice(0),o=u.indexOf(t)
o>-1&&u.splice(o,1)
var s=u.join(),a=u.slice(0)
r()
var l,c=[],m=[]
for(o=d.length-1;o>=0;o--)l=d[o],l.keys===i&&l.onRelease?c.unshift(l):l.keys===s&&l.onPress&&m.unshift(l)
for(o=c.length-1;o>=0&&(l=c[o],!l.onRelease(n));o--)l.options.tryUntilSuccess&&p.unshift(l)
for(o=m.length-1;o>=0&&(l=m[o],!l.onPress(a));o--)l.options.tryUntilSuccess&&h.unshift(l)}function l(){var e,t
for(t=0;t<p.length;)e=p[t],!0===e.onRelease(e.keys.split())?p.splice(t,1):t++
for(t=0;t<h.length;)e=h[t],!0===e.onPress(e.keys.split())?h.splice(t,1):t++
return!1}function c(){for(var e=u.length-1;e>=0;e--)a(null,u[e])}var d=[],u=[],h=[],p=[],m=Autodesk.Viewing.KeyCode,g=["hotkeys"]
return{pushHotkeys:n,popHotkeys:o,handleKeyDown:s,handleKeyUp:a,handleBlur:c,getName:t,getNames:e,activate:function(){},deactivate:function(){},update:l,KEYCODES:m}},Autodesk.Viewing.theHotkeyManager=new Autodesk.Viewing.HotkeyManager,AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.FovTool=function(e){function t(e){return e<0&&e>-3?-3:e>0&&e<3?3:e}var i=e.navigation,n=i.getCamera(),o=["fov"],r=!1,s=0,a=null,l=null,c=!1,d=0,u=-5,h=new THREE.Vector3,p=new THREE.Vector3,m=new THREE.Vector3,g=null
this.getNames=function(){return o},this.getName=function(){return o[0]},this.activate=function(e){d=0},this.deactivate=function(e){u=-5},this.getCursor=function(){return 0!==d&&-5===u?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"},this.getMotionDelta=function(e){var t=p.x-h.x,i=p.y-h.y,n=p.z-h.z
Math.abs(t)<.001&&(t=0),Math.abs(i)<.001&&(i=0),Math.abs(n)<.001&&(n=0),e.set(t,i,n)},this.stepMotionDelta=function(e,t){t?(h.x+=.6*e.x,h.y+=.6*e.y,h.z+=.6*e.z):h.copy(p)},this.getAccumulatedWheelDelta=function(){var e=Date.now(),i=0
return l&&e-l>100?(i=t(s),s=0,a=null,l=null,c=!1):a&&e-a>100&&(c?Math.abs(s)>=3&&(i=s,s=0):(i=t(s),c=!0,s=0)),i},this.update=function(){var e=!1,t=u>-5
if(u>-5){this.controller.setIsLocked(!0),this.getMotionDelta(m)
var o=m.x,s=m.y,a=m.z
if(0!==o||0!==s||0!==a)if(t=!0,u>=0)s=-s,0!==(a=Math.abs(o)>Math.abs(s)?o:s)&&(a*=-1,i.setVerticalFov(i.getVerticalFov()*(1+a),!0))
else{var l=this.getAccumulatedWheelDelta()/3
0!==l&&i.setFocalLength(i.getFocalLength()+l,!0)}this.stepMotionDelta(m,!0),-1===u&&Math.abs(a)<1e-5&&(this.interactionEnd(-1),e=!0)}return t?this.utilities.pivotActive(i.getPivotSetFlag(),!0):this.utilities.pivotUpdate(),!r&&(e||u>-5)&&(u>-1&&h.copy(p),u=-5,this.controller.setIsLocked(!1)),n.dirty},this.interactionStart=function(e,t){(t||e>u)&&(u=e,r=!0),i.toPerspective()},this.interactionEnd=function(e){e===u&&(-1!==e&&this.utilities.pivotActive(!1),r=!1)},this.handleWheelInput=function(e){if(u>-1)return!1
i.getReverseZoomDirection()&&(e*=-1),p.z+=e,s+=e
var t=Date.now()
return a||(a=t),l=t,0!=e&&this.interactionStart(-1),!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return this.handleButtonDown(e,0)
case"dragmove":return this.handleMouseMove(e)
case"dragend":return this.handleButtonUp(e,0)
case"drag3start":return g="drag",this.handleButtonDown(e,0)
case"drag3move":return"drag"===g&&this.handleMouseMove(e)
case"drag3end":return"drag"===g&&this.handleButtonUp(e,0),g=null,!1}return!1},this.handleButtonDown=function(e,t){return d+=1<<t,2!==t&&(h.x=.5*(e.normalizedX+1),h.y=1-.5*(e.normalizedY+1),p.copy(h),this.interactionStart(t),!0)},this.handleButtonUp=function(e,t){return d-=1<<t,2!==t&&(p.x=.5*(e.normalizedX+1),p.y=1-.5*(e.normalizedY+1),this.interactionEnd(t),!0)},this.handleMouseMove=function(e){return p.x=.5*(e.normalizedX+1),p.y=1-.5*(e.normalizedY+1),u>-1},this.handleBlur=function(e){return this.interactionEnd(u),!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.WorldUpTool=function(e,t){function i(e,t){function i(e,t){var i=Math.abs(e-t)
return i>u?i:Math.min(u-i,i)}function n(e,t){var i=g(e)
return i.distanceToSquared(t)<h||(x.set(-t.x,-t.y,-t.z),i.distanceToSquared(x)<h)}function a(e,t){for(var o=q+K+2*Math.PI/180,r=0;r<6;++r)if(z[r]!==Q)for(var s=r+1;s<6;++s)if(z[s]!==Q){var a=i(z[r],z[s])
if(a<o){if(e[r]<e[s]&&!n(r,t)||n(s,t)){z[r]=Q
break}z[s]=Q}}}function l(e){return e>u?e:e<=0?e+Math.PI:e-Math.PI}function c(e,t,i){var n=e.clone().normalize(),o=new Array(3),r=new Array(6)
o[0]=d(1,0,0,n),o[1]=d(0,1,0,n),o[2]=d(0,0,1,n)
var s,c=t.clone().cross(n).normalize()
for(s=0;s<3;++s){var u=o[s]
r[s]=u.length(),r[s]<J?z[s]=Q:(u.multiplyScalar(1/r[s]),z[s]=Math.atan2(c.dot(u),t.dot(u)))}for(z[3]=l(z[0]),z[4]=l(z[1]),z[5]=l(z[2]),r[3]=r[0],r[4]=r[1],r[5]=r[2],a(r,i),s=0;s<6;++s)if(z[s]!==Q){var h=x.set(0,0,1)
P.setFromAxisAngle(h,z[s])
var p=x.set(0,.54,0)
p.applyQuaternion(P),F[s].position.copy(p),F[s].visible=!0}else F[s].visible=!1}function p(){H=new THREE.Object3D
var e=new THREE.RingGeometry(.5-.01*V,.5,60),t=new THREE.Mesh(e,S)
D=t
var i=.007*V,n=new THREE.BoxGeometry(.93,i,i),o=new THREE.BoxGeometry(i,.93,i),r=new THREE.BoxGeometry(i,i,.93)
N=new THREE.Mesh(n,S),_=new THREE.Mesh(o,S),O=new THREE.Mesh(r,S),H.add(N),H.add(_),H.add(O),B=new THREE.Mesh(new THREE.CircleGeometry(.005),S),H.add(B),F=new Array(6),G=new Array(6)
for(var s=0;s<6;++s){var a=.005*V,l=.0025*V
F[s]=new THREE.Mesh(new THREE.CircleGeometry(a,16),S),G[s]=new THREE.Mesh(new THREE.CircleGeometry(l,16),S),G[s].visible=!1,F[s].add(G[s]),t.add(F[s])}return H.add(t),H}function m(e,t,i,n,o){return H||(H=p()),s.orient(D,t,k.position,n),c(i,o,n),H.scale.x=e,H.scale.y=e,H.scale.z=e,H.position.copy(t),H}function g(e){if(R.set(0,0,0),e>=0){var t=e>=3?-1:1
e%=3,0===e&&(R.x=t),1===e&&(R.y=t),2===e&&(R.z=t)}return j&&R.multiplyScalar(-1),R}function f(e,t){for(var n=i(z[0],e),o=0,r=1;r<6;++r){var s=i(z[r],e)
s<n&&(n=s,o=r)}return U=n,n<t?o:-1}function v(e){s.setWorldUpVector(e,!0)}function E(e){if(0!==e){var t=30*Math.PI/180,i=x.copy(k.position).sub(L).normalize()
P.setFromAxisAngle(i,e)
var n=s.getWorldUpVector(),o=Math.abs(i.angleTo(n));(o<t||Math.PI-o<t)&&n.copy(s.getCameraUpVector()),n.applyQuaternion(P),v(n)}}function y(){if(!Y){var e=f(W,q)
if(e>=0)return U=0,Y=!0,W=z[e],g(e)}return!1}function A(){if(Y){if(f(W,K)<0)return Y=!1,!0
U=0}return!1}function T(e,t,i,n){if(e<t)return g(i).distanceToSquared(n)<h
return!1}function b(e,t){e.dot(t)<0&&(t=t.clone().multiplyScalar(-1)),s.orient(B,L,k.position,t),B.position.copy(t.multiplyScalar(.495))
for(var n=!1,o=Y?K:q,r=0;r<6;++r){var a=i(z[r],W),l=T(a,o,r,e)
l&&(n=!0)
var c=l?4:3*(1-3*a/Math.PI)
c<1&&(c=1),c*=V,G[r].visible=l
var d=F[r]
d.scale.x=c,d.scale.y=c,d.scale.z=c}return N.visible=n,_.visible=n,O.visible=n,n}function w(e){W+=e,W>Math.PI?W-=u:W<=-Math.PI&&(W=u+W)
var t=y()
if(t)X=W,v(t)
else if(A()){var i=W-X
E(i),X=0}else{if(Y)return!1
E(e)}return!0}var C=2*Math.tan(THREE.Math.degToRad(15)),S=new THREE.MeshPhongMaterial({color:12303291,ambient:12303291,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),R=new THREE.Vector3,x=new THREE.Vector3,P=new THREE.Quaternion,k=new THREE.PerspectiveCamera(30,t.aspect,t.near,t.far),M=t,V=1,I=1,L=null,D=null,N=null,_=null,O=null,H=null,B=null,F=null,G=null,z=new Array(6),U=0,W=0,j=!1,Y=!0,X=0,q=5*Math.PI/180,K=7*Math.PI/180,Z=1,Q=1e3,J=.1
e.createOverlayScene("roll",null,null,k),this.updateRollCamera=function(e,t){k.position.copy(M.position),k.quaternion.copy(M.quaternion),k.up.copy(M.up),k.aspect=M.aspect,e&&t&&(k.near=t-e,k.far=t+e),k.updateProjectionMatrix()},this.isSnapped=function(){return Y},this.resize=function(){var e=Z*C,t=e*M.aspect,i=(M.aspect<1?t:e)*I
H.scale.x=i,H.scale.y=i,H.scale.z=i},this.start=function(t,i){this.updateHUD(t,i),e.addOverlay("roll",H)},this.updateHUD=function(e,t){L=e,t<o?t=o:t>r&&(t=r),I=t,V=r/t
var i=R.copy(e).sub(M.position)
Z=i.length()
var n=Z*C,a=n*M.aspect,l=(M.aspect<1?a:n)*t
this.updateRollCamera(l,Z)
var c=s.getWorldUpVector(),d=s.getCameraUpVector()
m(l,e,i,c,d),W=0,X=0
var u=c.dot(d)
j=u<0,Y=b(c,d)},this.handleRoll=function(e,t,i){if(this.updateRollCamera(),b(s.getWorldUpVector(),s.getCameraUpVector()),0!==e||0!==t){var n=i.x-e-.5,o=i.y-t-.5,r=i.x-.5,a=i.y-.5
return w(Math.atan2(a,r)-Math.atan2(o,n))}return!1},this.handleRollTouch=function(e){this.updateRollCamera(),b(s.getWorldUpVector(),s.getCameraUpVector())
var t=e-W
return Math.abs(t)>.001&&w(t)},this.end=function(){e.removeOverlay("roll",H)}}function n(e){var t=e.pointers[1].clientX-e.pointers[0].clientX,i=e.pointers[1].clientY-e.pointers[0].clientY,n=Math.sqrt(t*t+i*i),o=s.getScreenViewport()
return n/Math.min(o.width,o.height)}var o=.35,r=.8,s=t.navigation,a=s.getCamera(),l=["worldup"],c=this,d=function(){var e=new THREE.Vector3
return function(t,i,n,o){var r=new THREE.Vector3(t,i,n),s=o.dot(r)
return e.copy(o),e.multiplyScalar(s),r.sub(e)}}(),u=2*Math.PI,h=1e-5,p=!1,m=!1,g=!1,f=new i(e,a),v=new THREE.Vector3,E=new THREE.Vector3,y=new THREE.Vector3,A=null,T=0,b={x:.5,y:.5},w=1
this.getNames=function(){return l},this.getName=function(){return l[0]},this.activate=function(e){t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),g=!1},this.deactivate=function(e){f.end(),t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),this.utilities.restorePivot(),A=null,p=!1,g=!1},this.getCursor=function(){return"auto"},this.getMotionDelta=function(e){var t=E.x-v.x,i=E.y-v.y,n=E.z-v.z
Math.abs(t)<.001&&(t=0),Math.abs(i)<.001&&(i=0),Math.abs(n)<.001&&(n=0),e.set(t,i,n)},this.stepMotionDelta=function(){v.copy(E)},this.update=function(){if(!g){var e=s.getEyeVector(),t=.5*(a.near+a.far)
e.normalize().multiplyScalar(t)
var i=e.add(a.position)
this.utilities.savePivot(),this.utilities.setPivotPoint(i,!0,!0),this.utilities.pivotActive(!0)
f.start(i,.65),g=!0}var n=m
this.getMotionDelta(y)
var o=y.x,r=y.y,l=y.z
return(m||"roll"===A||p&&(0!==o||0!==r||0!==l))&&(m="roll"===A?f.handleRollTouch(T):f.handleRoll(o,r,E)),this.stepMotionDelta(),a.dirty&&(n=!0),n},this.handleResize=function(){f.resize(),m=!0},this.handleGesture=function(e){switch(e.type){case"dragstart":return A="drag",this.handleButtonDown(e,0)
case"dragmove":return this.handleMouseMove(e)
case"dragend":return A=null,this.handleButtonUp(e,0)
case"rotatestart":return t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),A="roll",T=THREE.Math.degToRad(e.rotation),b={x:.5*(e.normalizedX+1),y:1-.5*(e.normalizedY+1)},w=n(e),!0
case"rotatemove":return T=THREE.Math.degToRad(e.rotation),"roll"===A
case"rotateend":return t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),T=THREE.Math.degToRad(e.rotation),A=null,!1}return!1},this.handleWheelInput=function(e){return!0},this.handleCameraChange=function(){var e=s.getEyeVector(),t=.5*(a.near+a.far)
e.normalize().multiplyScalar(t)
var i=e.add(a.position)
f.updateHUD(i,.65)},this.handleButtonDown=function(e,i){return v.x=.5*(e.normalizedX+1),v.y=1-.5*(e.normalizedY+1),E.copy(v),p=!0,A=null,this.controller.setIsLocked(!0),t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c.handleCameraChange),!0},this.handleButtonUp=function(e,i){return E.x=.5*(e.normalizedX+1),E.y=1-.5*(e.normalizedY+1),p=!1,m=!0,this.controller.setIsLocked(!1),t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c.handleCameraChange),!0},this.handleMouseMove=function(e){return E.x=.5*(e.normalizedX+1),E.y=1-.5*(e.normalizedY+1),!0},this.handleBlur=function(e){return p=!1,A=null,!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.ToolInterface=function(){this.names=["unnamed"],this.getNames=function(){return this.names},this.getName=function(){return this.names[0]},this.register=function(){},this.deregister=function(){},this.activate=function(e,t){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){return!1},this.handleGesture=function(e){return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}},function(){"use strict"
function e(e,t){function o(){return t.getData().instanceTree}function r(){return t.getData().instanceTree||t.getData().fragmentMap}function s(i){var n=o()
if(p[i]>0)0==--p[i]&&e.highlightObjectNode(t,i,!1)
else if(p[i]<0)throw"Selection State machine broken. Negatively selected object!"
n&&n.enumNodeChildren(i,function(e){s(e)},!1)}function a(i,n){var r=o()
p[i]?p[i]++:(e.highlightObjectNode(t,i,!0,n),p[i]=1),r&&r.enumNodeChildren(i,function(e){a(e,!0)},!1)}function l(e){if(void 0!==e&&h.selectedObjectIds[e])return!0}function c(e){var t=o()
if(!t||(e=t.findNodeForSelection(e,h.selectionMode),t.isNodeSelectable(e))){l(e)||(h.selectedObjectIds[e]=e,h.selectionCount++,a(e))}}function d(e){l(e)&&(s(e),h.selectedObjectIds[e]=0,h.selectionCount--)}function u(e){if(h.selectionCount!==e.length)return!1
for(var t=0;t<e.length;t++)if(!l(e[t]))return!1
return!0}var h=this
this.selectedObjectIds={},this.selectionCount=0,this.selectionMode=i.SelectionMode.LEAF_OBJECT
var p={}
this.getInstanceTree=o,this.getFragmentMap=r,this.getSelectionLength=function(){return h.selectionCount},this.getSelection=function(){var e=[],t=h.selectedObjectIds
for(var i in t)if(t[i]){var n=parseInt(i)
e.push(n)}return e},this.clearSelection=function(e){if(this.selectionCount>0){var t=h.selectedObjectIds
for(var i in t){var n=parseInt(i)
void 0!==n&&s(n)}h.selectedObjectIds={},h.selectionCount=0}},this.deselectInvisible=function(){var i=!1,n=h.selectedObjectIds,o=e.visibilityManager
for(var r in n){var s=parseInt(r)
s&&!o.isNodeVisible(t,s)&&(d(s),i=!0)}return i},this.toggleSelection=function(e){if(!e)return void n.logger.error("Attempting to select node 0.",i.errorCodeString(i.ErrorCodes.VIEWER_INTERNAL_ERROR))
l(e)?d(e):c(e)},this.setSelectionMode=function(e){this.clearSelection(!0),this.selectionMode=e},this.setSelection=function(e){if(!u(e)&&(this.clearSelection(!0),null!=e&&0!==e.length))for(var t=0;t<e.length;t++)c(e[t])},this.getSelectionBounds=function(){var e=new THREE.Box3,i=new THREE.Box3,n=r()
if(n){var o=t.getFragmentList(),s=h.selectedObjectIds
for(var a in s){var l=parseInt(a)
n.enumNodeFragments(l,function(t){o.getWorldBounds(t,i),e.union(i)},!0)}}return e},this.getSelectionVisibility=function(){var e=!1,i=!1,n=h.selectedObjectIds
for(var o in n){var s=parseInt(o)
if(s){var a=r()
if(a&&a.isNodeHidden(s)?i=!0:e=!0,e&&i)break}}return{hasVisible:e,hasHidden:i,model:t}},this.dtor=function(){this.selectedObjectIds=null}}function t(t){function o(){a.length>1&&n.logger.warn("This selection call does not yet support multiple models.")}function r(){for(var e=[],n=0;n<a.length;n++){var o=[],r=[],s=a[n].selector.selectedObjectIds,l=a[n].selector.getFragmentMap()
for(var c in s)if(s[c]){var d=parseInt(c)
d&&(o.push(d),l&&l.enumNodeFragments(d,function(e){r.push(e)},!1))}o.length&&e.push({fragIdsArray:r,dbIdArray:o,nodeArray:o,model:a[n]})}var u
1===a.length&&(u={type:i.SELECTION_CHANGED_EVENT,fragIdsArray:e[0]?e[0].fragIdsArray:[],dbIdArray:e[0]?e[0].dbIdArray:[],nodeArray:e[0]?e[0].dbIdArray:[],model:a[0]},t.api.fireEvent(u)),u={type:i.AGGREGATE_SELECTION_CHANGED_EVENT,selections:e},t.api.fireEvent(u)}function s(){for(var e=!1,t=0;t<a.length;t++)e=a[t].selector.deselectInvisible()||e
e&&r()}var a=[]
this.addModel=function(i){-1==a.indexOf(i)&&(i.selector=new e(t,i),a.push(i))},this.removeModel=function(e){var t=a.indexOf(e)
e.selector.getSelection()
e.selector.clearSelection(),e.selector=null,a.splice(t,1)},this.getSelectionLength=function(){for(var e=0,t=0;t<a.length;t++)e+=a[t].selector.getSelectionLength()
return e},this.getSelection=function(){return o(),a.length>1&&n.logger.warn("Use getAggregateSelection instead of getSelection when there are multiple models in the scene."),a[0].selector.getSelection()},this.getAggregateSelection=function(){for(var e=[],t=0;t<a.length;t++){var i=a[t].selector.getSelection()
i&&i.length&&e.push({model:a[t],selection:i})}return e},this.clearSelection=function(e){for(var t=0;t<a.length;t++)a[t].selector.clearSelection(e)
e||r()},this.toggleSelection=function(e,t){t||(o(),t=a[0]),t.selector.toggleSelection(e),r()},this.setSelectionMode=function(e){for(var t=0;t<a.length;t++)a[t].selector.setSelectionMode(e)},this.setSelection=function(e,t){if(e&&0!==e.length){if(t)for(var i=0;i<a.length;i++)a[i]!==t&&a[i].selector.clearSelection()
else o(),t=a[0]
t.selector.setSelection(e)}else this.clearSelection()
r()},this.getSelectionBounds=function(){if(1==a.length)return a[0].selector.getSelectionBounds()
for(var e=new THREE.Box3,t=0;t<a.length;t++){var i=a[t].selector.getSelectionBounds()
e.union(i)}return e},this.getSelectionVisibility=function(){for(var e={hasVisible:!1,hasHidden:!1,details:[]},t=0;t<a.length;t++){var i=a[t].selector.getSelectionVisibility()
e.hasVisible=e.hasVisible||i.hasVisible,e.hasHidden=e.hasHidden||i.hasHidden,e.details.push(i)}return e},this.dtor=function(){for(var e=0;e<a.length;e++)a[e].selector.dtor()},t.api.addEventListener(i.ISOLATE_EVENT,function(e){s()}),t.api.addEventListener(i.HIDE_EVENT,function(e){s()})}var i=Autodesk.Viewing,n=i.Private
n.Selector=e,n.MultiModelSelector=t}(),function(){"use strict"
function e(e){this.viewer=e,this.models=[]}var t=Autodesk.Viewing,i=t.Private,n=function(e,t){this.viewerImpl=e,this.model=t,this.isolatedNodes=[],this.hiddenNodes=[]}
n.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null},n.prototype.getFragmentMap=function(){return this.model?this.model.getData().instanceTree||this.model.getData().fragmentMap:null},n.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)},n.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)},n.prototype.setAllVisibility=function(e){var t=this.model?this.model.getRootId():null
t&&this.setVisibilityOnNode(t,e),this.model.getData().is2d&&this.model.setAllVisibility(e)},n.prototype.isNodeVisible=function(e){var t=this.getInstanceTree()
return t?!t.isNodeHidden(e):-1==this.hiddenNodes.indexOf(e)&&(0==this.isolatedNodes.length||-1!=this.isolatedNodes.indexOf(e))},n.prototype.isolate=function(e){var t=this.getInstanceTree(),i=t?t.getRootId():null,n="number"==typeof e&&e===i||"object"==typeof e&&e.dbId===i
e&&!n?this.isolateMultiple(Array.isArray(e)?e:[e]):this.isolateNone()},n.prototype.isolateNone=function(){this.model.setAllVisibility(!0),this.viewerImpl.sceneUpdated(!0),this.setAllVisibility(!0),this.hiddenNodes=[],this.isolatedNodes=[],this.viewerImpl.invalidate(!0)
var e={type:t.ISOLATE_EVENT,nodeIdArray:[],model:this.model}
this.viewerImpl.api.fireEvent(e)},n.prototype.isolateMultiple=function(e){if(e&&0!=e.length){this.setAllVisibility(!1),this.model.getData().is2d||(this.model.setAllVisibility(!1),this.viewerImpl.sceneUpdated(!0)),this.isolatedNodes=e.slice(0),this.hiddenNodes=[]
for(var i=0;i<e.length;i++)this.setVisibilityOnNode(e[i],!0)
var n={type:t.ISOLATE_EVENT,nodeIdArray:e,model:this.model}
this.viewerImpl.api.fireEvent(n)}else this.isolateNone()
this.viewerImpl.invalidate(!0)},n.prototype.hide=function(e){var i
if(Array.isArray(e)){for(var n=0;n<e.length;++n)this.setVisibilityOnNode(e[n],!1)
e.length>0&&(i={type:t.HIDE_EVENT,nodeIdArray:e,model:this.model})}else this.setVisibilityOnNode(e,!1),i={type:t.HIDE_EVENT,nodeIdArray:[e],model:this.model}
i&&this.viewerImpl.api.fireEvent(i)},n.prototype.show=function(e){var i
if(Array.isArray(e)){for(var n=0;n<e.length;++n)this.setVisibilityOnNode(e[n],!0)
e.length>0&&(i={type:t.SHOW_EVENT,nodeIdArray:e,model:this.model})}else this.setVisibilityOnNode(e,!0),i={type:t.SHOW_EVENT,nodeIdArray:[e],model:this.model}
i&&this.viewerImpl.api.fireEvent(i)},n.prototype.toggleVisibility=function(e){var i=this.getFragmentMap().isNodeHidden(e)
this.setVisibilityOnNode(e,i)
var n={type:i?t.SHOW_EVENT:t.HIDE_EVENT,nodeIdArray:[e],model:this.model}
this.viewerImpl.api.fireEvent(n)},n.prototype.setVisibilityOnNode=function(e,t){var i=this.viewerImpl,n=this.model,o=this.getFragmentMap(),r=!t,s=n.getData().is2d
this.viewerImpl.matman()
o?o.enumNodeChildren(e,function(e){o.setNodeHidden(e,r),s?n.getFragmentList().setObject2DGhosted(e,!t):o.enumNodeFragments(e,function(e){n.setVisibility(e,t)},!1)},!0):s?n.getFragmentList().setObject2DGhosted(e,!t):n.setVisibility(e,t),i.sceneUpdated(!0),this.updateNodeVisibilityTracking(e,t)},n.prototype.updateNodeVisibilityTracking=function(e,t){var i=t
if(this.isolatedNodes.length>0){var n=this.isolatedNodes.indexOf(e)
i&&-1===n?this.isolatedNodes.push(e):i||-1===n||this.isolatedNodes.splice(n,1)}else{var o=this.hiddenNodes.indexOf(e)
i||-1!==o?i&&-1!==o&&this.hiddenNodes.splice(o,1):this.hiddenNodes.push(e)}var r=this.getInstanceTree()
r&&r.root&&r.root.dbId===e&&(t?(this.isolatedNodes=[],this.hiddenNodes=[]):(this.isolatedNodes=[],this.hiddenNodes=[e]))},n.prototype.setNodeOff=function(e,t){var i=this.viewerImpl,n=this.model,o=this.getFragmentMap(),r=n.getData().is2d
o?o.enumNodeChildren(e,function(e){o.setNodeOff(e,t),r?n.getFragmentList().setObject2DVisible(e,!t):o.enumNodeFragments(e,function(e){n.getFragmentList().setFragOff(e,t)},!1)},!0):r?n.getFragmentList().setObject2DVisible(e,!t):n.getFragmentList().setFragOff(e,t),i.sceneUpdated(!0)},t.Private.VisibilityManager=n,e.prototype.addModel=function(e){-1==this.models.indexOf(e)&&(e.visibilityManager=new n(this.viewer,e),this.models.push(e))},e.prototype.removeModel=function(e){var t=this.models.indexOf(e)
e.visibilityManager.isolateNone(),e.visibilityManager=null,this.models.splice(t,1)},e.prototype.warn=function(){this.models.length>1&&i.logger.warn("This selection call does not yet support multiple models.")},e.prototype.getIsolatedNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getIsolatedNodes()},e.prototype.getHiddenNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getHiddenNodes()},e.prototype.isNodeVisible=function(e,t){return e||(this.warn(),e=this.models[0]),e.visibilityManager.isNodeVisible(t)},e.prototype.isolate=function(e,t){(t?[t]:this.models).forEach(function(t){t.visibilityManager.isolate(e)})},e.prototype.hide=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.hide(e)},e.prototype.show=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.show(e)},e.prototype.toggleVisibility=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.toggleVisibility(e)},e.prototype.setVisibilityOnNode=function(e,t,i){i||(this.warn(),i=this.models[0]),i.visibilityManager.setVisibilityOnNode(e,t)},e.prototype.setNodeOff=function(e,t,i){i||(this.warn(),i=this.models[0]),i.visibilityManager.setNodeOff(e,t)},t.Private.MultiModelVisibilityManager=e}()
var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,LMV_WORKER_URL=avp.LMV_WORKER_URL||"src/workers/MainWorker-web.js",ENABLE_INLINE_WORKER=avp.ENABLE_INLINE_WORKER||!1
!function(){"use strict"
var e=null,t=!1,i=[]
avp.clearWorkerDataURL=function(){e=null},avp.initWorkerScript=function(n,o){if(ENABLE_INLINE_WORKER&&!e){if(i.push({successCB:n}),t)return
var r=new XMLHttpRequest,s=LMV_WORKER_URL,a=avp.getResourceUrl(LMV_WORKER_URL)
a&&(s=a),r.open("GET",s,!0),r.withCredentials=!1,r.onload=function(){t=!1
var n
window.URL=window.URL||window.webkitURL
try{n=new Blob([r.responseText],{type:"application/javascript"})}catch(e){n=new BlobBuilder,n.append(r.responseText),n=n.getBlob()}e=URL.createObjectURL(n)
var o=i.concat()
i=[]
for(var s=0;s<o.length;++s)o[s].successCB&&o[s].successCB()},t=!0,r.send()
var l={}
return l.cancel=function(){var e=-1
return!!i.some(function(t,i){return t.successCB==n&&(e=i,!0)})&&(i.splice(e,1),!0)},l}return n&&n(),null},avp.createWorker=function(){var t
return t=ENABLE_INLINE_WORKER?new Worker(e):new Worker(avp.getResourceUrl(LMV_WORKER_URL)),t.doOperation=t.postMessage,t},avp.createWorkerWithIntercept=function(){function e(e){if(!i)return null
for(var t=0;t<i.length;++t)if(i[t].arg===e){var n=i[t].callback
return i.splice(t,1),0===i.length&&(i=null),n}return null}var t=avp.createWorker()
t.checkEvent=function(e){return!(!e.data||!e.data.assetRequest)&&(avp.assets&&avp.assets.push(e.data.assetRequest),!0)}
var i=[]
return t.addEventListenerWithIntercept=function(e){var n=function(i){t.checkEvent(i)||e(i)}
return i||(i=[]),i.push({arg:e,callback:n}),t.addEventListener("message",n,!1),n},t.removeEventListenerWithIntercept=function(i){var n=e(i)
n&&t.removeEventListener("message",n,!1)},t.clearAllEventListenerWithIntercept=function(){if(i)for(var e=i.concat(),n=0;n<e.length;++n)t.removeEventListenerWithIntercept(e[n].arg)},t}}(),function(){"use strict"
function e(e){var t=e.data
if(t&&t.debug)return void r.logger.debug(t.message)
if(t.cbId){var i=l[t.cbId]
t&&t.error?i[1]&&i[1](t.error):i[0]&&i[0](t.result),delete l[t.cbId]}}function t(e,t){var i=a++
return l[i]=[e,t],i}function i(){n&&n.doOperation({operation:s,clearCaches:!0})}var n,o=Autodesk.Viewing,r=o.Private,s="UNLOAD_PROPERTYDB",a=1,l={},c=function(e,t,i){if(this.eventTarget=i||new o.EventDispatcher,this.model=t,this.svf=t&&t.getData(),this.dbPath="",this.sharedDbPath=!1,this.svf&&this.svf.propertydb&&this.svf.propertydb.avs.length){this.dbFiles=this.svf.propertydb
for(var n in this.dbFiles)this.dbFiles[n][0]=this.dbFiles[n][0]&&this.dbFiles[n][0].replace(/\\/g,"/")
var s=r.pathToURL(this.svf.basePath)
if(e){var a=r.ViewingService.simplifyPath(s+this.svf.propertydb.avs[0])
if((a=a.slice(0,a.lastIndexOf("/")+1))===e){var l={}
for(var n in this.dbFiles){var c=this.dbFiles[n][0]
c=r.ViewingService.simplifyPath(s+c),l[n]=[c]}this.dbFiles=l,this.dbPath=e,this.sharedDbPath=!0}else this.dbPath=s,this.sharedDbPath=!1}else this.dbPath=s,this.sharedDbPath=!1}else this.sharedDbPath=!0,this.dbPath=e,this.dbFiles={attrs:[],avs:[],ids:[],values:[],offsets:[]},r.logger.log("Using shared db path "+e)
this.queryParams="",this.svf&&this.svf.acmSessionId&&(this.queryParams="acmsession="+this.svf.acmSessionId)}
c.prototype.dtor=function(){this.asyncPropertyOperation({operation:s},function(){},function(){})},c.prototype.processLoadResult=function(e){var t=this
if(e.instanceTreeStorage){var i=new r.InstanceTreeAccess(e.instanceTreeStorage,e.rootId,e.instanceBoxes)
t.instanceTree=new r.InstanceTree(i,e.objectCount,e.maxTreeDepth),t.svf&&(t.svf.instanceTree=t.instanceTree)}else e.instanceTree?(r.logger.warn("glTF instance tree not supported"),t.hasObjectProperties=e.objectCount):e.objectCount&&(t.hasObjectProperties=e.objectCount,t.svf&&(t.svf.hasObjectProperties=e.objectCount))
t.eventTarget.fireEvent({type:o.OBJECT_TREE_CREATED_EVENT,svf:t.svf,model:t.model,target:t})},c.prototype.processLoadError=function(e){var t=this
t.propertyDbError=e,t.eventTarget.fireEvent({type:o.OBJECT_TREE_UNAVAILABLE_EVENT,svf:t.svf,model:t.model,target:t})},c.prototype.load=function(){var i=this
if(this.svf&&this.svf.instanceTree&&this.svf.instanceBoxes)return void setTimeout(function(){i.processLoadResult(i.svf)},0)
n||(n=r.createWorkerWithIntercept(),n.addEventListenerWithIntercept(e)),this.propWorker=n
var o=function(e){i.processLoadResult(e)},s=function(e){i.processLoadError(e)},a=t(o,s),l=this.model.loader.options,c={operation:"LOAD_PROPERTYDB",dbPath:this.dbPath,sharedDbPath:this.sharedDbPath,propertydb:this.dbFiles,fragToDbId:this.svf&&this.svf.fragments.fragId2dbId,fragBoxes:this.svf&&this.svf.fragments.boxes,headers:l.svfHeaders,cbId:a,queryParams:this.queryParams}
n.doOperation(r.initLoadContext(c))},c.prototype.asyncPropertyOperation=function(e,i,r){var s=this
if(e.dbPath=this.dbPath,s.instanceTree||s.hasObjectProperties)e.cbId=t(i,r),n.doOperation(e)
else if(s.propertyDbError)r&&r(s.propertyDbError)
else{var a=function(t){s.eventTarget.removeEventListener(o.OBJECT_TREE_CREATED_EVENT,a),s.eventTarget.removeEventListener(o.OBJECT_TREE_UNAVAILABLE_EVENT,a),s.instanceTree||s.hasObjectProperties||s.propertyDbError?s.asyncPropertyOperation(e,i,r):r&&r({code:o.UNKNOWN_FAILURE,msg:"Failed to load properties"})}
s.eventTarget.addEventListener(o.OBJECT_TREE_CREATED_EVENT,a),s.eventTarget.addEventListener(o.OBJECT_TREE_UNAVAILABLE_EVENT,a)}},c.prototype.getProperties=function(e,t,i){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbId:e},t,i)},c.prototype.getBulkProperties=function(e,t,i,n,o){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbIds:e,propFilter:t,ignoreHidden:o},i,n)},c.prototype.searchProperties=function(e,t,i,n,o){this.asyncPropertyOperation({operation:"SEARCH_PROPERTIES",searchText:e,attributeNames:t,completeInfo:o},i,n)},c.prototype.getExternalIdMapping=function(e,t){this.asyncPropertyOperation({operation:"BUILD_EXTERNAL_ID_MAPPING"},e,t)},c.prototype.isObjectTreeLoaded=function(){return!!this.instanceTree},c.prototype.getObjectTree=function(e,t){var i=this
if(i.instanceTree)e(i.instanceTree)
else if(i.propertyDbError)t&&t(i.propertyDbError)
else if("hasObjectProperties"in i)t&&t("F2D files do not have an InstanceTree.")
else{var n=function(){i.eventTarget.removeEventListener(o.OBJECT_TREE_CREATED_EVENT,n),i.eventTarget.removeEventListener(o.OBJECT_TREE_UNAVAILABLE_EVENT,n),i.getObjectTree(e,t)}
i.eventTarget.addEventListener(o.OBJECT_TREE_CREATED_EVENT,n),i.eventTarget.addEventListener(o.OBJECT_TREE_UNAVAILABLE_EVENT,n)}},r.PropDbLoader=c,r.clearPropertyWorkerCache=i}(),function(){"use strict"
function e(e){var t=e.width,i=e.height
if(0==(t&t-1)&&0==(i&i-1))return e
for(var n=1;2*n<t;)n*=2
for(var o=1;2*o<i;)o*=2
var r=document.createElement("canvas"),s=r.getContext("2d")
return r.width=n,r.height=o,r.wasNPOT=!0,s.drawImage(e,0,0,n,o),r}function t(e){return e.format===THREE.AlphaFormat||e.format===THREE.RGBAFormat}function i(e){return e.clampS||e.clampT}function n(e){return e.minFilter!==THREE.NearestFilter&&e.minFilter!==THREE.LinearFilter}function o(e){!0===e.image.wasNPOT&&t(e)&&i(e)&&n(e)&&g.isChrome()&&g.isWindows()&&(e.minFilter=THREE.LinearFilter,e.generateMipmaps=!1,e.needsUpdate=!0)}function r(t,i,n,o,r){if(g.getUseCredentials()){var s=-1===t.indexOf("://")||-1!==t.indexOf(window.location.host)||f.urlIsApiViewingOrDev(t)
THREE.ImageUtils.crossOrigin=s?"use-credentials":"anonymous"}else THREE.ImageUtils.crossOrigin=""
if(-1!==t.indexOf("urn:")){var a=f.getDomainParam()
o&&(a&&(a+="&"),a+="acmsession="+o),a&&(t+="?"+a)}var d=function(t){v--,r||(t.image=e(t.image)),n(t)},u=function(e){v--,n(e)},h=function(e){v--,f.logger.error("Texture load error",e)}
if(v++,g.isNodeJS)return c(t,i,u)
if(".dds"===t.slice(t.length-4).toLocaleLowerCase()){if(g.isIOSDevice()){var p=t.slice(0,t.length-4)+".pvr"
return(new THREE.PVRLoader).load(p,u,h)}return(new THREE.DDSLoader).load(t,u,h)}return s?l(t,i,d):THREE.ImageUtils.loadTexture(t,i,d,h)}function s(e){for(var t="",i=new Uint8Array(e),n=i.byteLength,o=0;o<n;o++)t+=String.fromCharCode(i[o])
return"data:image/jpeg;base64,"+window.btoa(t)}function a(e,t,i){v--
var n="Error: "+e+" ("+t+")"
f.logger.error(n,g.errorCodeString(g.ErrorCodes.NETWORK_SERVER_ERROR))}function l(e,t,i){function n(e){var t=new Image
r.image=t,o(r),t.onload=function(){r.needsUpdate=!0,i&&i(r)},t.onerror=function(e){f.logger.error(e,g.errorCodeString(g.ErrorCodes.UNKNOWN_FAILURE))},t.src=s(e)}var r=new THREE.Texture(void 0,t)
return f.ViewingService.getItem(f.initLoadContext(),e,n,a),r}function c(e,t,i){function n(e){r.image={data:e,width:void 0,height:void 0},o(r),r.needsUpdate=!0,i&&i(r)}var r=new THREE.DataTexture(void 0,t)
return f.ViewingService.getItem(f.initLoadContext(),e,n,a),r}function d(e,t,i,n){var o=i.getData()
return r(function(e,t,i){var n=null,r=e.proteinType,s=e.isPrismMaterial&&e.prismType,a=(s&&PRISM_ROOT||r&&PROTEIN_ROOT)&&(0===t.uri.indexOf("1/Mats")||0===t.uri.indexOf("2/Mats")||0===t.uri.indexOf("3/Mats"))
if(a)n=s?PRISM_ROOT+t.uri:PROTEIN_ROOT+t.uri
else{for(var l=0;l<o.manifest.assets.length;++l){var c=o.manifest.assets[l]
if(c.id.toLowerCase()==t.uri.toLowerCase()){n=f.pathToURL(o.basePath+c.URI)
break}}n||(n=f.pathToURL(o.basePath+t.uri))}return{path:n,isShared:a}}(e,t).path,THREE.UVMapping,n,o.acmSessionId)}function u(){return v}function h(e,t,i){if(t.textureMaps&&!t.texturesLoaded){t.texturesLoaded=!0
var n=e.getData(),o=t.textureMaps
for(var r in o){var s=o[r]
if(!i.matman().loadTextureFromCache(e,t,s,r)){var a=d(t,s,e,function(t){return function(o){var r=i.matman()
r&&(r.setTextureInCache(e,t,o),n.loadOptions.onTextureReceived&&n.loadOptions.onTextureReceived(r,t,o,!u()),!u()&&i&&n.loadDone&&!n.texLoadDone&&(n.texLoadDone=!0,i.onTextureLoadComplete(e)))}}(s)),l=n.materials.scene.SceneUnit,c=i.renderer()?i.renderer().getMaxAnisotropy():0
f.MaterialConverter.convertTexture(s,a,l,c)}}}}function p(e,t){var i=t.matman(),n=i._getModelHash(e)
for(var o in i._materials)if(-1!=o.indexOf(n)){var r=i._materials[o]
h(e,r,t)}var s=e.getData()
!u()&&t&&s.loadDone&&!s.texLoadDone&&(s.texLoadDone=!0,t.onTextureLoadComplete(e))}function m(e,t,i){var n,o=function(n){n?(n.mapping=THREE.CubeReflectionMapping,n.LogLuv=-1!==e.indexOf("logluv"),n.RGBM=-1!==e.indexOf("rgbm"),f.DecodeEnvMap(n,t,!1,i)):i&&i(n)}
return THREE.ImageUtils.crossOrigin="",Array.isArray(e)?(n=THREE.ImageUtils.loadTextureCube(e,THREE.CubeReflectionMapping,o),n.format=THREE.RGBFormat):"string"==typeof e?-1!==e.toLowerCase().indexOf(".dds")?n=(new THREE.DDSLoader).load(e,o):(n=THREE.ImageUtils.loadTexture(e,THREE.SphericalReflectionMapping,i),n.format=THREE.RGBFormat):e?i&&i(e):i&&i(null),n}var g=Autodesk.Viewing,f=g.Private,v=0
f.TextureLoader={loadTextureWithSecurity:r,loadModelTextures:p,loadMaterialTextures:h,loadCubeMap:m}}(),function(){"use strict"
var e=Autodesk.Viewing,t=e.Private,i=2,n=1048576,o=function(o,r){function s(e,t,i,o,r,s){function a(e,t,i){var n=null
if(t){var o=i-1
y=y+o&~o
var r=t.length
n=new e(E,y,r),n.set(t),y+=r*i}return n}var c,d=0,u=0,h=[],p=s.inMemory,m=!1,g=0,f=t.geoms
if(!i&&s.travsed>=s.currentCount)return 0
var v
for(v=0;v<s.totalCount;++v)!function(n){if(p[n>>5]&1<<(31&n)){var s=t.fragments.mesh2frag[e+":"+n]
Array.isArray(s)&&(s=s[0])
var a=f.geoms[t.getGeometryId(s)]
if(a&&a.packId==e){var v=a.vb.buffer===a.ib.buffer?a.vb.buffer.byteLength>a.vb.byteLength+a.ib.byteLength:a.vb.buffer.byteLength>a.vb.byteLength||a.ib.buffer.byteLength>a.ib.byteLength;(i||a.traversed!=o&&a.transparent!=r)&&(c=f.removeGeometry(a.svfid,l.viewer3DImpl.glrenderer()))>0?(u+=c,p[a.meshIndex>>5]&=~(1<<(31&a.meshIndex)),m=m||v):(++g,v&&(d+=a.vb.byteLength,d+=a.ib.byteLength+3&-4,h.push(a)))}else console.error("Mismapped or missing geometry %d:%d",e,n)}}(v)
if(s.currentCount=g,s.culled=0,0==u)return 0
if(u/=n,0==h.length||!m)return u
var E=new ArrayBuffer(d),y=0
return h.forEach(function(e){e.vb=a(Float32Array,e.vb,4),e.ib=a(Uint16Array,e.ib,2)}),u}var a=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},l=o
this.options={onDemandLoading:!1,pageOutGeometryEnabled:!1},a(this.options,r),this.options.debug={maxPageOutSize:195,pixelCullingEnable:this.options.onDemandLoading,pixelCullingThreshold:WGS.PIXEL_CULLING_THRESHOLD,occlusionThreshold:1,occlusionTestThreshold:1,startOcclusionTestingPackCount:8,testPackfileCount:4,useOcclusionInstancing:!0,automaticRefresh:!0,boxProxyMaxCount:0,boxProxyMinScreen:.4},a(this.options.debug,r.debug),this.reachLimit=!1,this.geomidsmap={},this.geomTravCount=[],this.loadedPacks={},this.loadedPackfileCount=0,this.memoryOverhead=0,this.loadingPacks={},this.loadingPacksSize=0,this.queuedPacks=[],this.packQueuedMap={},this.queuedPacksSize=0,this.occludedPacks=[],this.occlusionCulledCount=0,this.packsPagedOut=0,this.traversedCounter=0,this.transparentCounter=0,this.resetCount=0,this.invalidateCount=-1,this.geompacks=l.svf.geompacks,this.geommap=l.geommap,this.totalGeomSize=this.options.totalGeomSize,this.overheadSize=this.options.overheadSize,this.minMemoryLimit=Math.min(Math.max(.1*this.totalGeomSize,10),50)+this.overheadSize,this.lastPageOut=-1,this.pageOutResetCounter=-1
var c,d=!1,u=0,h=0,p=0,m=[],g=-1,f=[],v=!0,E=null,y=0,A=!0,T=!1,b=function(e){this.resetCanPageOut(!!e.debug.unloadPackFiles,0!=e.delay,!1)}.bind(this)
l.viewer3DImpl.api.addEventListener(e.LOAD_MISSING_GEOMETRY,b),this.dtor=function(){l.viewer3DImpl.api.removeEventListener(e.LOAD_MISSING_GEOMETRY,b)},this.onDemandLoadingEnabled=function(){return this.options.onDemandLoading},this.pageOutGeometryEnabled=function(){return this.options.pageOutGeometryEnabled&&this.onDemandLoadingEnabled()},this.pixelCullingEnable=function(){return this.options.debug.pixelCullingEnable},this.pixelCullingThreshold=function(){return this.options.debug.pixelCullingThreshold},this.getMemoryLimit=function(){return Math.max(this.minMemoryLimit,this.options.limit)},this.getMemoryInfo=function(){return this.onDemandLoadingEnabled()?{limit:this.options.limit,effectiveLimit:this.getMemoryLimit(),loaded:this.preparedPackFilesSize()}:null},this.getLoadedMeshes=function(e){var t=this.loadedPacks[e]
return t&&t.inMemory},this.loadPackFile=function(){return!0},this.doLoadPackFile=function(e){return!!this.onDemandLoadingEnabled()&&(!!this.loadingPacks[e]||!0!==this.occludedPacks[e]&&(this.queuedPacks.length>0||this.occlusionTesting>=1?!!this.addGeomPackMissingLastFrame(e)&&(this.loadGeometryMissingLastFrame(),!0):l.loadGeometryPackOnDemand(e,this.getLoadedMeshes(e))))},this.unloadPackFile=function(e,t,i){if(!this.onDemandLoadingEnabled())return!1
var n=l.model.getFragmentList(),o=this.loadedPacks[e]
return!!(n&&o&&n.geoms)&&(s(e,n,t,this.traversedCounter,this.transparentCounter,o),0==o.currentCount&&(delete this.loadedPacks[e],--this.loadedPackfileCount,i&&++this.packsPagedOut),!0)}
var w=function(){if(this.resetCount!=this.pageOutResetCounter)return!1
l.viewer3DImpl.invalidate(!1,!0)}.bind(this)
this.onPackFileLoaded=function(e,i,n){var o=this.geommap[e]
if(T=!1,this.loadingPacks.hasOwnProperty(e)&&(delete this.loadingPacks[e],this.loadingPacksSize-=o.geomSize+o.usize),i){var r=this.loadedPacks[e]
if(!r){var s=i.meshes.length
r=this.loadedPacks[e]={totalCount:s,travsed:0,culled:0,resetCounter:this.resetCount,geomSize:0,inMemory:new Array((s+31)/32|0)},++this.loadedPackfileCount,this.options.debug.occlusionTestThreshold>0&&0==this.occlusionTesting&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount&&(this.occlusionTesting=1)}r.geomSize+=n,r.currentCount=r.totalCount,r.inMemory.fill(-1),this.totalGeomSize+=r.geomSize-o.geomSize,this.packQueuedMap[e]&&(this.queuedPacksSize+=r.geomSize-o.geomSize),o.geomSize=r.geomSize,w()}this.loadedGeometrySize()>this.getMemoryLimit()&&t.logger.warn("More pack files being loaded than the max count: "+this.loadedGeometrySize())},this.checkLoadFinished=function(){if(!T){var e=l.pack_workers
if(e)for(var t=0;t<e.length;t++)if(0!=e[t].queued)return;(0!=this.geomPacksMissingLastFrame().length||u<m.length)&&(this.loadedGeometrySize()<this.getMemoryLimit()||A)||(T=!0,l.onDemandGeomLoadDone())}},this.doOnDemandLoadFinished=function(){this.loadGeometryMissingLastFrame(),this.checkLoadFinished()},this.onPackFileLoading=function(e){if(!this.loadingPacks.hasOwnProperty(e)){this.loadingPacks[e]=!0
var t=this.geommap[e]
this.loadingPacksSize+=t.geomSize+t.usize}},this.onProcessReceivedMesh=function(e,t){var i=e.svfid
this.onDemandLoadingEnabled()&&t>1&&null==this.geomidsmap[i]&&(this.geomidsmap[i]=this.geomTravCount.length,this.geomTravCount.push(0))},this.loadedGeometrySize=function(){return l.model.getGeometryList().geomMemory/n+this.overheadSize},this.preparedPackFilesSize=function(){return this.loadingPacksSize+this.loadedGeometrySize()},this.cancelPending=function(){this.loadingPacksSize>1/n&&(l.cancelGeometryPackLoading(),this.loadingPacks={},this.loadingPacksSize=0),this.queuedPacks.length=0,this.queuedPacksSize=0,this.packQueuedMap={},this.occlusionTesting=this.onDemandLoadingEnabled()&&this.options.debug.occlusionTestThreshold>0&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount?1:0,this.occludedPacks.length=0},this.resetIterator=function(){++this.resetCount},this.reset=function(){var e=this.loadedPacks
for(var t in e)e[t].travsed=0,e[t].culled=0
this.geomTravCount.fill(0),this.resetCount>this.invalidateCount&&(this.cancelPending(),this.resetCanPageOut(!1,!0,!0))},this.geomPacksMissingLastFrame=function(){return this.queuedPacks},this.addGeomPackMissingLastFrame=function(e){if(!this.onDemandLoadingEnabled())return!0
if(this.pageOutGeometryEnabled()&&this.loadedGeometrySize()>=this.getMemoryLimit()&&(this.reachLimit=!0),!this.packQueuedMap[e]){var t=this.geommap[e]
t&&(this.queuedPacks.push(e),this.queuedPacksSize+=t.geomSize,this.packQueuedMap[e]=!0)}return!0},this.loadGeometryMissingLastFrame=function(){var e,t=this.queuedPacks
for(e=0;e<t.length;++e){var i=t[e]
if(this.occlusionTesting>=1&&void 0===this.occludedPacks[i])break
if(!this.geommap[i].loading&&!this.occludedPacks[i]&&!l.loadGeometryPackOnDemand(i,this.getLoadedMeshes(i)))break}0!=e||T||w()
var n=this
t.splice(0,e).forEach(function(e){n.queuedPacksSize-=n.geommap[e].geomSize,delete n.packQueuedMap[e]})},this.needResumeNextFrame=function(){return d}
var C=function(e,t){var i=e>=f.length?1e10:f[e]
return(t>=f.length?1e10:f[t])-i}.bind(this.loadedPacks)
this.markVisibleGeoms=function(e){var t,i=l.model.getData().instanceTree||l.model.getData().fragmentMap
if(i&&e.visibleIdCB&&(t=e.visibleIdCB())){var n,o,r=++this.traversedCounter,s={},a=t.length,c=this.loadedPacks
for(o in c)c[o].travsed=0
for(var d=0;d<a;d+=4)n=t[d]|t[d+1]<<8|t[d+2]<<16,(n=n<<8>>8)>0&&(s[n]=1+(0|s[n]))
var u=l.model.getFragmentList(),h=0|this.options.debug.occlusionThreshold
for(o in s)n=Number(o),s[n]>=h&&i.enumNodeFragments(n,function(e){var t=u.getGeometry(e)
if(t){var i=c[t.packId]
i&&t.traversed!=r&&++i.travsed,t.traversed=r}})}},this.pageOut=function(e,n,o){d=!1
var r=WGS.PAGEOUT_SUCCESS
if(e&&this.options.debug.occlusionTestThreshold>0&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount&&(this.occlusionTesting=i),this.occlusionTest(o),!e)return r
this.pageOutResetCounter=this.resetCount
var s=this.loadedGeometrySize()
if(A=!0,s&&(this.reachLimit||s>this.getMemoryLimit())){this.markVisibleGeoms(o)
var a=this.loadedPacks,l=Object.keys(a),c=!1
l.sort(C)
var u=s-Math.min(s,this.options.debug.maxPageOutSize)
return l.every(function(e){return a[e].resetCounter<this.resetCount?this.unloadPackFile(e,!1,!0):c=!0,this.loadedGeometrySize()>u}.bind(this)),n&&this.loadedGeometrySize()==s&&a[l[0]].resetCounter<this.resetCount&&(this.unloadPackFile(l[0],!1,!0),t.logger.log("A force page out occur.")),this.loadedGeometrySize()==s?(r=WGS.PAGEOUT_SUCCESS,this.reachLimit=!0):(this.reachLimit=!1,this.loadGeometryMissingLastFrame(),d=!0),this.lastPageOut=s-this.loadedGeometrySize(),t.logger.log("[On Demand Loading] Unload pack files size: "+this.lastPageOut),window&&window.gc&&window.gc(),0==this.lastPageOut&&(A=c,this.checkLoadFinished()),r}return d=d||this.queuedPacks.length>0,this.loadFragsFromLoadOrder(),r},this.occlusionTest=function(e){function n(e){var t=d.fragments.packIds
if(!t)return null
var i=[]
return e.forEach(function(e){for(var n=[],o=t.lastIndexOf(e);o>=0;)t[o]==e?n.push(o--):o=t.lastIndexOf(e,o-1)
i.push(n)}),i}function o(t){var i=null
g=0
var n=e.queuedPacks,o=e.occludedPacks
t=Math.min(4,t||4)
for(var r=n.length,s=0;s<r&&t>0;++s){var a=n[s]
void 0===o[a]?(i=i||[],i.push(a),--t):o[a]||++g}return i}function r(i){h=null
for(var n=0;n<p.length;++n)e.occludedPacks[p[n]]=!i[n],i[n]||(t.logger.debug("[On Demand Loading] Occluded Geometry Pack file: "+p[n]),++e.occlusionCulledCount)
e.doOnDemandLoadFinished(),s()}function s(){m||h||T||(h=null,c&&!u&&(p=o(e.options.debug.testPackfileCount))&&(m=setTimeout(function(){m=0
var t=n(p)
h=c(d.boxes,e.options.debug.occlusionTestThreshold,t,e.options.debug.useOcclusionInstancing,p),h.then(r,function(){r([!0,!0,!0,!0])})},g*f)))}function a(e){h||this.occlusionTesting<i||(e&&(c=e.occlusionTestCB,u=e.moved),(d=l.model.getFragmentList())&&c&&!u&&s())}var c=null,d=null,u=!1,h=null,p=null,m=0,g=0,f=3
return a}(this),this.loadFragsFromLoadOrder=function(){for(var e=l.model.getFragmentList();u<m.length;){for(var t=m[u],i=t.length;h<i;){var n=t[h]
if(!e.getGeometry(n)){var o=e.fragments.packIds?e.fragments.packIds[n]:n,r=this.queuedPacks.length
if(!this.doLoadPackFile(o)&&r==this.queuedPacks.length)return}++h}++u,h=0}},this.pfOrder=function(){return c},this.getNumVisiblePFs=function(){return c?g:-1},this.onLoadOrderCalculated=function(e){if(e.error)return void(E=null)
if(e.fragOrder&&e.packOrder&&(E=e),e.id==p&&E){if(this.lastPageOut=-1,A=!0,T=!1,m.length=0,l.model){var i=l.model.getFastLoadList()
i&&(t.logger.log("Using PF fast-load-list for homeView, size:",i.length),m.push(i))}m.push(E.fragOrder),c=E.packOrder,g=E.pfVisible
var n,o=c.length
for(f.length=this.geompacks.length,f.fill(1e10),n=0;n<o;++n)f[c[n]]=n
var r,s=l.model.getFragmentList(),a=this.overheadSize,d=this.getMemoryLimit()
for(r=0;r<m.length&&a<d;++r){var v=m[r]
o=v.length
var y=[]
y.length=f.length,y.fill(0)
var b=this.geompacks
for(n=0;n<o&&a<d;++n){var w=v[n],C=s.fragments.packIds?s.fragments.packIds[w]:w,S=b[C]
if(S){var R=s.getGeometry(w)?S.geomSize:S.totalGeomSize
R>y[C]&&(a+=R-y[C],y[C]=R)}}}var x=this.loadedPacks
for(var P in x)x.hasOwnProperty(P)&&(y[P]||this.unloadPackFile(P,!0));++this.traversedCounter,++this.transparentCounter,this.reachLimit=this.loadedGeometrySize()>=this.getMemoryLimit(),this.cancelPending(),u=0,h=0,this.loadFragsFromLoadOrder(),l.viewer3DImpl.invalidate(!0,!0,!0),this.invalidateCount=this.resetCount+1}},this.resetCanPageOut=function(e,t,i){function n(t){if(y=0,v||!i||t.options.debug.automaticRefresh){t.occlusionCulledCount=0,t.packsPagedOut=0
var n,o=l.viewer3DImpl.camera,r=t.loadedPacks
if(e)for(n in r)r.hasOwnProperty(n)&&t.unloadPackFile(n,!0)
l.calculateLoadOrder(++p,o,t.options.debug.pixelCullingEnable?t.options.debug.pixelCullingThreshold:-1),v=!1}}y&&(clearTimeout(y),y=0),t?y=setTimeout(n,100,this):n(this)},this.onGeomTraversed=function(e,t){var i=e.packId,n=e.svfid
e.traversed=this.traversedCounter,t&&(e.transparent=this.transparentCounter)
var o=!0,r=this.geomidsmap[n]
null!=r&&(this.geomTravCount[r]+=2,this.geomTravCount[r]|=1,o=e.instanceCount==this.geomTravCount[r]>>1)
var s=this.loadedPacks[i]
s&&o&&s.travsed++},this.onGeomCulled=function(e){if(e){var t=e.packId,i=e.svfid,n=this.geomidsmap[i],o=!n
null!=n&&(1&this.geomTravCount[n]?this.onGeomTraversed(e):(this.geomTravCount[n]+=2,o=e.instanceCount==this.geomTravCount[n]>>1))
var r=this.loadedPacks[t]
r&&o&&r.culled++}}}
t.SvfPagingProxy=o}(),function(){"use strict"
function e(e,i){function n(){if(this.fragIds)return t
var e=this.model
if(!e||!this.data||!this.data.meshes)return null
var t=this.fragIds=[],i=this.data.packId,n=0,o=e.getData(),r=o.fragments
return this.data.meshes.forEach(function(e){var o=i+":"+n++,s=r.mesh2frag[o]
void 0!==s&&(Array.isArray(s)?s.forEach(function(e){t.push(e)}):t.push(s))}),t}e.viewer3DImpl.api.fireEvent({type:t.FRAGMENTS_LOADED_EVENT,model:e.model,getFragIds:n,data:i})}var t=Autodesk.Viewing,i=t.Private,n=t.isNodeJS?10:t.isMobileDevice()?2:6,o=function(e){this.viewer3DImpl=e,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.tmpMatrix=new THREE.Matrix4,this.tmpBox=new THREE.Box3,this.fetchingTopology=!1,this.logger=i.logger,this.loadTime=0,i.processMemoryOptions(this.viewer3DImpl.api.config)
var t=this.viewer3DImpl.api.config&&this.viewer3DImpl.api.config.memory,n=this.memoryOpts={onDemandLoading:!1,debug:{}}
t&&(t.hasOwnProperty("limit")&&(n.limit=t.limit,n.onDemandLoading=!0,WGS.memoryOptimizedLoading=!0,n.pageOutGeometryEnabled=!0),n.debug=t.debug||{})}
o.prototype.dtor=function(){if(this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,i.logger.debug("SVF loader dtor: on init worker script.")),this.svfWorker&&(this.svfWorker.clearAllEventListenerWithIntercept(),this.svfWorker.terminate(),this.svfWorker=null,i.logger.debug("SVF loader dtor: on svf worker.")),this.svfLoadOrderWorker&&(this.svfLoadOrderWorker.terminate(),this.svfLoadOrderWorker=null,i.logger.debug("SVF loader dtor: on load order worker.")),this.pack_workers){for(var e=0;e<this.pack_workers.length;e++)this.pack_workers[e].clearAllEventListenerWithIntercept(),this.pack_workers[e].terminate()
this.pack_workers=null,i.logger.debug("SVF loader dtor: on geom worker.")}this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.pagingProxy&&(this.pagingProxy.dtor(),this.pagingProxy=null),this.viewer3DImpl=null,this.logger=null,this.tmpMatrix=null,this.tmpBox=null,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadTime=0},o.prototype.isValid=function(){return null!=this.viewer3DImpl},i.pathToURL=function(e){if(-1!==e.indexOf("://")||0===e.indexOf("urn:"))return e
if("undefined"==typeof window)return e
var t=window.location.pathname,i=t.lastIndexOf("/")
return t=t.substr(0,i+1),window.location.protocol+"//"+window.location.host+t+e},o.prototype.loadFile=function(e,t,n,o,r){if(!this.viewer3DImpl)return i.logger.log("SVF loader was already destructed. So no longer usable."),!1
if(this.loading)return i.logger.log("Loading of SVF already in progress. Ignoring new request."),!1
this.loading=!0,this.viewer3DImpl._addLoadingFile(this)
var s=e.indexOf("urn:")
if(-1!=s){e=decodeURIComponent(e)
var a=e.substr(s,e.substr(s).indexOf("/"))
i.logger.log("Extracted URN: "+a)
var l=a.lastIndexOf(":")
this.svfUrn=a.substr(l+1)}else this.svfUrn=e
this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e
var c=this.currentLoadPath.lastIndexOf("/");-1!=c&&(this.basePath=this.currentLoadPath.substr(0,c+1)),this.acmSessionId=t.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=t
var d=this
return this.initWorkerScriptToken=i.initWorkerScript(function(){d.loadSvfCB(e,t,n,o,r)}),!0},o.prototype.interceptManifest=void 0,o.prototype.loadSvfCB=function(e,o,r,s,a){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this.failedToLoadSomeGeometryPacks=null,this.failedToLoadPacksCount=0
var l=!0,c=this,d={url:i.pathToURL(e),basePath:this.currentLoadPath,objectIds:o.ids,globalOffset:o.globalOffset,placementTransform:o.placementTransform,applyRefPoint:o.applyRefPoint,queryParams:this.queryParams,bvhOptions:o.bvhOptions||{isWeakDevice:t.isMobileDevice()},applyScaling:o.applyScaling,loadInstanceTree:o.loadInstanceTree,headers:o.svfHeaders,max_pf_files:0},u=this.memoryOpts.onDemandLoading||!!this.memoryOpts.debug.memoryOptimizedSvfLoading
u&&(d.perfOpt={memoryOptimizedSvfLoading:u,forceMemoryOptimizedMode:!!this.memoryOpts.debug.forceMemoryOptimizedModeOnSvfLoading})
var h=this.svfWorker=i.createWorkerWithIntercept(),p=function(e){var o=function(){h&&(h.clearAllEventListenerWithIntercept(),h.terminate(),c.svfWorker=null,h=null)}
if(l&&a&&(l=!1,a()),e.data&&e.data.manifest)c.interceptManifest(e.data.manifest),d.operation="LOAD_SVF_CONTD",d.manifest=e.data.manifest,h.doOperation(d)
else if(e.data&&e.data.svf){var u=c.svf=e.data.svf
c.failedToLoadSomeGeometryPacks&&(s&&s(c.failedToLoadSomeGeometryPacks.code,c.failedToLoadSomeGeometryPacks.msg),c.failedToLoadSomeGeometryPacks=null),c.onModelRootLoadDone(u),r&&r(c.model),c.viewer3DImpl.api.fireEvent({type:t.MODEL_ROOT_LOADED_EVENT,svf:u,model:c.model}),c.svf.loadDone=!1
var p=!1
if(c.svf.metadata&&c.svf.metadata.gltf&&(p=!0),!p){var m=u.geompacks.length
if(0==m)c.onGeomLoadDone()
else if(c.model.getFragmentList().onDemandLoadingEnabled())i.logger.debug("[On Demand Loading]: Enabled."),c.loadedPacksCount=0
else if(m)for(var g=Math.min(m,n),f=0;f<g;f++){var v=u.geompacks[c.next_pack++]
v.loading=!0,t.isNodeJS?c.loadGeometryPack(v.id,v.uri):function(e){setTimeout(function(){c.loadGeometryPack(e.id,e.uri)},200*f)}(v)}}1==e.data.progress&&(c.loading=!1,o()),u.fragments.polygonCounts||(u.fragments.polygonCounts=new Int32Array(u.fragments.length)),e.data.bvh&&(c.svf.bvh=e.data.bvh,c.model.setBVH(new i.NodeArray(c.svf.bvh.nodes,c.svf.bvh.useLeanNodes),c.svf.bvh.primitives,c.options.bvhOptions),c.viewer3DImpl.invalidate(!1,!0))}else e.data&&e.data.bvh?(c.svf.bvh||(c.svf.bvh=e.data.bvh,c.model.setBVH(new i.NodeArray(c.svf.bvh.nodes,c.svf.bvh.useLeanNodes),c.svf.bvh.primitives,c.options.bvhOptions),c.viewer3DImpl.invalidate(!1,!0)),c.loading=!1,o()):e.data&&e.data.mesh?(c.processReceivedMesh(e.data),1===e.data.progress&&(c.onGeomLoadDone(),c.loading=!1,o())):e.data&&e.data.progress?1==e.data.progress&&(c.loading=!1,o()):e.data&&e.data.error?(c.loading=!1,o(),i.logger.error("Error while processing SVF: "+JSON.stringify(e.data.error.args)),s&&s(e.data.error.code,e.data.error.msg,e.data.error.args)):e.data&&e.data.debug?i.logger.debug(e.data.message):(i.logger.error("SVF download failed.",t.errorCodeString(t.ErrorCodes.NETWORK_FAILURE)),c.loading=!1,o())}
return h.addEventListenerWithIntercept(p),d.operation="LOAD_SVF",d.interceptManifest=!!this.interceptManifest,h.doOperation(i.initLoadContext(d)),!0},o.prototype.cancelGeometryPackLoading=function(){if(this.pack_workers&&this.isValid()){for(var e=0;e<this.pack_workers.length;e++){if(this.svf){var t=this.geommap[this.pack_workers[e].packId]
t&&(t.loading=!1)}this.pack_workers[e].queued=0,this.pack_workers[e].clearAllEventListenerWithIntercept(),this.pack_workers[e].terminate()}this.pack_workers=null}},o.prototype.loadGeometryPackOnDemand=function(o,r){function s(e,t){e.queued=0,d.geommap[t].loading=!1,c.doOnDemandLoadFinished()}if(!this.svf||!this.isValid())return!0
var a=this.geommap[o]
if(!a||a.loading)return!0
this.t0||(this.t0=(new Date).getTime())
var l,c=this.pagingProxy,d=this,u=function(n){if(n.data&&n.data.meshes){for(var o=n.data.meshes,r={packId:n.data.packId,meshIndex:0,mesh:null},a=0,l=0;l<o.length;l++){var u=o[l]
u&&(r.meshIndex=l,r.mesh=u,d.processReceivedMesh(r),r.geometry&&(a+=r.geometry.byteSize+WGS.GEOMETRY_OVERHEAD,r.geometry=null))}c.onPackFileLoaded(n.data.packId,n.data,a/1048576),e(d,n.data),n.data.progress>=1&&(d.loadedPacksCount++,s(d.pack_workers[n.data.workerId],n.data.packId))}else n.data&&n.data.progress?(d.pack_workers[n.data.workerId].queued-=1,d.viewer3DImpl.signalProgress(100*d.loadedPacksCount/d.svf.geompacks.length,t.ProgressState.LOADING)):n.data&&n.data.debug?i.logger.debug(n.data.message):n.data&&n.data.error?(c.onPackFileLoaded(n.target.packId,null,0),s(n.target,n.target.packId),++d.failedToLoadPacksCount,d.failedToLoadSomeGeometryPacks={code:n.data.error.code,msg:n.data.error.msg}):(c.onPackFileLoaded(n.target.packId,null,0),s(n.target,n.target.packId))}
if(!this.pack_workers){this.pack_workers=[]
var h=n
for(l=0;l<h;l++){var p=i.createWorkerWithIntercept()
p.addEventListenerWithIntercept(u),p.queued=0,this.pack_workers.push(p)}}var m=0,g=this.pack_workers[0].queued
for(l=1;l<this.pack_workers.length;l++)this.pack_workers[l].queued<g&&(m=l,g=this.pack_workers[l].queued)
if(g>1||c.preparedPackFilesSize()>=c.getMemoryLimit())return this.model.addGeomPackMissingLastFrame(o)||this.viewer3DImpl.invalidate(!1,!0),!1
var f,v,E=a.uri
f=this.pack_workers[m],f.queued+=2,f.packId=o,v=m,c.onPackFileLoading(o),a.loading=!0,d.svf.partPacksLoadDone=!1,i.logger.debug("[On Demand Loading] Loading Geometry Pack file: "+o)
var y=i.pathToURL(this.svf.basePath+E),A={operation:"LOAD_GEOMETRY",url:y,packId:parseInt(o),workerId:v,packNormals:this.options.packNormals,headers:this.options.svfHeaders,createWireframe:this.options.createWireframe,skipAssetCallback:!0,queryParams:this.queryParams,inMemory:r}
return f.doOperation(i.initLoadContext(A)),!0},o.prototype.loadGeometryPack=function(e,o){var r,s,a,l,c=this
if(this.svf&&this.isValid()){var d=function(e){if(e.data&&e.data.meshes){for(var n=e.data.meshes,o={packId:e.data.packId,meshIndex:0,mesh:null},r=0;r<n.length;r++){var s=n[r]
s&&(o.meshIndex=r,o.mesh=s,c.processReceivedMesh(o))}if(e.data.progress>=1){c.pack_workers[e.data.workerId].queued-=1,c.loadedPacksCount++,c.viewer3DImpl.signalProgress(100*c.loadedPacksCount/c.svf.geompacks.length,t.ProgressState.LOADING)
var a=!0
for(l=0;l<c.pack_workers.length;l++)if(0!=c.pack_workers[l].queued){a=!1
break}if(a){for(l=0;l<c.pack_workers.length;l++)c.pack_workers[l].clearAllEventListenerWithIntercept(),c.pack_workers[l].terminate()
c.pack_workers=null}c.loadedPacksCount+c.failedToLoadPacksCount==c.svf.geompacks.length&&c.onGeomLoadDone()}}else if(e.data&&e.data.progress){if(c.pack_workers[e.data.workerId].queued-=1,c.next_pack<c.svf.geompacks.length){for(var d=null;c.next_pack<c.svf.geompacks.length&&(d=c.svf.geompacks[c.next_pack++],d.loading););d&&!d.loading?(d.loading=!0,c.loadGeometryPack(d.id,d.uri)):(c.viewer3DImpl.modelQueue().enforceBvh=!1,c.svf.fragments.packIds=null)}}else e.data&&e.data.debug?i.logger.debug(e.data.message):e.data&&e.data.error?(++c.failedToLoadPacksCount,c.failedToLoadSomeGeometryPacks={code:e.data.error.code,msg:e.data.error.msg}):c.pack_workers[e.data.workerId].queued-=2},u=this.pack_workers
if(u||(u=this.pack_workers=[]),u.length<n){var h=!0
for(a=0;a<u.length;a++)if(0===u.queued){h=!1
break}if(h){var p=i.createWorkerWithIntercept()
p.addEventListenerWithIntercept(d),p.queued=0,u.push(p)}}var m=0,g=u[0].queued
for(a=1;a<u.length;a++)u[a].queued<g&&(m=a,g=u[a].queued)
r=u[m],r.queued+=2,s=m
var f=i.pathToURL(this.svf.basePath+o),v={operation:"LOAD_GEOMETRY",url:f,packId:parseInt(e),workerId:s,createWireframe:this.options.createWireframe,headers:this.options.svfHeaders,packNormals:this.options.packNormals,queryParams:this.queryParams}
r.doOperation(i.initLoadContext(v))}},o.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,n=this.svf,o=n.fragments,r=this.model,s=o.mesh2frag[t]
if(void 0===s)return void i.logger.warn("Mesh "+t+" was not referenced by any fragments.")
Array.isArray(s)||(s=[s]),i.BufferGeometryUtils.meshToGeometry(e),e.geometry.packId=e.packId,e.geometry.meshIndex=e.meshIndex
var a=s.length,l=r.getFragmentList().getGeometryId(s[0])
r.getGeometryList().addGeometry(e.geometry,a,l),this.pagingProxy&&this.pagingProxy.onProcessReceivedMesh(e.geometry,a)
for(var c=e.geometry.attributes.index.array||e.geometry.ib,d=c.length/3,u=0;u<s.length;u++){var h=0|s[u]
r.getFragmentList().getOriginalWorldMatrix(h,this.tmpMatrix)
var p=o.materials[h].toString()
o.polygonCounts&&(o.polygonCounts[h]=d)
var m=this.viewer3DImpl.setupMesh(this.model,e.geometry,p,this.tmpMatrix)
r.activateFragment(h,m,!!n.placementTransform)}this.model.getFragmentList().onDemandLoadingEnabled()||(o.mesh2frag[t]=null),o.numLoaded+=s.length,r.getGeometryList().geomPolyCount>n.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),n.numRepaints++,n.nextRepaintPolys+=1e4*Math.pow(1.5,n.numRepaints),this.viewer3DImpl.invalidate(!1,!0))},o.prototype.onModelRootLoadDone=function(e){function n(e){p.isValid()&&p.pagingProxy&&p.pagingProxy.onLoadOrderCalculated(e.data)}this.viewer3DImpl._removeLoadingFile(this),e.geomMemory=0,e.fragments.numLoaded=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.nextRepaintPolys=0,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath=this.basePath,e.loadOptions=this.options
var o=Date.now()
this.loadTime+=o-this.t0,i.logger.log("SVF load: "+(o-this.t0))
var r=this.model=new t.Model(e)
r.loader=this
var s=this.memoryOpts
this.viewer3DImpl.modelQueue().getModels().length>0&&(s.pageOutGeometryEnabled=!1)
var a=this.geommap={},l=Object.keys(e.fragments.mesh2frag).length,c=e.fragments.length,d=(224*l+134*c)/1048576,u=0
e.geompacks.forEach(function(e){e.hasOwnProperty("geomSize")||(e.geomSize=.7*e.usize),e.usize/=1048576,e.geomSize/=1048576,u+=e.geomSize,a[parseInt(e.id)]=e})
var h=t.isMobileDevice()?Math.min(u,WGS.GPU_MEMORY_LIMIT):0
u+=d,s.totalGeomSize=u,s.overheadSize=d,s.onDemandLoading&&(u+h<s.limit&&!s.debug.force?s.onDemandLoading=!1:this.pagingProxy=new i.SvfPagingProxy(this,s)),r.initialize(this.pagingProxy)
var p=this
this.model.getFragmentList().onDemandLoadingEnabled()&&e.fragments.boxes&&e.fragments.packIds&&(this.svfLoadOrderWorker=i.createWorker(),this.svfLoadOrderWorker.addEventListener("message",n,!1),this.svfLoadOrderWorker.doOperation({operation:"CALCULATE_LOAD_ORDER",fragments:{boxes:e.fragments.boxes,packIds:e.fragments.packIds}}),this.model.setUUID(e.urn)),this.model.getFragmentList().onDemandLoadingEnabled()&&t.isMobileDevice()||this.options.skipPropertyDb?this.svf.fragmentMap=new WGS.DbidFragmentMap(this.svf.fragments.fragId2dbId):this.loadPropertyDb()
var m=this.convertMaterials(r)
if(this.t0=o,e.bbox=(new THREE.Box3).copy(e.bbox),e.modelBox&&(e.modelBox=(new THREE.Box3).copy(e.modelBox)),e.refPointTransform&&(e.refPointTransform=new LmvMatrix4(!0).copy(e.refPointTransform)),e.placementTransform&&(e.placementTransform=new LmvMatrix4(!0).copy(e.placementTransform)),e.cameras)for(var g=0;g<e.cameras.length;g++){var f=e.cameras[g]
f.position=(new THREE.Vector3).copy(f.position),f.target=(new THREE.Vector3).copy(f.target),f.up=(new THREE.Vector3).copy(f.up)}e.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT&&i.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),i.logger.log("scene bounds: "+JSON.stringify(e.bbox))
var v={category:"metadata_load_stats",urn:e.urn,has_topology:!!e.topologyPath,has_animations:!!e.animations,cameras:e.cameras?e.cameras.length:0,lights:e.lights?e.lights.length:0,materials:m,is_mobile:t.isMobileDevice()}
i.logger.track(v),this.viewer3DImpl.signalProgress(5,t.ProgressState.ROOT_LOADED),this.viewer3DImpl.invalidate(!1,!1)},o.prototype.calculateLoadOrder=function(e,t,i){if(!this.svfLoadOrderWorker)return!1
var n={projectionMatrix:{elements:t.projectionMatrix.elements},matrixWorldInverse:{elements:t.matrixWorldInverse.elements},aspect:t.aspect,position:{x:t.position.x,y:t.position.y,z:t.position.z},clientWidth:t.clientWidth,clientHeight:t.clientHeight},o={operation:"CALCULATE_LOAD_ORDER",id:e,camera:n,pixelCullingThreshold:i}
this.svfLoadOrderWorker.doOperation(o)},o.prototype.convertMaterials=function(e){var t,n=this.viewer3DImpl.matman(),o=e.getData(),r=0
if(!o.materials)return r
if(o.gltfMaterials){var s=o.materials.materials
for(t in s){var a=s[t],l=i.MaterialConverter.convertMaterialGltf(a,o),c=n._getMaterialHash(e,t)
n.addMaterial(c,l,!1),r++}return r}var d=o.materials.materials,u=o.proteinMaterials?o.proteinMaterials.materials:null
for(t in d){var h=u&&u[t]&&i.MaterialConverter.isPrismMaterial(u[t]),p=h?u[t]:d[t]
n.convertOneMaterial(e,p,t),r++}return n.hasTwoSidedMaterials()&&this.viewer3DImpl.renderer().toggleTwoSided(!0),r},o.prototype.makeBVH=function(e){var n=performance.now(),o=e.materials?e.materials.materials:null
e.bvh=new i.BVHBuilder(e.fragments,o),e.bvh.build(this.options.bvhOptions||{isWeakDevice:t.isMobileDevice()})
var r=performance.now()
i.logger.log("BVH build time: "+(r-n))},o.prototype.onDemandGeomLoadDone=function(){this.svf.loadDone=!0,!this.svf.proteinMaterials||!PROTEIN_ROOT||PRISM_ROOT
var e=Date.now(),t="[On Demand Loading] On demand requested geometries load time: "+(e-this.t0)
i.logger.log(t)
var n={category:"on_demand_geom_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:e-this.t0,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),load_pack_count:this.loadedPacksCount,urn:this.svfUrn}
i.logger.track(n,!0),this.t0=null,this.loadedPacksCount=0,this.svf.partPacksLoadDone=!0,this.viewer3DImpl.onDemandLoadComplete(this.model)},o.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,this.svf.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT||i.TextureLoader.loadModelTextures(this.model,this.viewer3DImpl),this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null
var e=Date.now(),n="Fragments load time: "+(e-this.t0)
this.loadTime+=e-this.t0
var o=this.firstPixelTimestamp-this.t0
if(n+=" (first pixel time: "+o+")",this.svf.bvh&&!this.svf.placementTransform||(this.makeBVH(this.svf),this.model.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives,this.options.bvhOptions),this.viewer3DImpl.invalidate(!1,!0)),i.logger.log(n),this.options.useConsolidation){var r=this.viewer3DImpl.glrenderer()
this.model.consolidate(this.viewer3DImpl.getMaterials(),this.options.consolidationMemoryLimit,r)}var s={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn}
o>0&&(s.first_pixel_time=o),i.logger.track(s,!0),i.assets&&t.isBrowser&&window.webkit&&(!function(e){var i={command:"assets",data:e}
t.isBrowser&&window.webkit.messageHandlers.callbackHandler&&window.webkit.messageHandlers.callbackHandler.postMessage(i)}(i.assets),i.assets=null),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},o.prototype.loadPropertyDb=function(){this.svf.propDbLoader=new i.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propDbLoader.load()},o.prototype.fetchTopologyFile=function(e,t){function n(e){if(e.data["status-topology"])return r=(new Date).getTime(),a=Math.round((r-c)/1e3),void i.logger.log("Topology file downloaded. ("+a+" seconds). Processing...")
var n=e.data["fetch-topology"]
n&&(s=(new Date).getTime(),a=Math.round((s-r)/1e3),n.topology?i.logger.log("Topology file processed successfully! ("+a+" seconds)."):i.logger.log("Topology file processed, but an error ocurred. ("+a+" seconds)."),t(n),d.fetchingTopology=!1,o.clearAllEventListenerWithIntercept(),o.terminate(),o=null)}if(!this.fetchingTopology){this.fetchingTopology=!0
var o=i.createWorkerWithIntercept()
o.addEventListenerWithIntercept(n)
var r,s,a,l={path:e,queryParams:this.queryParams},c=(new Date).getTime()
i.logger.log("Fetching topology file..."),l.operation="FETCH_TOPOLOGY",o.doOperation(i.initLoadContext(l))
var d=this}},o.prototype.is3d=function(){return!0},i.SvfLoader=o,t.FileLoaderManager.registerFileLoader("svf",["svf","gltf","glb"],i.SvfLoader)}(),function(){"use strict"
function e(e){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new THREE.Matrix4,this.logger=n.logger,this.loadTime=0,this.useInstancing=this.viewer3DImpl.use2dInstancing}function t(e,t){function n(){if(this.fragIds)return e
if(!this.model||!this.data||!this.data.meshes)return null
for(var e=this.fragIds=[],t=0|this.data.baseIndex,i=0;i<this.data.meshes.length;++i)e.push(t++)
return e}e.viewer3DImpl.api.fireEvent({type:i.FRAGMENTS_LOADED_EVENT,model:e.model,getFragIds:n,data:t})}var i=Autodesk.Viewing,n=i.Private,o="PARSE_F2D_FRAME",r=1,s=2,a=4,l=8,c=1048576,d=function(e,t){function n(e){for(;++e<m.length&&(m[e]&(a|l))!=a;);return e}function d(e){var t=0
if(h.model){var i=h.model.getGeometryList()
i&&(t=i.geomMemory/c)}for(var a=n(y),d=t+h.fileMemorySize+p;d+v<e.limit;){var u=-1,g=null
if(f.length>0&&(w||a>m.length))g=f.shift(),u=g.lmv_buffer_id
else{if(!(a<m.length))break
u=a,y=a,a=n(a),w=!0}h.parsingWorker.doOperation({operation:o,bufferId:u,rendered:!!(m[u]&r),promised:!!(m[u]&s),conditional:!!(m[u]&l)}),m[u]&l||(v+=p,m[u]|=l)}}var u=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},h=e
this.options={onDemandLoading:!1,pageOutGeometryEnabled:!1},u(this.options,t),this.options.debug={pageOutStart:.75,pageOutEnd:.5,pixelCullingEnable:!1,pixelCullingThreshold:WGS.PIXEL_CULLING_THRESHOLD},u(this.options.debug,t.debug)
var p,m=[],g={},f=[],v=0,E=0,y=-1,A=-1,T=-1,b=0,w=!0,C=0
h.useInstancing?(p=(i.isMobileDevice()?16383:32767)/4|0,p=48*p/c):p=3932100/c
var S=!1,R=[]
this.options.limit=Math.max(this.options.limit,10),this.options.debug.pageOutEnd=Math.min(this.options.debug.pageOutEnd,this.options.debug.pageOutStart),this.totalGeomSize=e.totalGeomSize,this.onDemandLoadingEnabled=function(){return this.options.onDemandLoading},this.pageOutGeometryEnabled=function(){return this.options.onDemandLoading},this.pixelCullingEnable=function(){return this.options.debug.pixelCullingEnable},this.pixelCullingThreshold=function(){return this.options.debug.pixelCullingThreshold},this.getMemoryInfo=function(){var e=0
if(h.model){var t=h.model.getGeometryList()
t&&(e=t.geomMemory/c)}return this.onDemandLoadingEnabled()?{limit:this.options.limit,effectiveLimit:this.options.limit,loaded:e+h.fileMemorySize}:null},this.loadPackFile=function(e){return!!this.onDemandLoadingEnabled()&&(!(e<0||S&&e>=C)&&(e>T&&(T=e),m[e]&r||(e<=y&&this.reset(),m[e]|=a|r),d(this.options),!0))},this.promisePackFile=function(e){if(!this.onDemandLoadingEnabled())return Promise.reject({reason:"Not supported"})
if(e<0||e>=C)return Promise.reject({reason:"Buffer id out of bounds"})
var t=g[e]
if(t)return d(this.options),t
var i,n
return t=new Promise(function(e,t){i=e,n=t}),t.lmv_resolve=i,t.lmv_reject=n,t.lmv_buffer_id=e,f.push(t),g[e]=t,m[e]|=a|s,d(this.options),t},this.cancelPromisedPackFile=function(e){if(!e||!e.hasOwnProperty("lmv_buffer_id")||g[e.lmv_buffer_id]!=e)return!1
var t=f.indexOf(e)
t>=0&&f.splice(t,1)
var i=m[e.lmv_buffer_id]
return i&l&&(h.parsingWorker.doOperation({operation:o,cancelPromise:e.lmv_buffer_id}),i&r||(v-=p)),i&r?i&=~s:i=0,m[e.lmv_buffer_id]=i,delete g[e.lmv_buffer_id],e.lmv_reject&&e.lmv_reject({canceled:!0}),d(this.options),!0},this.resetIterator=function(){},this.reset=function(){h.parsingWorker.doOperation({operation:o,cancel:!0}),v=0
for(var e=0;e<m.length;++e)m[e]&s?(m[e]&=~r,m[e]&l&&(v+=p)):m[e]=0
this.lastPageOut=-1,y=-1,A=-1,R.length=0,T=C-1,++b},this.addGeomPackMissingLastFrame=function(){return!0},this.needResumeNextFrame=function(){return!1},this.pageOut=function(e,t){var i=h.model.getGeometryList(),n=i.geomMemory/c+h.fileMemorySize,o=Math.min(this.options.debug.pageOutStart*this.options.limit,this.options.limit-1.1*p),r=Math.min(this.options.debug.pageOutEnd*this.options.limit,o)
if(n>o){for(var s=0,a=n-r;s<R.length&&a>0;)a-=i.removeGeometry(R[s++],h.viewer3DImpl.glrenderer())/c
for(R.splice(0,s),s=i.geoms.length;--s>0&&a>0;)(s<=A||s>y)&&(a-=i.removeGeometry(s,h.viewer3DImpl.glrenderer())/c)
if(t)for(a=i.geomMemory/c-o,s=y;s>0&&a>0;--s)a-=i.removeGeometry(s,h.viewer3DImpl.glrenderer())/c
this.lastPageOut=n-i.geomMemory/c,window&&window.gc&&window.gc()}var l=i.geomMemory/c
if(e&&!S){var d=this.options.limit-l
if(d>0)for(var u=y;(d-=p)>=0;)this.loadPackFile(++u)}return WGS.PAGEOUT_SUCCESS},this.onGeomTraversed=function(e){A=e.svfid-1},this.onGeomCulled=function(e){this.onDemandLoadingEnabled()&&e&&R.push(e.svfid-1)},this.onMeshReceived=function(e,t){if(!this.onDemandLoadingEnabled())return!0
var i=g[t]
if(i){i.lmv_resolve&&i.lmv_resolve(),delete g[t]
var n=f.indexOf(i)
n>=0&&f.splice(n,1)}return!!(m[t]&l&&(0==b||m[t]&s))&&(t>=C&&(C=t+1,E+=e.vb.byteLength+e.indices.byteLength+WGS.GEOMETRY_OVERHEAD),m[t]&r&&h.viewer3DImpl.invalidate(!1,!0),m[t]=0,v-=p,!0)},this.onFinalFrame=function(){this.onDemandLoadingEnabled()&&(S||(this.totalGeomSize=E/c+h.fileMemorySize),S=!0,m.splice(C,m.length).forEach(function(e){e&l&&(v-=p)}))},this.preparedPackFilesSize=function(){return h.fileMemorySize+v+h.model.getGeometryList().geomMemory/c},this.cancelAcknowledged=function(){--b}}
e.prototype.dtor=function(){this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,n.logger.debug("F2D loader dtor: on init worker script.")),this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null,n.logger.debug("F2D loader dtor: on streaming worker.")),this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null,n.logger.debug("F2D loader dtor: on parsing worker.")),this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.viewer3DImpl=null,this.loading=!1,this.tmpMatrix=null,this.logger=null,this.loadTime=0,this.svf=null,this.options=null,this.pagingProxy=null},e.prototype.isValid=function(){return null!=this.viewer3DImpl},e.prototype.loadFile=function(e,t,i,o,r){if(!this.viewer3DImpl)return n.logger.log("F2D loader was already destructed. So no longer usable."),!1
if(this.loading)return n.logger.log("Loading of F2D already in progress. Ignoring new request."),!1
this.loading=!0,this.viewer3DImpl._addLoadingFile(this)
var s=e.indexOf("urn:")
if(-1!=s){e=decodeURIComponent(e)
var a=e.substr(s,e.substr(s).indexOf("/"))
n.logger.log("Extracted URN: "+a)
var l=a.lastIndexOf(":")
this.svfUrn=a.substr(l+1)}else this.svfUrn=e
this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e,this.acmSessionId=t.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=t,this.options.placementTransform?this.modelScale=this.options.modelScale||this.options.placementTransform.getMaxScaleOnAxis():this.modelScale=this.options.modelScale||1,this.isf2d=!0
var c=this
n.processMemoryOptions(this.viewer3DImpl.api.config)
var d=this.viewer3DImpl.api.config&&this.viewer3DImpl.api.config.memory,u=this.memoryOpts={onDemandLoading:!1,debug:{}}
return d&&(d.hasOwnProperty("limit")&&(u.limit=d.limit,u.onDemandLoading=!0,WGS.memoryOptimizedLoading=!0,u.pageOutGeometryEnabled=!0),u.debug=d.debug||{}),this.initWorkerScriptToken=n.initWorkerScript(function(){c.loadFydoCB(e,t,i,o,r)}),!0}
e.prototype.loadFydoCB=function(e,r,s,a,l){this.t0=Date.now()
var d=n.pathToURL(e)
this.streamingWorker=n.createWorker(),this.parsingWorker=n.createWorker()
var u=this,h=!0,p=function(){u.memoryOpts.onDemandLoading||(u.parsingWorker.terminate(),u.parsingWorker=null)},m=function(e){if(u.isValid()){var t=function(e){if(e){var t=e.geom_metrics,i=3*(t.arcs+t.circ_arcs)
i+=t.circles,i+=t.pline_points-(t.plines||0),i+=t.rasters,i+=t.ptri_indices/3*3
var o,r=n.isMobileDevice?16383:32767
u.useInstancing?(i+=t.ptri_indices/3,o=0,r/=4):(o=6*i+t.ptri_indices,i*=4,i+=t.ptri_points)
var s=(i*(48+WGS.GEOMETRY_OVERHEAD/r)+2*o)/c+u.fileMemorySize,a=u.memoryOpts
a.onDemandLoading&&!a.debug.force&&s<a.limit&&(a.onDemandLoading=!1,a.pageOutGeometryEnabled=!1),u.totalGeomSize=s}return u.memoryOpts.onDemandLoading}
h&&l&&(h=!1,l())
var s
e.data&&"F2DBLOB"==e.data.type?(e.data.hasOwnProperty("f2dSize")&&(u.fileMemorySize=e.data.f2dSize/c),t(e.data.metadata),s={operation:"PARSE_F2D",data:e.data.buffer,metadata:e.data.metadata,manifest:e.data.manifest,basePath:e.data.basePath,f2dLoadOptions:{modelSpace:r.modelSpace,bgColor:r.bgColor,isMobile:i.isMobileDevice(),useInstancing:u.useInstancing,onDemandLoading:u.memoryOpts.onDemandLoading},url:d},u.parsingWorker.doOperation(s,[s.data]),u.streamingWorker.terminate(),u.streamingWorker=null):e.data&&"F2DSTREAM"==e.data.type?(e.data.hasOwnProperty("f2dSize")&&(u.fileMemorySize=2*e.data.f2dSize/c),t(e.data.metadata),s={operation:o,data:e.data.frames,url:d,f2dLoadOptions:{modelSpace:r.modelSpace,bgColor:r.bgColor,isMobile:i.isMobileDevice(),useInstancing:u.useInstancing,onDemandLoading:u.memoryOpts.onDemandLoading}},e.data.metadata&&(s.metadata=e.data.metadata,s.manifest=e.data.manifest),e.data.finalFrame&&(s.finalFrame=!0,u.streamingWorker.terminate(),u.streamingWorker=null,u.fileMemorySize/=2),e.data.progress&&u.viewer3DImpl.signalProgress(100*e.data.progress,i.ProgressState.LOADING),u.parsingWorker.doOperation(s,s.data?[s.data]:void 0)):e.data&&"F2DAssetURL"==e.data.type?n.assets=n.assets.concat(e.data.urls):e.data&&e.data.assetRequest?n.assets.push(e.data.assetRequest):e.data&&e.data.progress||(e.data&&e.data.debug?n.logger.debug(e.data.message):e.data&&e.data.error?(u.loading=!1,u.streamingWorker.terminate(),u.streamingWorker=null,a&&a.call(this,e.data.error.code,e.data.error.msg,e.data.error.args)):(n.logger.error("F2D download failed.",i.errorCodeString(i.ErrorCodes.NETWORK_FAILURE)),u.loading=!1,u.streamingWorker.terminate(),u.streamingWorker=null))}},g=function(e){if(u.isValid()){h&&l&&(h=!1,l())
var o,r
if(e.data&&e.data.f2d){for(o=u.svf=e.data.f2d,p(),n.logger.info("Num polylines: "+o.numPolylines),n.logger.info("Line segments: "+o.numLineSegs),n.logger.info("Circular arcs: "+o.numCircles),n.logger.info("Ellipitcal arcs:"+o.numEllipses),n.logger.info("Plain triangles:"+o.numTriangles),n.logger.info("Total # of op codes generated by fydo.parse: "+o.opCount),u.onModelRootLoadDone(u.svf),s&&s(u.model),u.viewer3DImpl.api.fireEvent({type:i.MODEL_ROOT_LOADED_EVENT,svf:u.svf,model:u.model}),r=0;r<o.meshes.length;r++)u.processReceivedMesh2D(o.meshes[r],r)
o.meshes=null,u.onGeomLoadDone(),u.loading=!1}else if(e.data&&e.data.f2dframe){var c=0
if(e.data.meshes){var d=e.data.bbox
u.svf.bbox=new THREE.Box3(d.min,d.max),c=e.data.baseIndex}else u.svf=e.data.f2dframe,c=e.data.baseIndex
if(o=u.svf,o.fragments&&o.fragments.initialized||(u.onModelRootLoadDone(o),s&&s(u.model),u.viewer3DImpl.api.fireEvent({type:i.MODEL_ROOT_LOADED_EVENT,svf:o,model:u.model})),e.data.meshes&&e.data.meshes.length){for(r=0;r<e.data.meshes.length;r++)u.processReceivedMesh2D(e.data.meshes[r],c+r)
u.pagingProxy&&u.pagingProxy.onDemandLoadingEnabled()&&t(u,e.data)}if(e.data.finalFrame){var m=e.data.cumulativeProps
for(var g in m)o[g]=m[g]
p(),u.onGeomLoadDone(),u.loading=!1,u.pagingProxy&&u.pagingProxy.onFinalFrame()}}else e.data&&e.data.progress||(e.data&&e.data.debug?n.logger.debug(e.data.message):e.data&&e.data.canceled&&u.pagingProxy?u.pagingProxy.cancelAcknowledged():e.data&&e.data.error?(u.loading=!1,p(),n.logger.error("Error while processing F2d: "+JSON.stringify(e.data.error.args)),a&&a.call(this,e.data.error.code,e.data.error.msg,e.data.error.args)):(n.logger.error("F2D download failed.",i.errorCodeString(i.ErrorCodes.NETWORK_FAILURE)),u.loading=!1,p()))}}
this.streamingWorker.addEventListener("message",m,!1),this.parsingWorker.addEventListener("message",g,!1)
var f={operation:"STREAM_F2D",url:d,objectIds:r.ids,queryParams:this.queryParams}
return this.streamingWorker.doOperation(n.initLoadContext(f)),!0},e.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,i=this.svf,o=i.fragments,r=o.mesh2frag[t]
if(void 0===r)return void n.logger.warn("Mesh "+t+" was not referenced by any fragments.")
Array.isArray(r)||(r=[r]),n.BufferGeometryUtils.meshToGeometry(e)
var s=r.length,a=this.model
a.getGeometryList().addGeometry(e.geometry,s,e.meshIndex+1)
for(var l=e.geometry.attributes.index.array||e.geometry.ib,c=l.length/3,d=0;d<r.length;d++){var u=0|r[d]
a.getFragmentList().getOriginalWorldMatrix(u,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new THREE.Matrix4).multiplyMatrices(this.options.placementTransform,this.tmpMatrix))
var h=o.materials[u].toString()
o.polygonCounts&&(o.polygonCounts[u]=c)
var p=this.viewer3DImpl.setupMesh(this.model,e.geometry,h,this.tmpMatrix)
a.activateFragment(u,p)}o.mesh2frag[t]=null,o.numLoaded+=r.length,o.numLoaded},e.prototype.processReceivedMesh2D=function(e,t){if(!this.pagingProxy||this.pagingProxy.onMeshReceived(e,t)){var i={mesh:e,is2d:!0,packId:"0",meshIndex:t},n="0:"+t,o=this.svf.fragments
if(!o.fragId2dbId[t]){var r=Object.keys(i.mesh.dbIds).map(function(e){return parseInt(e)})
o.fragId2dbId[t]=r
for(var s=0;s<r.length;s++){var a=r[s],l=o.dbId2fragId[a]
Array.isArray(l)?l.push(t):o.dbId2fragId[a]=void 0!==l?[l,t]:t}e.material.modelScale=this.modelScale
var c=this.viewer3DImpl
o.materials[t]=this.viewer3DImpl.matman().create2DMaterial(this.model,e.material,!1,!1,function(){c.invalidate(!1,!0,!1)}),o.length++}o.mesh2frag[n]=t,this.processReceivedMesh(i)}},e.prototype.onModelRootLoadDone=function(e){this.viewer3DImpl._removeLoadingFile(this),e.fragments={},e.fragments.mesh2frag={},e.fragments.materials=[],e.fragments.fragId2dbId=[],e.fragments.dbId2fragId=[],e.fragments.length=0,e.fragments.initialized=!0,e.geomMemory=0,e.fragments.numLoaded=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.nextRepaintPolys=1e4,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath=""
var t=this.currentLoadPath.lastIndexOf("/");-1!=t&&(e.basePath=this.currentLoadPath.substr(0,t+1)),e.loadOptions=this.options
var o=Date.now()
this.loadTime+=o-this.t0,n.logger.log("SVF load: "+(o-this.t0)),this.t0=o,e.bbox=(new THREE.Box3).copy(e.bbox)
var r=this.model=new i.Model(e)
r.loader=this
var s=this.memoryOpts
this.viewer3DImpl.modelQueue().getModels().length>0&&(s.pageOutGeometryEnabled=!1),s.onDemandLoading&&(this.pagingProxy=new d(this,s)),r.initialize(this.pagingProxy),!(this.model.getFragmentList().onDemandLoadingEnabled()&&i.isMobileDevice())&&!this.options.skipPropertyDb&&(this.svf.propDbLoader=new n.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api)),n.logger.log("scene bounds: "+JSON.stringify(e.bbox))
var a={category:"metadata_load_stats",urn:e.urn,layers:e.layerCount}
n.logger.track(a),this.viewer3DImpl.signalProgress(5,i.ProgressState.ROOT_LOADED),this.viewer3DImpl.invalidate(!1,!1)},e.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0,this.svf.fragments.entityIndexes=null,this.memoryOpts.onDemandLoading||(this.svf.fragments.mesh2frag=null)
var e=Date.now(),t="Fragments load time: "+(e-this.t0)
this.loadTime+=e-this.t0,this.options.skipPropertyDb||this.loadPropertyDb(),n.logger.log(t)
var o={category:"model_load_stats",is_f2d:!0,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,urn:this.svfUrn}
n.logger.track(o,!0),n.assets&&i.isBrowser&&window.webkit&&(!function(e){if(i.isBrowser){var t=window.webkit.messageHandlers.callbackHandler
t.doOperation?t.doOperation({command:"assets",data:e}):t.postMessage&&t.postMessage({command:"assets",data:e})}}(n.assets),n.assets=null),this.currentLoadPath=null,this.isf2d=void 0,this.memoryOpts.onDemandLoading?this.viewer3DImpl.onDemandLoadComplete(this.model):this.viewer3DImpl.onLoadComplete(this.model)},e.prototype.loadPropertyDb=function(){this.svf.propDbLoader&&this.svf.propDbLoader.load()},e.prototype.is3d=function(){return!1},n.F2DLoader=e,n.F2DPagingProxy=d,i.FileLoaderManager.registerFileLoader("f2d",["f2d"],n.F2DLoader)}(),function(){"use strict"
function e(e){var n=e
this.loadFile=function(e,o,r,s,a){function l(){function s(i){this.bbox=new THREE.Box3,this.basePath=e,this.is2d=!0
var o=i&&i.paperWidth>=0?i.paperWidth:d.texWidth,r=i&&i.paperHeight>=0?i.paperHeight:d.texHeight
this.pageToModelTransform=d.getPageToModelTransform(o,r),this.metadata={},this.metadata.page_dimensions={}
var s=this.metadata.page_dimensions
s.page_width=o,s.page_height=r,s.page_units=i.paperUnits,this.loadDone=!0,this.isLeaflet=!0,n.signalProgress(100,t.ProgressState.LOADING),d.texWidth>0&&(this.maxPixelPerUnit=d.texWidth/d.getQuadWidth())}var a=new s(o.loadOptions)
a.loadOptions=o,u.getVisibleBounds(a.bbox)
var l=new t.Model(a)
l.initFromCustomIterator(u),u.callWhenRefined(function(){var e=Date.now()
a.loadTime=e-c,i.logger.log("SVF load: "+a.loadTime)}.bind(this)),r(l)}var c=Date.now(),d=new i.TexQuadConfig
d.initFromLoadOptions(e,o.loadOptions,function(e,t,n){i.TextureLoader.loadTextureWithSecurity(e,THREE.UVMapping,t,o.acmSessionId,h)})
var u=null
a&&a()
var h=!d.valid()
h&&d.initForSimpleImage(e,l),d.pixelRatio=n.glrenderer().getPixelRatio(),u=new i.ModelIteratorTexQuad(d,n.getMaterials()),h||l()}}var t=Autodesk.Viewing,i=Autodesk.Viewing.Private
e.computeLevelOffset=function(e){for(var t=1,n=0,o=0;o<20;o++){if((t*=2)>e)return n
n++}return i.logger.log("unexpected leaflet tileSize"),0},e.prototype.is3d=function(){return!1},Autodesk.Viewing.Private.LeafletLoader=e,Autodesk.Viewing.FileLoaderManager.registerFileLoader("Leaflet",["jpeg","jpg","png"],i.LeafletLoader)}(),function(){"use strict"
function e(e,t,i){var n=t||65536
this.FULL_COUNT=0|(i||32767),this.useInstancing=e,this.stride=12,this.vb=new ArrayBuffer(4*this.stride*(this.useInstancing?n/4:n)),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=this.useInstancing?null:new Uint16Array(n),this.reset(0)}var t=Autodesk.Viewing,i=t.Private,n=2*Math.PI,o=[0,1,3,0,3,2]
e.prototype.reset=function(e){this.vcount=e,this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-1/0,this.dbIds={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0},e.prototype.expandStride=function(){},e.prototype.addToBounds=function(e,t){e<this.minx&&(this.minx=e),e>this.maxx&&(this.maxx=e),t<this.miny&&(this.miny=t),t>this.maxy&&(this.maxy=t)},e.prototype.setCommonVertexAttribs=function(e,t,i,n,o,r,s,a){t&=255,i&=255,a&=255,r&=65535,s&=65535,this.vbi[e+8]=t|i<<8|a<<16,this.vbi[e+6]=n,this.vbi[e+7]=o,this.vbi[e+9]=r|s<<16,this.dbIds[o]=1},e.prototype.addVertexTriangleGeom=function(e,t,i,n,o,r,s,a,l,c){for(var d=this.vcount,u=this.vbf,h=this.useInstancing?1:4,p=0;p<h;p++){var m=(d+p)*this.stride
u[m]=e,u[m+1]=t,u[m+2]=i,u[m+3]=n,u[m+4]=o,u[m+5]=r,this.setCommonVertexAttribs(m,0+p,5,s,a,l,c,0),this.vcount++}return d},e.prototype.addVertexLine=function(e,t,i,n,o,r,s,a,l,c,d){for(var u=this.vcount,h=this.vbf,p=this.useInstancing?1:4,m=0;m<p;m++){var g=(u+m)*this.stride
h[g]=e,h[g+1]=t,h[g+2]=i,h[g+3]=n,h[g+4]=.5*r,h[g+5]=o,this.setCommonVertexAttribs(g,0+m,1,s,a,l,c,d),this.vcount++}return u},e.prototype.addVertexTexQuad=function(e,t,i,n,o,r,s,a,l){for(var c=this.vcount,d=this.vbf,u=this.useInstancing?1:4,h=0;h<u;h++){var p=(c+h)*this.stride
d[p]=e,d[p+1]=t,d[p+2]=o,d[p+3]=i,d[p+4]=n,this.setCommonVertexAttribs(p,0+h,4,r,s,a,l,0),this.vcount++}return c},e.prototype.addVertexArc=function(e,t,i,n,o,r,s,a,l,c,d,u){for(var h=this.vcount,p=this.vbf,m=o==r?2:3,g=this.useInstancing?1:4,f=0;f<g;f++){var v=(h+f)*this.stride
p[v]=e,p[v+1]=t,p[v+2]=i,p[v+3]=n,p[v+4]=.5*a,p[v+5]=o,3===m&&(p[v+10]=r,p[v+11]=s),this.setCommonVertexAttribs(v,0+f,m,l,c,d,u,0),this.vcount++}return h},e.prototype.addVertex=function(e,t,i,n,o,r){if(!this.useInstancing){var s=this.vcount,a=this.stride*s,l=this.vbf
return l[a]=e,l[a+1]=t,this.setCommonVertexAttribs(a,0,0,i,n,o,r,0),this.vcount++,s}},e.prototype.addVertexPolytriangle=function(e,t,i,n,o,r){this.useInstancing||(this.addVertex(e,t,i,n,o,r),this.addToBounds(e,t))},e.prototype.addIndices=function(e,t){if(!this.useInstancing){var i=this.ib,n=this.icount
if(n+e.length>=i.length){for(var o=new Uint16Array(2*Math.max(e.length,i.length)),r=0;r<n;++r)o[r]=i[r]
this.ib=i=o}for(var r=0;r<e.length;++r)i[n+r]=t+e[r]
this.icount+=e.length}},e.prototype.finalizeQuad=function(e){this.useInstancing||this.addIndices(o,e)},e.prototype.addSegment=function(e,t,i,n,o,r,s,a,l,c,d){var u=i-e,h=n-t,p=u||h?Math.atan2(h,u):0,m=u||h?Math.sqrt(u*u+h*h):0,g=this.addVertexLine(e,t,p,m,o,r,s,a,l,c,d)
this.finalizeQuad(g),this.addToBounds(e,t),this.addToBounds(i,n)},e.prototype.addTriangleGeom=function(e,t,i,n,o,r,s,a,l,c){this.numTriangleGeoms++
var d=this.addVertexTriangleGeom(e,t,i,n,o,r,s,a,l,c)
this.finalizeQuad(d),this.addToBounds(e,t),this.addToBounds(i,n),this.addToBounds(o,r)},e.prototype.addArc=function(e,t,i,o,s,a,l,c,d,u,h,p){s==a?this.numCirculars++:this.numEllipticals++
var m=r(i,o)
i=m.start,o=m.end,0==i&&0==o&&(o=n)
var g=Math.abs(i-o)
if(g>1e-4&&Math.abs(g-n)>1e-4){var f=e+s*Math.cos(i),v=t+a*Math.sin(i)
this.addSegment(f,v,f,v,0,c,d,u,h,p)
var E=e+s*Math.cos(o),y=t+a*Math.sin(o)
this.addSegment(E,y,E,y,0,c,d,u,h,p)}else this.addToBounds(e-s,t-a),this.addToBounds(e+s,t+a)
var A=this.addVertexArc(e,t,i,o,s,a,l,c,d,u,h,p)
this.finalizeQuad(A)
var g,f,v,E,y},e.prototype.addTexturedQuad=function(e,t,i,n,o,r,s,a,l){var c=this.addVertexTexQuad(e,t,i,n,o,r,s,a,l)
this.finalizeQuad(c)
var d=.5*Math.cos(o),u=.5*Math.sin(o),h=Math.abs(i*d)+Math.abs(n*u),p=Math.abs(i*u)+Math.abs(n*d)
this.addToBounds(e-h,t-p),this.addToBounds(e+h,t+p)},e.prototype.isFull=function(e){e=e||3
var t=this.useInstancing?4:1
return this.vcount*t+e>this.FULL_COUNT},e.prototype.toMesh=function(){var e={}
e.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4)),e.vbstride=this.stride
var t=this.useInstancing?1:0
if(e.vblayout={fields1:{offset:0,itemSize:3,bytesPerItem:4,divisor:t,normalize:!1},fields2:{offset:3,itemSize:3,bytesPerItem:4,divisor:t,normalize:!1},color4b:{offset:6,itemSize:4,bytesPerItem:1,divisor:t,normalize:!0},dbId4b:{offset:7,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},flags4b:{offset:8,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},layerVp4b:{offset:9,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1}},this.stride>10&&(e.vblayout.extraParams={offset:10,itemSize:2,bytesPerItem:4,divisor:t,normalize:!1}),this.useInstancing){e.numInstances=this.vcount
var i=new Int32Array([0,1,2,3])
e.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalize:!1},e.vblayout.instFlags4b.array=i.buffer
e.indices=new Uint16Array(o)}else e.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount))
e.dbIds=this.dbIds
var n=this.maxx-this.minx,r=this.maxy-this.miny,s=Math.max(n,r)
e.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-s},max:{x:this.maxx,y:this.maxy,z:.001*s}}
e.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(n*n+r*r)}
return e}
var r=function(e,t){function i(){function i(e,t){return Math.abs(e-t)<.001}i(e,0)&&(e=0),i(t,0)&&(t=0),i(e,n)&&(e=n),i(t,n)&&(t=n)}if(i(),e>t)for(;e>n;)e-=n,t-=n
else for(;t>n;)e-=n,t-=n
return i(),e<0&&t>0&&(e+=n),{start:e,end:t}}
i.VertexBufferBuilder=e}(),function(){"use strict"
function e(e){this.bounds=e,this.point=new THREE.Vector4,this.point.z=0,this.point.w=1}var t=(Autodesk.Viewing,Autodesk.Viewing.Private)
Math.PI
t.VertexBufferReader=function(e,t){this.vb=e.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=e.ib,this.stride=e.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=!!t},t.VertexBufferReader.prototype.getDbIdAt=function(e){return this.vbi[e*this.stride+7]},t.VertexBufferReader.prototype.getVertexFlagsAt=function(e){return this.vbi[e*this.stride+8]},t.VertexBufferReader.prototype.getLayerIndexAt=function(e){return 65535&this.vbi[e*this.stride+9]},t.VertexBufferReader.prototype.getViewportIndexAt=function(e){return this.vbi[e*this.stride+9]>>16&65535},t.VertexBufferReader.prototype.decodeLineAt=function(e,t,i,n){if(n.onLineSegment){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=r+l*Math.cos(a),d=s+l*Math.sin(a)
n.onLineSegment(r,s,c,d,i)}},t.VertexBufferReader.prototype.decodeCircularArcAt=function(e,t,i,n){if(n.onCircularArc){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=this.vbf[o+5]
n.onCircularArc(r,s,a,l,c,i)}},t.VertexBufferReader.prototype.decodeEllipticalArcAt=function(e,t,i,n){if(n.onEllipticalArc){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=this.vbf[o+5],d=this.vbf[o+10],u=this.vbf[o+11]
n.onEllipticalArc(r,s,a,l,c,d,u,i)}},t.VertexBufferReader.prototype.decodeTexQuadAt=function(e,t,i,n){if(n.onTexQuad){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=this.vbf[o+4]
n.onTexQuad(r,s,l,c,a,i)}},t.VertexBufferReader.prototype.decodeOneTriangleAt=function(e,t,i,n){if(n.onOneTriangle){var o=this.stride*e,r=this.vbf[o],s=this.vbf[o+1],a=this.vbf[o+2],l=this.vbf[o+3],c=this.vbf[o+4],d=this.vbf[o+5]
n.onOneTriangle(r,s,a,l,c,d,i)}},t.VertexBufferReader.prototype.decodeTriangleIndexed=function(e,t,i,n,o,r){if(r.onOneTriangle){var s=this.stride*e,a=this.vbf[s],l=this.vbf[s+1]
s=this.stride*t
var c=this.vbf[s],d=this.vbf[s+1]
s=this.stride*i
var u=this.vbf[s],h=this.vbf[s+1]
r.onOneTriangle(a,l,c,d,u,h,o)}},t.VertexBufferReader.prototype.enumGeomsForObject=function(e,t){if(this.useInstancing)for(var i=0;i<this.vcount;){var n=this.getVertexFlagsAt(i),o=n>>8&255,r=this.getLayerIndexAt(i),s=this.getViewportIndexAt(i),a=this.getDbIdAt(i)===e
if(a)switch(o){case 1:this.decodeLineAt(i,r,s,t)
break
case 2:this.decodeCircularArcAt(i,r,s,t)
break
case 3:this.decodeEllipticalArcAt(i,r,s,t)
break
case 4:this.decodeTexQuadAt(i,r,s,t)
break
case 5:this.decodeOneTriangleAt(i,r,s,t)}i+=1}else for(var i=0;i<this.ib.length;){var l=this.ib[i],n=this.getVertexFlagsAt(l),o=n>>8&255,r=this.getLayerIndexAt(l),s=this.getViewportIndexAt(l),a=this.getDbIdAt(l)===e
if(0===o)a&&this.decodeTriangleIndexed(this.ib[i],this.ib[i+1],this.ib[i+2],r,s,t),i+=3
else{if(a)switch(o){case 1:this.decodeLineAt(l,r,s,t)
break
case 2:this.decodeCircularArcAt(l,r,s,t)
break
case 3:this.decodeEllipticalArcAt(l,r,s,t)
break
case 4:this.decodeTexQuadAt(l,r,s,t)
break
case 5:this.decodeOneTriangleAt(l,r,s,t)}i+=6}}},t.VertexBufferReader.prototype.enumGeomsForVisibleLayer=function(e,t){if(this.useInstancing)for(var i=0;i<this.vcount;){var n=this.getVertexFlagsAt(i),o=n>>8&255,r=this.getLayerIndexAt(i),s=this.getViewportIndexAt(i),a=!e||0!==r&&-1!==e.indexOf(r)
if(a)switch(o){case 1:this.decodeLineAt(i,r,s,t)
break
case 2:this.decodeCircularArcAt(i,r,s,t)
break
case 3:this.decodeEllipticalArcAt(i,r,s,t)
break
case 4:this.decodeTexQuadAt(i,r,s,t)
break
case 5:this.decodeOneTriangleAt(i,r,s,t)}i+=1}else for(var i=0;i<this.ib.length;){var l=this.ib[i],n=this.getVertexFlagsAt(l),o=n>>8&255,r=this.getLayerIndexAt(l),s=this.getViewportIndexAt(l),a=!e||0!==r&&-1!==e.indexOf(r)
if(0===o)a&&this.decodeTriangleIndexed(this.ib[i],this.ib[i+1],this.ib[i+2],r,s,t),i+=3
else{if(a)switch(o){case 1:this.decodeLineAt(l,r,s,t)
break
case 2:this.decodeCircularArcAt(l,r,s,t)
break
case 3:this.decodeEllipticalArcAt(l,r,s,t)
break
case 4:this.decodeTexQuadAt(l,r,s,t)
break
case 5:this.decodeOneTriangleAt(l,r,s,t)}i+=6}}},e.prototype.onVertex=function(e,t,i){this.point.x=e,this.point.y=t,this.bounds.expandByPoint(this.point)},e.prototype.onLineSegment=function(e,t,i,n,o){this.onVertex(e,t),this.onVertex(i,n)},e.prototype.onCircularArc=function(e,t,i,n,o,r){this.onEllipticalArc(e,t,i,n,o,o,0,r)},e.prototype.onEllipticalArc=function(e,t,i,n,o,r,s,a){0==s?i<=0&&n>=2*Math.PI-1e-5?this.onTexQuad(e,t,2*o,2*r,s,a):(this.point.x=e+Math.cos(i)*o,this.point.y=t+Math.sin(i)*r,this.bounds.expandByPoint(this.point),this.point.x=e+Math.cos(n)*o,this.point.y=t+Math.sin(n)*r,this.bounds.expandByPoint(this.point),i>n&&(this.point.x=e+o,this.point.y=t,this.bounds.expandByPoint(this.point),i-=2*Math.PI),i<.5*Math.PI&&n>.5*Math.PI&&(this.point.x=e,this.point.y=t+r,this.bounds.expandByPoint(this.point)),i<Math.PI&&n>Math.PI&&(this.point.x=e-o,this.point.y=t,this.bounds.expandByPoint(this.point)),i<1.5*Math.PI&&n>1.5*Math.PI&&(this.point.x=e,this.point.y=t-r,this.bounds.expandByPoint(this.point))):this.onTexQuad(e,t,2*o,2*r,s,a)},e.prototype.onTexQuad=function(e,t,i,n,o,r){var s=.5*i,a=.5*i
if(0==o)this.onVertex(e-s,t-a),this.onVertex(e+s,t+a)
else{var l=new THREE.Matrix4,c=new THREE.Matrix4
l.makeRotationZ(o),c.makeTranslation(e,t,0),c.multiply(l)
for(var d=0;d<4;d++)this.point.x=d%2==1?s:-s,this.point.y=d>=2?a:-a,this.point.applyMatrix4(c),this.bounds.expandByPoint(this.point)}},e.prototype.onOneTriangle=function(e,t,i,n,o,r,s){this.onVertex(e,t),this.onVertex(i,n),this.onVertex(o,r)},t.BoundsCallback=e}(),function(){"use strict"
function e(){this.entries={},this.add=function(e,t){this.entries[e]={callback:t}},this.remove=function(e){this.entries[e]&&delete this.entries[e]},this.render=function(){for(var e in this.entries)this.entries[e].callback()}}Autodesk.Viewing.Private.RenderCallbacks=e}(),function(){"use strict"
var e=Autodesk.Viewing,t=e.Private,i=Object.freeze({Color:"Color",Depth:"Depth",ModelId:"ModelId",Overlay:"Overlay",Post1:"Post1",Post2:"Post2"})
t.RenderTargets=i}(),function(){"use strict"
function e(){function e(){var e=Re.NormalsShader
f=Re.createShaderMaterial(e),f.blending=THREE.NoBlending,f.packedNormals=!0,f.depthWrite=!1
var t={NoCutPlanes:1,Instancing:2,Count:4},i=[]
i[0]=null
for(var n=1;n<t.Count;n++){var o=f.clone()
n&t.NoCutPlanes&&(o.cutPlanes=null,o.blending=THREE.NoBlending,o.packedNormals=!0,o.doNotCut=!0),n&t.Instancing&&(o.useInstancing=!0),i[n]=o}f.variants=i,f.getCustomOverrideMaterial=function(e){var i=!e||!e.cutplanes||0==e.cutplanes.length,n=e.useInstancing,o=(i?t.NoCutPlanes:0)|(n?t.Instancing:0)
return this.variants[o]}}function n(){var e=Re.EdgeShader
v=Re.createShaderMaterial(e),v.depthWrite=!0,v.depthTest=!0,v.isEdgeMaterial=!0,v.transparent=!0,v.blending=THREE.NormalBlending
var i={Instancing:1,Count:2},n=[]
n[0]=null
for(var o=1;o<i.Count;o++){var r=v.clone()
r.defines=t.ObjectAssign({},v.defines),r.isEdgeMaterial=!0,o&i.Instancing&&(r.useInstancing=!0),n[o]=r}v.variants=n,v.getCustomOverrideMaterial=function(e){var t=e.useInstancing,n=t?i.Instancing:0,o=this.variants[n]||v
return o.uniforms.color.value=ge?me?ce:le:ae,o.uniforms.color.needsUpdate=!0,o}}function o(e){e(f)
for(var t=1;t<f.variants.length;t++)e(f.variants[t])}function r(){function t(e){e.material.blending=THREE.NoBlending,e.material.depthWrite=!1,e.material.depthTest=!1}e(),n(),C=new Re.LmvShaderPass(Re.SAOShader),t(C),w=new Re.LmvShaderPass(Re.SAOBlurShader),t(w),R=new Re.LmvShaderPass(Re.SAOMinifyFirstShader),t(R),S=new Re.LmvShaderPass(Re.SAOMinifyShader),t(S),x=new Re.LmvShaderPass(Re.FXAAShader),t(x),P=new Re.LmvShaderPass(Re.CelShader),t(P),k=new Re.LmvShaderPass(Re.BlendShader),t(k),b=new Re.LmvShaderPass(Re.BackgroundShader),t(b),M=new Re.LmvShaderPass(Re.CopyShader),t(M)}function s(e){switch(e){case i.RenderTargets.Color:return!0
case i.RenderTargets.Depth:return Ce.sao||Ce.toonShaded
case i.RenderTargets.ModelId:return Ce.idbuffer||Ce.occlusionid
case i.RenderTargets.Overlay:return!0
case i.RenderTargets.Post1:return Ce.antialias||Ce.sao||Ce.customPresentPass||Ce.toonShaded
case i.RenderTargets.Post2:return Ce.sao||Ce.toonShaded||Ce.antialias&&Ce.customPresentPass}}function a(e,t){var i=3*e[1],n=3*(e[3]-e[1])-i
return(((1-i-n)*t+n)*t+i)*t}function l(){J=new THREE.WebGLRenderTarget(Ce.deviceWidth,Ce.deviceHeight,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,stencilBuffer:!1}),J.generateMipmaps=!1,J.shareDepthFrom=z}function c(e,t,i,n){return e[t++]=i[n],e[t++]=i[n+1],e[t++]=i[n+2],e[t++]=i[n+3],e[t++]=i[n+1],e[t++]=i[n+2],e[t++]=i[n],e[t++]=i[n+4],e[t++]=i[n+2],e[t++]=i[n+3],e[t++]=i[n+4],e[t++]=i[n+2],e[t++]=i[n],e[t++]=i[n+1],e[t++]=i[n+5],e[t++]=i[n+3],e[t++]=i[n+1],e[t++]=i[n+5],e[t++]=i[n],e[t++]=i[n+4],e[t++]=i[n+5],e[t++]=i[n+3],e[t++]=i[n+4],e[t++]=i[n+5],t}function d(e,t,i){return e[t++]=i,e[t++]=i+1,e[t++]=i+5,e[t++]=i,e[t++]=i+5,e[t++]=i+4,e[t++]=i,e[t++]=i+2,e[t++]=i+3,e[t++]=i,e[t++]=i+3,e[t++]=i+1,e[t++]=i,e[t++]=i+4,e[t++]=i+6,e[t++]=i,e[t++]=i+6,e[t++]=i+2,e[t++]=i+7,e[t++]=i+6,e[t++]=i+4,e[t++]=i+7,e[t++]=i+4,e[t++]=i+5,e[t++]=i+7,e[t++]=i+5,e[t++]=i+1,e[t++]=i+7,e[t++]=i+1,e[t++]=i+3,e[t++]=i+7,e[t++]=i+3,e[t++]=i+2,e[t++]=i+7,e[t++]=i+2,e[t++]=i+6,t}function u(e,t,i,n){var o=new Float32Array(24*n),r=new Uint16Array(36*n),s=0,a=0,l=0
for(n+=i;i<n;++i,l+=8)a=d(r,a,l),s=c(o,s,e,6*t[i])
var u=new THREE.BufferGeometry
return u.addAttribute("position",new THREE.BufferAttribute(o,3)),u.addAttribute("index",new THREE.BufferAttribute(r,1)),u.streamingDraw=!0,u.streamingIndex=!0,u}function h(e,t,i,n){for(var o=new Float32Array(3*n),r=new Float32Array(3*n),s=0,a=n+i;i<a;++i){var l=6*t[i]
r[s]=e[l+3]-e[l],o[s++]=e[l++],r[s]=e[l+3]-e[l],o[s++]=e[l++],r[s]=e[l+3]-e[l],o[s++]=e[l++]}var c=new THREE.BufferGeometry
c.addAttribute("position",new THREE.BufferAttribute(ee,3)),c.addAttribute("index",new THREE.BufferAttribute(te,1))
var d=new THREE.BufferAttribute(o,3)
d.divisor=1
var u=new THREE.BufferAttribute(r,3)
return u.divisor=1,c.addAttribute("instOffset",d),c.addAttribute("instScaling",u),c.numInstances=n,c.streamingDraw=!0,c.streamingIndex=!0,c}function p(){ee=new Float32Array(24),te=new Uint16Array(36),d(te,0,0),c(ee,0,[0,0,0,1,1,1],0)}function m(e,t){for(var i=!!t,n=Q[t].length;n<e;++n){var o=Re.createShaderMaterial(WGS.OcclusionShader)
o.useInstancing=i,o.depthWrite=!1,o.uniforms.color.value.set(xe[n][0],xe[n][1],xe[n][2]),o.uniforms.opacity.value=Pe[n],o.defaultAttributeValues.instRotate=[1,0,0,0],o.blending=THREE.CustomBlending,o.blendDst=THREE.SrcColorFactor,o.blendSrc=THREE.ZeroFactor,o.blendEquation=THREE.AddEquation,o.transparent=!0,Q[t][n]=o}}var g,f,v,E,y,A,T,b,w,C,S,R,x,P,k,M,V,I,L,D,N,_,O,H,B=!1,F=!1,G=null,z=null,U=null,W=null,j=null,Y=[],X=0,q=0,K=0,Z=1,Q=[[],[]],J=null,$=null,ee=null,te=null,ie=null,ne=!1,oe=new Uint8Array(4),re=(new THREE.Color).setRGB(1,1,1),se=(new THREE.Color).setRGB(0,0,0),ae=new THREE.Vector4(0,0,0,.3),le=new THREE.Vector4(1,1,1,1),ce=new THREE.Vector4(1,1,1,.5),de=null,ue=!1,he=!0,pe=!1,me=!1,ge=!1,fe=!1,ve=!1,Ee=null,ye=!1,Ae=0,Te=0,be=0,we=[.42,0,1,1],Ce={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,idbuffer:!0,occlusionid:!0,customPresentPass:!1,toonShaded:!1,envMapBg:!1,swapBlackAndWhite:!1,numIdTargets:1},Se={},Re=Autodesk.Viewing.Shaders
this.settings=Ce,this.init=function(e,n,o){if(r(),!e)return void i.logger.error("You need a gl context to make a renderer. Things will go downhill from here.",t.errorCodeString(t.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED))
var s=-1!=window.navigator.userAgent.indexOf("Firefox")
H=s?THREE.RGBAFormat:THREE.RGBFormat,ue=t.isMobileDevice(),Ce.idbuffer=!ue,_=n,O=o,g=e},this.setDepthMaterialOffset=function(e,t,i){o(function(n){n.polygonOffset=e,n.polygonOffsetFactor=t,n.polygonOffsetUnits=i,n.extraDepthOffset&&(n.polygonOffsetFactor+=n.extraDepthOffset),n.needsUpdate=!0})},this.overlayUpdate=function(){if(0===Te||-1===Te)return!1
var e=k.uniforms.highlightIntensity.value,t=.004*(performance.now()-Ae)
t=Math.min(t,1)
var i=a(we,t)
return e!=i&&(k.uniforms.highlightIntensity.value=i,!0)},this.beginScene=function(e,n,o,r){if(y=n,T=e.fog,A=o,B=!1,F=!1,!z&&_)this.initPostPipeline(Ce.sao,Ce.antialias)
else if(!z&&!_)return void(ne||(i.logger.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance.",t.errorCodeString(t.ErrorCodes.VIEWER_INTERNAL_ERROR)),ne=!0))
if(r){if(de&&!Ce.envMapBg){if(Ce.swapBlackAndWhite){var a=new THREE.Color(1,1,1),l=new THREE.Color(0,0,0)
de.equals(a)?g.setClearColor(l,1):de.equals(l)?g.setClearColor(a,1):g.setClearColor(de,1)}else g.setClearColor(de,1)
g.clearTarget(z,!0,!0,!1)}else b.uniforms.uCamDir.value=y.worldUpTransform?y.getWorldDirection().clone().applyMatrix4(y.worldUpTransform):y.getWorldDirection(),b.uniforms.uCamUp.value=y.worldUpTransform?y.up.clone().applyMatrix4(y.worldUpTransform):y.up,b.uniforms.uResolution.value.set(_,O),b.uniforms.uHalfFovTan.value=Math.tan(THREE.Math.degToRad(.5*y.fov)),g.clearTarget(z,!1,!0,!1),b.render(g,z,null)
for(var c=0;c<Y.length;c++)g.setClearColor(re,1),g.clearTarget(Y[c],!0,!1,!1)
ye=!1}if(s(i.RenderTargets.Depth)){r&&(g.setClearColor(se,0),g.clearTarget(N,!0,!1,!1))
var d=n.near,u=n.far
C.uniforms.cameraNear.value=d,C.uniforms.cameraFar.value=u,P.uniforms.cameraNear.value=d,P.uniforms.cameraFar.value=u,R.uniforms.cameraNear.value=d,R.uniforms.cameraInvNearFar.value=1/(d-u)
var h=n.projectionMatrix.elements
n.isPerspective?(C.uniforms.projInfo.value.set(-2/(z.width*h[0]),-2/(z.height*h[5]),(1-h[8])/h[0],(1+h[9])/h[5]),P.uniforms.projInfo.value.copy(C.uniforms.projInfo.value),C.uniforms.isOrtho.value=0,P.uniforms.isOrtho.value=0):(C.uniforms.projInfo.value.set(-2/(z.width*h[0]),-2/(z.height*h[5]),(1-h[12])/h[0],(1-h[13])/h[5]),P.uniforms.projInfo.value.copy(C.uniforms.projInfo.value),C.uniforms.isOrtho.value=1,P.uniforms.isOrtho.value=1)
C.uniforms.projScale.value=z.height*h[5]*.125}Ce.sao||(k.uniforms.useAO.value=0),this.renderScenePart(e,!0,!0,!1,!0)},this.copyOcclusionIds=function(){return Ce.occlusionid&&Y[0]&&Ee?(ye||g.readRenderTargetPixels(Y[0],0,0,Y[0].width,Y[0].height,Ee),Ee):null},this.renderScenePart=function(e,t,n,o,r){o&&Ce.occlusionid&&Y[0]&&Ee&&e instanceof i.RenderBatch&&(ye=!1),B=!1,F=!1
var a=r?A:void 0
e.fog=T
var l
if(fe&&ve)s(i.RenderTargets.ModelId)&&o&&s(i.RenderTargets.Depth)?g.render(e,y,[z,N].concat(Y),!1,a):s(i.RenderTargets.Depth)?g.render(e,y,[z,N],!1,a):s(i.RenderTargets.ModelId)&&o?g.render(e,y,[z].concat(Y)):g.render(e,y,z,!1,a)
else if(ve)s(i.RenderTargets.ModelId)&&o?g.render(e,y,[z].concat(Y),!1,a):g.render(e,y,z,!1,a),s(i.RenderTargets.Depth)&&n&&!e.sortObjects&&(l=e.overrideMaterial,e.overrideMaterial=f,f.depthWrite!==c&&(f.depthWrite=c,f.needsUpdate=!0),g.render(e,y,N,!1),e.overrideMaterial=l)
else{var c=!1
t?g.render(e,y,z,!1,a):c=!0,s(i.RenderTargets.ModelId)&&o&&(E?(l=e.overrideMaterial,e.overrideMaterial=E,g.render(e,y,Y[0],!1),e.overrideMaterial=l):(g.setProgramPrefix(1,"#define ID_COLOR","#define ID_COLOR"),g.render(e,y,Y[0],!1),g.setProgramPrefix(0,"","")),c=!1),s(i.RenderTargets.Depth)&&n&&!e.sortObjects&&(l=e.overrideMaterial,f.depthWrite!==c&&(f.depthWrite=c,f.needsUpdate=!0),e.overrideMaterial=f,g.render(e,y,N,!1),e.overrideMaterial=l)}t&&pe&&(l=e.overrideMaterial,e.overrideMaterial=v,g.context.depthFunc(g.context.LESS),g.render(e,y,[z],!1),g.context.depthFunc(g.context.LEQUAL),e.overrideMaterial=l)}
var xe=[[0,1,1],[1,0,1],[1,1,0],[1,1,1]],Pe=[1,1,1,0],ke={}
this.occlusionTest=function(e,t,i,n,o){if(!i||i.length<=0||i.length>4)return Promise.reject({error:"fragIds invalid. Must be a nonempty array of fragment id arrays with length <= 4"})
var r=[0,0,0,0],s=0
n=n&&g.supportsInstancedArrays()?1:0,(!Q[n]||Q[n].length<i.length)&&m(i.length,n),n&&!ee&&p(),ie||(ie=new THREE.Scene),ie.frustumCulled=!1
var a,c=n?32768:4096
for(a=0;a<i.length;++a){var d=i[a]
if(d&&d.length>0){r[a]=t,++s
for(var f,v=Q[n][a],E=d.length,A=0;A<E;A+=f){f=Math.min(c,E-A)
var T=n?h(e,d,A,f):u(e,d,A,f),b=new THREE.Mesh(T,v)
b.frustumCulled=!1,ie.add(b)}}}switch(J||l(),g.setClearColor(re,1),g.setRenderTarget(J),g.clear(!0,!1,!1),g.render(ie,y,J,!1,null),g.clearBlend(),ie.children.forEach(function(e){e.geometry.dispose()}),ie.remove.apply(ie,ie.children),(ke[o[0]]||ke[o[1]]||ke[o[2]]||ke[o[3]])&&this.getRenderTargetPixels("occlusion"),$||($=new Uint8Array(4*Ce.deviceWidth*Ce.deviceHeight)),g.readRenderTargetPixels(J,0,0,Ce.deviceWidth,Ce.deviceHeight,$),i.length){case 1:for(a=$.length;s>0&&(a-=4)>=0;)$[a]||(r[0]-=1,s-=!r[0])
return Promise.resolve([r[0]<=0])
case 2:for(a=$.length;s>0&&(a-=4)>=0;)$[a]||(r[0]-=1,s-=!r[0]),$[a+1]||(r[1]-=1,s-=!r[1])
return Promise.resolve([r[0]<=0,r[1]<=0])
case 3:for(a=$.length;s>0&&(a-=4)>=0;)$[a]||(r[0]-=1,s-=!r[0]),$[a+1]||(r[1]-=1,s-=!r[1]),$[a+2]||(r[2]-=1,s-=!r[2])
return Promise.resolve([r[0]<=0,r[1]<=0,r[2]<=0])
case 4:for(a=$.length;s>0&&(a-=4)>=0;)$[a]||(r[0]-=1,s-=!r[0]),$[a+1]||(r[1]-=1,s-=!r[1]),$[a+2]||(r[2]-=1,s-=!r[2]),$[a+3]||(r[3]-=1,s-=!r[3])
return Promise.resolve([r[0]<=0,r[1]<=0,r[2]<=0,r[3]<=0])}},this.clearAllOverlays=function(){g.clearTarget(U,!0,!1,!1)},this.renderOverlays=function(e,t){var i=0
ge=!0
for(var n in e){var o=e[n],r=o.scene,s=o.camera?o.camera:y
r.children.length&&(i||(i=1,g.setClearColor(se,0),g.clearTarget(U,!0,!1,!1)),o.materialPre&&(r.overrideMaterial=o.materialPre),g.render(r,s,U,!1,t),o.materialPost&&(me=!0,g.context.depthFunc(g.context.GREATER),pe&&(v.depthWrite=!1,v.depthTest=!1,r.overrideMaterial=v,g.render(r,s,U,!1)),r.overrideMaterial=o.materialPost,g.render(r,s,U,!1,t),g.context.depthFunc(g.context.LEQUAL),me=!1),pe&&o.materialPre&&(v.depthWrite=!1,v.depthTest=!0,r.overrideMaterial=v,g.render(r,s,U,!1)),r.overrideMaterial=null)}ge=!1,v.depthWrite=!0,v.depthTest=!0,k.uniforms.useOverlay.value=i},this.computeSSAO=function(e){if(e||!Ce.sao||Ce.toonShaded)k.uniforms.useAO.value=0
else{if(!B){if(G&&G.length){var t=G[0]
R.uniforms.resolution.value.set(1/t.width,1/t.height),R.render(g,t,N)
for(var i=1;i<G.length;i++){var n=G[i]
S.uniforms.resolution.value.set(1/n.width,1/n.height),S.render(g,n,t),t=n}}C.render(g,j,z),w.uniforms.axis.value.set(1,0),w.render(g,W,j),w.uniforms.axis.value.set(0,1),w.render(g,j,W),B=!0}k.uniforms.useAO.value=1}},this.presentBuffer=function(e){if(g){!(Ce.sao||k.uniforms.useOverlay.value||0!==Te&&-1!==Te||0!==be&&-1!==be)?Ce.antialias?e?(x.render(g,W,z),e.render(g,null,W)):Ce.toonShaded?(P.render(g,W,z),x.render(g,null,W)):x.render(g,null,z):e?e.render(g,null,z):Ce.toonShaded?(P.render(g,W,z),M.render(g,null,W)):M.render(g,null,z):Ce.antialias?(k.render(g,W,z),e?(x.render(g,j,W),e.render(g,null,j)):Ce.toonShaded?(P.render(g,j,W),x.render(g,null,j)):x.render(g,null,W)):e?(k.render(g,W,z),e.render(g,null,W)):Ce.toonShaded?(k.render(g,W,z),P.render(g,j,W),M.render(g,null,j)):k.render(g,null,z)}},this.composeFinalFrame=function(e,t){Ce.sao&&!Ce.toonShaded&&this.computeSSAO(e),t||this.presentBuffer()},this.cleanup=function(){if(z&&(z.dispose(),z=null),N&&(N.dispose(),N=null),U&&(U.dispose(),U=null),W&&(W.dispose(),W=null),j&&(j.dispose(),j=null),G){for(var e=0;e<G.length;e++)G[e].dispose()
G=[]}J&&(J.dispose(),J=null),$=null},this.setSize=function(e,n,o){if(_=e,O=n,Ce.logicalWidth=e,Ce.logicalHeight=n,0===e&&0===n||!g)return void this.cleanup()
var r=0|e*g.getPixelRatio(),a=0|n*g.getPixelRatio()
Ce.deviceWidth=r,Ce.deviceHeight=a,g.setSize(e,n)
var l,c=1/r,d=1/a
if((Ce.useSSAA||Ce.toonShaded&&g.getPixelRatio()<=1)&&(r*=2,a*=2,o=!0),!o&&z&&z.width==r&&z.height==a||(i.logger.log("Reallocating render targets."),this.cleanup(),z=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:Ce.useHdrTarget?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1}),z.generateMipmaps=!1,U=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,stencilBuffer:!1}),U.generateMipmaps=!1,U.shareDepthFrom=z,N=null,W=null,j=null,G=[]),s(i.RenderTargets.Post1)&&(!o&&W&&W.width==r&&W.height==a||(W=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),W.generateMipmaps=!1)),!j&&s(i.RenderTargets.Post2)&&(j=W.clone()),s(i.RenderTargets.Depth)){if(o||!N||N.width!=r||N.height!=a){var u=THREE.FloatType
t.isMobileDevice()&&(u=THREE.HalfFloatType),N=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:H,type:u,stencilBuffer:!1}),N.shareDepthFrom=z,G=[]
for(var h=0;h<5;h++){var p=new THREE.WebGLRenderTarget(0|r/(2<<h),0|a/(2<<h),{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,depthBuffer:!1,stencilBuffer:!1})
p.generateMipmaps=!1,G.push(p),C.uniforms["tDepth_mip"+(h+1)].value=p}fe=g.verifyMRTWorks([z,N])}C.uniforms.size.value.set(r,a),C.uniforms.resolution.value.set(c,d),C.uniforms.tDepth.value=N,w.uniforms.size.value.set(r,a),w.uniforms.resolution.value.set(c,d),P.uniforms.tDepth.value=N}if(s(i.RenderTargets.ModelId)){if(o||!Y[0]||Y[0].width!=r||Y[0].height!=a){for(l=0;l<Y.length;l++)Y[l]&&Y[l].dispose()
for(Y=[],l=0;l<Ce.numIdTargets;l++)Y[l]=new THREE.WebGLRenderTarget(r,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,stencilBuffer:!1}),Y[l].generateMipmaps=!1,Y[l].shareDepthFrom=z,Y[l].canReadPixels=!0
ve=g.verifyMRTWorks([z].concat(Y)),ve||i.logger.warn("ID buffer requested, but MRT is not supported. Some features will not work."),Ee=new Uint8Array(4*Y[0].width*Y[0].height)}P.uniforms.tID.value=Y[0]}else if(Y[0]){for(Ee=null,l=0;l<Y.length;l++)Y[l].dispose(),Y[l]=null
Y.length=0}x.uniforms.uResolution.value.set(c,d),P.uniforms.resolution.value.set(c,d),k.uniforms.tOverlay.value=U,k.uniforms.tAO.value=j,k.uniforms.useAO.value=Ce.sao?1:0,k.uniforms.resolution.value.set(c,d),k.uniforms.tID.value=Y[0]},this.getMaxAnisotropy=function(){return g?g.getMaxAnisotropy():0},this.mrtFlags=function(){return{mrtNormals:fe&&s(i.RenderTargets.Depth),mrtIdBuffer:ve&&s(i.RenderTargets.ModelId)?Ce.numIdTargets:void 0}},this.getAntialiasing=function(){return Ce.antialias},this.initPostPipeline=function(e,i){Ce.sao=e&&!t.isIE11,Ce.antialias=i&&!t.isIE11,Ce.sao&&(Ce.toonShaded=!1),Ce.haveTwoSided&&o(function(e){e.side=THREE.DoubleSide}),o(function(e){e.needsUpdate=!0}),C.material.needsUpdate=!0,w.material.needsUpdate=!0,R.material.needsUpdate=!0,S.material.needsUpdate=!0,x.material.needsUpdate=!0,P.material.needsUpdate=!0,k.material.needsUpdate=!0,b.material.needsUpdate=!0,M.material.needsUpdate=!0,this.setSize(_,O)},this.setClearColors=function(e,t){(de=t?e.equals(t)||ue?new THREE.Color(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)):void 0:e.clone())||(b.uniforms.color1.value.copy(e),b.uniforms.color2.value.copy(t))},this.setAOEnabled=function(e){Ce.sao=e,this.setSize(_,O)},this.setAOOptions=function(e,i,n){void 0!==e&&(C.uniforms.radius.value=e,C.uniforms.bias.value=e*t.isMobileDevice()?.1:.01,w.uniforms.radius.value=e),void 0!==i&&(C.uniforms.intensity.value=i),k.uniforms.aoOpacity.value=void 0!==n?n:1,B=!1},this.getAOEnabled=function(){return Ce.sao},this.getAORadius=function(){return C.uniforms.radius.value},this.getAOIntensity=function(){return C.uniforms.intensity.value},this.setCubeMap=function(e){b.material.envMap=e,e||this.toggleEnvMapBackground(!1)},this.setEnvRotation=function(e){q=e,b.material.envRotationSin=Math.sin(e),b.material.envRotationCos=Math.cos(e)},this.getEnvRotation=function(){return q},this.setEnvExposure=function(e){b.uniforms.envMapExposure.value=Math.pow(2,e),b.material.envMapExposure=Math.pow(2,e),b.material.needsUpdate=!0},this.setTonemapExposureBias=function(e){X=e,b.uniforms.exposureBias.value=Math.pow(2,e)},this.getExposureBias=function(){return X},this.setCamera=function(e){y=e},this.setTonemapMethod=function(e){K=e,g.gammaInput=0!==e,b.material.tonemapOutput=K,b.material.needsUpdate=!0},this.getToneMapMethod=function(){return K},this.toggleTwoSided=function(e){Ce.haveTwoSided!=e&&f&&o(function(t){t.side=e?THREE.DoubleSide:THREE.FrontSide,t.needsUpdate=!0}),Ce.haveTwoSided=e},this.toggleEdges=function(e){pe=e},this.toggleCelShading=function(e){Ce.sao=!e,Ce.toonShaded=e,Ce.idbuffer=e&&!ue&&he,this.initPostPipeline(Ce.sao,Ce.antialias)},this.toggleEnvMapBackground=function(e){Ce.envMapBg=e,b.uniforms.envMapBackground.value=e},this.toggleSwapBlackAndWhite=function(e){Ce.swapBlackAndWhite=e},this.enter2DMode=function(e){E=e,Se.sao=Ce.sao,Se.toonShaded=Ce.toonShaded,Se.antialias=Ce.antialias,Se.idbuffer=Ce.idbuffer,Se.occlusionid=Ce.occlusionid,Ce.idbuffer=!0,Ce.occlusionid=!1,Ce.toonShaded=!1,k.material.defines.IS_2D="",this.initPostPipeline(!1,!1)},this.exit2DMode=function(){E=null,Ce.idbuffer=Se.idbuffer&&he,Ce.occlusionid=Se.occlusionid,Ce.toonShaded=Se.toonShaded,delete k.material.defines.IS_2D,this.initPostPipeline(Se.sao,Se.antialias)},this.idAtPixel=function(e,t,i){if(!Y[0])return 0
var n=0|.5*(e+1)*Y[0].width,o=0|.5*(t+1)*Y[0].height
if(F&&n===V&&o===I)return i&&(i[0]=L,i[1]=D),L
g.readRenderTargetPixels(Y[0],n,o,1,1,oe)
var r=oe[2]<<16|oe[1]<<8|oe[0],s=0
return Y[1]?(g.readRenderTargetPixels(Y[1],n,o,1,1,oe),s=oe[1]<<8|oe[0],s=s<<16>>16,r=r<<8>>8):r=r<<8>>8,V=n,I=o,L=r,D=s,F=!0,i&&(i[0]=r,i[1]=s),r},this.idAtPixels=function(e,t,i,n){if(!Y[0])return 0
var o=.5*(e+1)*Y[0].width-.5*(i-1),r=.5*(t+1)*Y[0].height-.5*(i-1),s=new Uint8Array(4*i*i)
g.readRenderTargetPixels(Y[0],o,r,i,i,s)
var a=void 0
return n&&Y[1]&&(a=new Uint8Array(4*i*i),g.readRenderTargetPixels(Y[1],o,r,i,i,a)),function(){for(var e,t=0,o=0,r=0,l=-1,c=0;c<i*i;c++){var d=t+(i-1)/2,u=o+(i-1)/2
if(d>=0&&d<=i&&u>=0&&u<=i){var h=d+u*i
if(e=s[4*h+2]<<16|s[4*h+1]<<8|s[4*h],(e=e<<8>>8)>=0){if(a){var p=a[4*h+1]<<8|a[4*h]
p=p<<16>>16,n[0]=e,n[1]=p}break}}if(t==o||t<0&&t==-o||t>0&&t==1-o){var m=r
r=-l,l=m}t+=r,o+=l}return e}()},this.readbackTargetId=function(){if(!Y[0])return null
var e=new Uint8Array(4*Y[0].width*Y[0].height)
return g.readRenderTargetPixels(Y[0],0,0,Y[0].width,Y[0].height,e),{buffer:e,width:Y[0].width,height:Y[0].height}},this.rolloverObjectViewport=function(e,t,i){if(he){var n=i?i[0]:this.idAtPixel(e,t)
return this.rolloverObjectId(n,i)}},this.rolloverObjectId=function(e,t,i){return i=i||0,!(!he||e===Te&&i===be)&&(k.uniforms.highlightIntensity.value=0,k.uniforms.objID.value=e,Ae=performance.now(),Te=e,be=i,t?(t.length>1&&t.shift(),k.uniforms.highlightRange.value=1,k.uniforms.objIDStart.value=t[0],k.uniforms.objIDEnd.value=t[t.length-1]):(k.uniforms.highlightRange.value=0,e<=0&&(e=0),k.uniforms.objIDv3.value.set((255&e)/255,(e>>8&255)/255,(e>>16&255)/255)),!0)},this.setMemoryLimited=function(e){he=!e,Ce.idbuffer=Ce.idbuffer&&he,Ce.occlusionid=e,this.setSize(_,O)},this.isMemoryLimited=function(){return!he},this.setUnitScale=function(e){Z=e},this.getUnitScale=function(){return Z},this.getBlendPass=function(){return k},this.getClearPass=function(){return b},this.getColorTarget=function(){return z},this.getDepthTarget=function(){return N},this.getIdTarget=function(){return Y[0]},this.getDepthMaterial=function(){return f},this.getPostTarget=function(){return W},this.getEdgeMaterial=function(){return v},this.getCurrentFramebuffer=function(){return g.getCurrentFramebuffer()}}var t=Autodesk.Viewing,i=t.Private
i.RenderContext=e}(),function(){"use strict"
function e(e,t){var i=255*t[2]+t[3],n=Math.pow(2,(i-127)/2),o=n/t[1],r=t[0]*o,s=l[0]*r+l[3]*n+l[6]*o,a=l[1]*r+l[4]*n+l[7]*o,c=l[2]*r+l[5]*n+l[8]*o
s<0&&(s=0),a<0&&(a=0),c<0&&(c=0),e[0]=s,e[1]=a,e[2]=c}function t(e,t,i){var n=.0625*Math.sqrt(t[0]*i),o=.0625*Math.sqrt(t[1]*i),r=.0625*Math.sqrt(t[2]*i),s=Math.max(Math.max(n,o),Math.max(r,1e-6))
s>1&&(s=1)
var a=Math.ceil(255*s)/255
n>1&&(n=1),o>1&&(o=1),r>1&&(r=1),e[3]=a
var l=1/a
e[0]=n*l,e[1]=o*l,e[2]=r*l}function i(e,t,i){var n=Math.sqrt(t[0]*i),o=Math.sqrt(t[1]*i),r=Math.sqrt(t[2]*i)
n>65504&&(n=65504),o>65504&&(o=65504),r>65504&&(r=65504),e[0]=n,e[1]=o,e[2]=r}function n(e){for(var t=[],i=Array.isArray(e.image)?e.image:[e.image],n=0;n<i.length;n++)for(var o=i[n],r=0;r<o.mipmaps.length;r++){var s=o.mipmaps[r]
t.push(s.data.buffer)}return t}var o=Autodesk.Viewing,r=Autodesk.Viewing.Private,s=Autodesk.LMVTK
r.DefaultLightPreset=1,r.DefaultLightPreset2d=0,r.ModelSettingsEnvironment=null,r.BackgroundPresets={"Fusion Grey":[230,230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Snow:[181,186,199,181,186,199],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Dark Sky":[51,51,51,51,51,51],"Infinity Pool":[255,255,255,255,255,255],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Field:[202,226,252,202,201,190],Boardwalk:[216,230,248,230,228,220],Custom:[230,230,230,150,150,150]}
var a=r.BackgroundPresets
r.LightPresets=[{name:"Simple Grey",path:null,tonemap:0,E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.2,.225,.25],lightMultiplier:1,bgColorGradient:a["Fusion Grey"],darkerFade:!1,rotation:0},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.5,-.2,-.06],bgColorGradient:a["Photo Booth"],darkerFade:!0,rotation:0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:1,lightDirection:[.1,-.55,-1],bgColorGradient:a["Dark Sky"],darkerFade:!1,rotation:0},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:a["Grey Room"],darkerFade:!0,rotation:0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:a["Photo Booth"],darkerFade:!0,rotation:0},{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:a.Tranquility,darkerFade:!1,rotation:0},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:a["Infinity Pool"],darkerFade:!1,rotation:0},{name:"Simple White",path:null,tonemap:0,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25,.25,.25],lightMultiplier:1,bgColorGradient:a.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0,rotation:0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:1,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a["Sky Blue"],darkerFade:!1,rotation:0},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a.Midnight,darkerFade:!1,rotation:0},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.35,-.35,-.5],bgColorGradient:a["Photo Booth"],darkerFade:!0,rotation:0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:a["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-0,-.15,-.5],bgColorGradient:a["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.5,0],bgColorGradient:a["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.6,0],bgColorGradient:a["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Plaza",path:"Plaza",type:"logluv",tonemap:1,E_bias:-14,directLightColor:[.9,.9,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.2,-.18,.72],bgColorGradient:a.Plaza,darkerFade:!1,rotation:0},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:1,E_bias:-10.461343,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-1,0],bgColorGradient:a.Snow,darkerFade:!1,rotation:0},{name:"Field",path:"field",type:"logluv",tonemap:1,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a.Field,useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:1,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a.Boardwalk,useIrradianceAsBackground:!0,darkerFade:!1,rotation:0}],r.DebugEnvironments=[{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:1,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!0,rotation:0},{name:"Seaport",path:"seaport",type:"logluv",tonemap:1,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a["Sky Blue"],useIrradianceAsBackground:!0,darkerFade:!1,rotation:0},{name:"Glacier",path:"glacier",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a.Midnight,darkerFade:!1,rotation:0},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:a["RaaS SBS"],darkerFade:!1,rotation:0}],r.ENABLE_DEBUG&&(r.LightPresets=r.LightPresets.concat(r.DebugEnvironments)),r.copyLightPreset=function(e,t){o.ObjectAssign(t,e),t.name=e.name+" (copy)"},r.CreateCubeMapFromColors=function(e,t){for(var i=255*e.x,n=255*e.y,o=255*e.z,r=255*t.x,s=255*t.y,a=255*t.z,l=new Uint8Array(16),c=new Uint8Array(16),d=new Uint8Array(16),u=0;u<4;u++)l[4*u]=i,l[4*u+1]=n,l[4*u+2]=o,l[4*u+3]=255,c[4*u]=r,c[4*u+1]=s,c[4*u+2]=a,c[4*u+3]=255,u>1?(d[4*u]=i,d[4*u+1]=n,d[4*u+2]=o,d[4*u+3]=255):(d[4*u]=r,d[4*u+1]=s,d[4*u+2]=a,d[4*u+3]=255)
var h=new THREE.DataTexture(d,2,2,THREE.RGBAFormat),p=new THREE.DataTexture(d,2,2,THREE.RGBAFormat),m=new THREE.DataTexture(c,2,2,THREE.RGBAFormat),g=new THREE.DataTexture(l,2,2,THREE.RGBAFormat),f=new THREE.DataTexture(d,2,2,THREE.RGBAFormat),v=new THREE.DataTexture(d,2,2,THREE.RGBAFormat),E=new THREE.Texture(null,THREE.CubeReflectionMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat)
return E.image=[p,h,g,m,v,f],E.needsUpdate=!0,E}
var l=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268],c=new Float32Array(4),d=new Float32Array(4)
r.DecodeEnvMap=function(n,o,s,a){if(!n.LogLuv)return void r.logger.warn("Environment map expected to be in LogLuv format.")
for(var l=Math.pow(2,o),u=Array.isArray(n.image)?n.image:[n.image],h=0;h<u.length;h++)for(var p=u[h],m=0;m<p.mipmaps.length;m++){var g,f=p.mipmaps[m],v=f.data
s?(g=new Uint16Array(v.length/4*3),f.data=g):g=v.buffer
for(var E=0,y=0;y<v.length;y+=4)c[0]=v[y]/255,c[1]=v[y+1]/255,c[2]=v[y+2]/255,c[3]=v[y+3]/255,e(d,c),s?(i(c,d,l),g[E++]=r.FloatToHalf(c[0]),g[E++]=r.FloatToHalf(c[1]),g[E++]=r.FloatToHalf(c[2])):(t(c,d,l),v[y]=Math.round(255*c[0]),v[y+1]=Math.round(255*c[1]),v[y+2]=Math.round(255*c[2]),v[y+3]=Math.round(255*c[3]))}n.LogLuv=!1,s?(n.type=THREE.HalfFloatType,n.format=THREE.RGBFormat,n.RGBM=!1,n.GammaEncoded=!0):n.RGBM=!0,a&&a(n)},r.imageWorker=null
var u=1
r.DecodeEnvMapAsync=function(e,t,i,o){if(!e.LogLuv)return void r.logger.warn("Environment map expected to be in LogLuv format.")
r.imageWorker||(r.imageWorker=r.createWorker())
var s=u++,a=function(t){if(t.data.id===s){r.imageWorker.removeEventListener("message",a)
var n=t.data.map
e.image=n.image,e.LogLuv=!1,i?(e.type=THREE.HalfFloatType,e.format=THREE.RGBFormat,e.RGBM=!1,e.GammaEncoded=!0):e.RGBM=!0,o(e)}}
r.imageWorker.addEventListener("message",a),r.imageWorker.postMessage({operation:"DECODE_ENVMAP",map:e,exposure:t,useHalfFloat:i,id:s},n(e))},s.doDecodeEnvmap=function(e){r.DecodeEnvMap(e.map,e.exposure,e.useHalfFloat),self.postMessage({map:e.map,id:e.id},n(e.map))}}(),function(){"use strict"
function e(e){WGS.MaterialManager.call(this,e)
var t=WGS.MaterialManager.prototype,o=!1
this.hasTransparentMaterial=function(){return o},this.convertOneMaterial=function(e,t,i){var r=e.getData(),s=n.MaterialConverter.convertMaterial(t)
r.doubleSided&&(s.side=THREE.DoubleSide)
var a=this._getMaterialHash(e,i)
if(this.addMaterial(a,s),o=o||s.transparent,t.decals){s.decals=[]
for(var l=0,c=t.decals.length;l<c;l++){var d=t.decals[l],u=n.MaterialConverter.convertMaterial(d.material)
s.decals.push({uv:d.uv||0,material:u}),this.addMaterial(a+"|decal|"+l,u)}}},this.create2DMaterial=function(o,r,s,a,l){var c=o?o.getData():null,d="__lineMaterial__"
r.image&&(d+="|image:"+r.image.name),r.clip&&(d+="|clip:"+JSON.stringify(r.clip)),s&&(d+="|id"),a&&(d+="|selection"),r.skipEllipticals&&(d+="|skipEllipticals"),r.skipCircles&&(d+="|skipCircles"),r.skipTriangleGeoms&&(d+="|skipTriangleGeoms"),r.useInstancing&&(d+="|useInstancing")
var u=this._getMaterialHash(o,d)
if(!this._materials.hasOwnProperty(u)){var h=i.Shaders,p=h.createShaderMaterial(h.LineShader)
if(p.is2d=!0,p.transparent=!0,p.depthWrite=!1,p.depthTest=!1,p.side=THREE.DoubleSide,p.blending=THREE.NormalBlending,s?(p.defines.ID_COLOR=1,p.blending=THREE.NoBlending):a?(p.uniforms.tSelectionTexture.value=a,p.uniforms.vSelTexSize.value.set(a.image.width,a.image.height),p.defines.SELECTION_RENDERER=1,p.uniforms.selectionColor.value=new THREE.Vector4(0,0,1,1)):e&&e.supportsMRT()&&(p.mrtIdBuffer=this._mrtIdBuffer),r.skipEllipticals||(p.defines.HAS_ELLIPTICALS=1),r.skipCircles||(p.defines.HAS_CIRCLES=1),r.skipTriangleGeoms||(p.defines.HAS_TRIANGLE_GEOMS=1),r.useInstancing&&(p.defines.USE_INSTANCING=1),r.image){var m=function(e){e.wrapS=THREE.ClampToEdgeWrapping,e.wrapT=THREE.ClampToEdgeWrapping,e.minFilter=THREE.LinearMipMapLinearFilter,e.magFilter=THREE.LinearFilter,e.anisotropy=1,e.flipY=!0,e.generateMipmaps=!0,e.needsUpdate=!0,p.defines.HAS_RASTER_QUADS=1,p.uniforms.tRaster.value=e,-1!==r.image.dataURI.indexOf("png")&&(p.transparent=!0),p.needsUpdate=!0,l&&l(e)}
n.TextureLoader.loadTextureWithSecurity(r.image.dataURI,THREE.UVMapping,m,c.acmSessionId)}p.modelScale=r.modelScale||1,t.addLineMaterial.call(this,u,p)}return d}}function t(t){return n.hasOwnProperty("MaterialManager")||(e.prototype=new WGS.MaterialManager(t),e.prototype.constructor=e,n.MaterialManager=e),new n.MaterialManager(t)}var i=Autodesk.Viewing,n=i.Private
Autodesk.Viewing.Private.createMaterialManager=t}(),function(){"use strict"
function e(e,t){function i(e,t,i,n,o,r,s){var a=.5*(i-e),l=.5*(n-t)
return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*r+a*o+t}var n,o,r,s,a,l,c,d,u,h=[],p=[]
return n=(e.length-1)*t,o=Math.floor(n),r=n-o,h[0]=0===o?o:o-1,h[1]=o,h[2]=o>e.length-2?o:o+1,h[3]=o>e.length-3?o:o+2,l=e[h[0]],c=e[h[1]],d=e[h[2]],u=e[h[3]],s=r*r,a=r*s,p[0]=i(l[0],c[0],d[0],u[0],r,s,a),p[1]=i(l[1],c[1],d[1],u[1],r,s,a),p[2]=i(l[2],c[2],d[2],u[2],r,s,a),p}var t=Autodesk.Viewing.Private,i={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2},n=function(){this.animations=[]}
n.prototype.init=function(e){if(!0===e.initialized)return e
for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++)if(e.hierarchy[t].keys[i].time<0&&(e.hierarchy[t].keys[i].time=0),void 0!==e.hierarchy[t].keys[i].rot&&!(e.hierarchy[t].keys[i].rot instanceof THREE.Quaternion)){var n=e.hierarchy[t].keys[i].rot
Array.isArray(n)||(n=[n._x,n._y,n._z,n._w]),e.hierarchy[t].keys[i].rot=(new THREE.Quaternion).fromArray(n)}for(var i=1;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time&&(e.hierarchy[t].keys.splice(i,1),i--)
for(var i=0;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].index=i}return e.initialized=!0,e},n.prototype.parse=function(e){function t(e,i){if(i.push(e),e.children&&!(e instanceof THREE.Camera))for(var n=0;n<e.children.length;n++)t(e.children[n],i)}var i=[]
return t(e,i),i},n.prototype.play=function(e){-1===this.animations.indexOf(e)&&this.animations.push(e)},n.prototype.stop=function(e){var t=this.animations.indexOf(e);-1!==t&&this.animations.splice(t,1)},n.prototype.update=function(e){for(var t=0;t<this.animations.length;t++)this.animations[t].update(e)}
var o=function(e,t,n){this.root=e,this.handler=n.animationHandler,this.data=this.handler.init(t),this.hierarchy=this.handler.parse(e),this.viewer=n.viewer,this.animator=n,this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!1,this.delta=.5,this.interpolationType=i.LINEAR,this.setStartAndEndKeyTime()}
o.prototype.setStartAndEndKeyTime=function(){if(this.data.hierarchy.length>0){var e=this.data.hierarchy[0].keys
this.startKeyTime=e[0].time,this.endKeyTime=e[e.length-1].time}else this.startKeyTime=this.endKeyTime=0},o.prototype.keyTypes=[],o.prototype.defaultKey={},o.prototype.play=function(e){this.currentTime=void 0!==e?e:0,this.isPlaying=!0,this.isPaused=!1,this.reset(),this.handler.play(this)},o.prototype.pause=function(){!0===this.isPaused?this.handler.play(this):this.handler.stop(this),this.isPaused=!this.isPaused},o.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.handler.stop(this)},o.prototype.goto=function(e){this.isPlaying||this.play(),this.isPaused||this.pause()
var t=e-this.currentTime
this.update(t)},o.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var i=this.hierarchy[e]
void 0===i.animationCache&&(i.animationCache={}),void 0===i.animationCache[this.data.name]&&(i.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:i.matrix})
for(var n=i.animationCache[this.data.name],o=0;o<this.keyTypes.length;o++){for(var r=this.keyTypes[o],s=this.data.hierarchy[e].keys[0],a=this.getNextKeyWith(r,e,1);a.time<this.currentTime&&a.index>s.index;)s=a,a=this.getNextKeyWith(r,e,a.index+1)
n.prevKey[r]=s,n.nextKey[r]=a}}this.setStartAndEndKeyTime()},o.prototype.getNextKeyWith=function(e,t,n){var o=this.data.hierarchy[t].keys
for(this.interpolationType===i.CATMULLROM||this.interpolationType===i.CATMULLROM_FORWARD?n=n<o.length-1?n:o.length-1:n%=o.length;n<o.length;n++)if(void 0!==o[n][e])return o[n]
return this.data.hierarchy[t].keys[0]},o.prototype.getPrevKeyWith=function(e,t,n){var o=this.data.hierarchy[t].keys
for(n=this.interpolationType===i.CATMULLROM||this.interpolationType===i.CATMULLROM_FORWARD?n>0?n:0:n>=0?n:n+o.length;n>=0;n--)if(void 0!==o[n][e])return o[n]
return this.data.hierarchy[t].keys[o.length-1]},o.prototype.isPlayingOutOfRange=function(){return!1===this.isPaused&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)},o.prototype.resetIfLooped=function(){!0===this.loop&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())}
var r=function(e,t,i){o.call(this,e,t,i),this.localMatrix=new THREE.Matrix4,this.root.getAnimTransform(),this.relativeTransform=!t.custom||!t.custom.transform||"abs"!==t.custom.transform}
r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype.keyTypes=["pos","rot","scl"],r.prototype.defaultKey={pos:0,rot:0,scl:0},r.prototype.update=function(){function t(){n||(n=new THREE.Vector3,o=new THREE.Vector3,r=new THREE.Quaternion,s=new THREE.Matrix4,a=new THREE.Matrix4)}var n,o,r,s,a,l=[]
return function(c){if(!1!==this.isPlaying&&(this.currentTime+=c*this.timeScale,t(),this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var d=0,u=this.hierarchy.length;d<u;d++){for(var h=this.hierarchy[d],p=h.animationCache[this.data.name],m=0;m<this.keyTypes.length;m++){var g=this.keyTypes[m],f=p.prevKey[g],v=p.nextKey[g]
if(v.time<=this.currentTime||f.time>=this.currentTime){for(f=this.data.hierarchy[d].keys[0],v=this.getNextKeyWith(g,d,1);v.time<this.currentTime&&v.index>f.index;)f=v,v=this.getNextKeyWith(g,d,v.index+1)
p.prevKey[g]=f,p.nextKey[g]=v}var E=f[g],y=v[g]
if(v.time!==f.time&&void 0!==E&&void 0!==y){var A=(this.currentTime-f.time)/(v.time-f.time)
if(A<0&&(A=0),A>1&&(A=1),"pos"===g)if(this.interpolationType===i.LINEAR)o.x=E[0]+(y[0]-E[0])*A,o.y=E[1]+(y[1]-E[1])*A,o.z=E[2]+(y[2]-E[2])*A,h.position.copy(o)
else{l[0]=this.getPrevKeyWith("pos",d,f.index-1).pos,l[1]=E,l[2]=y,l[3]=this.getNextKeyWith("pos",d,v.index+1).pos,A=.33*A+.33
var T=e(l,A)
if(o.x=T[0],o.y=T[1],o.z=T[2],h.position.copy(o),this.interpolationType===i.CATMULLROM_FORWARD){var b=e(l,1.01*A)
n.set(b[0],b[1],b[2]),n.sub(vector),n.y=0,n.normalize()
var w=Math.atan2(n.x,n.z)
h.rotation.set(0,w,0)}}else"rot"===g?(THREE.Quaternion.slerp(E,y,r,A),h.quaternion.copy(r)):"scl"===g&&(o.x=E[0]+(y[0]-E[0])*A,o.y=E[1]+(y[1]-E[1])*A,o.z=E[2]+(y[2]-E[2])*A,h.scale.copy(o))}}if(!this.relativeTransform){var C=s.compose(h.position,h.quaternion,h.scale),S=a
h.getOriginalWorldMatrix(S),S.getInverse(S)
var R=s.multiplyMatrices(C,S)
R.decompose(h.position,h.quaternion,h.scale)}h.updateAnimTransform()}}}()
var s=function(e,t,i){o.call(this,e,t,i)}
s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.keyTypes=["pos","up","target","fov","perspective"],s.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0},s.prototype.update=function(){function t(){n||(n=new THREE.Vector3,o=new THREE.Vector3)}var n,o,r=[]
return function(s){if(!1!==this.isPlaying&&(this.currentTime+=s*this.timeScale,t(),this.resetIfLooped(),!this.isPlayingOutOfRange())){for(var a=0,l=this.hierarchy.length;a<l;a++){for(var c=this.hierarchy[a],d=c.animationCache[this.data.name],u=0;u<this.keyTypes.length;u++){var h=this.keyTypes[u],p=d.prevKey[h],m=d.nextKey[h]
if(m.time<=this.currentTime||p.time>=this.currentTime){for(p=this.data.hierarchy[a].keys[0],m=this.getNextKeyWith(h,a,1);m.time<this.currentTime&&m.index>p.index;)p=m,m=this.getNextKeyWith(h,a,m.index+1)
d.prevKey[h]=p,d.nextKey[h]=m}var g=p[h],f=m[h]
if(m.time!==p.time&&void 0!==g&&void 0!==f){var v=(this.currentTime-p.time)/(m.time-p.time)
v<0&&(v=0),v>1&&(v=1)
var E
if("pos"===h)E=c.position
else if("up"===h)E=c.up
else if("target"===h)E=c.target
else{if("fov"===h){c.setFov(g+(f-g)*v)
continue}if("perspective"===h){var y=v>.5?f:g
y?c.toPerspective():c.toOrthographic()
continue}}if(this.interpolationType===i.LINEAR)o.x=g[0]+(f[0]-g[0])*v,o.y=g[1]+(f[1]-g[1])*v,o.z=g[2]+(f[2]-g[2])*v,E.copy(o)
else{r[0]=this.getPrevKeyWith(h,a,p.index-1)[h],r[1]=g,r[2]=f,r[3]=this.getNextKeyWith(h,a,m.index+1)[h],v=.33*v+.33
var A=e(r,v)
if(o.x=A[0],o.y=A[1],o.z=A[2],E.copy(o),this.interpolationType===i.CATMULLROM_FORWARD){var T=e(r,1.01*v)
n.set(T[0],T[1],T[2]),n.sub(E),n.y=0,n.normalize()
var b=Math.atan2(n.x,n.z)
c.rotation.set(0,b,0)}}}}c.matrixAutoUpdate=!0,c.matrixWorldNeedsUpdate=!0}c.lookAt(c.target),this.animator.updateFlag|=this.animator.UPDATE_CAMERA}}}()
var a=function(e,t,i,n){o.call(this,e,t,n),this.nodeId=i,this.epsilon=.1,this.root.setMaterial(this.viewer.matman().cloneMaterial(e.getMaterial()))}
a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype.keyTypes=["vis","opa"],a.prototype.defaultKey={viz:1,opa:1},a.prototype.update=function(){return function(e){if(!1!==this.isPlaying&&(this.currentTime+=e*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var t=0,i=this.hierarchy.length;t<i;t++)for(var n=this.hierarchy[t],o=n.animationCache[this.data.name],r=0;r<this.keyTypes.length;r++){var s=this.keyTypes[r],a=o.prevKey[s],l=o.nextKey[s]
if(l.time<=this.currentTime||a.time>=this.currentTime){for(a=this.data.hierarchy[t].keys[0],l=this.getNextKeyWith(s,t,1);l.time<this.currentTime&&l.index>a.index;)a=l,l=this.getNextKeyWith(s,t,l.index+1)
o.prevKey[s]=a,o.nextKey[s]=l}var c=a[s],d=l[s]
if(l.time!==a.time&&void 0!==c&&void 0!==d){var u=n.getMaterial()
if("vis"===s){var h=Math.abs(this.currentTime-l.time)<this.epsilon,p=h?d:c
this.viewer.visibilityManager.setNodeOff(this.nodeId,!p)}else if("opa"===s){var m=(this.currentTime-a.time)/(l.time-a.time)
m<0&&(m=0),m>1&&(m=1)
var g=c+(d-c)*m
u.transparent=1!==g,u.opacity=g,g>0&&this.viewer.visibilityManager.setNodeOff(this.nodeId,!1)}}}}}()
var l=function(e,t,i){var n=this
null===e&&(e=function(e,t,i){var o=n.container=document.createElement("div"),r=e.name
o.id=r,o.style.cursor="pointer",o.style.visibility=i
var s=document.createElement("div")
s.id=r+"-txt",s.style.cssText="display: none;position: absolute;z-index: 1;",o.appendChild(s)
var a=document.createElement("img"),l=e.custom&&e.custom.att&&1===e.custom.att
a.src=l?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==",a.id=r+"-img",a.style.cssText="display: block;position: absolute;z-index: 1;",o.appendChild(a),t.api.container.appendChild(o),o.addEventListener("click",function(){s.style.display="none"===s.style.display?"block":"none"})
var c=new THREE.SphereGeometry(.01),d=new THREE.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0}),u=new THREE.Mesh(c,d)
return u.visible=!1,void 0===t.overlayScenes.annotation&&t.createOverlayScene("annotation"),t.addOverlay("annotation",u),u}(t,i.viewer,"hidden")),o.call(this,e,t,i),this.id=t.name,this.text="",this.state="hidden",this.epsilon=.1,this.viewer.api.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(t){n.updateText(e.position,n.text)})}
l.prototype=Object.create(o.prototype),l.prototype.constructor=l,l.prototype.keyTypes=["pos","text","vis"],l.prototype.defaultKey={pos:0,text:"",vis:1},l.prototype.stop=function(){o.prototype.stop.call(this),this.container.parentNode.removeChild(this.container),this.viewer.removeOverlay("annotation",this.root),this.root=null},l.prototype.updateText=function(e,t){var i=function(e,t,i){var n=e.clone(),o=new THREE.Matrix4
return t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),o.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),n.applyProjection(o),{x:(n.x+1)*i.width/2+i.offsetLeft,y:(1-n.y)*i.height/2+i.offsetTop}}(e,this.viewer.camera,this.viewer.canvas),n=document.getElementById(this.id+"-txt")
n&&(n.innerHTML=t,n.style.left=i.x+"px",n.style.top=i.y+"px",this.text=t),(n=document.getElementById(this.id+"-img"))&&(n.style.left=i.x+"px",n.style.top=i.y-24+"px")},l.prototype.update=function(){function t(){n||(n=new THREE.Vector3,o=new THREE.Vector3)}var n,o,r=[]
return function(s){if(!1!==this.isPlaying&&(this.currentTime+=s*this.timeScale,t(),this.resetIfLooped(),!this.isPlayingOutOfRange())){if(this.isPaused&&this.currentTime<this.startKeyTime){var a=document.getElementById(this.id)
return void(a&&(a.style.visibility=this.state))}for(var l=0,c=this.hierarchy.length;l<c;l++){for(var d=this.hierarchy[l],u=d.animationCache[this.data.name],h=0;h<this.keyTypes.length;h++){var p=this.keyTypes[h],m=u.prevKey[p],g=u.nextKey[p]
if(g.time<=this.currentTime||m.time>=this.currentTime){for(m=this.data.hierarchy[l].keys[0],g=this.getNextKeyWith(p,l,1);g.time<this.currentTime&&g.index>m.index;)m=g,g=this.getNextKeyWith(p,l,g.index+1)
u.prevKey[p]=m,u.nextKey[p]=g}var f=m[p],v=g[p]
if(g.time!==m.time&&void 0!==f&&void 0!==v){var E=(this.currentTime-m.time)/(g.time-m.time)
if(E<0&&(E=0),E>1&&(E=1),"pos"===p){if(this.interpolationType===i.LINEAR)o.x=f[0]+(v[0]-f[0])*E,o.y=f[1]+(v[1]-f[1])*E,o.z=f[2]+(v[2]-f[2])*E,d.position.copy(o)
else if(this.interpolationType===i.CATMULLROM||this.interpolationType===i.CATMULLROM_FORWARD){r[0]=this.getPrevKeyWith("pos",l,m.index-1).pos,r[1]=f,r[2]=v,r[3]=this.getNextKeyWith("pos",l,g.index+1).pos,E=.33*E+.33
var y=e(r,E)
if(o.x=y[0],o.y=y[1],o.z=y[2],d.position.copy(o),this.interpolationType===i.CATMULLROM_FORWARD){var A=e(r,1.01*E)
n.set(A[0],A[1],A[2]),n.sub(vector),n.y=0,n.normalize()
var T=Math.atan2(n.x,n.z)
d.rotation.set(0,T,0)}}}else if("text"===p){var b=Math.abs(this.currentTime-g.time)<this.epsilon?v:f
this.updateText(d.position,b)}else if("vis"===p){var a=document.getElementById(this.id)
if(a){var w=Math.abs(this.currentTime-g.time)<this.epsilon?v:f
a.style.visibility=w?"visible":"hidden"}}}}d.matrixAutoUpdate=!0,d.matrixWorldNeedsUpdate=!0}}}}()
var c=function(e,t,i){this.viewer=i.viewer,null===e&&(e=this.createPolyline([])),o.call(this,e,t,i),this.epsilon=.1}
c.prototype=Object.create(o.prototype),c.prototype.constructor=c,c.prototype.keyTypes=["points","vis"],c.prototype.defaultKey={points:[],vis:1},c.prototype.stop=function(){o.prototype.stop.call(this),this.viewer.removeOverlay("polyline",this.root),this.root=null},c.prototype.update=function(){function e(e){e.root&&(e.viewer.removeOverlay("polyline",e.root),e.root=null)}return function(t){if(!1!==this.isPlaying&&(this.currentTime+=t*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange())){if(this.isPaused&&this.currentTime<this.startKeyTime)return void e(this)
for(var i=0,n=this.hierarchy.length;i<n;i++)for(var o=this.hierarchy[i],r=o.animationCache[this.data.name],s=0;s<this.keyTypes.length;s++){var a=this.keyTypes[s],l=r.prevKey[a],c=r.nextKey[a]
if(c.time<=this.currentTime||l.time>=this.currentTime){for(l=this.data.hierarchy[i].keys[0],c=this.getNextKeyWith(a,i,1);c.time<this.currentTime&&c.index>l.index;)l=c,c=this.getNextKeyWith(a,i,c.index+1)
r.prevKey[a]=l,r.nextKey[a]=c}var d=l[a],u=c[a]
if(c.time!==l.time&&void 0!==d&&void 0!==u){var h=(this.currentTime-l.time)/(c.time-l.time)
if(h<0&&(h=0),h>1&&(h=1),"points"===a){var p=h<.5?d:u
this.viewer.removeOverlay("polyline",this.root),this.root=null
for(var m=[],g=0;g<p.length;g++){var f=p[g].slice()
if(0===g)f[0]=d[g][0]+(u[g][0]-d[g][0])*h,f[1]=d[g][1]+(u[g][1]-d[g][1])*h,f[2]=d[g][2]+(u[g][2]-d[g][2])*h
else if(g===p.length-1){var v=d.length-1,E=u.length-1
f[0]=d[v][0]+(u[E][0]-d[v][0])*h,f[1]=d[v][1]+(u[E][1]-d[v][1])*h,f[2]=d[v][2]+(u[E][2]-d[v][2])*h}var y=new THREE.Vector3(f[0],f[1],f[2])
m.push(y)}this.root=this.createPolyline(m)}else if("vis"===a){var A=Math.abs(this.currentTime-c.time)<this.epsilon?u:d
this.root.visible=A,A||e(this)}}}}}}(),c.prototype.createPolyline=function(e){for(var t=new THREE.Geometry,i=0;i<e.length;i++)t.vertices.push(e[i])
t.computeLineDistances()
var n=new THREE.LineDashedMaterial({color:0,dashSize:1,gapSize:.5,linewidth:1}),o=new THREE.Line(t,n,THREE.LineStrip)
return void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline"),this.viewer.addOverlay("polyline",o),o},t.Animation=o,t.AnimationHandler=n,t.MeshAnimation=r,t.CameraAnimation=s,t.PolylineAnimation=c,t.VisibilityAnimation=a,t.AnnotationAnimation=l}(),function(){"use strict"
var e=Autodesk.Viewing.Private,t=function(e,t){this.animations=[],this.viewer=e,this.keys=[],this.isPlaying=!1,this.isPaused=!0,this.updateFlag=0,this.duration=t,this.currentTime=0,this.onPlayCallback=null,this.animationHandler=new Autodesk.Viewing.Private.AnimationHandler,this.areCameraAnimationsPaused=!1,this.UPDATE_SCENE=1,this.UPDATE_CAMERA=2}
t.prototype.destroy=function(){this.stop(),this.viewer=null,this.keys=null,this.animations=null,this.isPlaying=!1,this.isPaused=!1,this.animationHandler=null},t.prototype.add=function(t){if(!(!t.hierarchy||t.hierarchy.length<1||!t.hierarchy[0].keys||t.hierarchy[0].keys.length<2)){var i=null,n=this
if("camera"===t.type?(i=new e.CameraAnimation(n.viewer.camera,t,n),n.animations.push(i)):"annotation"===t.type?(i=new e.AnnotationAnimation(null,t,n),n.animations.push(i)):"polyline"===t.type?(i=new e.PolylineAnimation(null,t,n),n.animations.push(i)):"mesh"!==t.type&&"visibility"!==t.type||n.viewer.model.getData().instanceTree.enumNodeFragments(t.id,function(o){var r=n.viewer.getFragmentProxy(n.viewer.model,o)
r&&(i="mesh"===t.type?new e.MeshAnimation(r,t,n):new e.VisibilityAnimation(r,t,t.id,n),n.animations.push(i))},!0),i){for(var o=0,r=t.hierarchy.length;o<r;o++)for(var s=t.hierarchy[o].keys,a=0;a<s.length;a++)void 0===s[a].xk&&n.keys.push(s[a].time)
!function(e){e.sort(function(e,t){return e-t}),function(e,t,i){for(t=e.length;i=--t;)for(;i--;)e[t]!==e[i]||e.splice(i,1)}(e)}(n.keys)}this.updateFlag|=this.UPDATE_SCENE}},t.prototype.update=function(e){this.animationHandler.update(e)
var t=this.updateFlag
return this.isPlaying&&!this.isPaused&&(this.currentTime+=e,this.currentTime=Math.min(this.currentTime,this.duration),this.onPlayCallback&&this.onPlayCallback(this.duration>0?this.currentTime/this.duration*100:0),this.currentTime>=this.duration&&this.pause(),t|=this.UPDATE_SCENE),this.updateFlag=0,t},t.prototype.play=function(e,t){if(this.onPlayCallback=t,this.currentTime>=this.duration&&this.goto(0),this.isPlaying)return void this.pause()
for(var i=0;i<this.animations.length;i++){this.animations[i].play(e)}this.isPlaying=!0,this.isPaused=!1},t.prototype.pause=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e]
t.isPaused===this.isPaused&&t.pause()}this.isPaused=!this.isPaused,this.areCameraAnimationsPaused=this.isPaused},t.prototype.pauseCameraAnimations=function(){for(var e=0;e<this.animations.length;e++){var t=this.animations[e]
t instanceof Autodesk.Viewing.Private.CameraAnimation&&t.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused},t.prototype.stop=function(){for(var e=0;e<this.animations.length;e++){this.animations[e].stop()}this.isPlaying=!1,this.isPaused=!1},t.prototype.goto=function(e){if(void 0!==e){for(var t=0;t<this.animations.length;t++){this.animations[t].goto(e)}this.isPlaying=!0,this.isPaused=!0,this.currentTime=e,this.updateFlag|=this.UPDATE_SCENE}},t.prototype.next=function(){var e=function(e,t){for(var i=-1,n=0;n<t.length;n++)if(t[n]>e){i=t[n]
break}return i<0?t[t.length-1]:i}(this.currentTime,this.keys)
this.goto(e)},t.prototype.prev=function(){var e=function(e,t){for(var i=-1,n=t.length-1;n>-1;n--)if(t[n]<e){i=t[n]
break}return i<0?t[0]:i}(this.currentTime,this.keys)
this.goto(e)},e.KeyFrameAnimator=t}()
var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,ENABLE_DEBUG=!1
!function(){"use strict"
function e(e,t){function i(e){if(!e)return null
var t=window.devicePixelRatio
t||(t=1)
var i=av.InitParametersSetting
i.canvas=e,i.devicePixelRatio=t
var n=new avp.FireflyWebGLRenderer(i)
return n.context?(n.autoClear=!1,n.sortObjects=!1,n):null}function n(e){var t=K.phase,i=t==avp.RENDER_NORMAL,n=(U.settings.idbuffer||U.settings.occlusionid)&&t!=avp.RENDER_HIDDEN
n&&U.settings.occlusionid&&e instanceof avp.RenderBatch&&e.sortObjects&&(n=!1),t==avp.RENDER_HIDDEN?e.overrideMaterial=Q.fadeMaterial:t==avp.RENDER_HIGHLIGHTED&&(e.overrideMaterial=Q.highlightMaterial),U.renderScenePart(e,!0,i,n),e.overrideMaterial=null}function o(e){Ee++,fe<=e&&fe>0&&(ve=.8*ve+.2*(e-fe)),Q.fpsCallback&&Q.fpsCallback(Q.fps())}function r(e){if(Q.keyFrameAnimator){var t=fe>0?(e-fe)/1e3:0,i=Q.keyFrameAnimator.update(t)
if(i&&(Q.sceneUpdated(!0),i&Q.keyFrameAnimator.UPDATE_CAMERA))return!0}return!1}function s(){H&&(Q.camera.aspect=B/F,Q.camera.clientWidth=B,Q.camera.clientHeight=F,U.setSize(B,F),Q.controls.handleResize(),X&&X.setSize(B,F),Q.invalidate(!0,!0,!0),H=!1,Q.api.fireEvent({type:av.VIEWER_RESIZE_EVENT,width:B,height:F}))}function a(){if((Y.enabled||X)&&!Q.is2d){var e
if(e=Q.model&&!Q.model.isLoadDone()?Q.model.getData().bbox:Q.getVisibleBounds(!0,!1)){var t=Q.camera,i=e.clone(),n=new THREE.Vector3(1,0,0),o=re.clone()
t.worldUpTransform&&(i.applyMatrix4(t.worldUpTransform),n.applyMatrix4(t.worldUpTransform),o.applyMatrix4(t.worldUpTransform)),i.min.y-=.005*(i.max.y-i.min.y),W&&W.expandByGroundShadow(i,o)
var r=i.size(),s=i.center()
if(W||(r.x*=1.25,r.z*=1.25,r.x=r.z=Math.max(r.x,r.z)),t.worldUpTransform){var a=(new THREE.Matrix4).getInverse(t.worldUpTransform)
s.applyMatrix4(a)}if(Y.setTransform(s,r,t.worldup,n),X){var l=(new THREE.Vector3).subVectors(s,t.worldup.clone().multiplyScalar(r.y/2))
X.setTransform(l,t.worldup,r)}W&&W.setGroundShadowTransform(s,r,t.worldup,n)}}}function l(){return!!ue&&(a(),Y.setDirty(),ue=!1,!0)}function c(e){for(var t in Q.selectionMeshes){var i=Q.selectionMeshes[t]
if(i.model){var n=i.model.getFragmentList()
i.geometry===n.getGeometry(i.fragId)&&n.getWorldMatrix(i.fragId,i.matrix)}}}function d(){W&&(W.state=avp.SHADOWMAP_NEEDS_UPDATE)}function u(){this.highResTimeStamp=-1,this.screenDrawn=!1,this.screenHasChanged=!1,this.frameBudget=0,this.frameRemaining=0,this.phase=avp.RENDER_NORMAL,this.signalProgressByRendering=!1,this.tickCount=0,this.beginFrameAvg=0,this.lastBeginFrameTimeStamp=0,this.RENDERMODE_FULL=0,this.RENDERMODE_PROGRESSIVE=1,this.RENDERMODE_SILENT=2,this.renderType=this.RENDERMODE_FULL,this.INITIAL_GROUND_SHADOW=.2,this.cmdListActive=!1,this.cmdIndex=0,this.continueExecution=!0,this.encounteredAlwaysDo=!1,this.finishedFullRender=!0,this.groundShadowInPost=!1,this.drawOverlay=!1,this.cmdIsOpen=!1,this.allocArraySize=0,this.cmdListLength=0,this.cmdList=[],this.paramList=[],this.CMD_NORMAL_SEQUENCE=0,this.CMD_DO_AFTER=1,this.CMD_ALWAYS_DO=2,this.isActive=function(){return this.cmdListActive},this.setFrame=function(e){this.frameBudget=e},this.beginCommandSet=function(){this.cmdListActive=!0,this.cmdIndex=0,this.cmdListLength=0,this.encounteredAlwaysDo=!1,this.tickCount=0,this.screenDrawn=!1,this.screenHasChanged=!1},this.endCommandSet=function(){this.cmdIsOpen&&(this.cmdIsOpen=!1,this.cmdListLength++)},this._internalSetParam=function(e,t){this.paramList[this.cmdIndex][e]=t},this.addCommand=function(e,t){for(this.cmdIsOpen&&this.cmdListLength++,this.cmdIsOpen=!0;this.allocArraySize<=this.cmdListLength;)this.cmdList[this.cmdListLength]={},this.paramList[this.cmdListLength]={},this.allocArraySize++
return this.cmdList[this.cmdListLength]=e,this.paramList[this.cmdListLength].executionLevel=t||this.CMD_NORMAL_SEQUENCE,this.encounteredAlwaysDo=this.encounteredAlwaysDo||t===this.CMD_ALWAYS_DO,this.cmdListLength},this.setParam=function(e,t){this.cmdIsOpen?this.paramList[this.cmdListLength][e]=t:ENABLE_DEBUG&&avp.logger.error("ERROR: cannot set param when no command is open!")},this.getParam=function(e){return ENABLE_DEBUG&&void 0===this.paramList[this.cmdIndex][e]&&avp.logger.error("ERROR: parameter "+e+" was never set for this command! Go fix it."),this.paramList[this.cmdIndex][e]},this.executeCommandList=function(){if(K.cmdListActive){this.frameRemaining=this.frameBudget,ENABLE_DEBUG&&this.cmdIsOpen&&avp.logger.error("ERROR: should call endCommandSet before executing"),this.continueExecution=!0
var e
if(ENABLE_DEBUG&&(0===this.tickCount&&console.log("==================="),console.log("Running commands for "+(K.renderType===K.RENDERMODE_PROGRESSIVE?"progressive":K.renderType===K.RENDERMODE_FULL?"full":"silent")+" render, for tick count "+this.tickCount)),this.encounteredAlwaysDo)for(var t=0;t<this.cmdIndex;)this.paramList[t].executionLevel>=K.CMD_ALWAYS_DO&&(ENABLE_DEBUG&&console.log("  ALWAYS DO command "+t+": "+this.cmdList[t].name),this.cmdList[t]()),t++
for(;this.cmdIndex<this.cmdListLength;)(this.continueExecution||this.paramList[this.cmdIndex].executionLevel>=K.CMD_DO_AFTER)&&(ENABLE_DEBUG&&console.log("  command "+this.cmdIndex+": "+this.cmdList[this.cmdIndex].name+" and "+K.frameRemaining+" frame budget remaining"),this.cmdList[this.cmdIndex]()&&(ENABLE_DEBUG&&console.log("  >>> out of tick time with "+K.frameRemaining),e=this.cmdIndex,this.continueExecution=!1)),this.cmdIndex++
return this.continueExecution?this.cmdListActive=!1:this.cmdIndex=e,this.tickCount++,!this.continueExecution}return!0}}function h(){if(K.renderType===K.RENDERMODE_PROGRESSIVE)if(K.getParam("GenerateGroundShadow.afterBeauty")){if(K.frameRemaining=Y.prepareGroundShadow(Q.modelQueue(),0,K.frameRemaining),Y.getStatus()==avp.GROUND_RENDERED){if(K.getParam("GenerateGroundShadow.signalRedraw"))return Q.requestSilentRender(),ENABLE_DEBUG&&console.log(" $$$$ SIGNAL FULL GROUND SHADOW REDRAW"),!0
K.groundShadowInPost=!0}}else 0===K.tickCount&&Y.prepareGroundShadow(Q.modelQueue(),10)
else K.frameRemaining=Y.prepareGroundShadow(Q.modelQueue(),0,K.frameRemaining)
return K.frameRemaining<0&&Y.getStatus()===avp.GROUND_UNFINISHED}function p(){return Y.getStatus()!==avp.GROUND_UNFINISHED&&Q.renderGroundShadow(),!1}function m(){return K.renderType===K.RENDERMODE_PROGRESSIVE?K.getParam("GenerateGroundReflection.afterBeauty")?(K.frameRemaining=X.prepareGroundReflection(Y,Q,!1,0,K.frameRemaining),X.getStatus()==avp.GROUND_RENDERED&&(K.screenDrawn=!0,K.groundShadowInPost&&G.hasTransparentMaterial()&&Q.requestDeferredSilentRender())):0===K.tickCount&&X.prepareGroundReflection(Y,Q,!0,10):K.frameRemaining=X.prepareGroundReflection(Y,Q,!1,0,K.frameRemaining),K.frameRemaining<0&&X.getStatus()===avp.GROUND_UNFINISHED}function g(){if(W.state===avp.SHADOWMAP_NEEDS_UPDATE)K.frameRemaining=W.startUpdate(q,K.frameRemaining,Q.camera,re,G)
else if(W.state==avp.SHADOWMAP_INCOMPLETE&&(K.frameRemaining=W.continueUpdate(q,K.frameRemaining,G),W.state==avp.SHADOWMAP_VALID))return Q.requestSilentRender(),ENABLE_DEBUG&&console.log(" $$$$ SIGNAL FULL SHADOW MAP REDRAW"),!0
return K.frameRemaining<0&&W.state!==avp.SHADOWMAP_VALID}function f(){W.state=avp.SHADOWMAP_NEEDS_UPDATE}function v(){if(K.signalProgressByRendering&&Q.signalProgress(0,av.ProgressState.RENDERING),K.renderType===K.RENDERMODE_PROGRESSIVE){if(K.lastBeginFrameTimeStamp>0){var e=K.highResTimeStamp-K.lastBeginFrameTimeStamp
K.beginFrameAvg=.75*K.beginFrameAvg+.25*e}K.lastBeginFrameTimeStamp=K.highResTimeStamp,K.beginFrameAvg<$&&K.frameBudget<J?(Q.targetFrameBudget+=1,Q.targetFrameBudget>J&&(Q.targetFrameBudget=J)):K.beginFrameAvg>$&&K.frameBudget>ee&&(Q.targetFrameBudget-=1,Q.targetFrameBudget<ee&&(Q.targetFrameBudget=ee))}Q.updateCameraMatrices()
var t=K.getParam("BeginScene.clear")
return U.beginScene(Q.scene,Q.camera,Q.lightsOn?Q.lights:Q.no_lights,t),K.screenDrawn=K.screenDrawn||t,K.getParam("BeginScene.signalCameraChanged")&&Q.api.fireEvent(Q.cameraChangedEvent),!1}function E(){return K.phase=K.getParam("BeginPhase.phase"),ENABLE_DEBUG&&console.log("     render phase is now "+K.phase),q.reset(Q.camera,K.phase,K.getParam("BeginPhase.moved")),!1}function y(){return q.isEmpty()||q.isDone()||(K.screenDrawn=!0,K.frameRemaining=q.renderSome(n,K.frameRemaining,Se),K.signalProgressByRendering&&(Q.signalProgress(100*q.getRenderProgress(),av.ProgressState.RENDERING),ENABLE_DEBUG&&console.log("  %%% percent done "+100*q.getRenderProgress()))),!q.isDone()}function A(){return K.phase=avp.RENDER_FINISHED,U.renderScenePart(Q.sceneAfter,!0,!0,!0),Q.renderAfters.render(),!1}function T(){return K.phase=avp.RENDER_FINISHED,!1}function b(){Q.signalProgress(100,av.ProgressState.RENDERING)}function w(){return Q.isOverlayDirty()&&(Q.clearOverlayDirtyFlag(),K.drawOverlay=!0),K.drawOverlay&&(!q.isEmpty()&&q.isDone()||Q.showOverlaysWhileMoving?(Q.renderOverlays(),K.screenDrawn=!0):(U.clearAllOverlays(),K.drawOverlay=!1)),!1}function C(){K.screenDrawn=!0}function S(){return!K.screenDrawn||K.phase!==avp.RENDER_FINISHED&&K.tickCount%Q.frameDisplayRate!=0||(U.composeFinalFrame(!K.getParam("PostAndPresent.performAO")),K.screenHasChanged=!0,K.screenDrawn=!1,o(K.highResTimeStamp),Q.api.fireEvent({type:av.RENDER_PRESENTED_EVENT})),!1}function R(){return ENABLE_DEBUG&&!1===U.getAOEnabled()&&avp.logger.error("AO should be on at this point!"),U.setAOEnabled(!1),!1}function x(){return ENABLE_DEBUG&&!0===U.getAOEnabled()&&avp.logger.error("AO should be off at this point!"),U.setAOEnabled(!0),!1}function P(){return Q.requestSilentRender(),!1}function k(){return K.finishedFullRender=!0,!1}function M(e){K.highResTimeStamp=e=e||0
var t=G.updateMaterials()
Q.invalidate(t.needsClear,t.needsRender,t.overlayDirty)
var i=r(e),n=Q.controls.update(e),o=q&&q.update(e),a=n||i||j||o
Se.moved=a,j=!1
var d=H
s(),ae=ae||a,ce=ce||a
var u=!1
ce?c(e):U.overlayUpdate()&&!ce&&(ce=u=!0),K.signalProgressByRendering=Q.model&&(Q.model.isLoadDone()||!0===Q.model.myData.partPacksLoadDone),l()&&(ae=!0)
var M=ae,V=q.frameResumePossible()
if(ae=ae||!V,me=me||pe&&!K.cmdListActive,ae||le||ce||me)if(K.drawOverlay=ce,ae||le||me){var I,L=M?WGS.RESET_RELOAD:WGS.RESET_NORMAL
ae||le?Q.progressiveRender?(K.renderType=K.RENDERMODE_PROGRESSIVE,I=Q.targetFrameBudget):(K.renderType=K.RENDERMODE_FULL,I=Q.interruptBudget):(K.renderType=K.RENDERMODE_SILENT,I=Q.targetFrameBudget,ae=!0,L=WGS.RESET_REDRAW),pe=me=!1,K.setFrame(I),K.finishedFullRender=!1,K.beginCommandSet()
var D=Y.enabled&&!Q.is2d&&!ye,N=!!X&&!Q.is2d&&!ye,_=a||d,O=a&&Q.skipAOWhenMoving&&U.getAOEnabled()
K.addCommand(v),K.setParam("BeginScene.signalCameraChanged",_),K.setParam("BeginScene.clear",ae),O&&K.addCommand(R,K.CMD_ALWAYS_DO),q&&(W&&W.state!==avp.SHADOWMAP_VALID&&K.addCommand(g),D&&(K.addCommand(h),K.setParam("GenerateGroundShadow.afterBeauty",!1),K.setParam("GenerateGroundShadow.signalRedraw",!1)),N?(X.setDirty(),K.addCommand(m),K.setParam("GenerateGroundReflection.afterBeauty",!1)):D&&K.addCommand(p),q.hasHighlighted()&&(K.addCommand(E),K.setParam("BeginPhase.phase",avp.RENDER_HIGHLIGHTED),K.setParam("BeginPhase.moved",L),L=!1,K.addCommand(y)),K.addCommand(E),K.setParam("BeginPhase.phase",avp.RENDER_NORMAL),K.setParam("BeginPhase.moved",L),L=!1,K.addCommand(y),!q.areAllVisible()&&Q.showGhosting?(N&&K.renderType===K.RENDERMODE_PROGRESSIVE||(K.addCommand(E),K.setParam("BeginPhase.phase",avp.RENDER_HIDDEN),K.setParam("BeginPhase.moved",L),K.addCommand(y)),K.addCommand(T)):K.addCommand(A),K.signalProgressByRendering&&K.addCommand(b)),K.addCommand(w,K.renderType===K.RENDERMODE_PROGRESSIVE?K.CMD_DO_AFTER:K.CMD_NORMAL_SEQUENCE),K.addCommand(S,K.renderType===K.RENDERMODE_PROGRESSIVE?K.CMD_DO_AFTER:K.CMD_NORMAL_SEQUENCE),K.setParam("PostAndPresent.performAO",U.getAOEnabled()&&!O),K.renderType===K.RENDERMODE_PROGRESSIVE&&q&&(W&&W.state!==avp.SHADOWMAP_VALID&&(K.addCommand(f),K.addCommand(g)),D&&(K.addCommand(h),K.setParam("GenerateGroundShadow.afterBeauty",!0),K.setParam("GenerateGroundShadow.signalRedraw",!N),K.signalProgressByRendering&&K.addCommand(b)),N&&(K.groundShadowInPost=!1,K.addCommand(m),K.setParam("GenerateGroundReflection.afterBeauty",!0),!q.areAllVisible()&&Q.showGhosting&&(K.addCommand(E),K.setParam("BeginPhase.phase",avp.RENDER_HIDDEN),K.setParam("BeginPhase.moved",L),K.addCommand(y)),K.addCommand(T),K.addCommand(S),K.setParam("PostAndPresent.performAO",U.getAOEnabled()&&!O),K.signalProgressByRendering&&K.addCommand(b))),O&&(K.addCommand(x,K.CMD_ALWAYS_DO),K.addCommand(P)),K.addCommand(k),K.endCommandSet(),ae=!1,le=!1,ce=!1}else K.finishedFullRender&&(K.beginCommandSet(),ENABLE_DEBUG&&console.log("=====\nOVERLAY DIRTY"),u?K.addCommand(C):K.addCommand(w,!0),K.addCommand(S,!0),K.setParam("PostAndPresent.performAO",U.getAOEnabled()),K.endCommandSet(),ce=!1)
K.executeCommandList(),he!==K.screenHasChanged&&(he=K.screenHasChanged,Q.api.fireEvent({type:av.FINAL_FRAME_RENDERED_CHANGED_EVENT,value:{finalFrame:!K.cmdListActive}})),fe=K.highResTimeStamp}function V(){for(var e in Q.selectionMeshes){var t=Q.selectionMeshes[e]
t.model&&t.model.isConsolidated()&&t.model.updateRenderProxy(t,t.fragId)}}function I(e){function t(){if(i.animations){Q.keyFrameAnimator=new avp.KeyFrameAnimator(Q,i.animations.duration)
for(var e in i.animations.animations)Q.keyFrameAnimator.add(i.animations.animations[e])
Q.keyFrameAnimator.goto(0),Q.api.fireEvent({type:av.ANIMATION_READY_EVENT})}Q.api.removeEventListener(av.OBJECT_TREE_CREATED_EVENT,t)}var i=e.getData()
e.isObjectTreeCreated()?t():Q.api.addEventListener(av.OBJECT_TREE_CREATED_EVENT,t)}function L(e,t){xe=xe||new THREE.Box3,t.updateMatrixWorld(!0),t.traverse(function(t){var i=t.geometry
void 0!==i&&i.visible&&(i.boundingBox||i.computeBoundingBox(),xe.copy(i.boundingBox),xe.applyMatrix4(t.matrixWorld),e.union(xe))})}function D(){var e=new THREE.Box3,t=Q.overlayScenes
for(var i in t)t.hasOwnProperty(i)&&L(e,t[i].scene)
return L(e,Q.scene),e}function N(e){var t,i,n
if(-1==e.indexOf(";base64,"))return t=e.split(","),i=t[0].split(":")[1],n=decodeURIComponent(t[1]),new Blob([n],{type:i})
t=e.split(";base64,"),i=t[0].split(":")[1],n=window.atob(t[1])
for(var o=n.length,r=new Uint8Array(o),s=0;s<o;++s)r[s]=n.charCodeAt(s)
return new Blob([r],{type:i})}var _,O,H,B,F,G,z,U,W,j,Y,X,q,K,Z,Q=this,J=1e3/15,$=1e3/30,ee=1e3/120,te=-1,ie=-1,ne="y",oe=null,re=null,se=null,ae=!1,le=!1,ce=!1,de={type:Autodesk.Viewing.PROGRESS_UPDATE_EVENT,state:Autodesk.Viewing.ProgressState.LOADING,percent:0},ue=!1,he=!1,pe=!1,me=!1,ge=0,fe=0,ve=1e3/60,Ee=0,ye=!0,Ae=!1,Te=!1,be=null,we=null,Ce=av.getGlobal(),Se={visibleIdCB:function(){return U?U.copyOcclusionIds():null},occlusionTestCB:function(e,t,i,n,o){return U?U.occlusionTest(e,t,i,n,o):Promise.resolve(!0)}}
e&&setInterval(function(){ye||Ee<60||Q.track({name:"fps",value:Number(Q.fps().toFixed(2)),aggregate:"last"})},3e4),this.api=t,this.canvas=e,this.loader=null,this.initialize=function(){if(_=new THREE.Vector3(0,1,0),q=new avp.RenderScene,(z=i(e))||av.isNodeJS){U=new avp.RenderContext,U.init(z,e?e.clientWidth:0,e?e.clientHeight:0),this.use2dInstancing=av.isMobileDevice()&&this.glrenderer().supportsInstancedArrays(),G=new avp.createMaterialManager(z),avp.init_UnifiedCamera(THREE),this.camera=new av.UnifiedCamera(e?e.clientWidth:512,e?e.clientHeight:512),this.lightsOn=!1,this.lights=[],this.no_lights=[],be=(new THREE.Color).setRGB(1,1,1),we=(new THREE.Color).setRGB(1,1,1),this.cameraChangedEvent=this.camera.getCameraChangedEvent(),oe=new THREE.Vector3(1,1,1),re=(new THREE.Vector3).copy(oe),se=new THREE.Vector3(-1,0,1),this.scene=new THREE.Scene,this.sceneAfter=new THREE.Scene,this.sceneAfter.sortObjects=!1,this.renderAfters=new avp.RenderCallbacks,this.overlayScenes={},this.selectionMaterial2d=null,this.selectionMaterialBase=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.selectionMaterialTop=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:.15,transparent:!0}),this.selectionMaterialTop.packedNormals=!0,this.selectionMaterialBase.packedNormals=!0,Re("selection",this.selectionMaterialBase,this.selectionMaterialTop),this.createOverlayScene("selection_points",null,null),this.selectionMeshes={},this.fadeMaterial=new THREE.MeshPhongMaterial({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1}),this.fadeMaterial.packedNormals=!0,G.addInstancingSupport(this.fadeMaterial),G.addMaterial("__fadeMaterial__",this.fadeMaterial,!0),this.highlightMaterial=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.highlightMaterial.packedNormals=!0,G.addInstancingSupport(this.highlightMaterial),G.addMaterial("__highlightMaterial__",this.highlightMaterial,!0),this.progressiveRender=!0,this.swapBlackAndWhite=!1,this.targetFrameBudget=$,this.frameDisplayRate=5,av.isMobileDevice()&&(J*=2,ee/=2,$*=2,this.targetFrameBudget/=2,this.frameDisplayRate/=2),this.interruptBudget=1e10,this.controls={update:function(e){this.camera.lookAt(this.camera.target),this.camera.updateProjectionMatrix(),this.camera.dirty=!1},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){},isToolActivated:function(){return!1}},this.selector=new avp.MultiModelSelector(this),this.visibilityManager=new avp.MultiModelVisibilityManager(this),this.showGhosting=!0,this.showOverlaysWhileMoving=!0,this.skipAOWhenMoving=!1,this.keyFrameAnimator=null,this.zoomBoundsChanged=!0
var t=avp.LightPresets[avp.DefaultLightPreset].bgColorGradient
this.setClearColors(t[0],t[1],t[2],t[3],t[4],t[5]),Y=new av.Shaders.GroundShadow(z),Y.enabled=!0,K=new u,G.addMaterialNonHDR("groundShadowDepthMaterial",Y.getDepthMaterial()),G.addOverrideMaterial("normalsMaterial",U.getDepthMaterial()),G.addOverrideMaterial("edgeMaterial",U.getEdgeMaterial()),U.beginScene(this.scene,this.camera,this.noLights,!0),U.composeFinalFrame(!0,av.isIE11),Z=function(){var e=!!q.getMemoryInfo()
G.toggleDepthWriteTransparent(!e),U.setMemoryLimited(e),e&&(this.toggleGroundReflection(!1),this.toggleGroundShadow(!1))}.bind(this),this.api.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,Z),this.api.addEventListener(av.MODEL_UNLOADED_EVENT,Z)}},this.renderGroundShadow=function(e){W?W.state==avp.SHADOWMAP_VALID&&W.renderGroundShadow(Q.camera,e||U.getColorTarget()):(Y.renderShadow(Q.camera,e||U.getColorTarget()),Y.rendered=!0)},this.setLmvDisplay=function(e){Ce=e},this.run=function(){O=0,setTimeout(function(){!function e(t){O=Ce.requestAnimationFrame(e),M(t)}()},1)},this.toggleProgressive=function(e){this.progressiveRender=e,ae=!0},this.toggleVizBuffer=function(e){var t=this.glrenderer()
t&&this.isvizCacheEnabled!==e&&(this.isvizCacheEnabled=e,this.model&&t&&(this.model.isvizCacheEnabled=e,this.model.readbackTargetIdCallback=this.renderer().readbackTargetId,t.setIdBufferSource(e?WGS.FRAGMENT_ID:WGS.DB_ID)),ae=!0)},this.toggleSwapBlackAndWhite=function(e){this.swapBlackAndWhite=e,U.toggleSwapBlackAndWhite(e),ae=!0},this.toggleGhosting=function(e){this.showGhosting=e,ae=!0},this.toggleOverlaysWhileMoving=function(e){this.showOverlaysWhileMoving=e},this.togglePostProcess=function(e,t){U.initPostPipeline(e,t),this.fireRenderOptionChanged(),ae=!0},this.toggleCelShading=function(e){U.toggleCelShading(e),this.fireRenderOptionChanged(),ae=!0},this.toggleGroundShadow=function(e){Y.enabled!==e&&(Y.enabled=e,Y.clear(),e&&Y.setDirty(),a(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundShadowColor=function(e){Y.enabled&&(Y.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundShadowAlpha=function(e){Y.enabled&&(Y.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleGroundReflection=function(e){e&&X||!e&&!X||(e?(X=new av.Shaders.GroundReflection(z,this.canvas.clientWidth,this.canvas.clientHeight,{clearPass:U.getClearPass()}),X.setClearColors(this.clearColorTop,this.clearColorBottom,av.isAndroidDevice()||av.isIOSDevice()),X.toggleEnvMapBackground(Ae),X.setEnvRotation(U.getEnvRotation()),a()):(X.cleanup(),X=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundReflectionColor=function(e){X&&(X.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundReflectionAlpha=function(e){X&&(X.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleEnvMapBackground=function(e){Ae=e,U.toggleEnvMapBackground(e),X&&X.toggleEnvMapBackground(e),this.invalidate(!0,!0,!1)},this.isEnvMapBackground=function(){return Ae},this.setOptimizeNavigation=function(e){this.skipAOWhenMoving=e},this.renderOverlays=function(){V()
var e=this.lightsOn
e||this.toggleLights(!0,!0)
var t
this.dir_light1&&(t=this.dir_light1.intensity,this.dir_light1.intensity=1),U.renderOverlays(this.overlayScenes,this.lightsOn?this.lights:this.no_lights),e||this.toggleLights(!1,!0),this.dir_light1&&(this.dir_light1.intensity=t)},this.setLayerVisible=function(e,t){this.matman().setLayerVisible(e,t),this.invalidate(!0)},this.isLayerVisible=function(e){return this.matman().isLayerVisible(e)},this.getVisibleLayerIds=function(){var e=this.model.getData(),t=e.layersMap,i=[]
for(var n in t)this.isLayerVisible(n)&&i.push(t[n])
return i},this.updateCameraMatrices=function(){function e(){t=new THREE.Matrix4,i=new THREE.Matrix4,n=new THREE.Box3}var t,i,n
return function(){n||e()
var o=this.camera
if(t.compose(o.position,o.quaternion,o.scale),i.getInverse(t),o.worldup&&this.setWorldUp(o.worldup),this.model){var r=this.getVisibleBounds(!0,ce)
if(n.copy(r),X){var s=new THREE.Vector3
s.multiplyVectors(n.max,o.worldup)
var a=new THREE.Vector3
a.multiplyVectors(n.min,o.worldup),s.sub(a),s.x>=0?n.min.x-=s.x:n.max.x-=s.x,s.y>=0?n.min.y-=s.y:n.max.y-=s.y,s.z>=0?n.min.z-=s.z:n.max.z-=s.z}W&&W.groundShapeBox&&n.union(W.groundShapeBox),n.applyMatrix4(i)
var l=1e-5*(n.max.z-n.min.z),c=.5*(n.max.y-n.min.y),d=-(n.max.z+l)-c,u=-(n.min.z-l)+c
o.isPerspective&&(d=Math.max(d,Math.min(1,1e-4*Math.abs(u-d))),u<0&&(u=1e-4),d=Math.max(d,1e-5*u)),u=Math.max(u,d),o.near=d,o.far=u,o.updateProjectionMatrix()
var h,p
if(this.model.is2d()){var m=this.intersectGroundViewport(new THREE.Vector3(0,0,1))
h=m?o.position.distanceTo(m):o.position.distanceTo(r.center()),p=U.settings.deviceHeight/(2*h*Math.tan(THREE.Math.degToRad(.5*o.fov))),G.updatePixelScale(p),G.updateSwapBlackAndWhite(this.swapBlackAndWhite)}else{var g,f=G.getCutPlanesRaw()
if(f&&f.length){var v=f[0],E=o.target.clone().sub(o.position).normalize(),y=E.dot(v)
if(0===y)g=r.center()
else{var A=-(o.position.clone().dot(v)+v.w)/y
g=r.clampPoint(E.multiplyScalar(A).add(o.position))}}else g=r.center()
h=o.position.distanceTo(g),p=U.settings.deviceHeight/(2*h*Math.tan(THREE.Math.degToRad(.5*o.fov))),G.updatePixelScale(p)}}}}(),this.initLights=function(){this.dir_light1=new THREE.DirectionalLight(be,1),this.dir_light1.position.copy(se),this.amb_light=new THREE.AmbientLight(we),this.lights=[this.dir_light1,this.amb_light],this.camera.add(this.dir_light1),this.camera.add(this.dir_light1.target),Te=!0},this.toggleLights=function(e,t){if(this.amb_light){this.lightsOn=e
var i=avp.LightPresets[te],n=i.ambientColor,o=i.directLightColor
n=n||we.toArray(),o=o||be.toArray(),this.lightsOn?(t&&this.amb_light?this.amb_light.color.setRGB(.5*o[0],.5*o[1],.5*o[2]):this.amb_light&&this.amb_light.color.setRGB(n[0],n[1],n[2]),this.dir_light1&&this.dir_light1.color.setRGB(o[0],o[1],o[2])):this.amb_light&&t&&this.amb_light.color.setRGB(n[0],n[1],n[2])}},this.syncCamera=function(e){this.camera.updateProjectionMatrix(),e&&this.setWorldUp(this.api.navigation.getWorldUpVector()),j=!0},this.setViewFromFile=function(e,t){var i,n=e.getDefaultCamera()
if(n)i=n
else{i={}
var o=e.getBoundingBox(),r=o.size()
if(i.target=o.center(),e.is2d()){i.isPerspective=!1
var s=r.x/r.y,a=this.camera.aspect
i.orthoScale=a>s?r.y:r.x/a,i.up=new THREE.Vector3(0,0,1),i.position=i.target.clone(),i.position.z+=i.orthoScale,i.target.y+=1e-6*r.y}else i.isPerspective=!0,i.fov=this.camera.fov,i.up=this.camera.up.clone(),i.position=i.target.clone(),i.position.z+=1.5*Math.max(r.x,r.y,r.z)}this.setViewFromCamera(i,t)},this.adjustOrthoCamera=function(e){if(!e.isPerspective&&this.model){var t=this.model.getBoundingBox(),i=t.size(),n=e.target.clone().sub(e.position),o=n.length()
if(o>1e3*i.length()){var r=e.position.distanceTo(t.center())
e.target.copy(e.position).add(n.normalize().multiplyScalar(r))}else if(Math.abs(o-e.orthoScale)/o>1e-5){avp.logger.warn("Ortho scale does not match eye-target distance. One of them is likely wrong, but which one?")
var s=0===e.fov&&1===e.orthoScale,a=!s
a&&e.position.copy(e.target).add(n.normalize().multiplyScalar(-e.orthoScale))}}},this.setViewFromCamera=function(e,t){this.adjustOrthoCamera(e)
var i,n=this.model.getMetadata("navigation hint","value",null),o=this.controls.isToolActivated("freeorbit")||t&&"Freeorbit"===n,r=this.model?this.model.getUpVector():null
i=r?(new THREE.Vector3).fromArray(r):o?e.up.clone():av.Navigation.snapToAxis(e.up.clone()),o?this.api.prefs&&this.api.prefs.set("fusionOrbitConstrained",i.equals(e.up)):e.up=i
var s=this.api.navigation
if(s){var a=this.camera
if(t)a.up.copy(e.up),a.position.copy(e.position),a.target.copy(e.target),e.isPerspective?a.fov=e.fov:(a.saveFov=e.fov,a.fov=av.UnifiedCamera.ORTHO_FOV),a.isPerspective=e.isPerspective,a.orthoScale=e.orthoScale,a.dirty=!0,s.setWorldUpVector(o?i:a.up),s.setView(a.position,a.target),s.setPivotPoint(a.target),this.syncCamera(!0)
else if(a.isPerspective=e.isPerspective,e.isPerspective||(a.saveFov=e.fov,e.fov=av.UnifiedCamera.ORTHO_FOV),o)s.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,e.up,i)
else{var l=s.computeOrthogonalUp(e.position,e.target)
s.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,l,i)}}j=!0},this.setViewFromViewBox=function(e,t,i,n){if(e.is2d()){var o={},r=e.getBoundingBox(),s={width:t[2]-t[0],height:t[3]-t[1]}
s.aspect=s.width/s.height,s.centerX=t[0]+s.width/2,s.centerY=t[1]+s.height/2
var a=this.camera.aspect
a>s.aspect?o.orthoScale=s.height:o.orthoScale=s.width/a,o.isPerspective=!1,o.position=new THREE.Vector3(s.centerX,s.centerY,r.center().z+o.orthoScale),o.target=new THREE.Vector3(s.centerX,s.centerY,r.center().z),o.target.y+=1e-6*s.height,o.up=new THREE.Vector3(0,0,1),this.setViewFromCamera(o,n)}},this.setWorldUp=function(e){if(!_.equals(e)){_.copy(e)
var t=Math.abs(e.x)
ne="x",Math.abs(e.y)>t&&(ne="y",t=Math.abs(e.y)),Math.abs(e.z)>t&&(ne="z")
var i=new THREE.Vector3(0,1,0)
Q.camera.worldUpTransform=function(e,t){var i=(new THREE.Vector3).crossVectors(t,e).normalize(),n=Math.acos(e.dot(t))
return(new THREE.Matrix4).makeRotationAxis(i,n)}(i,e),this.sceneUpdated(!1)}},this.addModel=function(e){if(e){var t=!!this.model,i=e.is2d()
if(this.model||(this.model=e,i||this.toggleVizBuffer(this.isvizCacheEnabled),U.setUnitScale(e.getUnitScale())),q.addModel(e),this.selector.addModel(e),this.visibilityManager.addModel(e),i){var n=e.getData()
G.initLayersTexture(n.layerCount,n.layersMap)
var o=G.create2DMaterial(e,{useInstancing:this.use2dInstancing},!0,!1,function(){Q.invalidate(!1,!0,!1)}),r=G.findMaterial(e,o)
if(U.enter2DMode(r),!t){this.is2d=!0,ie=te,this.setLightPreset(avp.DefaultLightPreset2d)
var s=e.getData()
if(s.hidePaper){var a=s.bgColor,l=a>>16&255,c=a>>8&255,d=255&a
this.setClearColors(l,c,d,l,c,d)}}}if(this.api.navigation){this.api.navigation.setIs2D(i&&!t),this.api.setActiveNavigationTool()
var u=e.getData()
u.isLeaflet?this.api.navigation.setConstraints2D(u.bbox,u.maxPixelPerUnit):this.api.navigation.setConstraints2D()}t||e.getData().loadOptions.preserveView||(this.setViewFromFile(e,!0),this.controls.recordHomeView()),this.setupLighting(e),this.fireRenderOptionChanged(),this.invalidate(!0)}},this.setupLighting=function(e){(e=e||this.model)&&!e.is2d()&&(this.setLightPresetFromFile(e)||(ie>=0?(this.setLightPreset(ie,!0),ie=-1):this.setLightPreset(te,!1)),this.setAOHeuristics(e))},this.getSvfMaterialId=function(e){return this.model.getFragmentList().getSvfMaterialId(e)},this.getMaterials=function(){return G},this.setupMesh=function(e,t,i,n){var o,r=e.getData(),s={geometry:t,matrix:n,isLine:t.isLines,isWideLine:t.isWideLines,isPoint:t.isPoints,is2d:t.is2d}
if(t.isLines||t.isPoints){var a=!!t.attributes.color,l=G.findMaterial(e,i)
t.isPoints?o=new THREE.PointCloudMaterial({vertexColors:a,size:t.pointSize}):t.isWideLines?(o=new THREE.MeshBasicMaterial({vertexColors:a}),o.wideLines=!0,t.isLines=!1,s.isLine=!1,o.polygonOffset=l.polygonOffset,o.polygonOffsetFactor=l.polygonOffsetFactor,o.polygonOffsetUnits=l.polygonOffsetUnits):a?(l.cachedLineMaterialVC||(l.cachedLineMaterialVC=new THREE.LineBasicMaterial({vertexColors:a})),o=l.cachedLineMaterialVC):(l.cachedLineMaterial||(l.cachedLineMaterial=new THREE.LineBasicMaterial({vertexColors:a})),o=l.cachedLineMaterial),a||(o.color=l.color),o.svfMatId=i,G.addMaterialNonHDR(r.basePath+i+"_line_"+o.id,o),s.material=o,r.hasLines=!0}else o=G.findMaterial(e,i),o&&(o.svfMatId=i),avp.MaterialConverter.applyGeometryFlagsToMaterial(o,t),s.material=o
return s},this.onDemandLoadComplete=function(e){if(ye=!1,this.signalProgress(100,av.ProgressState.LOADING),(Y&&Y.enabled||X)&&this.invalidate(!1,!0),this.is2d){var t=G.initSelectionTexture(e.myData.maxObjectNumber),i=G.create2DMaterial(e,{useInstancing:this.use2dInstancing},!1,t,function(){Q.invalidate(!1,!0,!1)})
this.selectionMaterial2d=G.findMaterial(e,i),this.createOverlayScene("selection2d",this.selectionMaterial2d)}e.getData().hasLines&&(G.togglePolygonOffset(!0),U.setDepthMaterialOffset(G.getPolygonOffsetOn(),G.getPolygonOffsetFactor(),G.getPolygonOffsetUnits())),G.hasTransparentMaterial()&&this.requestDeferredSilentRender(),I(e),this.api.fireEvent({type:av.GEOMETRY_LOADED_EVENT,model:e,onDemandLoad:!0})},this.onLoadComplete=function(e){if(ye=!1,this.signalProgress(100,av.ProgressState.LOADING),(Y&&Y.enabled||X)&&this.sceneUpdated(!1),this.is2d){var t=G.initSelectionTexture(e.myData.maxObjectNumber),i=G.create2DMaterial(e,{useInstancing:this.use2dInstancing},!1,t,function(){Q.invalidate(!1,!0,!1)})
this.selectionMaterial2d=G.findMaterial(e,i),this.createOverlayScene("selection2d",this.selectionMaterial2d)}var n=e.getData()
q.getGeometryList()&&q.getGeometryList().printStats(),n.hasLines&&(G.togglePolygonOffset(!0),U.setDepthMaterialOffset(G.getPolygonOffsetOn(),G.getPolygonOffsetFactor(),G.getPolygonOffsetUnits())),e.hasGeometry()?G.hasTransparentMaterial()&&this.requestSilentRender():avp.logger.warn("Loaded model has no geometry."),I(e),this.api.fireEvent({type:av.GEOMETRY_LOADED_EVENT,model:e})},this.onTextureLoadComplete=function(e){this.api.fireEvent({type:av.TEXTURES_LOADED_EVENT,model:e})},this.signalProgress=function(e,t){de.percent===e&&de.state===t||(de.percent=e,de.state=t,this.api.fireEvent(de))},this.resize=function(e,t){H=!0,B=e,F=t},this.unloadModel=function(e){this.removeModel(e)&&e.loader&&e.loader.dtor()},this._addLoadingFile=function(e){this.loaders||(this.loaders=[]),this.loaders.push(e)},this._removeLoadingFile=function(e){if(this.loaders){var t=this.loaders.indexOf(e)
t>=0&&this.loaders.splice(t,1)}},this.removeModel=function(e){return!!q.removeModel(e)&&(this.keyFrameAnimator&&(this.keyFrameAnimator.destroy(),this.keyFrameAnimator=null),e.dtor(this.glrenderer()),G.cleanup(e),this.selector.removeModel(e),this.visibilityManager.removeModel(e),e===this.model&&(this.model=null,q.isEmpty()||(this.model=q.getModels()[0])),this.api.fireEvent({type:av.MODEL_UNLOADED_EVENT,model:e}),this.invalidate(!0,!0,!0),!0)},this.unloadCurrentModel=function(){this.is2d&&(this.is2d=void 0,this.selectionMaterial2d=null,this.removeOverlayScene("selection2d"),U.exit2DMode(),te=ie),U.beginScene(this.scene,this.camera,this.lightsOn?this.lights:this.no_lights,!0),U.composeFinalFrame(!0),this.loaders&&(this.loaders.forEach(function(e){e.dtor()}),this.loaders=[])
for(var e=q.getModels(),t=e.length-1;t>=0;t--)this.unloadModel(e[t])}
var Re=function(e,t,i){t.depthWrite=!1,t.depthTest=!0,t.side=THREE.DoubleSide,i.depthWrite=!1,i.depthTest=!0,i.side=THREE.DoubleSide,G.addInstancingSupport(t),G.addInstancingSupport(i),Q.createOverlayScene(e,t,i)}
this.createOverlayScene=function(e,t,i,n){t&&G.addOverrideMaterial(e+"_pre",t),i&&G.addOverrideMaterial(e+"_post",i)
var o=new THREE.Scene
o.__lights=this.scene.__lights,this.overlayScenes[e]={scene:o,camera:n,materialPre:t,materialPost:i}},this.removeOverlayScene=function(e){this.overlayScenes[e]&&(delete this.overlayScenes[e],this.invalidate(!1,!1,!0))},this.addOverlay=function(e,t){this.overlayScenes[e].scene.add(t),this.invalidate(!1,!1,!0)},this.addMultipleOverlays=function(e,t){for(var i in t)t.hasOwnProperty(i)&&this.addOverlay(e,t[i])},this.removeOverlay=function(e,t){this.overlayScenes[e]&&(this.overlayScenes[e].scene.remove(t),this.invalidate(!1,!1,!0))},this.removeMultipleOverlays=function(e,t){for(var i in t)t.hasOwnProperty(i)&&this.removeOverlay(e,t[i])},this.clearOverlay=function(e){if(this.overlayScenes[e]){var t,i,n=this.overlayScenes[e].scene
for(i=n.children.length-1;i>=0;--i)(t=n.children[i])&&n.remove(t)
this.invalidate(!1,!1,!0)}},this.setClearColors=function(e,t,i,n,o,r){this.clearColorTop=new THREE.Vector3(e/255,t/255,i/255),this.clearColorBottom=new THREE.Vector3(n/255,o/255,r/255),U.setClearColors(this.clearColorTop,this.clearColorBottom),X&&X.setClearColors(this.clearColorTop,this.clearColorBottom,av.isAndroidDevice()||av.isIOSDevice()),ae=!0,this.fireRenderOptionChanged()}
var xe
this.getVisibleBounds=function(e,t){var i=new THREE.Box3
return q.isEmpty()||(L(i,this.scene),i=q.getVisibleBounds(e).union(i),t&&(i=D().union(i))),i},this.getFitBounds=function(e){var t
return e||null===this.selector||(t=this.selector.getSelectionBounds()),t&&!t.empty()||(t=this.getVisibleBounds()),t},this.getRenderProxy=function(e,t){return e.getFragmentList().getVizmesh(t)},this.promiseRenderProxy=function(e,t){var i=e.getFragmentList().promiseVizmesh(t)
return i.lmv_model=e,i},this.cancelPromisedRenderProxy=function(e){return!!e.lmv_model&&e.lmv_model.getFragmentList().cancelPromisedVizmesh(e)},this.getFragmentProxy=function(e,t){return new avp.FragmentPointer(e.getFragmentList(),t)},this.getRenderProxyCount=function(e){return e.getFragmentList().getCount()},this.getRenderProxyDbIds=function(e,t){return e.getFragmentList().getDbIds(t)},this.isWholeModelVisible=function(e){return!q||q.areAllVisible()},this.isNodeVisible=function(e,t){return this.visibilityManager.isNodeVisible(t,e)},this.highlightObjectNode=function(e,t,i,n){e.is2d()&&(G.highlightObject2D(t,i),this.invalidate(!1,!1,!0))
var o=this,r=e.getData().instanceTree||e.getData().fragmentMap
if(r&&!e.is2d())r.enumNodeFragments(t,function(t){o.highlightFragment(e,t,i,n)},!1)
else{var s=t
if(e.is2d()&&(s=e.getData().fragments.dbId2fragId[t]),Array.isArray(s))for(var a=0;a<s.length;a++)o.highlightFragment(e,s[a],i,n)
else o.highlightFragment(e,s,i,n)}},this.highlightFragment=function(e,t,i,n){var o=this.getRenderProxy(e,t)
if(o){var r=!n||o.is2d||o.isPoint,s=e.id+":"+t
if(r){var a="selection"
if(e.is2d()&&(a+="2d"),o.isPoint&&(a+="_points"),i){var l=this.promiseRenderProxy(e,t),c=this
this.selectionMeshes[s]=l,l.then(function(i){var n,o=c.getRenderProxy(i.model,i.fragId)
if(o&&o.geometry){if(o.isPoint){var r=o.material.clone()
r.color=c.selectionMaterialBase.color,r.needsUpdate=!0,n=new THREE.Mesh(o.geometry,r)}else n=new THREE.Mesh(o.geometry,o.material)
n.matrix.copy(o.matrixWorld),n.matrixAutoUpdate=!1,n.matrixWorldNeedsUpdate=!0,n.frustumCulled=!1,n.model=e,n.fragId=t,i.model.getFragmentList().lockGeometry(t),c.addOverlay(a,n),c.selectionMeshes[s]=n}}).catch(function(e){e.canceled||delete c.selectionMeshes[s]})}else if(this.selectionMeshes.hasOwnProperty(s)){var d=this.selectionMeshes[s]
d instanceof Promise?this.cancelPromisedRenderProxy(d):(e.getFragmentList().unlockGeometry(t),this.removeOverlay(a,d)),delete this.selectionMeshes[s]}}r&&i||e.setHighlighted(t,i)&&this.invalidate(!0)}},this.explode=function(e){e!=ge&&(ge=e,q.explode(e),this.sceneUpdated(!0),this.api.fireEvent({type:av.EXPLODE_CHANGE_EVENT,scale:e}))},this.getExplodeScale=function(){return ge},this.setGhostingBrightness=function(e){this.fadeMaterial.color=e?new THREE.Color(1052688):new THREE.Color(16777215),this.fadeMaterial.needsUpdate=!0},this.loadCubeMapFromColors=function(e,t){var i=avp.CreateCubeMapFromColors(e,t)
return i.isBgColor=!0,G.setReflectionMap(i),i},this.loadCubeMap=function(e,t){this._reflectionMapPath=e
var i=function(t){e===Q._reflectionMapPath&&(G.setReflectionMap(t),Q.invalidate(!0),t?avp.LightPresets[te].useIrradianceAsBackground||U.setCubeMap(t):Q.loadCubeMapFromColors(Q.clearColorTop,Q.clearColorBottom))}
return avp.TextureLoader.loadCubeMap(e,t,i)},this.loadIrradianceMap=function(e,t){this._irradianceMapPath=e
var i=function(t){e===Q._irradianceMapPath&&(G.setIrradianceMap(t),Q.invalidate(!0),avp.LightPresets[te].useIrradianceAsBackground&&U.setCubeMap(t))}
return avp.TextureLoader.loadCubeMap(e,t,i)},this.setLightPreset=function(e,t){if(Te||this.initLights(),te!==e||t){(e<0||avp.LightPresets.length<=e)&&(e=avp.DefaultLightPreset),te=e
var i=avp.LightPresets[e],n=i.bgColorGradient
if(n||(n=avp.BackgroundPresets.Custom),this.setClearColors(n[0],n[1],n[2],n[3],n[4],n[5]),i&&i.path){var o="res/environments/"+i.path,r=avp.getResourceUrl(o+"_mipdrop."+(i.type||"")+".dds"),s=avp.getResourceUrl(o+"_irr."+(i.type||"")+".dds")
this.loadIrradianceMap(s,i.E_bias),this.loadCubeMap(r,i.E_bias),G.setEnvExposure(-i.E_bias),U.setEnvExposure(-i.E_bias),this.setTonemapExposureBias(i.E_bias),this.setTonemapMethod(i.tonemap),this.setGhostingBrightness(i.darkerFade)}else{var a=this.loadCubeMapFromColors(this.clearColorTop,this.clearColorBottom)
U.setCubeMap(a),G.setIrradianceMap(null),G.setEnvExposure(-i.E_bias||0),U.setEnvExposure(-i.E_bias||0),this.setTonemapExposureBias(i.E_bias||0),this.setTonemapMethod(i.tonemap||0),this.setGhostingBrightness(i.darkerFade),U.toggleEnvMapBackground(Ae),this.invalidate(!0)}var l=av.Shaders.SAOShader.uniforms.radius.value,c=av.Shaders.SAOShader.uniforms.intensity.value
i.hasOwnProperty("saoRadius")&&(l=i.saoRadius),i.hasOwnProperty("saoIntensity")&&(c=i.saoIntensity),U.setAOOptions(l,c)
var u=1
null!==i.lightMultiplier&&void 0!==i.lightMultiplier&&(u=i.lightMultiplier),re.copy(oe),i.lightDirection&&re.fromArray(i.lightDirection).negate(),W&&d(),this.dir_light1&&(this.dir_light1.intensity=u,i.lightDirection?this.dir_light1.position.set(-i.lightDirection[0],-i.lightDirection[1],-i.lightDirection[2]):this.dir_light1.position.copy(se)),G.setEnvRotation(i.rotation||0),U.setEnvRotation(i.rotation||0),X&&X.setEnvRotation(i.rotation||0),this.toggleLights(0!==u),this.invalidate(!0,!1,!0),this.fireRenderOptionChanged()}},this.setLightPresetFromFile=function(e){if(!e||e.is2d())return!1
var t=e.getMetadata("renderEnvironmentStyle","value",null)
if(null===t||""===t)return!1
var i=e.getMetadata("renderEnvironmentGroundReflection","value",null)
null!==i&&(this.api.prefs.hasTag("groundReflection","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): groundReflection is locked. No changes."):(this.api.prefs.tag("no-storage","groundReflection"),this.api.setGroundReflection(i)))
var n=e.getMetadata("renderEnvironmentGroundShadow","value",null)
null!==n&&(this.api.prefs.hasTag("groundShadow","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): groundShadow is locked. No changes."):(this.api.prefs.tag("no-storage","groundShadow"),this.api.setGroundShadow(n)))
var o=e.getMetadata("renderEnvironmentAmbientShadows","value",null)
null!==o&&(this.api.prefs.hasTag("ambientShadows","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): ambientShadows is locked. No changes."):(this.api.prefs.tag("no-storage","ambientShadows"),this.api.setQualityLevel(o,U.getAntialiasing())))
var r=e.getMetadata("renderEnvironmentDisplayLines","value",null)
null!==r&&(this.api.prefs.hasTag("lineRendering","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): lineRendering is locked. No changes."):(this.api.prefs.tag("no-storage","lineRendering"),this.api.hideLines(!r)))
var s=e.getMetadata("renderEnvironmentDisplayPoints","value",null)
null!==s&&(this.api.prefs.hasTag("pointRendering","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): pointRendering is locked. No changes."):(this.api.prefs.tag("no-storage","pointRendering"),this.api.hidePoints(!s)))
var a=avp.LightPresets.filter(function(e){return e.name===t})
if(a=a[0]||null)if(this.api.prefs.hasTag("lightPreset","ignore-producer"))avp.logger.debug("setLightPresetFromFile(): lightPreset is locked. No changes.")
else{this.api.prefs.tag("no-storage","lightPreset")
var l=avp.ModelSettingsEnvironment
l||(l=avp.ModelSettingsEnvironment={},avp.LightPresets.push(l)),avp.copyLightPreset(a,l),l.name="(Custom: Model defined)"
var c=e.getMetadata("renderEnvironmentExposureBias","value",null),d=e.getMetadata("renderEnvironmentExposureBase","value",null)
null!==c&&null!==d&&(l.E_bias=c+d)
var u=e.getMetadata("renderEnvironmentBackgroundColor","value",null)
this.api.prefs.hasTag("backgroundColorPreset","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): backgroundColorPreset is locked. No changes."):u&&(l.bgColorGradient=[255*u[0],255*u[1],255*u[2],255*u[0],255*u[1],255*u[2]])
var h=e.getMetadata("renderEnvironmentRotation","value",null)
null!==h&&(l.rotation=h)
var p=avp.LightPresets.indexOf(l)
this.api.setLightPreset(p)}var m=e.getMetadata("renderEnvironmentBackgroundFromEnvironment","value",null)
return null!==m&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(m))),a},this.setLightPresetForAec=function(){for(var e=-1,t=0;t<avp.LightPresets.length;t++)if("Field"===avp.LightPresets[t].name){e=t
break}return e>=0&&(this.api.prefs.hasTag("lightPreset","ignore-producer")?avp.logger.debug("setLightPresetForAec(): lightPreset is locked. No changes."):(this.api.prefs.tag("no-storage","lightPreset"),this.api.setLightPreset(e))),this.api.prefs.hasTag("envMapBackground","ignore-producer")?avp.logger.debug("setLightPresetForAec(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(!0)),this.api.prefs.hasTag("edgeRendering","ignore-producer")?avp.logger.debug("setLightPresetForAec(): edgeRendering is locked. No changes."):(this.api.prefs.tag("no-storage","edgeRendering"),this.api.setDisplayEdges(!av.isMobileDevice())),!0},this.setAOHeuristics=function(e){if(e.isAEC()){var t=e.getUnitScale()
t>.3?U.setAOOptions(4/t,1,.625):U.setAOOptions(.25/t,1,.625)}else{var i=e.getData().bbox,n=i.size().length()
U.setAOOptions(Math.min(10,.05*n))}},this.setTonemapMethod=function(e){e!=U.getToneMapMethod()&&(U.setTonemapMethod(e),G.setTonemapMethod(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setTonemapExposureBias=function(e){e!=U.getExposureBias()&&(U.setTonemapExposureBias(e),G.setTonemapExposureBias(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.dtor=function(){window.cancelAnimationFrame(O),this.api.removeEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,Z),this.api.removeEventListener(av.MODEL_UNLOADED_EVENT,Z),this.unloadCurrentModel(),this.controls=null,this.canvas=null,this.loader=null,this.selector.dtor(),this.selector=null,this.model=null,this.visibilityManager=null,q=null,U=null,G.dtor(),G=null},this.hideLines=function(e){return!(!q||q.isEmpty())&&(q.hideLines(e),this.sceneUpdated(!0),!0)},this.hidePoints=function(e){return!(!q||q.isEmpty())&&(q.hidePoints(e),this.sceneUpdated(!0),!0)},this.setDisplayEdges=function(e){U.toggleEdges(e)
var t=e
e||(t=!(!this.model||!this.model.getData().hasLines)),G.togglePolygonOffset(t),U.setDepthMaterialOffset(G.getPolygonOffsetOn(),G.getPolygonOffsetFactor(),G.getPolygonOffsetUnits()),this.invalidate(!0)},this.getCutPlanes=function(){return G.getCutPlanes()},this.setCutPlanes=function(e){G.setCutPlanes(e),this.sceneUpdated(),this.api.fireEvent({type:av.CUTPLANES_CHANGE_EVENT,planes:e})},this.fireRenderOptionChanged=function(){G.toggleMRTSetting(U.mrtFlags()),this.api.fireEvent({type:av.RENDER_OPTION_CHANGED_EVENT})},this.viewportToRay=function(e,t){var i=this.camera
e.z=-1
var n=new THREE.Vector3(e.x,e.y,1)
return e=e.unproject(i),n=n.unproject(i),n.sub(e).normalize(),t||(t=new THREE.Ray),t.set(i.isPerspective?i.position:e,n),t},this.rayIntersect=function(e,t,i,n,o){var r=q.rayIntersect(e.origin,e.direction,t,i,n,o)
if(this.sceneAfter.children.length){var s=new THREE.Raycaster(e.origin,e.direction,this.camera.near,this.camera.far),a=[]
avp.VBIntersector.intersectObject(this.sceneAfter,s,a,!0),a.length&&(!r||a[0].distance<r.distance)&&(r=a[0])}if(!r)return null
var l=r.fragId,c=r.point,d=r.face,u=r.model,h=r.dbId
if(void 0===h&&void 0!==l){h=u.getFragmentList().getDbIds(l)
u.getData().instanceTree||u.getData().fragmentMap||(h=l)}return{dbId:h,fragId:l,intersectPoint:c,face:d,model:u}},this.castRayViewport=function(){var e
return function(t,i,n,o,r){return e=e||new THREE.Ray,q?(this.viewportToRay(t,e),this.rayIntersect(e,i,n,o,r)):{}}}(),this.clientToViewport=function(e,t){var i=Q.canvas.getBoundingClientRect()
return new THREE.Vector3((e+.5)/i.width*2-1,-(t+.5)/i.height*2+1,1)},this.viewportToClient=function(e,t){var i=Q.canvas.getBoundingClientRect()
return new THREE.Vector3(.5*(e+1)*i.width-.5,-.5*(t-1)*i.height-.5,0)},this.castRay=function(e,t,i){return this.castRayViewport(this.clientToViewport(e,t),i)},this.intersectGroundViewport=function(e){var t=this.camera,i="z"
this.is2d||(i=ne)
var n=e
n.z=-1
var o=new THREE.Vector3(n.x,n.y,1)
n=n.unproject(t),o=o.unproject(t),o.sub(n).normalize()
var r=o
if(Math.abs(r[i])<1e-6)return null
var s
s=t.isPerspective?t.position:n
var a=this.model?this.model.getBoundingBox().min[i]:0,l=(a-s[i])/r[i]
return r.multiplyScalar(l),r.add(s),r},this.intersectGround=function(e,t){return this.intersectGroundViewport(this.clientToViewport(e,t))},this.hitTestViewport=function(e,t){var i
if(Q.is2d){var n,o=[]
if((n=av.isMobileDevice()?U.idAtPixels(e.x,e.y,45,o):U.idAtPixels(e.x,e.y,5,o))<=0)return null
var r=this.intersectGroundViewport(e),s=q.findModel(o[1])||Q.model
i={intersectPoint:r,dbId:n,fragId:s.getData().fragments.dbId2fragId[n],model:s}}else i=this.castRayViewport(e,t)
return i},this.hitTest=function(e,t,i){return Q.hitTestViewport(this.clientToViewport(e,t),i)},this.snappingHitTestViewport=function(e,t){var i,n,o
if(this.model.getData().isLeaflet)n=this.intersectGroundViewport(e),i={intersectPoint:n}
else if(Q.is2d){if((o=av.isMobileDevice()?U.idAtPixels(e.x,e.y,45):U.idAtPixels(e.x,e.y,17))<0)return null
n=this.intersectGroundViewport(e)
var r=Q.model.getData().fragments,s=r?r.dbId2fragId[o]:-1
i={intersectPoint:n,dbId:o,fragId:s}}else o=U.idAtPixel(e.x,e.y),i=this.castRayViewport(e,t,o>0?[o]:null)
return i},this.snappingHitTest=function(e,t,i){return this.snappingHitTestViewport(this.clientToViewport(e,t),i)},this.rolloverObjectViewport=function(e){U.rolloverObjectViewport(e.x,e.y)&&this.invalidate(!1,!1,!0)},this.rolloverObject=function(e,t){this.rolloverDisabled||this.rolloverObjectViewport(this.clientToViewport(e,t))},this.disableRollover=function(e){this.rolloverDisabled=e,e&&(U.rolloverObjectId(-1),this.invalidate(!1,!1,!0))},this.rolloverObjectNode=function(e){var t=[],i=Q.model.getData().instanceTree
if(i){if(i.enumNodeChildren(e,function(e){t.push(e)},!0),t.length>1){var n=t.shift()
t.sort(function(e,t){return e-t}),t.unshift(n)}}else t.push(e)
U.rolloverObjectViewport(null,null,t)&&this.invalidate(!1,!1,!0)},this.getScreenShotBuffer=function(e,t,i){U.presentBuffer()
var n=Q.canvas.toDataURL("image/png"),o=av.isSafari()
if(o|=av.isIOSDevice(),o&&(e=e||B,t=t||F),!e||!t)return n
var r,s,a=0,l=0
e>t||B/F<e/t?(r=e,s=F/B*e,l=t/2-s/2):(s=t,r=B/F*t,a=e/2-r/2)
var c=window.URL.createObjectURL(N(Q.canvas.toDataURL("image/png"))),d=new Image
d.src=c
var u=document.createElement("canvas"),h=u.getContext("2d")
u.width=e,u.height=t,d.onload=function(){o&&(h.translate(0,s),h.scale(1,-1)),h.drawImage(d,a,l,r,s)
var e=u.toDataURL("image/png"),t=window.URL.createObjectURL(N(u.toDataURL("image/png")))
i?i(e):window.open(t)}},this.getScreenShot=function(e,t,i){U.presentBuffer()
var n=window.URL.createObjectURL(N(Q.canvas.toDataURL("image/png"))),o=av.isSafari()
o|=av.isIOSDevice(),o&&(e=e||B,t=t||F),function(e,t,i,n,o){if(n||t&&i){var r,s,a=0,l=0
t>i||B/F<t/i?(r=t,s=F/B*t,l=i/2-s/2):(s=i,r=B/F*i,a=t/2-r/2)
var c=new Image
c.src=e
var d=document.createElement("canvas"),u=d.getContext("2d")
d.width=t,d.height=i,c.onload=function(){n&&(u.translate(0,s),u.scale(1,-1)),u.drawImage(c,a,l,r,s)
var e=window.URL.createObjectURL(N(d.toDataURL("image/png")))
o?o(e):window.open(e)}}else o&&o(e)}(n,e,t,o,i)},this.modelQueue=function(){return q},this.glrenderer=function(){return z},this.renderer=function(){return U},this.shadowMaps=function(){return W},this.worldUp=function(){return _},this.worldUpName=function(){return ne},this.setUserRenderContext=function(e){U=e||new avp.RenderContext,U.init(z,this.canvas.clientWidth,this.canvas.clientHeight),U.setClearColors(this.clearColorTop,this.clearColorBottom),this.invalidate(!0),this.sceneUpdated(!1)},this.invalidate=function(e,t,i){ae=e||ae,le=t||le,ce=i||ce},this.isOverlayDirty=function(){return ce},this.clearOverlayDirtyFlag=function(){ce=!1},this.sceneUpdated=function(e){this.invalidate(!0,!1,!0),q&&e&&(q.invalidateVisibleBounds(),this.zoomBoundsChanged=!0),ue=!0,d()},this.requestSilentRender=function(){pe=me=!0},this.requestDeferredSilentRender=function(){pe=!0},this.currentLightPreset=function(){return te},this.matman=function(){return G},this.fps=function(){return 1e3/ve},this.setFPSTargets=function(e,t,i){J=1e3/i,ee=1e3/e,$=1e3/t,this.targetFrameBudget=av.isMobileDevice()?$/4:$},this.track=function(e){avp.logger.track(e)},this.worldToClient=function(e){var t=new THREE.Vector4(e.x,e.y,e.z,1)
return t.applyMatrix4(this.camera.matrixWorldInverse),t.applyMatrix4(this.camera.projectionMatrix),t.w>0&&(t.x/=t.w,t.y/=t.w,t.z/=t.w),this.viewportToClient(t.x,t.y)},this.clientToWorld=function(e,t,i){var n=null,o=this.model,r=o.getData()
if(o.is2d()){var s=this.intersectGround(e,t)
if(s){s.z=0
var a=r.bbox;(r.hidePaper||a.containsPoint(s))&&(n={point:s,model:o})}}else(n=this.hitTest(e,t,i))&&(n.point=n.intersectPoint)
return n},this.setSelectionColor=function(e){this.selectionMaterialBase.color.set(e),this.selectionMaterialTop.color.set(e),this.invalidate(!1,!1,!0)},this.updateViewportId=function(e){G.updateViewportId(e),this.invalidate(!0)},this.findModel=function(e){return q.findModel(e)},this.getFrameRate=function(){return this.frameDisplayRate},this.setFrameRate=function(e){this.frameDisplayRate=e<1?1:e},this.setShadowLightDirection=function(e){re.copy(e),d(),this.invalidate(!0,!1,!1),a()},this.getShadowLightDirection=function(e){var t=e||new THREE.Vector3
return t.copy(re),t},this.toggleShadows=function(e){!!W!=!!e&&(e?W=new avp.ShadowMaps(z):(W.cleanup(G),W=null),a(),this.invalidate(!0,!0,!1))},this.showTransparencyWhenMoving=function(e){q.enableNonResumableFrames=e},this.fitToView=function(e,t,i){function n(e,t,i,n){var o=e.getFragmentList().getVizmesh(t)
new avp.VertexBufferReader(o.geometry).enumGeomsForObject(i,n)}if(t=t||this.model,i=i||!1,!t)return!1
var o,r,s,a={type:av.FIT_TO_VIEW_EVENT,nodeIdArray:e,immediate:i,model:t},l=this,c=function(){var n=null
if(Array.isArray(e)&&e.length>0){for(var o=new THREE.Box3,r=new THREE.Box3,s=t.getFragmentMap(),c=t.getFragmentList(),d=function(e){c.getWorldBounds(e,r),o.union(r)},u=0;u<e.length;u++)s.enumNodeFragments(e[u],d,!0)
o.empty()||(n=o)}n&&!n.empty()||(n=l.getFitBounds()),l.api.navigation.fitBounds(i,n),l.api.fireEvent(a)}
if(e&&e.length>0)if(t.is2d()){o=new THREE.Box3,r=new avp.BoundsCallback(o)
var d=t.getData().fragments.dbId2fragId
for(s=0;s<e.length;s++){var u=d[e[s]]
if(Array.isArray(u))for(var h=0;h<u.length;h++)n(t,u[h],e[s],r)
else"number"==typeof u&&n(t,u,e[s],r)}if(!o.empty())return this.api.navigation.fitBounds(i,o),void this.api.fireEvent(a)}else{if(t.getFragmentMap())return void c()
var p=t.getData().propertydb,m=p&&p.attrs.length>0
if(m)return void t.getObjectTree(function(){c()})}var g=this.api.viewerState.getState(),f=g.objectSet[0]
if(t.is2d()&&!f.allLayers){o=new THREE.Box3,r=new avp.BoundsCallback(o)
var v=t.getData().fragments
for(s=0;s<v.length;s++)!function(e,t,i){var n=e.getFragmentList().getVizmesh(t),o=new avp.VertexBufferReader(n.geometry),r=l.getVisibleLayerIds()
o.enumGeomsForVisibleLayer(r,i)}(t,s,r)
if(!o.empty())return this.api.navigation.fitBounds(i,o),void this.api.fireEvent(a)}this.api.navigation.fitBounds(i,this.getFitBounds(!0)),this.api.fireEvent(a)}}av.InitParametersSetting={canvas:null,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!0,stencil:!1,depth:!1,devicePixelRatio:null},av.ProgressState={ROOT_LOADED:0,LOADING:1,RENDERING:2},e.prototype.constructor=e,avp.Viewer3DImpl=e}(),Autodesk.Viewing.Private.ViewerState=function(e){var t=Autodesk.Viewing.Private
this.getState=function(i){var n=e.navigation,o={}
o.seedURN=this.getSeedUrn()
var r=o.objectSet
Array.isArray(r)||(o.objectSet=r=[]),e.model&&!e.model.is2d()&&(r[0]={id:this.getSelectedNodes(),isolated:e.getIsolatedNodes(),hidden:e.getHiddenNodes(),explodeScale:e.getExplodeScale(),idType:"lmv"}),e.model&&e.model.is2d()&&(r[0]={id:this.getSelectedNodes(),isolated:this.getVisibleLayers2d(),allLayers:this.areAllLayersVisible(),hidden:[],idType:"lmv"})
var s=o.viewport
s||(s=o.viewport={})
var a=n.getCamera().isPerspective
s.name="",s.eye=n.getPosition().toArray(),s.target=n.getTarget().toArray(),s.up=n.getCamera().up.toArray(),s.worldUpVector=n.getWorldUpVector().toArray(),s.pivotPoint=n.getPivotPoint().toArray(),s.distanceToOrbit=n.getPivotPlaneDistance(),s.aspectRatio=this.getAspectRatio(),s.projection=a?"perspective":"orthographic",s.isOrthographic=!a,a?s.fieldOfView=n.getVerticalFov():s.orthographicHeight=this.getOrthographicHeight()
var l=o.renderOptions
if(l||(l=o.renderOptions={}),l.environment=t.LightPresets[e.impl.currentLightPreset()].name,l.ambientOcclusion={enabled:e.impl.renderer().getAOEnabled(),radius:e.impl.renderer().getAORadius(),intensity:e.impl.renderer().getAOIntensity()},l.toneMap={method:e.impl.renderer().getToneMapMethod(),exposure:e.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()},l.appearance={ghostHidden:e.impl.showGhosting,ambientShadow:e.prefs.ambientShadows,antiAliasing:e.impl.renderer().settings.antialias,progressiveDisplay:e.prefs.progressiveRendering,swapBlackAndWhite:e.prefs.swapBlackAndWhite,displayLines:e.prefs.lineRendering,displayPoints:e.prefs.pointRendering},e.model&&!e.model.is2d())for(var c=o.cutplanes=[],d=e.getCutPlanes(),u=0;u<d.length;u++)c.push(d[u].toArray())
for(var h in e.loadedExtensions){var p=e.loadedExtensions[h]
p.getState&&p.getState(o)}return i&&!0!==i&&this.applyFilter(o,i),o},this.restoreState=function(i,n,o){if(!i)return t.logger.warn("restoreState has no viewer state to restore from."),!1
if(!e||!e.model)return t.logger.warn("restoreState has no viewer or model to restore."),!1
n&&!0!==n&&(i=JSON.parse(JSON.stringify(i)),this.applyFilter(i,n))
var r=e.navigation,s=e.model.is2d(),a=!s
if(Array.isArray(i.objectSet)&&i.objectSet.length>0){var l=i.objectSet[0],c=l.id
if(c&&(c=this.toIntArray(c),e.select(c)),s){var d=l.isolated
Array.isArray(d)&&d.length>0?(e.setLayerVisible(null,!1),e.impl.setLayerVisible(d,!0)):e.setLayerVisible(null,!0)}else{var u=l.isolated||[]
if(u=this.toIntArray(u),e.isolate(u),0===u.length){var h=l.hidden||null
h&&h.length>0&&(h=this.toIntArray(h),e.hide(h))}}if("explodeScale"in l){var p=parseFloat(l.explodeScale)
e.explode&&e.explode(p)}}var m=i.viewport
if(m){var g=this.getVector3FromArray(m.eye,r.getPosition()),f=this.getVector3FromArray(m.up,r.getCamera().up),v=this.getVector3FromArray(m.target,r.getTarget()),E="fieldOfView"in m?parseFloat(m.fieldOfView):r.getVerticalFov(),y=this.getVector3FromArray(m.worldUpVector,null)
if(!y){var A=e.model?e.model.getUpVector():null
y=A?(new THREE.Vector3).fromArray(A):new THREE.Vector3(0,1,0)}var T=this.getVector3FromArray(m.pivotPoint,r.getPivotPoint()),b=r.getCamera().isPerspective
"isOrthographic"in m&&(b=!m.isOrthographic)
var w=this.getOrthographicHeight()
"orthographicHeight"in m&&(w=Number(m.orthographicHeight))
var C={position:g,target:v,up:f,worldup:y,aspect:e.impl.camera.aspect,fov:E,orthoScale:w,isPerspective:b,pivot:T}
this.restoreCameraState(C,o)}var S=i.renderOptions
if(S){var R=e.impl.renderer(),x=e.prefs,P=x.ambientShadows,k=x.antialiasing,M=S.ambientOcclusion
if(M){"enabled"in M&&(P=M.enabled)
var V="radius"in M?M.radius:null,I="intensity"in M?M.intensity:null
null!==V&&null!==I&&(V===R.getAORadius()&&I===R.getAOIntensity()||(R.setAOOptions(V,I),R.composeFinalFrame()))}if("environment"in S){var L=this.getLightPresetIndex(S.environment);-1!==L&&L!==x.get("lightPreset")&&a&&e.setLightPreset(L)}var D=S.toneMap
if(D){var N=!1,_="exposure"in D?D.exposure:null,O="lightMultiplier"in D?D.lightMultiplier:null
null!==_&&_!==R.getExposureBias()&&(R.setTonemapExposureBias(_),N=!0),null!==O&&e.impl.dir_light1&&O!==this.getToneMapIntensity()&&(e.impl.dir_light1.intensity=Math.pow(2,O),N=!0),N&&e.impl.invalidate(!0)}var H=S.appearance
H&&("antiAliasing"in H&&(k=H.antiAliasing),"progressiveDisplay"in H&&H.progressiveDisplay!==x.get("progressiveRendering")&&e.setProgressiveRendering(H.progressiveDisplay),"swapBlackAndWhite"in H&&H.swapBlackAndWhite!==x.get("swapBlackAndWhite")&&e.setSwapBlackAndWhite(H.swapBlackAndWhite),"ghostHidden"in H&&H.ghostHidden!==x.get("ghosting")&&a&&e.setGhosting(H.ghostHidden),"displayLines"in H&&H.displayLines!==x.get("lineRendering")&&e.hideLines(!H.displayLines),"displayPoints"in H&&H.displayPoints!==x.get("pointRendering")&&e.hidePoints(!H.displayPoints)),a&&P!==x.ambientShadows&&k!==x.antialiasing&&e.setQualityLevel(P,k)}if(Array.isArray(i.cutplanes)&&e.model&&a){for(var B=[],F=0;F<i.cutplanes.length;F++){var G=i.cutplanes[F]
Array.isArray(G)&&G.length>=4&&B.push(new THREE.Vector4(G[0],G[1],G[2],G[3]))}e.setCutPlanes(B)}for(var z in e.loadedExtensions){var U=e.loadedExtensions[z]
U.restoreState&&U.restoreState(i,o)}return!0},this.restoreCameraState=function(t,i){e.impl.adjustOrthoCamera(t)
var n=e.navigation
i?(t.isPerspective?n.toPerspective():n.toOrthographic(),n.setCameraUpVector(t.up),n.setWorldUpVector(t.worldup),n.setView(t.position,t.target),n.setPivotPoint(t.pivot),n.setVerticalFov(t.fov,!1),e.impl.syncCamera(!0)):(e.impl.camera.isPerspective=t.isPerspective,n.setRequestTransitionWithUp(!0,t.position,t.target,t.fov,t.up,t.worldup,t.pivot))},this.areEqual=function(e,t,i){function n(e,t){if(e=e||[],t=t||[],e.length!==t.length)return!1
for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1
return!0}function o(e,t,i){return e=e||[],t=t||[],e.length===t.length&&(0!==e.length&&(r(e[0],t[0],i)||r(e[1],t[1],i)||r(e[2],t[2],i)))}function r(e,t,i){var n=e?parseFloat(e):null,o=e?parseFloat(t):null,r=typeof n,s=typeof o
return"number"===r&&"number"===s?Math.abs(e-t)<i:(e=e||null,t=t||null,e===t)}var s=e,a=t
if(i&&!0!==i&&(s=this.applyFilter(s,i),a=this.applyFilter(a,i)),s.seedURN!==a.seedURN)return!1
var l=s.objectSet||[],c=a.objectSet||[]
if(l.length!==c.length)return!1
var d=l[0]||{},u=c[0]||{}
if(!(d.idType===u.idType&&r(d.explodeScale,u.explodeScale,1e-9)&&n(d.id,u.id)&&n(d.isolated,u.isolated)&&n(d.hidden,u.hidden)))return!1
var h=s.viewport||{},p=a.viewport||{}
return!!(h.name===p.name&&h.projection===p.projection&&h.isOrthographic===p.isOrthographic&&r(h.distanceToOrbit,p.distanceToOrbit,1e-9)&&r(h.fieldOfView,p.fieldOfView,1e-9)&&r(h.orthographicHeight,p.orthographicHeight,1e-9)&&o(h.eye,p.eye,1e-9)&&o(h.target,p.target,1e-9)&&o(h.up,p.up,1e-9)&&o(h.worldUpVector,p.worldUpVector,1e-9)&&o(h.pivotPoint,p.pivotPoint,1e-9))},this.toIntArray=function(e){var t=[]
if(Array.isArray(e))for(var i=0,n=e.length;i<n;++i)t.push(parseInt(e[i]))
return t},this.extractSelectedNodeIds=function(e){if(e&&Array.isArray(e.objectSet)&&e.objectSet.length>0){var t=e.objectSet[0]
return this.toIntArray(t.id)}return[]},this.extractIsolatedNodeIds=function(e){if(e&&Array.isArray(e.objectSet)&&e.objectSet.length>0){var t=e.objectSet[0]
return this.toIntArray(t.isolated)}return[]},this.getVector3FromArray=function(e,t){return e instanceof Array&&e.length>2?(e[0]=parseFloat(e[0]),e[1]=parseFloat(e[1]),e[2]=parseFloat(e[2]),(new THREE.Vector3).fromArray(e)):t},this.getSelectedNodes=function(){return e.impl&&e.impl.selector?e.impl.selector.getSelection():[]},this.getVisibleLayers2d=function(){var t=[],i=e.impl.matman(),n=i._layersMap
for(var o in n)n.hasOwnProperty(o)&&i.isLayerVisible(o)&&t.push(o)
return t},this.areAllLayersVisible=function(){var t=e.impl.matman(),i=t._layersMap
for(var n in i)if(i.hasOwnProperty(n)&&!t.isLayerVisible(n))return!1
return!0},this.getAspectRatio=function(){var t=e.navigation.getScreenViewport()
return t.width/t.height},this.getOrthographicHeight=function(){var t=e.navigation.getCamera()
return t.isPerspective?0:Math.abs(2*t.orthographicCamera.top)},this.getSeedUrn=function(){return e.model&&e.model.loader?e.model.loader.svfUrn||"":""},this.getToneMapIntensity=function(){var t=0
return e.impl.dir_light1&&(t=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),t},this.getLightPresetIndex=function(e){for(var i=0;i<t.LightPresets.length;i++)if(t.LightPresets[i].name===e)return i
return-1},this.applyFilter=function(e,i){if(!0!==i)for(var n in e)if(e.hasOwnProperty(n)){var o=i[n]
void 0===o?(delete e[n],t.logger.log("[applyFilter] C - skipping key ["+n+"] from viewerState; unspecified in filter.")):"boolean"==typeof o?!1===o&&(delete e[n],t.logger.log("[applyFilter] D - skipping key ["+n+"] from viewerState; explicit filtering.")):o instanceof Object?e[n]instanceof Object?this.applyFilter(e[n],i[n]):t.logger.warn("[applyFilter] A - Invalid filter Object for key ["+n+"]"):t.logger.warn("[applyFilter] B - Invalid filter value for key ["+n+"]")}}},Autodesk.Viewing.Private.ViewerState.prototype.constructor=Autodesk.Viewing.Private.ViewerState,AutodeskNamespace("Autodesk.Viewing.i18n"),function(){function e(){R="aaaa",Y()}function t(){R=null,Y()}function i(e,t){if(!t||"function"==typeof t)return e
for(var i in t)e[i]=t[i]
return e}function n(e,t,i){var n,o=0,r=e.length,s=void 0===r||"[object Array]"!==Object.prototype.toString.apply(e)||"function"==typeof e
if(i)if(s){for(n in e)if(!1===t.apply(e[n],i))break}else for(;o<r&&!1!==t.apply(e[o++],i););else if(s){for(n in e)if(!1===t.call(e[n],n,e[n]))break}else for(;o<r&&!1!==t.call(e[o],o,e[o++]););return e}function o(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,function(e){return _[e]}):e}function r(e){var t=function(e){if(window.XMLHttpRequest)return e(null,new XMLHttpRequest)
if(window.ActiveXObject)try{return e(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(t){return e(null,new ActiveXObject("Microsoft.XMLHTTP"))}return e(new Error)},i=function(e){if("string"==typeof e)return e
var t=[]
for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]))
return t.join("&")},n=function(e){e=e.replace(/\r\n/g,"\n")
for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i)
n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},o=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="
e=n(e)
var i,o,r,s,a,l,c,d="",u=0
do{i=e.charCodeAt(u++),o=e.charCodeAt(u++),r=e.charCodeAt(u++),s=i>>2,a=(3&i)<<4|o>>4,l=(15&o)<<2|r>>6,c=63&r,isNaN(o)?l=c=64:isNaN(r)&&(c=64),d+=t.charAt(s)+t.charAt(a)+t.charAt(l)+t.charAt(c),i=o=r="",s=a=l=c=""}while(u<e.length)
return d},r=function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var i=arguments[t]
for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])}return e},s=function(e,n,o,a){"function"==typeof o&&(a=o,o={}),o.doNotCache=o.doNotCache||!1,o.data=o.data||{},o.headers=o.headers||{},o.jsonp=o.jsonp||!1,o.async=void 0===o.async||o.async
var l,c=r({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},s.headers,o.headers)
if(l="application/json"===c["content-type"]?JSON.stringify(o.data):i(o.data),"GET"===e){var d=[]
if(l&&(d.push(l),l=null),o.doNotCache&&d.push("_="+(new Date).getTime()),o.jsonp&&(d.push("callback="+o.jsonp),d.push("jsonp="+o.jsonp)),d=d.join("&"),d.length>1&&(n.indexOf("?")>-1?n+="&"+d:n+="?"+d),o.jsonp){var u=document.getElementsByTagName("head")[0],h=document.createElement("script")
return h.type="text/javascript",h.src=n,void u.appendChild(h)}}t(function(t,i){if(t)return a(t)
i.open(e,n,o.async)
for(var r in c)c.hasOwnProperty(r)&&i.setRequestHeader(r,c[r])
i.onreadystatechange=function(){if(4===i.readyState){var e=i.responseText||""
if(!a)return
a(i.status,e)}},i.send(l)})};({authBasic:function(e,t){s.headers.Authorization="Basic "+o(e+":"+t)},connect:function(e,t,i){return s("CONNECT",e,t,i)},del:function(e,t,i){return s("DELETE",e,t,i)},get:function(e,t,i){return s("GET",e,t,i)},head:function(e,t,i){return s("HEAD",e,t,i)},headers:function(e){s.headers=e||{}},isAllowed:function(e,t,i){this.options(e,function(e,n){i(-1!==n.text().indexOf(t))})},options:function(e,t,i){return s("OPTIONS",e,t,i)},patch:function(e,t,i){return s("PATCH",e,t,i)},post:function(e,t,i){return s("POST",e,t,i)},put:function(e,t,i){return s("PUT",e,t,i)},trace:function(e,t,i){return s("TRACE",e,t,i)}})[e.type?e.type.toLowerCase():"get"](e.url,e,function(t,i){200===t?e.success(i,t,null):e.error(i,t,null)})}function s(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},B.extend(N,e),delete N.fixLng,"string"==typeof N.ns&&(N.ns={namespaces:[N.ns],defaultNs:N.ns}),"string"==typeof N.fallbackNS&&(N.fallbackNS=[N.fallbackNS]),"string"!=typeof N.fallbackLng&&"boolean"!=typeof N.fallbackLng||(N.fallbackLng=[N.fallbackLng]),N.interpolationPrefixEscaped=B.regexEscape(N.interpolationPrefix),N.interpolationSuffixEscaped=B.regexEscape(N.interpolationSuffix),N.lng||(N.lng=B.detectLanguage()),N.lng?N.useCookie&&B.cookie.create(N.cookieName,N.lng,N.cookieExpirationTime,N.cookieDomain):(N.lng=N.fallbackLng[0],N.useCookie&&B.cookie.remove(N.cookieName)),L=B.toLanguages(N.lng),x=L[0],B.log("currentLng set to: "+x)
var i=A
if(e.fixLng&&(i=function(e,t){return t=t||{},t.lng=t.lng||i.lng,A(e,t)},i.lng=x),G.setCurrentLng(x),N.resStore)return V=N.resStore,D=!0,void(t&&t(i))
var n=B.toLanguages(N.lng)
"string"==typeof N.preload&&(N.preload=[N.preload])
for(var o=0,r=N.preload.length;o<r;o++)for(var s=B.toLanguages(N.preload[o]),a=0,l=s.length;a<l;a++)n.indexOf(s[a])<0&&n.push(s[a])
Autodesk.Viewing.i18n.sync.load(n,N,function(e,n){V=n,D=!0,t&&t(i)})}function a(e,t){"string"==typeof e&&(e=[e])
for(var i=0,n=e.length;i<n;i++)N.preload.indexOf(e[i])<0&&N.preload.push(e[i])
return s(t)}function l(e,t,i){"string"!=typeof t?(i=t,t=N.ns.defaultNs):N.ns.namespaces.indexOf(t)<0&&N.ns.namespaces.push(t),V[e]=V[e]||{},V[e][t]=V[e][t]||{},B.extend(V[e][t],i)}function c(e,t){"string"!=typeof t&&(t=N.ns.defaultNs),V[e]=V[e]||{},V[e][t]={}}function d(e){N.ns.defaultNs=e}function u(e,t){h([e],t)}function h(e,t){var i={dynamicLoad:N.dynamicLoad,resGetPath:N.resGetPath,getAsync:N.getAsync,customLoad:N.customLoad,ns:{namespaces:e,defaultNs:""}},n=B.toLanguages(N.lng)
"string"==typeof N.preload&&(N.preload=[N.preload])
for(var o=0,r=N.preload.length;o<r;o++)for(var s=B.toLanguages(N.preload[o]),a=0,l=s.length;a<l;a++)n.indexOf(s[a])<0&&n.push(s[a])
for(var c=[],d=0,u=n.length;d<u;d++){var h=!1,p=V[n[d]]
if(p)for(var m=0,g=e.length;m<g;m++)p[e[m]]||(h=!0)
else h=!0
h&&c.push(n[d])}c.length?Autodesk.Viewing.i18n.sync._fetch(c,i,function(i,n){var o=e.length*c.length
B.each(e,function(e,i){N.ns.namespaces.indexOf(i)<0&&N.ns.namespaces.push(i),B.each(c,function(e,r){V[r]=V[r]||{},V[r][i]=n[r][i],0===--o&&t&&(N.useLocalStorage&&Autodesk.Viewing.i18n.sync._storeLocal(V),t())})})}):t&&t()}function p(e,t,i){return"function"==typeof t?(i=t,t={}):t||(t={}),t.lng=e,s(t,i)}function m(){return x}function g(e,t,i,n){if(!e)return e
if(n=n||t,e.indexOf(n.interpolationPrefix||N.interpolationPrefix)<0)return e
var o=n.interpolationPrefix?B.regexEscape(n.interpolationPrefix):N.interpolationPrefixEscaped,r=n.interpolationSuffix?B.regexEscape(n.interpolationSuffix):N.interpolationSuffixEscaped,s="HTML"+r
return B.each(t,function(t,a){var l=i?i+N.keyseparator+t:t
"object"==typeof a&&null!==a?e=g(e,a,l,n):n.escapeInterpolation||N.escapeInterpolation?(e=e.replace(new RegExp([o,l,s].join(""),"g"),a),e=e.replace(new RegExp([o,l,r].join(""),"g"),B.escape(a))):e=e.replace(new RegExp([o,l,r].join(""),"g"),a)}),e}function f(e,t){var i=B.extend({},t)
for(delete i.postProcess;-1!=e.indexOf(N.reusePrefix)&&!(++I>N.maxRecursion);){var n=e.lastIndexOf(N.reusePrefix),o=e.indexOf(N.reuseSuffix,n)+N.reuseSuffix.length,r=e.substring(n,o),s=r.replace(N.reusePrefix,"").replace(N.reuseSuffix,"")
if(-1!=s.indexOf(",")){var a=s.indexOf(",")
if(-1!=s.indexOf("{",a)&&-1!=s.indexOf("}",a)){var l=s.indexOf("{",a),c=s.indexOf("}",l)+"}".length
try{i=B.extend(i,JSON.parse(s.substring(l,c))),s=s.substring(0,a)}catch(e){}}}var d=w(s,i)
e=e.replace(r,d)}return e}function v(e){return e.context&&("string"==typeof e.context||"number"==typeof e.context)}function E(e){return void 0!==e.count&&"string"!=typeof e.count&&1!==e.count}function y(e,t){t=t||{}
var i=T(e,t),n=C(e,t)
return void 0!==n||n===i}function A(e,t){if(t=t||{},!D){B.log("i18next not finished initialization. you might have called t function before loading resources finished.")
var i=e.indexOf(":")
i<0?i=0:i++
var n=t.defaultValue||e.substr(i)
return n&&(n=g(n,t)),n}return I=0,w.apply(null,arguments)}function T(e,t){return void 0!==t.defaultValue?t.defaultValue:e}function b(){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t])
return{postProcess:"sprintf",sprintf:e}}function w(e,t){if(t&&"object"!=typeof t?"sprintf"===N.shortcutFunction?t=b.apply(null,arguments):"defaultValue"===N.shortcutFunction&&(t={defaultValue:t}):t=t||{},void 0===e||null===e)return""
"string"==typeof e&&(e=[e])
var i=e[0]
if(e.length>1)for(var n=0;n<e.length&&(i=e[n],!y(i,t));n++);var o,r=T(i,t),s=C(i,t),a=t.lng?B.toLanguages(t.lng):L,l=t.ns||N.ns.defaultNs
i.indexOf(N.nsseparator)>-1&&(o=i.split(N.nsseparator),l=o[0],i=o[1]),void 0===s&&N.sendMissing&&(t.lng?F.postMissing(a[0],l,i,r,a):F.postMissing(N.lng,l,i,r,a))
var c=t.postProcess||N.postProcess
if(void 0!==s&&c&&z[c]&&(s=z[c](s,i,t)),R&&void 0!==s)return R
var d=r
if(r.indexOf(N.nsseparator)>-1&&(o=r.split(N.nsseparator),d=o[1]),d===i&&N.parseMissingKey&&(r=N.parseMissingKey(r)),void 0===s&&(r=g(r,t),r=f(r,t),c&&z[c])){var u=T(i,t)
s=z[c](u,i,t)}return void 0!==s?s:r}function C(e,t){t=t||{}
var i,n,o=T(e,t),r=L
if(!V)return o
if("cimode"===r[0].toLowerCase())return o
if(t.lng&&(r=B.toLanguages(t.lng),!V[r[0]])){var s=N.getAsync
N.getAsync=!1,Autodesk.Viewing.i18n.sync.load(r,N,function(e,t){B.extend(V,t),N.getAsync=s})}var a=t.ns||N.ns.defaultNs
if(e.indexOf(N.nsseparator)>-1){var l=e.split(N.nsseparator)
a=l[0],e=l[1]}if(v(t)){i=B.extend({},t),delete i.context,i.defaultValue=N.contextNotFound
if((n=A(a+N.nsseparator+e+"_"+t.context,i))!=N.contextNotFound)return g(n,{context:t.context})}if(E(t)){i=B.extend({},t),delete i.count,i.defaultValue=N.pluralNotFound
var c=a+N.nsseparator+e+N.pluralSuffix,d=G.get(r[0],t.count)
if(d>=0?c=c+"_"+d:1===d&&(c=a+N.nsseparator+e),(n=A(c,i))!=N.pluralNotFound)return g(n,{count:t.count,interpolationPrefix:t.interpolationPrefix,interpolationSuffix:t.interpolationSuffix})}for(var u,h=e.split(N.keyseparator),p=0,m=r.length;p<m&&void 0===u;p++){for(var y=r[p],b=0,S=V[y]&&V[y][a];h[b];)S=S&&S[h[b]],b++
if(void 0!==S){var R=Object.prototype.toString.apply(S)
if("string"==typeof S)S=g(S,t),S=f(S,t)
else if("[object Array]"!==R||N.returnObjectTrees||t.returnObjectTrees){if(null===S&&!0===N.fallbackOnNull)S=void 0
else if(null!==S)if(N.returnObjectTrees||t.returnObjectTrees){if("[object Number]"!==R&&"[object Function]"!==R&&"[object RegExp]"!==R){var x="[object Array]"===R?[]:{}
B.each(S,function(i){x[i]=w(a+N.nsseparator+e+N.keyseparator+i,t)}),S=x}}else N.objectTreeKeyHandler&&"function"==typeof N.objectTreeKeyHandler?S=N.objectTreeKeyHandler(e,S,y,a,t):(S="key '"+a+":"+e+" ("+y+")' returned an object instead of string.",B.log(S))}else S=S.join("\n"),S=g(S,t),S=f(S,t)
"string"==typeof S&&""===S.trim()&&!0===N.fallbackOnEmpty&&(S=void 0),u=S}}if(void 0===u&&!t.isFallbackLookup&&(!0===N.fallbackToDefaultNS||N.fallbackNS&&N.fallbackNS.length>0))if(t.isFallbackLookup=!0,N.fallbackNS.length){for(var P=0,k=N.fallbackNS.length;P<k;P++)if(u=C(N.fallbackNS[P]+N.nsseparator+e,t)){var M=u.indexOf(N.nsseparator)>-1?u.split(N.nsseparator)[1]:u,I=o.indexOf(N.nsseparator)>-1?o.split(N.nsseparator)[1]:o
if(M!==I)break}}else u=C(e,t)
return u}function S(){var e,t=[]
if("undefined"!=typeof window&&(!function(){for(var e=window.location.search.substring(1),i=e.split("&"),n=0;n<i.length;n++){var o=i[n].indexOf("=")
if(o>0){var r=i[n].substring(0,o),s=i[n].substring(o+1)
t[r]=s}}}(),t[N.detectLngQS]&&(e=t[N.detectLngQS])),!e&&"undefined"!=typeof document&&N.useCookie){var i=B.cookie.read(N.cookieName)
i&&(e=i)}return e||"undefined"==typeof navigator||(e=navigator.language?navigator.language:navigator.userLanguage),e}var R=null
Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict"
if(null==this)throw new TypeError
var t=Object(this),i=t.length>>>0
if(0===i)return-1
var n=0
if(arguments.length>0&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&n!=1/0&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1
for(var o=n>=0?n:Math.max(i-Math.abs(n),0);o<i;o++)if(o in t&&t[o]===e)return o
return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){"use strict"
if(null==this)throw new TypeError
var t=Object(this),i=t.length>>>0
if(0===i)return-1
var n=i
arguments.length>1&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&n!=1/0&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n))))
for(var o=n>=0?Math.min(n,i-1):i-Math.abs(n);o>=0;o--)if(o in t&&t[o]===e)return o
return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})
var x,P=this,k=P.jQuery||P.Zepto,M={},V={},I=0,L=[],D=!1
"undefined"!=typeof module&&module.exports?module.exports=M:(k&&(k.i18n=k.i18n||M),P.i18n=P.i18n||M)
var N={lng:void 0,load:"current",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:["dev"],fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackOnEmpty:!1,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"res/locales/__lng__/__ns__.json",resPostPath:"res/locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048e5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",cookieDomain:void 0,objectTreeKeyHandler:void 0,postProcess:void 0,parseMissingKey:void 0,shortcutFunction:"sprintf"},_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},O={create:function(e,t,i,n){var o
if(i){var r=new Date
r.setTime(r.getTime()+60*i*1e3),o="; expires="+r.toGMTString()}else o=""
n=n?"domain="+n+";":"",document.cookie=e+"="+t+o+";"+n+"path=/"},read:function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1,o.length)
if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null},remove:function(e){this.create(e,"",-1)}},H={create:function(e,t,i,n){},read:function(e){return null},remove:function(e){}},B={extend:k?k.extend:i,each:k?k.each:n,ajax:k?k.ajax:"undefined"!=typeof document?r:function(){},cookie:"undefined"!=typeof document?O:H,detectLanguage:S,escape:o,log:function(e){N.debug&&"undefined"!=typeof console&&console.log(e)},toLanguages:function(e){var t=[]
if("string"==typeof e&&e.indexOf("-")>-1){var i=e.split("-")
e=N.lowerCaseLng?i[0].toLowerCase()+"-"+i[1].toLowerCase():i[0].toLowerCase()+"-"+i[1].toUpperCase(),"unspecific"!==N.load&&t.push(e),"current"!==N.load&&t.push(i[0])}else t.push(e)
for(var n=0;n<N.fallbackLng.length;n++)-1===t.indexOf(N.fallbackLng[n])&&N.fallbackLng[n]&&t.push(N.fallbackLng[n])
return t},regexEscape:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}}
B.applyReplacement=g
var F={load:function(e,t,i){t.useLocalStorage?F._loadLocal(e,t,function(n,o){for(var r=[],s=0,a=e.length;s<a;s++)o[e[s]]||r.push(e[s])
r.length>0?F._fetch(r,t,function(e,t){B.extend(o,t),F._storeLocal(t),i(null,o)}):i(null,o)}):F._fetch(e,t,function(e,t){i(null,t)})},_loadLocal:function(e,t,i){var n={},o=(new Date).getTime()
if(window.localStorage){var r=e.length
B.each(e,function(e,s){var a=window.localStorage.getItem("res_"+s)
a&&(a=JSON.parse(a),a.i18nStamp&&a.i18nStamp+t.localStorageExpirationTime>o&&(n[s]=a)),0===--r&&i(null,n)})}},_storeLocal:function(e){if(window.localStorage)for(var t in e)e[t].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+t,JSON.stringify(e[t]))},_fetch:function(e,t,i){var n=t.ns,o={}
if(t.dynamicLoad){var r=function(e,t){i(null,t)}
if("function"==typeof t.customLoad)t.customLoad(e,n.namespaces,t,r)
else{var s=g(t.resGetPath,{lng:e.join("+"),ns:n.namespaces.join("+")})
s=Autodesk.Viewing.Private.getResourceUrl(s),B.ajax({url:s,success:function(e,t,i){B.log("loaded: "+s),r(0,e.json())},error:function(e,t,i){B.log("failed loading: "+s),r()},dataType:"text",async:t.getAsync})}}else{var a,l=n.namespaces.length*e.length
B.each(n.namespaces,function(n,r){B.each(e,function(e,n){var s=function(e,t){e&&(a=a||[],a.push(e)),o[n]=o[n]||{},o[n][r]=t,0===--l&&i(a,o)}
"function"==typeof t.customLoad?t.customLoad(n,r,t,s):F._fetchOne(n,r,t,s)})})}},_fetchOne:function(e,t,i,n){var o=g(i.resGetPath,{lng:e,ns:t})
o=Autodesk.Viewing.Private.getResourceUrl(o),B.ajax({url:o,success:function(e,t,i){B.log("loaded: "+o)
var r=e
n(null,JSON.parse(r))},error:function(e,t,i){if(t&&200==t||e&&e.status&&200==e.status)B.log("There is a typo in: "+o)
else if(t&&404==t||e&&e.status&&404==e.status)B.log("Does not exist: "+o)
else{var r=t||(e&&e.status?e.status:null)
B.log(r+" when loading "+o)}n(i,{})},dataType:"text",async:i.getAsync})},postMissing:function(e,t,i,n,o){var r={}
r[i]=n
var s=[]
if("fallback"===N.sendMissingTo&&!1!==N.fallbackLng[0])for(var a=0;a<N.fallbackLng.length;a++)s.push({lng:N.fallbackLng[a],url:g(N.resPostPath,{lng:N.fallbackLng[a],ns:t})})
else if("current"===N.sendMissingTo||"fallback"===N.sendMissingTo&&!1===N.fallbackLng[0])s.push({lng:e,url:g(N.resPostPath,{lng:e,ns:t})})
else if("all"===N.sendMissingTo)for(var a=0,l=o.length;a<l;a++)s.push({lng:o[a],url:g(N.resPostPath,{lng:o[a],ns:t})})
for(var c=0,d=s.length;c<d;c++){var u=s[c]
B.ajax({url:u.url,type:N.sendType,data:r,success:function(e,o,r){B.log("posted missing key '"+i+"' to: "+u.url)
for(var s=i.split("."),a=0,l=V[u.lng][t];s[a];)l=a===s.length-1?l[s[a]]=n:l[s[a]]=l[s[a]]||{},a++},error:function(e,t,n){B.log("failed posting missing key '"+i+"' to: "+u.url)},dataType:"json",async:N.postAsync})}}},G={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(e){return Number(e>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ak:{name:"Akan",numbers:[1,2],plurals:function(e){return Number(e>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(e){return Number(e>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(e){return Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ay:{name:"Aymará",numbers:[1],plurals:function(e){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(e){return Number(1!=e)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},bo:{name:"Tibetan",numbers:[1],plurals:function(e){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(e){return Number(e>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},cgg:{name:"Chiga",numbers:[1],plurals:function(e){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},de:{name:"German",numbers:[1,2],plurals:function(e){return Number(1!=e)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(e){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(e){return Number(1!=e)}},en:{name:"English",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es:{name:"Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},et:{name:"Estonian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},eu:{name:"Basque",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fa:{name:"Persian",numbers:[1],plurals:function(e){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(e){return Number(e>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fr:{name:"French",numbers:[1,2],plurals:function(e){return Number(e>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(e){return Number(1!=e)}},gun:{name:"Gun",numbers:[1,2],plurals:function(e){return Number(e>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(e){return Number(1!=e)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(e){return Number(1!=e)}},id:{name:"Indonesian",numbers:[1],plurals:function(e){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(e){return Number(e%10!=1||e%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ja:{name:"Japanese",numbers:[1],plurals:function(e){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(e){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(e){return Number(0!==e)}},ka:{name:"Georgian",numbers:[1],plurals:function(e){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(e){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(e){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ko:{name:"Korean",numbers:[1],plurals:function(e){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(e){return Number(1==e?0:2==e?1:3==e?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(e){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(e){return Number(e>1)}},lo:{name:"Lao",numbers:[1],plurals:function(e){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[1,2,0],plurals:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(e){return Number(e>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(e){return Number(e>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(e){return Number(e>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(e){return Number(1==e||e%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(e){return Number(1==e?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ms:{name:"Malay",numbers:[1],plurals:function(e){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(e){return Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(e){return Number(1!=e)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(e){return Number(1!=e)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(e){return Number(e>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(e){return Number(1!=e)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(e){return Number(1!=e)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(e){return Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(e){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(e){return Number(1!=e)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(e){return Number(1!=e)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(e){return Number(1!=e)}},son:{name:"Songhay",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(e){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(e){return Number(1!=e)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(e){return Number(1!=e)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(e){return Number(1!=e)}},te:{name:"Telugu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(e){return Number(e>1)}},th:{name:"Thai",numbers:[1],plurals:function(e){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(e){return Number(e>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(e){return Number(1!=e)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(e){return Number(e>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(e){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(e){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(e){return Number(1!=e)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(e){return Number(e>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(e){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(e){return Number(e>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(e){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(e){return Number(1!=e)}},zh:{name:"Chinese",numbers:[1],plurals:function(e){return 0}}},addRule:function(e,t){G.rules[e]=t},setCurrentLng:function(e){if(!G.currentRule||G.currentRule.lng!==e){var t=e.split("-")
G.currentRule={lng:e,rule:G.rules[t[0]]}}},get:function(e,t){var i=e.split("-")
return function(t,i){var n
if(n=G.currentRule&&G.currentRule.lng===e?G.currentRule.rule:G.rules[t]){var o=n.plurals(i),r=n.numbers[o]
return 2===n.numbers.length&&1===n.numbers[0]&&(2===r?r=-1:1===r&&(r=1)),r}return 1===i?"1":"-1"}(i[0],t)}},z={},U=function(e,t){z[e]=t},W=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var i=[];t>0;i[--t]=e);return i.join("")}var i=function(){return i.cache.hasOwnProperty(arguments[0])||(i.cache[arguments[0]]=i.parse(arguments[0])),i.format.call(null,i.cache[arguments[0]],arguments)}
return i.format=function(i,n){var o,r,s,a,l,c,d,u=1,h=i.length,p="",m=[]
for(r=0;r<h;r++)if("string"===(p=e(i[r])))m.push(i[r])
else if("array"===p){if(a=i[r],a[2])for(o=n[u],s=0;s<a[2].length;s++){if(!o.hasOwnProperty(a[2][s]))throw W('[sprintf] property "%s" does not exist',a[2][s])
o=o[a[2][s]]}else o=a[1]?n[a[1]]:n[u++]
if(/[^s]/.test(a[8])&&"number"!=e(o))throw W("[sprintf] expecting number but found %s",e(o))
switch(a[8]){case"b":o=o.toString(2)
break
case"c":o=String.fromCharCode(o)
break
case"d":o=parseInt(o,10)
break
case"e":o=a[7]?o.toExponential(a[7]):o.toExponential()
break
case"f":o=a[7]?parseFloat(o).toFixed(a[7]):parseFloat(o)
break
case"o":o=o.toString(8)
break
case"s":o=(o=String(o))&&a[7]?o.substring(0,a[7]):o
break
case"u":o=Math.abs(o)
break
case"x":o=o.toString(16)
break
case"X":o=o.toString(16).toUpperCase()}o=/[def]/.test(a[8])&&a[3]&&o>=0?"+"+o:o,c=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",d=a[6]-String(o).length,l=a[6]?t(c,d):"",m.push(a[5]?o+l:l+o)}return m.join("")},i.cache={},i.parse=function(e){for(var t=e,i=[],n=[],o=0;t;){if(null!==(i=/^[^\x25]+/.exec(t)))n.push(i[0])
else if(null!==(i=/^\x25{2}/.exec(t)))n.push("%")
else{if(null===(i=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?"
if(i[2]){o|=1
var r=[],s=i[2],a=[]
if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(s)))throw"[sprintf] huh?"
for(r.push(a[1]);""!==(s=s.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(s)))r.push(a[1])
else{if(null===(a=/^\[(\d+)\]/.exec(s)))throw"[sprintf] huh?"
r.push(a[1])}i[2]=r}else o|=2
if(3===o)throw"[sprintf] mixing positional and named placeholders is not (yet) supported"
n.push(i)}t=t.substring(i[0].length)}return n},i}(),j=function(e,t){return t.unshift(e),W.apply(null,t)}
U("sprintf",function(e,t,i){return i.sprintf?"[object Array]"===Object.prototype.toString.apply(i.sprintf)?j(e,i.sprintf):"object"==typeof i.sprintf?W(e,i.sprintf):e:e})
var Y=function(e){function t(e){return[null,e]}var i=e||document
Array.prototype.forEach.call(i.querySelectorAll("[data-i18n]"),function(e){var i=e.getAttribute("data-i18n"),n=t(i),o=n[0],r=n[1],s=Autodesk.Viewing.i18n.translate(r)
s?o?e.setAttribute(o,s):e.textContent=s:o?e.setAttribute(o,r):e.textContent=r})}
Autodesk.Viewing.i18n.init=s,Autodesk.Viewing.i18n.setLng=p,Autodesk.Viewing.i18n.preload=a,Autodesk.Viewing.i18n.addResourceBundle=l,Autodesk.Viewing.i18n.removeResourceBundle=c,Autodesk.Viewing.i18n.loadNamespace=u,Autodesk.Viewing.i18n.loadNamespaces=h,Autodesk.Viewing.i18n.localize=Y,Autodesk.Viewing.i18n.setDefaultNamespace=d,Autodesk.Viewing.i18n.t=A,Autodesk.Viewing.i18n.translate=A,Autodesk.Viewing.i18n.exists=y,Autodesk.Viewing.i18n.detectLanguage=B.detectLanguage,Autodesk.Viewing.i18n.pluralExtensions=G,Autodesk.Viewing.i18n.sync=F,Autodesk.Viewing.i18n.functions=B,Autodesk.Viewing.i18n.lng=m,Autodesk.Viewing.i18n.addPostProcessor=U,Autodesk.Viewing.i18n.options=N,Autodesk.Viewing.i18n.setDebugLocString=e,Autodesk.Viewing.i18n.clearDebugLocString=t}(),function(){"use strict"
var e=(Autodesk.Viewing.UI,function(e,t,i,n){this.kMinWdth=100,this.kMinHeight=100,this.visibilityCallbacks=[],this.movedSinceLastClick=!1,this.parentContainer=e,this.container=document.createElement("div"),this.container.id=t,this.container.lastWidth="",this.container.dockRight=!1,this.container.dockBottom=!1,this.titleLabel=i,n=n||{},n.hasOwnProperty("localizeTitle")||(n.localizeTitle=!0),this.options=n,this.container.classList.add("dockingPanel"),e.appendChild(this.container),this.listeners=[],this.initialize(),this.setVisible(!1)})
e.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id),this.container.appendChild(this.title),this.initializeMoveHandlers(this.title),this.setTitle(this.titleLabel||this.container.id,this.options),this.closer=this.createCloseButton(),this.container.appendChild(this.closer)},e.prototype.uninitialize=function(){for(var e=0;e<this.listeners.length;++e){var t=this.listeners[e]
t.target.removeEventListener(t.eventId,t.callback)}this.listeners=[],this.visibilityCallbacks=[],this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.title=null,this.closer=null},e.prototype.addVisibilityListener=function(e){this.visibilityCallbacks.push(e)},e.prototype.setVisible=function(e){if(e){var t=this.getContainerBoundingRect()
if(this.container.dockRight){var i=t.width,n=300,o=this.container.lastWidth||this.container.style.width
o||(o=this.container.getBoundingClientRect().width),o&&(n=parseInt(o)),this.container.style.left=i-n+"px"}if(this.container.dockBottom){var r=t.height,s=300,a=this.container.lastHeight||this.container.style.height
a||(a=this.container.getBoundingClientRect().height),a&&(s=parseInt(a))
var l=r-s
this.container.style.top=l>0?l+"px":0}this.container.style.maxHeight=t.height+"px",this.container.style.maxWidth=t.width+"px",this.container.style.display="block"}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none"
for(var c=0;c<this.visibilityCallbacks.length;c++)this.visibilityCallbacks[c](e)},e.prototype.isVisible=function(){return"block"===this.container.style.display},e.prototype.visibilityChanged=function(){},e.prototype.initializeMoveHandlers=function(e){function t(e){var t=h.style.minWidth?parseInt(h.style.minWidth):p.kMinWdth,i=h.style.minHeight?parseInt(h.style.minHeight):p.kMinHeight,n=p.getContainerBoundingRect()
h.style.maxWidth&&parseInt(h.style.width)>parseInt(h.style.maxWidth)&&(h.style.width=h.style.maxWidth),h.style.maxHeight&&parseInt(h.style.height)>parseInt(h.style.maxHeight)&&(h.style.height=h.style.maxHeight),parseInt(h.style.width)<t&&(h.style.width=t+"px"),parseInt(h.style.height)<i&&(h.style.height=i+"px"),"touchmove"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),d+=e.screenX-s,u+=e.screenY-a,o=l+d,r=c+u
var m=parseInt(h.style.width),g=parseInt(h.style.height)
isNaN(m)&&(m=p.container.getBoundingClientRect().width),isNaN(g)&&(g=p.container.getBoundingClientRect().height),o<5&&(o=0),r<5&&(r=0),h.dockRight=!1,h.dockBottom=!1,n.width-5<o+m&&(o=n.width-m,h.dockRight=!0),n.height-5<r+g&&(r=n.height-g,h.dockBottom=!0),h.style.left=o+"px",h.style.top=r+"px",h.style.maxWidth=n.width-o+"px",h.style.maxHeight=n.height-r+"px",s=e.screenX,a=e.screenY,p.onMove(e,o,r)}function i(e){window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",i),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",i),p.onEndMove(e,o,r)}function n(e){"touchstart"===e.type&&(e.screenX=e.touches[0].screenX,e.screenY=e.touches[0].screenY),s=e.screenX,a=e.screenY,d=0,u=0,l=p.container.offsetLeft,c=p.container.offsetTop,window.addEventListener("mousemove",t,!1),window.addEventListener("mouseup",i,!1),window.addEventListener("touchmove",t,!1),window.addEventListener("touchend",i,!1),e.preventDefault(),p.onStartMove(e,l,c)}var o,r,s,a,l,c,d,u,h=this.container,p=this
p.addEventListener(e,"mousedown",n),p.addEventListener(e,"touchstart",n)},e.prototype.initializeCloseHandler=function(e){var t=this
t.addEventListener(e,"click",function(e){t.setVisible(!1)},!1)},e.prototype.createScrollContainer=function(e){var t=document.createElement("div"),i=t.classList
return i.add("dockingPanelScroll"),i.add(e&&e.left?"left":"right"),e&&e.heightAdjustment&&(t.style.height="calc(100% - "+e.heightAdjustment+"px)"),e&&e.marginTop&&(t.style.marginTop=e.marginTop+"px"),t.id=this.container.id+"-scroll-container",this.container.appendChild(t),this.scrollContainer=t,t},e.prototype.createTitleBar=function(e){var t=document.createElement("div")
t.className="dockingPanelTitle",t.textContent=e
var i=this
return i.addEventListener(t,"click",function(e){i.movedSinceLastClick||i.onTitleClick(e),i.movedSinceLastClick=!1}),i.addEventListener(t,"dblclick",function(e){i.onTitleDoubleClick(e)}),t},e.prototype.setTitle=function(e,t){t&&t.localizeTitle?(this.title.setAttribute("data-i18n",e),e=Autodesk.Viewing.i18n.translate(e)):this.title.removeAttribute("data-i18n"),this.title.textContent=e},e.prototype.createCloseButton=function(){var e=document.createElement("div")
return e.className="dockingPanelClose",e.innerHTML="&times;",this.initializeCloseHandler(e),e},e.prototype.onStartMove=function(e,t,i){},e.prototype.onEndMove=function(e,t,i){},e.prototype.onMove=function(e,t,i){this.movedSinceLastClick=!0},e.prototype.onTitleClick=function(e){},e.prototype.onTitleDoubleClick=function(e){},e.prototype.addEventListener=function(e,t,i){e.addEventListener(t,i),this.listeners.push({target:e,eventId:t,callback:i})},e.prototype.removeEventListener=function(e,t,i){for(var n=0;n<this.listeners.length;++n){var o=this.listeners[n]
if(o.target===e&&o.eventId===t&&o.callback===i)return e.removeEventListener(t,i),this.listeners.splice(n,1),!0}return!1},e.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}},e.prototype.resizeToContent=function(e){if(this.isVisible()){var t=this.getContentSize(),i=t.height,n=this.container.getBoundingClientRect(),o=this.getContainerBoundingRect(),r=e&&e.maxHeight?e.maxHeight:o.height
r-=75,i>r&&(i=r)
var s=n.top-o.top
s>0&&s+i+75>o.height&&(s=Math.max(0,o.height-(i+75))),this.container.style.maxHeight=r.toString()+"px",this.container.style.height=i.toString()+"px",this.container.style.top=s+"px"}},e.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()},Autodesk.Viewing.UI.DockingPanel=e}(),function(){"use strict"
var e=Autodesk.Viewing.UI,t=Autodesk.Viewing.Private,i=function(t,i,n,o){e.DockingPanel.call(this,t,i,n,o),this.container.classList.add("modelStructurePanel"),o=o||{},o.heightAdjustment||(o.heightAdjustment=40),o.marginTop||(o.marginTop=0),o.left=!0,this.createScrollContainer(o),this.options=o,this.instanceTree=null,this.tree=null,this.selectedNodes=[],this.uiCreated=!1
var r=this
this.addVisibilityListener(function(e){e&&(r.uiCreated||r.createUI(),r.resizeToContent())})}
i.prototype=Object.create(e.DockingPanel.prototype),i.prototype.constructor=i,i.prototype.setModel=function(e,t){this.instanceTree=e,this.modelTitle=t,this.isVisible()?this.createUI():this.uiCreated=!1},i.prototype.createUI=function(){var i=this,n=i.instanceTree
if(n){i.selectedNodes=[]
var o=i.modelTitle
o||i.options&&i.options.defaultTitle&&(o=i.options.defaultTitle)
var r={}
if(o||(o="Browser",r.localizeTitle=!0),i.setTitle(o,r),i.tree){for(;i.scrollContainer.hasChildNodes();)i.scrollContainer.removeChild(i.scrollContainer.lastChild)
i.title.removeEventListener("click",i.onTitleClick),i.title.removeEventListener("dblclick",i.onTitleDoubleClick)}var s,a=this.rootId=n.getRootId(),l=n.getNodeName(a),c=0,d=0
n.enumNodeChildren(a,function(e){d||(s=n.getNodeName(e),c=e),d++})
var u=function(){var n=new e.TreeDelegate
return n.getTreeNodeId=function(e){return"object"==typeof e?(t.logger.warn("Object used instead of dbId. Fix it."),e.dbId):e},n.getTreeNodeLabel=function(e){var t=this.getTreeNodeId(e),n=i.instanceTree.getNodeName(t)
return-1e10==t&&(n="Object 0"),n||"Object "+t},n.getTreeNodeClass=function(e){return i.getNodeClass(e)},n.isTreeNodeGroup=function(e){return i.isGroupNode(e)},n.shouldCreateTreeNode=function(e){return i.shouldInclude(e)},n.onTreeNodeClick=function(e,t,n){i.onClick(t,n)},n.onTreeNodeRightClick=function(e,t,n){i.onRightClick(t,n)},n.onTreeNodeDoubleClick=function(e,t,n){i.onDoubleClick(t,n)},n.onTreeNodeIconClick=function(e,t,n){i.onIconClick(t,n)},n.forEachChild=function(e,t){var n=this.getTreeNodeId(e)
i.instanceTree.enumNodeChildren(n,t)},n.onTreeNodeHover=function(e,t,n){i.onHover(t,n)},n}()
this.myDelegate=u
var h=1===d&&l===s,p={excludeRoot:h,localize:!0}
i.tree=new e.Tree(u,a,i.scrollContainer,p),i.options&&i.options.hasOwnProperty("startCollapsed")&&!i.options.startCollapsed||(i.tree.setAllCollapsed(!0),i.tree.setCollapsed(a,!1),h&&i.tree.setCollapsed(c,!1)),this.uiCreated=!0}},i.prototype.getNodeLabel=function(e){return this.myDelegate.getNodeLabel(e)},i.prototype.getNodeClass=function(e){return""},i.prototype.isGroupNode=function(e){var t=this.myDelegate.getTreeNodeId(e)
return this.instanceTree.getChildCount(t)},i.prototype.shouldInclude=function(e){return!0},i.prototype.onClick=function(e,t){this.setSelection([e])},i.prototype.onDoubleClick=function(e,t){},i.prototype.onIconClick=function(e,t){this.setGroupCollapsed(e,!this.isGroupCollapsed(e))},i.prototype.setGroupCollapsed=function(e,t){this.tree.delegate().isTreeNodeGroup(e)&&(this.tree.setCollapsed(e,t),this.resizeToContent())},i.prototype.isGroupCollapsed=function(e){return!!this.tree.delegate().isTreeNodeGroup(e)&&this.tree.isCollapsed(e)},i.prototype.onRightClick=function(e,t){},i.prototype.onTitleClick=function(e){},i.prototype.onTitleDoubleClick=function(e){},i.prototype.onHover=function(e,t){},i.prototype.setSelection=function(e){if(this.tree){var t,i
for(t=0;t<this.selectedNodes.length;++t)for(i=this.instanceTree.getNodeParentId(this.selectedNodes[t]);i;)this.tree.removeClass(i,"ancestor-selected"),i=this.instanceTree.getNodeParentId(i)
var n=[]
for(t=0;t<e.length;++t)for(n.push(e[t]),i=this.instanceTree.getNodeParentId(e[t]);i;)this.tree.addClass(i,"ancestor-selected"),i=this.instanceTree.getNodeParentId(i)
this.selectedNodes=e,this.tree.setSelection(n)}},i.prototype.getContentSize=function(){var e=this.tree
if(e){var t=e.getRootContainer()
if(t)return{height:t.clientHeight+this.options.heightAdjustment+35,width:t.clientWidth}}return{height:0,width:0}},i.prototype.addClass=function(e,t){return null!==this.tree&&this.tree.addClass(e,t)},i.prototype.removeClass=function(e,t){return null!==this.tree&&this.tree.removeClass(e,t)},Autodesk.Viewing.UI.ModelStructurePanel=i}(),function(){"use strict"
function e(e){e=String(e)
var t=' target="blank" class="propertyLink" '
return[{pattern:/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,value:"<a"+t+'href="$&">$&</a>'},{pattern:/(^|[^\/])(www\.[\S]+(\b|$))/gim,value:"$1<a"+t+'href="http://$2">$2</a>'}].reduce(function(e,t){return e.replace(t.pattern,t.value)},e)}var t=Autodesk.Viewing.UI,i=function(e,i,n,o){t.DockingPanel.call(this,e,i,n,o),this.container.classList.add("propertyPanel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:45,marginTop:0}),this.highlightableElements={}
var r=this,s=function(){function e(e){return"category"===e.type}var i=new t.TreeDelegate
return i.getTreeNodeId=function(e){return e.name+(e.hasOwnProperty("value")?e.value:"")+(e.hasOwnProperty("category")?e.category:"")},i.getTreeNodeClass=function(t){return e(t)?r.getCategoryClass(t):r.getPropertyClass(t)},i.isTreeNodeGroup=function(t){return e(t)},i.onTreeNodeClick=function(t,i,n){e(i)?r.onCategoryClick(i,n):r.onPropertyClick(i,n)},i.onTreeNodeRightClick=function(t,i,n){e(i)?r.onCategoryRightClick(i,n):r.onPropertyRightClick(i,n)},i.onTreeNodeDoubleClick=function(t,i,n){e(i)?r.onCategoryDoubleClick(i,n):r.onPropertyDoubleClick(i,n)},i.onTreeNodeIconClick=function(t,i,n){e(i)?r.onCategoryIconClick(i,n):r.onPropertyIconClick(i,n)},i.createTreeNode=function(t,i,n){var o=null;(o=e(t)?r.displayCategory(t,i,n):r.displayProperty(t,i,n))&&(r.highlightableElements[this.getTreeNodeId(t)]=o)},i}()
this.tree=new t.Tree(s,null,this.scrollContainer,{})}
i.prototype=Object.create(t.DockingPanel.prototype),i.prototype.constructor=i,i.prototype.setProperties=function(e,t){this.removeAllProperties()
for(var i=[],n=[],o=0;o<e.length;o++){var r=e[o]
if(!r.hidden){var s=e[o].displayCategory
s&&"string"==typeof s&&""!==s?i.push(r):n.push(r)}}if(i.length+n.length===0)return void this.showNoProperties()
for(var o=0;o<i.length;o++){var r=i[o],a=Autodesk.Viewing.Private.formatValueWithUnits(r.displayValue,r.units,r.type,r.precision)
this.addProperty(r.displayName,a,r.displayCategory)}for(var l=i.length>0,o=0;o<n.length;o++){var r=n[o],a=Autodesk.Viewing.Private.formatValueWithUnits(r.displayValue,r.units,r.type,r.precision)
this.addProperty(r.displayName,a,l?"Other":"",l?{localizeCategory:!0}:{})}},i.prototype.showNoProperties=function(){this.removeAllProperties()
var e=this.tree.myRootContainer,t=document.createElement("div")
t.className="noProperties"
var i="No properties to display"
t.setAttribute("data-i18n",i),t.textContent=Autodesk.Viewing.i18n.translate(i),e.appendChild(t)},i.prototype.showDefaultProperties=function(){this.showNoProperties(),this.resizeToContent()},i.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()},i.prototype.addProperty=function(e,t,i,n){if(this.tree.getElementForNode({name:e,value:t,category:i}))return!1
var o=null,r={name:e,value:t,type:"property"}
return i?(o=this.tree.getElementForNode({name:i}),o||(o=this.tree.createElement_({name:i,type:"category"},this.tree.myRootContainer,n&&n.localizeCategory?{localize:!0}:null)),r.category=i):o=this.tree.myRootContainer,this.tree.createElement_(r,o,n&&n.localizeProperty?{localize:!0}:null),!0},i.prototype.hasProperties=function(){for(var e in this.highlightableElements)return!0
return!1},i.prototype.removeProperty=function(e,t,i,n){var o={name:e,value:t,category:i},r=this.tree.getElementForNode(o)
return!!r&&(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(o)],r.parentNode.removeChild(r),!0)},i.prototype.removeAllProperties=function(){this.highlightableElements={},this.tree.clear()},i.prototype.setCategoryCollapsed=function(e,t){var i=this.tree.delegate().getTreeNodeId(e)
this.tree.setCollapsed(i,t)},i.prototype.isCategoryCollapsed=function(e){var t=this.tree.delegate().getTreeNodeId(e)
return this.tree.isCollapsed(t)},i.prototype.getContentSize=function(){var e=this.tree.myRootContainer
return{height:e.clientHeight+55,width:e.clientWidth}},i.prototype.highlight=function(e,t){for(var i in this.highlightableElements)for(var n=this.highlightableElements[i],o=0;o<n.length;++o)!function(t){var i=t.innerHTML,n=i.replace(/(<highlight>|<\/highlight>)/gim,"")
if(i!==n&&(t.innerHTML=n),e&&""!==e){var o=new RegExp("(\\b"+e+"\\b)","gim"),r=n.replace(o,"<highlight>$1</highlight>")
t.innerHTML=r}}(n[o])},i.prototype.displayCategory=function(e,t,i){var n=document.createElement("div"),o=e.name
return i&&i.localize&&(n.setAttribute("data-i18n",o),o=Autodesk.Viewing.i18n.translate(o)),n.textContent=o,n.title=o,n.className="categoryName",t.appendChild(n),[n]},i.prototype.displayProperty=function(t,i,n){var o=document.createElement("div"),r=t.name
n&&n.localize&&(o.setAttribute("data-i18n",r),r=Autodesk.Viewing.i18n.translate(r)),o.textContent=r,o.title=r,o.className="propertyName"
var s=document.createElement("div")
s.className="separator"
var a=document.createElement("div")
a.textContent=t.value
var l=t.value
return a.title=l,l=e(l),a.innerHTML=l,a.className="propertyValue",i.appendChild(o),i.appendChild(s),i.appendChild(a),[o,a]},i.prototype.getCategoryClass=function(e){return"category"},i.prototype.getPropertyClass=function(e){return"property"},i.prototype.onCategoryClick=function(e,t){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},i.prototype.onPropertyClick=function(e,t){},i.prototype.onCategoryIconClick=function(e,t){this.setCategoryCollapsed(e,!this.isCategoryCollapsed(e))},i.prototype.onPropertyIconClick=function(e,t){},i.prototype.onCategoryDoubleClick=function(e,t){},i.prototype.onPropertyDoubleClick=function(e,t){},i.prototype.onCategoryRightClick=function(e,t){},i.prototype.onPropertyRightClick=function(e,t){},Autodesk.Viewing.UI.PropertyPanel=i}(),function(){var e=Autodesk.Viewing,t=Autodesk.Viewing.Private,i=function(e){this.viewer=e,this.menus=[],this.open=!1}
i.prototype.constructor=i,i.prototype.show=function(e,t){var i=this.viewer.container.getBoundingClientRect()
Array.isArray(e.changedPointers)&&e.changedPointers.length>0&&(e.clientX=e.changedPointers[0].clientX,e.clientY=e.changedPointers[0].clientY)
var n=e.clientX-i.left,o=e.clientY-i.top
if(!this.open){var r=this
this.showMenu(t,n,o),this.open=!0,this.hideEventListener=function(e){"menuItem"!==e.target.className&&r.hide(e)},this.isTouch="press"===e.type,document.body.addEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener,!0)}},i.prototype.showMenu=function(i,n,o){var r,s=document.createElement("div"),a=[]
s.className="menu",this.viewer.container.appendChild(s),this.menus.push(s)
for(var l=0;l<i.length;++l){var c=i[l],d=c.title,u=c.target
r=this.createMenuItem(s,d),"function"==typeof u?this.addCallbackToMenuItem(r,u):Array.isArray(u)?a.push({menuItem:r,target:u}):t.logger.warn("Invalid context menu option:",d,u)}var h=s.getBoundingClientRect(),p=h.width,m=h.height,g=this.viewer.container.getBoundingClientRect(),f=g.width,v=g.height,E=e.isTouchDevice()&&!this.viewer.navigation.getUseLeftHandedInput()
for(E&&(n-=p),n<0&&(n=0),f<n+p&&(n=f-p)<0&&(n=0),o<0&&(o=0),v<o+m&&(o=v-m)<0&&(o=0),s.style.top=Math.round(o)+"px",s.style.left=Math.round(n)+"px",l=0;l<a.length;++l){var y=a[l]
r=y.menuItem,h=r.getBoundingClientRect(),n=Math.round((E?h.left:h.right)-g.left),o=Math.round(h.top-g.top),this.addSubmenuCallbackToMenuItem(r,y.target,n,o)}},i.prototype.createMenuItem=function(e,t){var i=document.createElement("div")
return i.className="menuItem",i.setAttribute("data-i18n",t),i.textContent=Autodesk.Viewing.i18n.translate(t),e.appendChild(i),i},i.prototype.addCallbackToMenuItem=function(e,t){var i=this
e.addEventListener("click",function(e){return i.hide(),t(),e.preventDefault(),!1},!1)},i.prototype.addSubmenuCallbackToMenuItem=function(e,t,i,n){var o=this
e.addEventListener("click",function(){o.showMenu(t,i,n)},!1)},i.prototype.hide=function(){if(this.open){for(var e=0;e<this.menus.length;++e)this.menus[e]&&this.menus[e].parentNode.removeChild(this.menus[e])
return this.menus=[],this.open=!1,document.body.removeEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener),this.isTouch=!1,!0}return!1},Autodesk.Viewing.Private.ContextMenu=i}(),function(){"use strict"
var e=(Autodesk.Viewing.UI,Autodesk.Viewing.Private),t=function(t){this.viewer=t,this.contextMenu=new e.ContextMenu(t)}
t.prototype.constructor=t,t.prototype.show=function(e){var t=this.viewer.getSelectionCount(),i=this.viewer.getSelectionVisibility(),n={numSelected:t,hasSelected:0<t,hasVisible:i.hasVisible,hasHidden:i.hasHidden},o=this.buildMenu(e,n)
this.viewer.runContextMenuCallbacks(o,n),o&&0<o.length&&this.contextMenu.show(e,o)},t.prototype.hide=function(){return this.contextMenu.hide()},t.prototype.buildMenu=function(e,t){return null},Autodesk.Viewing.UI.ObjectContextMenu=t}(),Autodesk.Viewing.Private.Preferences=function(e,t){function i(e,i){if(d){if(u.hasTag(e,"no-storage"))return
var n=t.prefix+e
return void 0!==i?localStorage[n]=i:i=localStorage[n],i}}function n(e,t){if("string"!=typeof e||"function"==typeof u[e])return void s.logger.log("Preferences: invalid name="+e)
var n=i(e),o=!1
if(void 0!==n)try{n=JSON.parse(n),o=!0}catch(e){}u[e]=o?n:t,c[e]={}}function o(e){d&&(e=t.prefix+e,delete localStorage[e])}"string"==typeof t&&(t={prefix:t}),t||(t={}),t.prefix||(t.prefix="Autodesk.Viewing.Preferences."),t.hasOwnProperty("localStorage")||(t.localStorage=!0)
var r=Autodesk.Viewing,s=Autodesk.Viewing.Private,a={},l={},c={},d=t.localStorage&&function(){var e=t.prefix+"test"
try{var i=window.localStorage
return i.setItem(e,"1"),i.removeItem(e),!0}catch(e){return!1}}(),u=this
e.addEventListener(r.PREF_CHANGED_EVENT,function(e){var t=l[e.name]
if(t){var i=t.changed
i&&i(e.value)}}),e.addEventListener(r.PREF_RESET_EVENT,function(e){var t=l[e.name]
if(t){var i=t.reset
i&&i(e.value)}}),e.addEventListener(r.RESTORE_DEFAULT_SETTINGS_EVENT,function(t){var i=e.model.is2d()?"2d":"3d"
u.reset(i)}),this.load=function(e){a=e
for(var t in a)a.hasOwnProperty(t)&&n(t,a[t])},this.tag=function(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(a)
for(var i=0;i<t.length;++i)c[t[i]][e]=!0}},this.untag=function(e,t){if(e){t?Array.isArray(t)||(t=[t]):t=Object.keys(a)
for(var i=0;i<t.length;++i)c[t[i]][e]=!1}},this.hasTag=function(e,t){var i=c[e]
return!!i&&!0===i[t]},this.add=function(e,t,i){if(!a.hasOwnProperty(e)){if(a[e]=t,n(e,t),i){Array.isArray(i)||(i=[i])
for(var o=0;o<i.length;++o)this.tag(i[o],e)}return!0}return s.logger.log("Preferences: "+e+" already exists"),!1},this.remove=function(e,t){return!!a.hasOwnProperty(e)&&(delete a[e],delete c[e],delete this[e],t&&o(e),!0)},this.reset=function(t,i){t&&void 0===i&&(i=!0)
for(var n in a)if(a.hasOwnProperty(n)){if(t){var s=!!c[n][t]
if(i&&!s||!i&&s)continue}this.set(n,a[n],!1)&&e.fireEvent({type:r.PREF_RESET_EVENT,name:n,value:this[n]}),o(n)}},this.get=function(e){return this[e]},this.set=function(t,n,o){return this[t]!==n&&(this[t]=n,i(t,n),(void 0===o||o)&&e.fireEvent({type:r.PREF_CHANGED_EVENT,name:t,value:n}),s.logger.track({category:"pref_changed",name:t,value:n}),!0)},this.addListeners=function(e,t,i){l[e]={changed:t,reset:i}},this.removeListeners=function(e){void 0!==l[e]&&delete l[e]}},AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.formatValueWithUnits=function(e,t,i,n){function o(e){var t=0<=e?Math.floor(e):Math.ceil(e)
return{intPart:t,fracPart:e-t}}function r(e,t,i){var n=""
return i&&0===e&&(n+="-"),n+=0<t?e.toFixed(t):e.toFixed(0)}function s(e,t,i){for(var n="",s=1,a=e<0,l=0;l<t;++l)s*=2
e>0?e+=.5/s:e-=.5/s
var c,d
i?d=e:(c=o(e/12).intPart,n+=r(c,0,a)+"' ",(d=e-12*c)<0&&(d=-d))
var u=o(d).intPart,h=o((d-u)*s).intPart
if(0!==h&&0===u||(n+=r(u,0)),0!==h){for(u<0&&h<0&&(h=-h);h%2==0;)h/=2,s/=2
0!==u&&(n+="-"),n+=r(h,0)+"/"+r(s,0)}return n+='"'}function a(e,t){var i=""
e<0&&(i="-",e=Math.abs(e))
var n=o(e),s=n.intPart,a=100*n.fracPart
return i+r(s,0)+" m "+r(a,t)+" cm"}function l(e,t){var i=""
e<0&&(i="-",e=Math.abs(e))
var n=o(e),s=n.intPart,a=12*n.fracPart
return i+r(s,0)+"' "+r(a,t)+'"'}var c
null===n&&(n=3)
try{if(1===i)c=Autodesk.Viewing.i18n.translate(e?"Yes":"No")
else if(24===i){var d=e.split(" ")
c=[]
for(var u=0;u<d.length;++u)c.push(Autodesk.Viewing.Private.formatValueWithUnits(parseFloat(d[u]),t,3,n))
c=c.join(", ")}else 2!==i&&3!==i||!isNaN(e)?"ft-and-fractional-in"===t?c=s(12*e,n):"ft-and-fractional-in^2"===t?c=s(12*e,n)+" "+String.fromCharCode(178):"ft-and-decimal-in"===t?c=l(e,n):"ft-and-decimal-in^2"===t?c=l(e,n)+" "+String.fromCharCode(178):"decimal-in"===t||"in"===t||"inch"===t?c=r(e,n)+'"':"decimal-in^2"===t||"in^2"===t||"inch^2"===t?c=r(e,n)+'" '+String.fromCharCode(178):"decimal-ft"===t||"ft"===t||"feet"===t||"foot"===t?c=r(e,n)+"'":"decimal-ft^2"===t||"ft^2"===t||"feet^2"===t||"foot^2"===t?c=r(e,n)+"' "+String.fromCharCode(178):"fractional-in"===t?c=s(e,n,!0):"fractional-in^2"===t?c=s(e,n,!0)+" "+String.fromCharCode(178):"m-and-cm"===t?c=a(e,n):"m-and-cm^2"===t?c=a(e,n)+" "+String.fromCharCode(178):3===i&&t?(t=t.replace("^2",String.fromCharCode(178)),t=t.replace("^3",String.fromCharCode(179)),c=r(e,n)+" "+t):c=t?e+" "+t:3===i?r(e,n):e:c="NaN"}catch(i){c=t?e+" "+t:e}return c},Autodesk.Viewing.Private.convertUnits=function(e,t,i,n,o){if(i=i||1,e===t&&1==i)return n
var r=1
switch(t){case"mm":r=1e3
break
case"cm":r=100
break
case"m":r=1
break
case"in":r=39.37007874
break
case"ft":case"ft-and-fractional-in":case"ft-and-decimal-in":r=3.280839895
break
case"decimal-in":r=39.37007874
break
case"decimal-ft":r=3.280839895
break
case"fractional-in":r=39.37007874
break
case"m-and-cm":r=1}var s=1
switch(e){case"mm":s=.001
break
case"cm":s=.01
break
case"m":s=1
break
case"in":s=.0254
break
case"ft":case"ft-and-fractional-in":case"ft-and-decimal-in":s=.3048
break
case"decimal-in":s=.0254
break
case"decimal-ft":s=.3048
break
case"fractional-in":s=.0254
break
case"m-and-cm":s=1}return"square"===o?n*Math.pow(r*s*i,2):n*r*s*i},AutodeskNamespace("Autodesk.Viewing.Private"),function(){var e=Autodesk.Viewing,t=Autodesk.Viewing.Private
t.OptionSlider=function(t,i,n,o,r){function s(e){e.target!=a.stepperElement&&(a.stepperElement.value=a.sliderElement.value),a.fireChangeEvent()}var a=this
this.tbody=o
var l=r&&r.insertAtIndex?r.insertAtIndex:-1
this.sliderRow=this.tbody.insertRow(l)
var c=this.sliderRow.insertCell(0)
this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),this.sliderElement=document.createElement("input"),this.sliderElement.type="range",this.sliderElement.id=t+"_slider",this.sliderElement.min=i,this.sliderElement.max=n,c.appendChild(this.caption),c.appendChild(this.sliderElement),c=this.sliderRow.insertCell(1),this.stepperElement=document.createElement("input"),this.stepperElement.type="number",this.stepperElement.id=t+"_stepper",this.stepperElement.min=i,this.stepperElement.max=n,this.stepperElement.step=1,this.stepperElement.style.width="64px",c.appendChild(this.stepperElement),this.blockEvent=!1,this.stepperElement.addEventListener("change",function(e){e.target!=a.sliderElement&&(a.sliderElement.value=a.stepperElement.value),a.fireChangeEvent()},!1),this.sliderElement.addEventListener("change",s,!1),this.sliderElement.addEventListener("input",s,!1)},t.OptionSlider.prototype.constructor=t.OptionSlider,e.EventDispatcher.prototype.apply(t.OptionSlider.prototype),t.OptionSlider.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value
var e=new CustomEvent("change",{detail:{target:this,value:this.sliderElement.value}})
this.dispatchEvent(e)}},t.OptionSlider.prototype.setValue=function(e){this.blockEvent=!0,this.value=e,this.sliderElement.value=e,this.stepperElement.value=e,this.blockEvent=!1},t.OptionSlider.prototype.setDisabled=function(e){this.sliderElement.disabled=e,this.stepperElement.disabled=e,this.caption.disabled=e},t.OptionCheckbox=function(t,i,n,o){var r=this
this.tbody=i
var s=o&&o.insertAtIndex?o.insertAtIndex:-1
this.sliderRow=this.tbody.insertRow(s)
var a=this.sliderRow.insertCell(0)
this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),a.appendChild(this.caption),a=this.sliderRow.insertCell(1),this.checkElement=document.createElement("input"),this.checkElement.type="checkbox",this.checkElement.id=t+"_check",this.checkElement.checked=n,a.appendChild(this.checkElement),this.blockEvent=!1,this.checked=n,this.checkElement.addEventListener("change",function(e){r.fireChangeEvent()},!1),e.isTouchDevice()&&(this.sliderRowHammer=new Hammer.Manager(this.sliderRow,{recognizers:[[Hammer.Tap]],inputClass:Hammer.TouchInput}),this.sliderRowHammer.on("tap",function(e){e.preventDefault(),e.target.click()})),this.checkElement.addEventListener("click",function(e){e.stopPropagation()},!1),this.sliderRow.addEventListener("click",function(e){r.checkElement.disabled||(r.checkElement.checked=!r.checkElement.checked,r.fireChangeEvent())},!1)},t.OptionCheckbox.prototype.constructor=t.OptionCheckbox,e.EventDispatcher.prototype.apply(t.OptionCheckbox.prototype),t.OptionCheckbox.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked
var e=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}})
this.dispatchEvent(e)}},t.OptionCheckbox.prototype.setChecked=function(e){this.checkElement.checked!=e&&(this.checkElement.checked=e,this.fireChangeEvent())},t.OptionCheckbox.prototype.setValue=function(e){this.blockEvent=!0,this.checked=e,this.checkElement.checked=e,this.blockEvent=!1},t.OptionCheckbox.prototype.getValue=function(){return this.checkElement.checked},t.OptionCheckbox.prototype.setDisabled=function(e){this.checkElement.disabled=e,this.caption.disabled=e},t.OptionCheckbox.prototype.setVisibility=function(e){this.sliderRow.style.display=e?"table-row":"none"},t.OptionLabel=function(t,i,n){this.tbody=i
var o=n&&n.insertAtIndex?n.insertAtIndex:-1
this.sliderRow=this.tbody.insertRow(o)
var r=this.sliderRow.insertCell(0)
this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),r.appendChild(this.caption),r.colSpan="2",r.style.paddingLeft="10px",r.style.paddingRight="10px",this.blockEvent=!1},t.OptionDropDown=function(t,i,n,o,r,s){var a=this
this.tbody=i
var l=s&&s.insertAtIndex?s.insertAtIndex:-1
this.sliderRow=this.tbody.insertRow(l),this.dropdownElement=document.createElement("select"),this.dropdownElement.id=t+"_dropdown",this.dropdownElement.className="optionDropDown"
for(var c=0;c<n.length;c++){var d=document.createElement("option")
d.value=c,d.setAttribute("data-i18n",n[c]),d.textContent=e.i18n.translate(n[c]),this.dropdownElement.add(d)}this.selectedIndex=this.dropdownElement.selectedIndex=o
var u=this.sliderRow.insertCell(0)
if(this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",t),this.caption.textContent=e.i18n.translate(t),u.appendChild(this.caption),r){u.colSpan="2",u.style.paddingLeft="10px",u.style.paddingRight="10px",this.sliderRow=this.tbody.insertRow(l)
var u=this.sliderRow.insertCell(0)
u.appendChild(this.dropdownElement),u.colSpan="2",this.dropdownElement.style.width="100%"}else{var u=this.sliderRow.insertCell(1)
u.appendChild(this.dropdownElement)}u.style.paddingLeft="5px",u.style.paddingRight="5px",this.blockEvent=!1,this.dropdownElement.addEventListener("change",function(e){a.fireChangeEvent()},!1)},t.OptionDropDown.prototype.constructor=t.OptionDropDown,e.EventDispatcher.prototype.apply(t.OptionDropDown.prototype),t.OptionDropDown.prototype.setSelectedIndex=function(e){this.blockEvent=!0,this.selectedIndex=this.dropdownElement.selectedIndex=e,this.blockEvent=!1},t.OptionDropDown.prototype.setSelectedValue=function(e){this.blockEvent=!0,this.dropdownElement.selectedValue=e,this.selectedIndex=this.dropdownElement.selectedIndex,this.blockEvent=!1},t.OptionDropDown.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=this.dropdownElement.selectedIndex
var e=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}})
this.dispatchEvent(e)}},t.OptionDropDown.prototype.setDisabled=function(e){this.dropdownElement.disabled=e,this.caption.disabled=e}}(),function(){"use strict"
var e=function(e){this.bg=document.createElement("div"),this.bg.className="progressbg",this.fg=document.createElement("div"),this.fg.className="progressfg",this.bg.appendChild(this.fg),this.lastValue=-1,e.appendChild(this.bg),this.widthScale=this.fg.clientWidth}
e.prototype.setPercent=function(e){e!=this.lastValue&&(this.lastValue=e,e>=99?this.bg.style.visibility="hidden":(this.bg.style.visibility="visible",this.fg.style.width=this.widthScale*e*.01+"px"))},Autodesk.Viewing.Private.ProgressBar=e}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.RenderOptionsPanel=function(e){var t=this,i=Autodesk.Viewing,n=Autodesk.Viewing.Private
this.viewer=e,Autodesk.Viewing.UI.DockingPanel.call(this,e.container,"RenderOptionsPanel","Rendering Options"),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.createScrollContainer({heightAdjustment:70,marginTop:20}),this.scrollContainer.appendChild(this.table),this.container.style.width="320px",this.container.style.top="260px",this.container.style.left="220px",this.container.style.height="460px",this.container.dockRight=!0,this.celToggle=new n.OptionCheckbox("Cel Shaded",this.tbody,!1),this.addEventListener(this.celToggle,"change",function(i){var n=t.celToggle.checked
e.prefs.set("celShaded",n),e.impl.toggleCelShading(n)}),this.saoToggle=new n.OptionCheckbox("AO Enabled",this.tbody,!0),this.addEventListener(this.saoToggle,"change",function(i){var n=t.saoToggle.checked
e.prefs.set("ambientShadows",n),e.setQualityLevel(n,e.impl.renderer().settings.antialias)}),this.saoRadius=new n.OptionSlider("AO Radius",0,200,this.tbody),this.saoRadius.setValue(10),this.saoRadius.sliderElement.step=this.saoRadius.stepperElement.step=.01,this.addEventListener(this.saoRadius,"change",function(i){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()}),this.saoIntensity=new n.OptionSlider("AO Intensity",0,3,this.tbody),this.saoIntensity.setValue(.4),this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.01,this.addEventListener(this.saoIntensity,"change",function(i){e.impl.renderer().setAOOptions(parseFloat(t.saoRadius.value),parseFloat(t.saoIntensity.value)),e.impl.renderer().composeFinalFrame()}),this.groundShadowAlpha=new n.OptionSlider("Shadow Alpha",0,2,this.tbody),this.groundShadowAlpha.setValue(1),this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1,this.addEventListener(this.groundShadowAlpha,"change",function(i){e.setGroundShadowAlpha(parseFloat(t.groundShadowAlpha.value))}),this.groundShadowColor=new n.OptionCheckbox("Shadow Color",this.tbody),i.isIE11||(this.groundShadowColor.checkElement.value="#000000",this.groundShadowColor.checkElement.type="color"),this.addEventListener(this.groundShadowColor,"change",function(i){var n=t.groundShadowColor.checkElement.value
e.setGroundShadowColor(new THREE.Color(parseInt(n.substr(1,7),16)))}),this.groundReflectionAlpha=new n.OptionSlider("Reflection Alpha",0,2,this.tbody),this.groundReflectionAlpha.setValue(1),this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1,this.addEventListener(this.groundReflectionAlpha,"change",function(i){e.setGroundReflectionAlpha(parseFloat(t.groundReflectionAlpha.value))}),this.groundReflectionColor=new n.OptionCheckbox("Reflection Color",this.tbody),i.isIE11||(this.groundReflectionColor.checkElement.value="#000000",this.groundReflectionColor.checkElement.type="color"),this.addEventListener(this.groundReflectionColor,"change",function(i){var n=t.groundReflectionColor.checkElement.value
e.setGroundReflectionColor(new THREE.Color(parseInt(n.substr(1,7),16)))})
for(var o=[],r=0;r<n.LightPresets.length;r++)o.push(n.LightPresets[r].name)
this.envSelect=new n.OptionDropDown("Environment",this.tbody,o,e.impl.currentLightPreset()),this.addEventListener(this.envSelect,"change",function(i){var n=t.envSelect.selectedIndex
e.setLightPreset(n)})
var s=e.impl.renderer().getToneMapMethod()
this.toneMapMethod=new n.OptionDropDown("Tonemap Method",this.tbody,["None","Canon-Lum","Canon-RGB"],s),this.addEventListener(this.toneMapMethod,"change",function(){var i=t.toneMapMethod.selectedIndex
e.impl.setTonemapMethod(i)}),this.exposureBias=new n.OptionSlider("Exposure Bias",-30,30,this.tbody),this.exposureBias.setValue(e.impl.renderer().getExposureBias()),this.exposureBias.sliderElement.step=this.exposureBias.stepperElement.step=.1,this.addEventListener(this.exposureBias,"change",function(i){e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)}),this.exposureBias.setDisabled(0==s),this.whiteScale=new n.OptionSlider("Light Intensity",-5,20,this.tbody)
var a=0
e.impl.dir_light1&&(a=0!=e.impl.dir_light1.intensity?Math.log(e.impl.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(a),this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1,this.addEventListener(this.whiteScale,"change",function(i){e.impl.dir_light1.intensity=Math.pow(2,t.whiteScale.value),e.impl.setTonemapExposureBias(t.exposureBias.value,t.whiteScale.value)}),this.fovAngle=new n.OptionSlider("FOV-degrees",6.88,100,this.tbody),this.fovAngle.setValue(e.getFOV()),this.addEventListener(this.fovAngle,"change",function(i){e.setFOV(parseFloat(t.fovAngle.value))}),this.frameRate=new n.OptionSlider("Frame rate:",1,100,this.tbody),this.frameRate.setValue(e.impl.getFrameRate()),this.frameRate.sliderElement.step=this.frameRate.stepperElement.step=1,this.addEventListener(this.frameRate,"change",function(i){e.impl.setFrameRate(t.frameRate.value)}),this.addEventListener(this.viewer,Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(i){var n=parseFloat(t.fovAngle.value),o=e.getFOV()
n!=o&&t.fovAngle.setValue(o)}),this.addEventListener(this.viewer,Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,function(e){t.syncUI()}),this.addVisibilityListener(function(){t.resizeToContent()})},Autodesk.Viewing.Private.RenderOptionsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.Private.RenderOptionsPanel.prototype.constructor=Autodesk.Viewing.Private.RenderOptionsPanel,Autodesk.Viewing.Private.RenderOptionsPanel.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.syncUI=function(){var e=this.viewer.impl,t=0
e.dir_light1&&(t=0!=e.dir_light1.intensity?Math.log(e.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(t),this.exposureBias.setValue(e.renderer().getExposureBias())
var i=e.renderer().getToneMapMethod()
this.toneMapMethod.setSelectedIndex(i),this.envSelect.setSelectedIndex(e.currentLightPreset()),this.exposureBias.setDisabled(0==i),this.saoToggle.setValue(e.renderer().getAOEnabled()),this.saoRadius.setDisabled(!e.renderer().getAOEnabled()),this.saoIntensity.setDisabled(!e.renderer().getAOEnabled()),this.saoRadius.setValue(e.renderer().getAORadius()),this.saoIntensity.setValue(e.renderer().getAOIntensity()),this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection")),this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection")),this.fovAngle.setValue(this.viewer.getFOV()),this.celToggle.setValue(e.renderer().settings.toonShaded)},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this),this.table=null,this.tbody=null,this.bgSelect=null,this.saoToggle=null,this.saoRadius=null,this.saoIntensity=null,this.groundShadowAlpha=null,this.envSelect=null,this.toneMapMethod=null,this.exposureBias=null,this.whiteScale=null,this.fovAngle=null,this.viewer=null},function(){"use strict"
var e=Autodesk.Viewing,t=Autodesk.Viewing.UI,i=function(i,n,o){this.viewer=i,this.tree=null,this.layersRoot=null,this.visibilityImages={},this.isMac=-1!==navigator.userAgent.search("Mac OS")
var r="Layer Manager",s=i.config.viewableName,a=!0
s&&"W2D"!==s&&(r=e.i18n.translate(r)+": "+s,a=!1),this.filterImageId=o+"-layerFilterImageId",t.DockingPanel.call(this,i.container,o,r,{localizeTitle:a}),this.container.classList.add("layersPanel"),this.filterContainer=document.createElement("div"),this.filterContainer.className="filterBox",this.filterContainer.id=this.container.id+"-search-container",this.container.appendChild(this.filterContainer),this.createScrollContainer({heightAdjustment:105,marginTop:5})
var l=this
i.model?l.build():l.addEventListener(i,e.GEOMETRY_LOADED_EVENT,function(){l.build()}),this.addVisibilityListener(function(){l.resizeToContent()})}
i.prototype=Object.create(t.DockingPanel.prototype),i.prototype.constructor=i,i.prototype.uninitialize=function(){t.DockingPanel.prototype.uninitialize.call(this),this.viewer=null,this.tree=null,this.layersRoot=null,this.visibilityImages=null,this.scrollContainer=null,this.filterContainer=null},i.prototype.build=function(){function i(){l&&clearTimeout(l),l=setTimeout(n,500)}function n(){function e(i){var n=[]
if(-1!==i.name.toLowerCase().indexOf(t))n.push(i)
else if(!i.isLayer)for(var o=i.children,r=0;r<o.length;++r)n=n.concat(e(o[r]))
return n}if(a.value){var t=a.value.toLowerCase()
u&&0<u.childCount&&(o.lockoutClearFilter=!0,c.setLayerVisible(e(u),!0,!0),o.lockoutClearFilter=!1)}else c.setLayerVisible(null,!0)
l=null}var o=this,r=document.createElement("div")
r.className="filterSearch",o.filterContainer.appendChild(r)
var s=document.createElement("div")
s.className="filterImage",s.id=o.filterImageId,s.title=e.i18n.translate("Show/hide all layers"),r.appendChild(s),o.visibilityImages[o.filterImageId]=s,o.addEventListener(s,"click",function(e){o.onImageClick(null,e),e.stopPropagation()})
var a=this.filterField=document.createElement("input")
a.className="filterInput",a.placeholder=e.i18n.translate("Enter filter term"),a.setAttribute("data-i18n","[placeholder]Enter filter term"),a.type="search",a.incremental="incremental",r.appendChild(a)
var l=null,c=o.viewer
a.addEventListener("keyup",function(e){i()}),a.addEventListener("click",function(e){if(""===a.value)return void c.setLayerVisible(null,!0)
setTimeout(function(){""===a.value&&(c.setLayerVisible(null,!0),e.preventDefault())},1)})
var d=function(){var e=new t.TreeDelegate
return e.getTreeNodeId=function(e){return e.id},e.getTreeNodeLabel=function(e){return o.getNodeLabel(e)},e.getTreeNodeClass=function(e){return o.getNodeClass(e)},e.isTreeNodeGroup=function(e){return o.isGroupNode(e)},e.shouldCreateTreeNode=function(e){return o.shouldInclude(e)},e.onTreeNodeClick=function(e,t,i){o.onClick(t,i)},e.onTreeNodeRightClick=function(e,t,i){o.onRightClick(t,i)},e.onTreeNodeDoubleClick=function(e,t,i){o.onDoubleClick(t,i)},e.onTreeNodeIconClick=function(e,t,i){o.onIconClick(t,i)},e.createTreeNode=function(e,t){o.createNode(e,t)},e}(),u=o.layersRoot=o.viewer.model.getLayersRoot()
u&&(o.tree=new t.Tree(d,u,o.scrollContainer,{excludeRoot:!0}),o.resizeToContent(),o.update(),o.addEventListener(o.viewer,e.LAYER_VISIBILITY_CHANGED_EVENT,function(){o.update()}))},i.prototype.update=function(){function e(e,t){var i
i=1===t?"layerVisible":0===t?"layerHidden":"layerMixed",e.classList.remove("layerVisible"),e.classList.remove("layerHidden"),e.classList.remove("layerMixed"),e.classList.add(i)}function t(e,t){0===t?o.tree.addClass(e.id,"dim"):o.tree.removeClass(e.id,"dim")}function i(e){var t
if(0<e.length)for(var i=0;i<e.length;++i){var n=e[i]
if(void 0===t?t=n:0===n&&1===t?t=-1:1===n&&0===t&&(t=-1),-1===t)break}else t=0
return t}function n(r){var s=r.id,a=o.visibilityImages[s]
if(!r.isLayer){for(var l=r.children,c=[],d=0;d<l.length;++d)c=c.concat(n(l[d]))
var u=i(c)
return e(a,u),t(r,u),c}var h=o.viewer.isLayerVisible(r)?1:0
return e(a,h),t(r,h),[h]}var o=this,r=this.layersRoot&&0<this.layersRoot.childCount?n(o.layersRoot):[],s=o.visibilityImages[o.filterImageId],a=i(r)
e(s,a),1!=a||this.lockoutClearFilter||(this.filterField.value="")},i.prototype.setLayerVisible=function(e,t){var i=e?e.id:this.filterImageId,n=this.visibilityImages[i].className,o="layerVisible"!==n
this.viewer.setLayerVisible(e,o,t),this.filterField.value="",this.viewer.clearSelection()},i.prototype.getNodeLabel=function(e){return e.isLayer||0===e.childCount?e.name:e.name+" ("+e.childCount+")"},i.prototype.getNodeClass=function(e){return""},i.prototype.isGroupNode=function(e){return!e.isLayer},i.prototype.shouldInclude=function(e){return!0},i.prototype.onIconClick=function(e,t){this.setGroupCollapsed(e,!this.isGroupCollapsed(e))},i.prototype.setGroupCollapsed=function(e,t){var i=this.tree.delegate()
if(i.isTreeNodeGroup(e)){var n=i.getTreeNodeId(e)
this.tree.setCollapsed(n,t),this.resizeToContent()}},i.prototype.isGroupCollapsed=function(e){var t=this.tree.delegate()
if(t.isTreeNodeGroup(e)){var i=t.getTreeNodeId(e)
return this.tree.isCollapsed(i)}return!1},i.prototype.onClick=function(e,t){},i.prototype.onDoubleClick=function(e,t){},i.prototype.onRightClick=function(e,t){},i.prototype.onImageClick=function(e,t){},i.prototype.getContentSize=function(){var e=this.filterContainer,t=e.clientHeight+80,i=e.clientWidth,n=this.tree
if(n){var o=n.getRootContainer()
if(o)return{height:o.clientHeight+t,width:Math.max(o.clientWidth,i)}}return{height:t,width:i}},i.prototype.createNode=function(t,i){var n=document.createElement("div")
i.children&&i.children.length>0?i.insertBefore(n,i.children[0]):i.appendChild(n),n.title=e.i18n.translate("Show/hide this layer"),this.visibilityImages[t.id]=n
var o=document.createElement("label")
o.textContent=this.getNodeLabel(t),i.appendChild(o)
var r=this
this.addEventListener(n,"click",function(e){r.onImageClick(t,e),e.stopPropagation()})},Autodesk.Viewing.UI.LayersPanel=i}(),AutodeskNamespace("Autodesk.Viewing.UI"),Autodesk.Viewing.UI.SettingsPanel=function(e,t,i,n){Autodesk.Viewing
Autodesk.Viewing.UI.DockingPanel.call(this,e,t,i,n),this.panelTabs=[],this.tabIdToIndex={},this.controls={},this.controlIdCount=0
var o=this,r=n&&void 0!==n.width?n.width:340
this.container.style.maxWidth="800px",this.container.style.minWidth=r+"px",this.container.style.top="100px",this.container.style.left=e.offsetWidth/2-170+"px",this.container.style.position="absolute",this.tabContainer=document.createElement("div"),this.tabContainer.className="settings-tabs",this.container.appendChild(this.tabContainer),this.tabs=document.createElement("ul"),this.tabContainer.appendChild(this.tabs),this.heightAdjustment=n&&n.heightAdjustment?n.heightAdjustment:110,this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0}),this.mouseOver=!1,this.addEventListener(this.container,"mouseover",function(e){var t=e.toElement||e.relatedTarget
if(o.mouseOver)return!0
for(var i=0;t&&t.parentNode&&t.parentNode!=window;){if(t.parentNode==this||t==this){t.preventDefault&&t.preventDefault(),o.mouseOver=!0
for(var i=0;i<o.panelTabs.length;i++)o.panelTabs[i].classList.remove("selectedmouseout")
return!0}t=t.parentNode}}),this.addEventListener(this.container,"mouseout",function(e){var t=e.toElement||e.relatedTarget
if(o.mouseOver){for(;t&&t.parentNode&&t.parentNode!=window;){if(t.parentNode==this||t==this)return t.preventDefault&&t.preventDefault(),!1
t=t.parentNode}o.mouseOver=!1
for(var i=0;i<o.panelTabs.length;i++)o.panelTabs[i].classList.contains("tabselected")&&o.panelTabs[i].classList.add("selectedmouseout")}}),this.expandID=function(e){return t+"-"+e}},Autodesk.Viewing.UI.SettingsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.UI.SettingsPanel.prototype.constructor=Autodesk.Viewing.UI.SettingsPanel,Autodesk.Viewing.UI.SettingsPanel.prototype.setVisible=function(e){e&&(this.container.style.display="block"),Autodesk.Viewing.UI.DockingPanel.prototype.setVisible.call(this,e)},Autodesk.Viewing.UI.SettingsPanel.prototype.addTab=function(e,t,i){function n(t){o.selectTab(e)}var o=this
if(void 0!==this.tabIdToIndex[e])return!1
var r=i&&void 0!==i.className?i.className:null,s=i&&void 0!==i.width?i.width:200,a=i&&void 0!==i.index?i.index:this.panelTabs.length,l=document.createElement("li")
l._id=e,l.id=this.expandID(l._id)
var c=document.createElement("a"),d=document.createElement("span")
d.setAttribute("data-i18n",t),d.textContent=Autodesk.Viewing.i18n.translate(t),c.appendChild(d),l.appendChild(c),this.tabs.appendChild(l)
var u=document.createElement("table")
u._id=e+"-table",u.id=this.expandID(u._id),u.className="settings-table adsk-lmv-tftable "+r
var h=document.createElement("tbody")
return u.appendChild(h),this.scrollContainer.appendChild(u),this.addEventListener(l,"touchstart",av.touchStartToClick),this.addEventListener(l,"click",n),this.panelTabs.push(l),this.tabIdToIndex[e]=a,s>(this.container.style.minWidth?parseInt(this.container.style.minWidth):0)&&(this.container.style.minWidth=s+"px"),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.removeTab=function(e){var t=this.tabIdToIndex[e]
if(!t)return!1
this.panelTabs.splice(t,1),this.tabs.removeChild(tabDom),this.tabIdToIndex={}
for(var i=this.panelTabs.length,n=0;n<i;n++){var o=this.panelTabs[n]
this.tabIdToIndex[o._id]=n}return!0},Autodesk.Viewing.UI.SettingsPanel.prototype.hasTab=function(e){var t=this.tabIdToIndex[e]
return void 0!==this.panelTabs[t]},Autodesk.Viewing.UI.SettingsPanel.prototype.selectTab=function(e){if(this.isTabSelected(e))return!1
for(var t=this.panelTabs.length,i=0;i<t;i++){var n=this.panelTabs[i],o=document.getElementById(this.expandID(n._id+"-table"))
e===n._id?(n.classList.add("tabselected"),o.style.display="table",this.mouseOver||n.classList.add("selectedmouseout")):(n.classList.remove("tabselected"),o.style.display="none",this.mouseOver||this.panelTabs[i].classList.remove("selectedmouseout"))}return this.resizeToContent(),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.isTabSelected=function(e){var t=this.tabIdToIndex[e],i=this.panelTabs[t]
return i&&i.classList.contains("tabselected")},Autodesk.Viewing.UI.SettingsPanel.prototype.addCheckbox=function(e,t,i,n,o){if(void 0===this.tabIdToIndex[e])return null
var r=document.getElementById(this.expandID(e+"-table")),s=new Autodesk.Viewing.Private.OptionCheckbox(t,r.tBodies[0],i,o)
return s.changeListener=function(e){var t=e.detail.target.checked
n(t)},this.addEventListener(s,"change",s.changeListener),this.addControl(e,s)},Autodesk.Viewing.UI.SettingsPanel.prototype.addSlider=function(e,t,i,n,o,r,s){if(void 0===this.tabIdToIndex[e])return null
var a=document.getElementById(this.expandID(e+"-table")),l=new Autodesk.Viewing.Private.OptionSlider(t,i,n,a.tBodies[0],s)
return l.setValue(o),l.sliderElement.step=l.stepperElement.step=1,this.addEventListener(l,"change",function(e){r(e)}),this.addControl(e,l)},Autodesk.Viewing.UI.SettingsPanel.prototype.addDropDownMenu=function(e,t,i,n,o,r){if(void 0===this.tabIdToIndex[e])return null
var s=document.getElementById(this.expandID(e+"-table")),a=new Autodesk.Viewing.Private.OptionDropDown(t,s.tBodies[0],i,n,r)
return this.addEventListener(a,"change",function(e){o(e)}),this.addControl(e,a)},Autodesk.Viewing.UI.SettingsPanel.prototype.addControl=function(e,t,i){if(void 0===this.tabIdToIndex[e])return null
if(!t.hasOwnProperty("sliderRow")){var n=i&&i.insertAtIndex?i.insertAtIndex:-1,o=i&&i.caption?i.caption:null,r=document.getElementById(this.expandID(e+"-table"))
n>r.length&&(n=-1)
var s=r.tBodies[0].insertRow(n),a=s.insertCell(0)
if(o){var l=document.createElement("div")
l.setAttribute("data-i18n",o),l.textContent=Autodesk.Viewing.i18n.translate(o),a.appendChild(l),a=s.insertCell(1)}else a.colSpan=2
a.appendChild(t),t.sliderRow=s,t.tbody=r.tBodies[0]}var c=this.expandID("adsk_settings_control_id_"+this.controlIdCount.toString())
return this.controlIdCount=this.controlIdCount+1,this.controls[c]=t,this.resizeToContent(),c},Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(e){return this.removeControl(e)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeSlider=function(e){return this.removeControl(e)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeDropdownMenu=function(e){return this.removeControl(e)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeControl=function(e){var t
if("object"==typeof e&&e.tbody){t=e
for(var i in this.controls)if(this.controls[i]===t){e=i
break}}else t=this.controls[e]
if(void 0===t)return!1
var n=t.tbody,o=t.sliderRow,r=o.rowIndex
return n.deleteRow(r),delete this.controls[e],this.resizeToContent(),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.getControl=function(e){return this.controls[e]||null},Autodesk.Viewing.UI.SettingsPanel.prototype.getContentSize=function(){for(var e=this.heightAdjustment,t=this.panelTabs.length>this.panelTabs[0]?0:null,i=0;i<this.panelTabs.length;i++){var n=this.panelTabs[i]
if(this.isTabSelected(n._id)){t=n
break}}if(t){e+=document.getElementById(this.expandID(n._id+"-table")).clientHeight}return{height:e,width:this.container.clientWidth}},function(){"use strict"
var e=function(){}
e.instances=[],e.displayError=function(t,i,n,o,r){var s=document.createElement("div")
s.className="alertBox error",t.appendChild(s)
var a=o
a||(a="img-item-not-found")
var l=document.createElement("div")
l.className="alertBoxImage "+a,s.appendChild(l)
var c=document.createElement("div")
c.className="alertBoxMsg",s.appendChild(c)
var d=n
d||(d=Autodesk.Viewing.i18n.translate("Error Occurred",{defaultValue:"Error Occurred"}))
var u=document.createElement("div")
u.className="alertBoxTitle",u.textContent=d,u.setAttribute("data-i18n",d),c.appendChild(u)
var h=document.createElement("div")
if(h.className="alertBoxText",h.textContent=i,h.setAttribute("data-i18n",i),c.appendChild(h),r){var p=document.createElement("div")
p.className="alertBoxContent",c.appendChild(p)
var m=document.createElement("ul")
m.className="alertBoxContent"
for(var g=0;g<r.length;g++){var f=r[g]
if(f){var v=document.createElement("li"),E=this.extractList(f)
if(E.list.length){var y=this.generateListElement(list)
m.appendChild(y)}v.innerHTML=E.msg,v.setAttribute("data-i18n",E.msg),m.appendChild(v)}}p.appendChild(m)}var A=document.createElement("div")
A.className="alertBoxOK",A.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"})
var T={alertBox:s,container:t}
A.addEventListener("click",function(i){s.style.visibility="hidden",t.removeChild(s),e.instances.splice(e.instances.indexOf(T),1)}),s.appendChild(A),s.style.visibility="visible",e.instances.push(T)},e.displayErrors=function(t,i,n){var o=document.createElement("div")
o.className="alertBox errors",t.appendChild(o)
var r=i
r||(r="img-item-not-found")
var s=document.createElement("div")
s.className="alertBoxImage "+r,o.appendChild(s)
var a=document.createElement("div")
a.className="alertBoxMsg errors",o.appendChild(a)
for(var l=0;l<n.length;l++){var c=n[l].header
c||(c=Autodesk.Viewing.i18n.translate("Error",{defaultValue:"Error"}))
var d=document.createElement("div")
d.className="alertBoxTitle errors",d.textContent=c,a.appendChild(d)
var u=document.createElement("div")
u.className="alertBoxText errors"
var h=n[l].msg,p=this.extractList(h)
if(p.list.length){var m=document.createElement("div"),g=this.generateListElement(p.list)
m.appendChild(g),u.textContent=p.msg,u.appendChild(m)}else u.textContent=h
if(a.appendChild(u),n[l].hints){var f=document.createElement("ul")
f.className="alertBoxContent"
for(var v=n[l].hints,E=0;E<v.length;E++){var y=v[E]
if(y){var A=document.createElement("li")
f.appendChild(A)
var p=this.extractList(y)
if(p.list.length){var g=this.generateListElement(p.list)
f.appendChild(g)}A.innerHTML=p.msg}}a.appendChild(f)}}var T=document.createElement("div")
T.className="alertBoxOK",T.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"})
var b={alertBox:o,container:t}
T.addEventListener("click",function(i){o.style.visibility="hidden",t.removeChild(o),e.instances.splice(e.instances.indexOf(b),1)}),o.appendChild(T),o.style.visibility="visible",e.instances.push(b)},e.extractList=function(e){var t={msg:e,list:[]}
if(e&&-1!=e.indexOf("<ul>")){var i=e.split("<ul>")
t.msg=i[0],i=i[1].split("</ul>"),t.list=i[0].split(", "),1===t.list.length&&(t.list=i[0].split(","))}return t},e.generateListElement=function(e){for(var t=document.createElement("ul"),i=0;i<e.length;i++){var n=document.createElement("li")
n.textContent=e[i],n.setAttribute("data-i18n",e[i]),t.appendChild(n)}return t},e.dismiss=function(){if(e.instances.length>0){var t=e.instances.pop()
return t.alertBox.style.visibility="hidden",t.container.removeChild(t.alertBox),!0}return!1},Autodesk.Viewing.Private.AlertBox=e}(),function(){"use strict"
var e=Autodesk.Viewing,t=function(){}
t.instances=[],t.displayMessage=function(i,n,o,r,s){if(!(t.instances.length>0)){var a=n.msgTitleKey,l=n.msgTitleDefaultValue||a,c=n.messageKey,d=n.messageDefaultValue||c,u=n.buttonText,h=n.checkboxChecked||!1,p=document.createElement("div")
p.className="hud",i.appendChild(p)
var m=document.createElement("div")
if(m.className="hudTitle",m.textContent=e.i18n.translate(a,{defaultValue:l}),m.setAttribute("data-i18n",a),p.appendChild(m),o){var g=document.createElement("div")
g.className="hudClose",g.innerHTML="&times;",g.addEventListener("click",function(e){t.dismiss(),o&&o(e)}),p.appendChild(g)}var f=document.createElement("div")
if(f.className="hudMessage",f.textContent=e.i18n.translate(c,{defaultValue:d}),f.setAttribute("data-i18n",d),p.appendChild(f),r){var v=document.createElement("div")
v.className="hudButton",v.textContent=e.i18n.translate(u,{defaultValue:u}),v.setAttribute("data-i18n",u),v.addEventListener("click",r),p.appendChild(v)}if(s){var E=document.createElement("div"),y=document.createElement("input")
y.className="hudCheckbox",y.type="checkbox",y.checked=h,E.appendChild(y)
var A="Do not show this message again",T=document.createElement("label")
T.setAttribute("for",A),T.setAttribute("data-i18n",A),T.textContent=e.i18n.translate(A,{defaultValue:A}),E.appendChild(T),y.addEventListener("change",s),p.appendChild(E)}var b={hudMessage:p,container:i}
t.instances.push(b)}},t.dismiss=function(){if(t.instances.length>0){var e=t.instances.pop()
return e.hudMessage.style.visibility="hidden",e.container.removeChild(e.hudMessage),!0}return!1},Autodesk.Viewing.Private.HudMessage=t}(),function(){"use strict"
var e=Autodesk.Viewing.UI,t=Autodesk.Viewing,i=Autodesk.Viewing.Private,n=function(){}
n.prototype.constructor=n,n.prototype.isTreeNodeGroup=function(e){throw"isTreeNodeGroup is not implemented."},n.prototype.getTreeNodeId=function(e){throw"getTreeNodeId is not implemented."},n.prototype.getTreeNodeLabel=function(e){return e.name},n.prototype.shouldCreateTreeNode=function(e){return!0},n.prototype.forEachChild=function(e,t){for(var i=e.children?e.children.length:0,n=0;n<i;++n){t(e.children[n])}},n.prototype.createTreeNode=function(e,t,i){var n=document.createElement("label")
t.appendChild(n)
var o=this.getTreeNodeLabel(e)
i&&i.localize&&(n.setAttribute("data-i18n",o),o=Autodesk.Viewing.i18n.translate(o)),n.textContent=o},n.prototype.onTreeNodeClick=function(e,t,i){},n.prototype.onTreeNodeIconClick=function(e,t,i){e.delegate().isTreeNodeGroup(t)&&e.setCollapsed(t,!e.isCollapsed(t))},n.prototype.onTreeNodeDoubleClick=function(e,t,i){},n.prototype.onTreeNodeRightClick=function(e,t,i){},n.prototype.onTreeNodeReized=function(e){},n.prototype.getTreeNodeClass=function(e){return""},n.prototype.getTreeNodeParentMaxSize=function(e){return{width:0,height:0}},n.prototype.getTreeNodeClientHeight=function(e){return 0},n.prototype.getTreeNodeDepthOffset=function(e,t){return 0},n.prototype.onTreeNodeHover=function(e,t,i){}
var o=function(e,t,i,n){this.myDelegate=e,this.mySelectedNodes=[],this.myOptions=n||{}
this.myGroupNodes=[],this.nodeToElement={},this.nodeIdToNode={}
var o=this.myRootContainer=this.createHtmlElement_(i,"div","treeview"),r=this.rootElem=this.createElement_(t,o,n,0)
this.setInputHandlers_(),n&&n.excludeRoot&&r.classList.add("exclude")}
o.prototype.constructor=o,o.prototype.show=function(e){var t=this.myRootContainer
t.style.display=e?"block":"none"},o.prototype.getRootContainer=function(){return this.myRootContainer},o.prototype.getElementForNode=function(e){return"number"!=typeof e&&"string"!=typeof e&&(e=this.myDelegate.getTreeNodeId(e)),this.nodeToElement[e]},o.prototype.delegate=function(){return this.myDelegate},o.prototype.isCollapsed=function(e){return this.hasClass(e,"collapsed")},o.prototype.setCollapsed=function(e,t,i){t?(this.addClass(e,"collapsed",i),this.removeClass(e,"expanded",i)):(this.addClass(e,"expanded",i),this.removeClass(e,"collapsed",i))},o.prototype.setAllCollapsed=function(e){var t,i
e?(t=function(e){return e.classList.contains("expanded")},i=function(e){e.classList.add("collapsed"),e.classList.remove("expanded")}):(t=function(e){return e.classList.contains("collapsed")},i=function(e){e.classList.add("expanded"),e.classList.remove("collapsed")})
for(var n=0;n<this.myGroupNodes.length;++n){var o=this.myGroupNodes[n]
t(o)&&i(o)}},o.prototype.addToSelection=function(e){for(var t=this,i=e.length,n=0;n<i;++n){var o=e[n];(function(e){return-1===t.mySelectedNodes.indexOf(e)&&(t.mySelectedNodes.push(e),!0)})(o)&&this.addClass(o,"selected")}},o.prototype.removeFromSelection=function(e){for(var t=this,i=e.length-1;i>=0;--i){var n=e[i];(function(e){var i=t.mySelectedNodes.indexOf(e)
return-1!==i&&(t.mySelectedNodes.splice(i,1),!0)})(n)&&this.removeClass(n,"selected")}},o.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedNodes),this.addToSelection(e),this.mySelectedNodes},o.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)},o.prototype.isSelected=function(e){return this.hasClass(e,"selected")},o.prototype.scrollTo=function(e){var t=this.getElementForNode(e)
if(t){var i=t.offsetTop
for(t=t.parentNode;t&&t!=this.myRootContainer;)i+=t.offsetTop,t=t.parentNode
this.myRootContainer.parentNode.scrollTop=i}},o.prototype.addClass=function(e,t,i){var n=this.getElementForNode(e)
if(n){if(i){n=n.parentNode
for(var o=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;n&&n!==o;)n.classList.add(t),n=n.parentNode}else n.classList.add(t)
return!0}return!1},o.prototype.removeClass=function(e,t,i){var n=this.getElementForNode(e)
if(n){if(i){n=n.parentNode
for(var o=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;n&&n!==o;)n.classList.remove(t),n=n.parentNode}else n.classList.remove(t)
return!0}return!1},o.prototype.hasClass=function(e,t){return this.getElementForNode(e).classList.contains(t)},o.prototype.clear=function(){for(var e=this.myRootContainer;e.hasChildNodes();)e.removeChild(e.lastChild)
this.nodeToElement={},this.nodeIdToNode={}},o.prototype.createElement_=function(e,t,i,n){function o(t,n,o,r){var a=s.createHtmlElement_(t,n,o),l=s.myDelegate.getTreeNodeId(r)
a.setAttribute("lmv-nodeId",l)
var c=s.createHtmlElement_(a,"lmvheader")
return s.createHtmlElement_(c,"icon").addEventListener("click",function(t){s.myDelegate.onTreeNodeIconClick(s,e,t),t.stopPropagation(),t.preventDefault()},!1),s.myDelegate.createTreeNode(e,c,i),a}if(void 0===e||null===e)return null
if(!this.myDelegate.shouldCreateTreeNode(e))return null
var r,s=this,a=this.myDelegate.getTreeNodeId(e)
if(s.myDelegate.isTreeNodeGroup(e)){r=o(t,"group","expanded",e),s.nodeToElement[a]=r,s.nodeIdToNode[a]=e
var l=s.myOptions.excludeRoot?1:0
n==l&&(r.style.left="0px"),s.myGroupNodes.push(r),s.myDelegate.forEachChild(e,function(e){s.createElement_(e,r,i,n+1)})}else{r=o(t,"leaf","expanded",e),s.nodeToElement[a]=r,s.nodeIdToNode[a]=e
var l=s.myOptions.excludeRoot?1:0
n==l&&(r.style.marginLeft="0px")}var c=s.myDelegate.getTreeNodeClass(e)
return c&&r.classList.add(c),r},o.prototype.setInputHandlers_=function(){var e=this,i=this.myRootContainer,n=function(t){var n=null,o=!1
do{t&&t!==i?t.hasAttribute("lmv-nodeId")?(n=t,o=!0):t=t.parentElement:(n=null,o=!0)}while(!o)
if(n){var r=n.getAttribute("lmv-nodeId")
return e.nodeIdToNode[r]||null}return null}
t.isTouchDevice()&&(this.hammer=new Hammer.Manager(i,{recognizers:[t.GestureRecognizers.doubletap,t.GestureRecognizers.press],inputClass:Hammer.TouchInput}),this.hammer.on("doubletap",function(t){var i=n(t.target)
null!==i&&e.myDelegate.onTreeNodeDoubleClick(e,i,t)}),this.hammer.on("press",function(t){var i=n(t.target)
null!==i&&e.myDelegate.onTreeNodeRightClick(e,i,t)})),i.addEventListener("click",function(t){var i=n(t.target)
null!==i&&(e.myDelegate.onTreeNodeClick(e,i,t),t.stopPropagation(),t.target.classList.contains("propertyLink")||t.preventDefault())},!1),i.addEventListener("dblclick",function(t){var i=n(t.target)
null!==i&&(e.myDelegate.onTreeNodeDoubleClick(e,i,t),t.stopPropagation(),t.preventDefault())},!1),i.addEventListener("contextmenu",function(t){var i=n(t.target)
null!==i&&(e.myDelegate.onTreeNodeRightClick(e,i,t),t.stopPropagation(),t.preventDefault())},!1),i.addEventListener("mouseover",function(t){var i=n(t.target)
null!==i&&(e.myDelegate.onTreeNodeHover(e,i,t),t.stopPropagation(),t.preventDefault())},!1),i.addEventListener("mouseout",function(t){var i=t.toElement||t.relatedTarget
if(n(t.target)!=n(i)){e.myDelegate.onTreeNodeHover(e,-1,t),t.stopPropagation(),t.preventDefault()}},!1)},o.prototype.createHtmlElement_=function(e,t,i){var n=document.createElement(t)
return e.appendChild(n),i&&(n.className=i),n},o.prototype.iterate=function(e,t){if(void 0!==e&&null!==e&&this.myDelegate.shouldCreateTreeNode(e)){var i=this.getElementForNode(e)
if(i){t(e,i)
var n=this
this.myDelegate.forEachChild(e,function(e){n.iterate(e,t)})}}},i.TreeDelegate=e.TreeDelegate=n,i.Tree=e.Tree=o}(),function(){"use strict"
function e(e,n,o,r){this.treeDelegate=e,this.root=n,this.options=r||{},this.dirty=!1,this.rootContainer=document.createElement("div"),this.rootContainer.classList.add("treeview"),this.rootContainer.classList.add("on-demand"),this.rootContainer.scroller=document.createElement("div"),this.rootContainer.scroller.classList.add("scroller"),this.rootContainer.appendChild(this.rootContainer.scroller),o&&o.appendChild(this.rootContainer)
var v=[],E={},A=this.options.excludeRoot?-1:0,T=[null],b=function(t){var n=i(this,t)
E[n]=v.length
var o=!!e.isTreeNodeGroup(t)
return v.push({node:t,parent:T[T.length-1],group:o,depth:A,classes:[]}),A++,T.push(n),this.treeDelegate.forEachChild(t,b),T.splice(T.length-1,1),A--,!0}.bind(this)
b(this.root),this.nodeHtmlStates=v,this.nodeIdToStateIndex=E
for(var w=[],C=y,S=0;S<C;++S){var R=s()
w[S]=R}this.elementsPool=w,this.elementsUsed=0
var x=f.isTouchDevice()
x&&(this.hammer=new Hammer.Manager(this.rootContainer,{recognizers:[f.GestureRecognizers.doubletap,f.GestureRecognizers.press],inputClass:Hammer.TouchInput})),o.addEventListener("scroll",a.bind(this))
for(var S=0;S<C;++S){var R=w[S]
x&&(this.hammer.on("doubletap",l.bind(this)),this.hammer.on("press",c.bind(this))),R.addEventListener("click",d.bind(this)),R.addEventListener("dblclick",u.bind(this)),R.addEventListener("contextmenu",h.bind(this)),R.addEventListener("mouseover",p.bind(this)),R.addEventListener("mouseout",m.bind(this)),R.icon.addEventListener("click",g.bind(this))}t(this)}function t(e,t){var n=function(){for(var t=e.elementsUsed,i=e.elementsPool,n=0;n<t;++n){var o=i[n]
o.setAttribute("lmv-nodeId",""),o.className=""
for(var r=o.header,s=r.childNodes.length-1,a=0;a<s;++a)r.removeChild(r.lastChild)}e.clear()}.bind(e),o=function(t){var n=e.rootContainer,s=n.scroller,a=i(e,t)
if(e.elementsUsed===e.elementsPool.length)return!1
var l=r(e,a),c=l.classes,d=-1===l.depth?0:e.treeDelegate.getTreeNodeClientHeight(t),u=n.height,h=u+d
if(n.height=h,h<s.top||u>s.top+s.height)return void(l.group&&-1!==c.indexOf("expanded")&&e.treeDelegate.forEachChild(t,o))
if(s.empty&&(s.empty=!1,s.style.top=s.top-(d-(n.height-s.top))+"px"),d>0){var p=e.elementsPool[e.elementsUsed++]
p.setAttribute("lmv-nodeId",a),l.group?(p.classList.add("group"),p.classList.add(-1!==c.indexOf("expanded")?"expanded":"collapsed")):(p.classList.add("leaf"),p.classList.add("expanded")),-1===l.depth&&p.classList.add("exclude"),e.treeDelegate.createTreeNode(t,p.header,e.options)
var m=e.treeDelegate.getTreeNodeClass(t)
m&&p.classList.add(m)
for(var g=c.length,f=0;f<g;++f)p.classList.add(c[f])
var v=e.treeDelegate.getTreeNodeDepthOffset(t,l.depth)
p.style.left=v+"px",s.appendChild(p)}l.group&&-1!==c.indexOf("expanded")&&e.treeDelegate.forEachChild(t,o)}.bind(e),s=function(){e.dirty=!1
var t=e.rootContainer
t.height=0
var i=t.parentNode
if(i){var r=t.scroller,s=e.treeDelegate.getTreeNodeParentMaxSize()
r.empty=!0,r.top=Math.max(0,i.scrollTop-A),e.rootContainer.height,r.width=999999,r.height=s.height+2*A,r.style.width=r.width+"px",r.style.top=r.top+"px",n(),o(e.root)
var a=Math.min(t.height,r.top+r.height)-r.top
a!==r.height&&(r.style.height=a+"px")
var l=Math.min(r.top,e.rootContainer.height)
l!==r.top&&(r.style.top=l+"px")
var c=e.rootContainer.height+"px"
t.style.height!=c&&(t.style.height=c,e.treeDelegate.onTreeNodeReized(e))}}.bind(e)
if(e.dirty&&!t)return!1
t?s():(e.dirty=!0,requestAnimationFrame(function(){s()}))}function i(e,t){return"number"!=typeof t&&"string"!=typeof t?e.threeDelegate.getTreeNodeId(0|t):t}function n(e,t){if("number"==typeof t||"string"==typeof t){var i=r(e,t)
t=i?i.node:null}return t}function o(e,t){for(var i=null;t&&t!==e.rootContainer;){if(t.hasAttribute("lmv-nodeId")){i=t
break}t=t.parentElement}if(!i)return null
var o=i.getAttribute("lmv-nodeId")
return o?n(e,o):null}function r(e,t){return e.nodeHtmlStates[e.nodeIdToStateIndex[t]]}function s(e,t){var i=document.createElement("lmvheader"),n=document.createElement("icon")
i.appendChild(n)
var o=document.createElement("div")
return o.header=i,o.icon=n,o.appendChild(i),o}function a(e){var i=this.rootContainer,n=i.scroller,o=this.treeDelegate.getTreeNodeParentMaxSize();(n.top+n.height<i.parentNode.scrollTop+o.height||n.top>i.parentNode.scrollTop)&&t(this,!0)}function l(e){var t=o(this,e.target)
t&&this.treeDelegate.onTreeNodeDoubleClick(this,t,e)}function c(e){var t=o(this,e.target)
t&&this.treeDelegate.onTreeNodeRightClick(this,t,e)}function d(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=o(this,e.target)
t&&(this.treeDelegate.onTreeNodeClick(this,t,e),e.stopPropagation(),e.target.classList.contains("propertyLink")||e.preventDefault())}}function u(e){if(!e.target.classList.contains("group")&&!e.target.classList.contains("leaf")){var t=o(this,e.target)
t&&(this.treeDelegate.onTreeNodeDoubleClick(this,t,e),e.stopPropagation(),e.preventDefault())}}function h(e){var t=o(this,e.target)
t&&(this.treeDelegate.onTreeNodeRightClick(this,t,e),e.stopPropagation(),e.preventDefault())}function p(e){if(e.target.classList.contains("group")||e.target.classList.contains("leaf"))return void this.treeDelegate.onTreeNodeHover(this,-1,e)
var t=o(this,e.target)
t&&(this.treeDelegate.onTreeNodeHover(this,t,e),e.stopPropagation(),e.preventDefault())}function m(e){var t=e.toElement||e.relatedTarget
o(this,e.target)!==o(this,t)&&(this.treeDelegate.onTreeNodeHover(this,-1,e),e.stopPropagation(),e.preventDefault())}function g(e){var t=o(this,e.target)
t&&(this.treeDelegate.onTreeNodeIconClick(this,t,e),e.stopPropagation(),e.preventDefault())}var f=Autodesk.Viewing,v=Autodesk.Viewing.UI,E=Autodesk.Viewing.Private,y=150,A=300,T=e.prototype
T.constructor=e,T.show=function(e){this.rootContainer.style.display=block},T.getRootContainer=function(){return this.rootContainer},T.delegate=function(){return this.treeDelegate},T.isCollapsed=function(e){var t=r(this,i(this,e))
return t&&-1!==t.classes.indexOf("collapsed")},T.setCollapsed=function(e,t,i){t?(this.addClass(e,"collapsed",i),this.removeClass(e,"expanded",i)):(this.addClass(e,"expanded",i),this.removeClass(e,"collapsed",i))},T.setAllCollapsed=function(e){var t=function(e){this.addClass(e.node,"collapsed",!1),this.removeClass(e.node,"expanded",!1)}.bind(e?this:this)
this.iterate(this.root,function(e){var n=r(this,i(this,e))
return n.group&&t(n),!0}.bind(this))},T.addToSelection=function(e){for(var i=e.length,n=0;n<i;++n)this.addClass(e[n],"selected",!1)
t(this)},T.removeFromSelection=function(e){for(var i=e.length,n=0;n<i;++n)this.removeClass(e[n],"selected",!1)
t(this)},T.setSelection=function(e){return this.clearSelection(),this.addToSelection(e),this.selectedNodes},T.clearSelection=function(){for(var e=this.nodeHtmlStates,t=e.length,i=[null],n=0;n<t;++n){var o=e[n];-1!==o.classes.indexOf("selected")&&(i[0]=o.node,this.removeFromSelection(i))}},T.isSelected=function(e){return-1!==r(this,i(this,e)).indexOf("selected")},T.scrollTo=function(e){var n=!1,o=[],s=function(t){var a=i(this,t),l=r(this,a)
if(!(n=n||i(this,e)===a)){o.push(this.treeDelegate.getTreeNodeClientHeight(e))
var c=o.length,d=l.group&&-1!==l.classes.indexOf("expanded")
this.treeDelegate.forEachChild(t,s),d||n||o.length>c&&o.splice(c)}}.bind(this)
this.setCollapsed(e,!1,!0),s(this.root)
for(var a=0,l=o.length,c=0;c<l;++c)a+=o[c]
this.rootContainer.parentNode.scrollTop!==a&&(t(this,!0),this.rootContainer.parentNode.scrollTop=a)},T.addClass=function(e,n,o){var s=function(e,t){var i=e.classes;-1===i.indexOf(t)&&i.push(t)},a=r(this,i(this,e))
if(a){if(o)for(e=a.parent;e;)a=r(this,i(this,e)),e=a.parent,s(a,n)
else s(a,n)
return t(this),!0}},T.removeClass=function(e,n,o){var s=function(e,t){var i=e.classes,n=i.indexOf(t);-1!==n&&i.splice(n,1)},a=r(this,i(this,e))
if(a){if(o)for(e=a.parent;e;)a=r(this,i(this,e)),e=a.parent,s(a,n)
else s(a,n)
return t(this),!0}},T.hasClass=function(e,t){return 1!==r(this,i(this,e)).classes.indexOf(t)},T.clear=function(){for(var e,t=this.rootContainer.scroller;e=t.lastChild;)t.removeChild(e)
this.elementsUsed=0},T.iterate=function(e,t){void 0!==e&&null!==e&&this.treeDelegate.shouldCreateTreeNode(e)&&t(e)&&this.treeDelegate.forEachChild(e,function(e){this.iterate(e,t)}.bind(this))},E.TreeOnDemand=v.TreeOnDemand=e}(),function(){"use strict"
var e=function(){},t=Autodesk.Viewing,i=Autodesk.Viewing.Private
e.prototype.constructor=e,e.prototype.getNodeId=function(e){throw"getId is not implemented."},e.prototype.getNodeLabel=function(e){return e.name},e.prototype.getNodeClass=function(e){return""},e.prototype.hasThumbnail=function(e){return!1},e.prototype.getThumbnailOptions=function(e){return null},e.prototype.getThumbnail=function(e){return null},e.prototype.onNodeClick=function(e,t,i){},e.prototype.onNodeHover=function(e,t,i){},e.prototype.selectItem=function(e){},e.prototype.deselectItem=function(e){},e.prototype.hasContent=function(e){return!1},e.prototype.addContent=function(e,t){}
var n=function(e,t,i){this.myDelegate=e,this.mySelectedIds=[]
this.myRootContainerId=i+"-browserview",this.idToElement={},this.myRootContainer=document.createElement("div"),this.myRootContainer.id=this.myRootContainerId,this.myRootContainer.classList.add("browserview"),document.getElementById(i).appendChild(this.myRootContainer),this.createElements(t,this.myRootContainer)}
n.prototype.constructor=n,n.prototype.show=function(e){e?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")},n.prototype.getRootContainer=function(){return this.myRootContainer},n.prototype.delegate=function(){return this.myDelegate},n.prototype.addToSelection=function(e){for(var t=this,i=0,n=e.length;i<n;++i){var o=e[i]
if(function(e){return-1==t.mySelectedIds.indexOf(e)&&(t.mySelectedIds.push(e),!0)}(o)){var r=t.idToElement[o]
void 0===r?t.myDelegate.selectItem(o):r.classList.add("selected")}}},n.prototype.removeFromSelection=function(e){for(var t=this,i=e.length-1;i>=0;--i){var n=e[i]
if(function(e){var i=t.mySelectedIds.indexOf(e)
return-1!=i&&(t.mySelectedIds.splice(i,1),!0)}(n)){var o=this.idToElement[n]
void 0===o?t.myDelegate.deselectItem(n):o.classList.remove("selected")}}},n.prototype.setSelection=function(e){return this.removeFromSelection(this.mySelectedIds),this.addToSelection(e),this.mySelectedIds},n.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)},n.prototype.createElements=function(e,t){if(e)for(var i=this,n=0;n<e.length;n++){var o=e[n]
i.createElement(o,t)}},n.prototype.createElement=function(e,n){var o=this,r=o.myDelegate.getNodeId(e),s=document.createElement("item")
n.appendChild(s),this.idToElement[r]=s,s.onmouseover=function(){o.myDelegate.onNodeHover(o,e)},s.onclick=function(t){o.myRootContainer.querySelector(".flipped").removeClass("flipped"),o.myDelegate.onNodeClick(o,e,t)}
var a=document.createElement("div")
a.classList.add("card"),s.appendChild(a)
var l=document.createElement("div")
l.classList.add("browserElement"),a.appendChild(l)
var c=o.myDelegate.getNodeLabel(e),d=document.createElement("label")
d.innerHTML=c,l.appendChild(d),d.onclick=function(t){o.myDelegate.onNodeClick(o,e,t)}
var u=o.myDelegate.getThumbnail(e)
if(u){var h=document.createElement("img")
h.classList.add("thumb")
var p=o.myDelegate.getThumbnailOptions(e)
t.Document.requestThumbnailWithSecurity(p,function(e,n){if(e)return void i.logger.error("Failed to load thumbnail: "+u,t.errorCodeString(t.ErrorCodes.NETWORK_FAILURE))
h.src=window.URL.createObjectURL(n),h.onload=function(){window.URL.revokeObjectURL(h.src)}}),l.appendChild(h),h.onclick=function(t){o.myDelegate.onNodeClick(o,e,t)}}o.myDelegate.hasContent(e)&&o.myDelegate.addContent(e,a),s.classList.add(o.myDelegate.getNodeClass(e))},Autodesk.Viewing.Private.BrowserDelegate=e,Autodesk.Viewing.Private.Browser=n}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var e=Autodesk.Viewing.Private
e.WEBGL_HELP_LINK=null,e.ErrorInfoData={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unloack","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You don’t have the required privileges to access this item.</message><hint> Please contact the author</hint>"},5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We can’t display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.autodesk.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported","default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>There’s nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-item-not-found","globalized-msg":"Viewer-ModeIsEmpty","default-msg":"<title>Model is empty</title><message>Model is empty, there is no geometry for the viewer to show.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},12:{img:"img-unsupported","globalized-msg":"Viewer-RTCError","default-msg":"<title> Sorry </title><message>We couldn’t connect to the Collaboration server.</message><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},13:{img:"img-unsupported","globalized-msg":"Viewer-FileExtNotSupported","default-msg":{title:"Sorry",message:"The file extension loaded into the Viewer is not supported",hints:["Try a different file"]}}},e.currentError=null,e.currentErrors=null,e.ErrorHandler=function(){},e.ErrorHandler.prototype.constructor=e.ErrorHandler,e.ErrorHandler.getErrorCode=function(e){return 403===e||401===e?Autodesk.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED:404===e?Autodesk.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND:e>=500?Autodesk.Viewing.ErrorCodes.NETWORK_SERVER_ERROR:Autodesk.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE},e.ErrorHandler.reportError=function(t,i,n,o,r,s){if(e.ErrorHandler.currentError=null,e.ErrorHandler.currentErrors=null,i){var a={category:"error",code:i,message:n,httpStatusCode:o,httpStatusText:r}
e.logger.track(a,!0),e.ErrorHandler.currentError=[t,i,n,s]
var l=e.ErrorInfoData[i]
if(l){var c={defaultValue:""}
c.defaultValue=l["default-msg"]
var d=l.img,u=l["globalized-msg"],h=this.parseErrorString(u,c)
if(i===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||i===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(var p=e.WEBGL_HELP_LINK||"http://www.autodesk.com/a360-browsers",m=0;m<h.hints.length;m++){var g=h.hints[m].indexOf('href="WEBGL_HELP"');-1!==g&&(h.hints[m]=h.hints[m].replace('href="WEBGL_HELP"','href="'+p+'"'))}e.AlertBox.displayError(t,h.msg,h.header,d,h.hints)}else{var d="img-unsupported",c={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"}
this.parseArguments(n,c)
var h=this.parseErrorString(i,c)
h.header||(h.header="warning"===s?Autodesk.Viewing.i18n.translate("header-warning"):""),e.AlertBox.displayError(t,h.msg,h.header,d,h.hints)}}},e.ErrorHandler.reportErrors=function(t,i){if(e.ErrorHandler.currentError=null,e.ErrorHandler.currentErrors=null,i){e.ErrorHandler.currentErrors=[t,i]
for(var n={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},o=[],r=0;r<i.length;r++)if(i[r].code){this.parseArguments(i[r].message,n)
var s=this.parseErrorString(i[r].code,n)
s.header||(s.header="warning"===i[0].type?Autodesk.Viewing.i18n.translate("header-warning",{defaultValue:"Warning"}):""),o.push(s)
var a={category:"error",code:i[r].code,message:i[r].message}
e.logger.track(a,!0)}if(o.length){e.AlertBox.displayErrors(t,"img-unsupported",o)}}},e.ErrorHandler.parseArguments=function(e,t){if(e)if("string"==typeof e)t.defaultValue=e
else{t.defaultValue=e[0]
for(var i=1;i<e.length;i++){var n=i-1,o=n.toString()
t[o]=e[i]}}},e.ErrorHandler.parseErrorString=function(e,t){var i={msg:null,msgList:null,header:null,hints:null}
if(!e)return i
if("object"==typeof t.defaultValue){var n=t.defaultValue
return i.header=n.title,i.msg=n.message,i.hints=n.hints.concat(),i}var o=Autodesk.Viewing.i18n.translate(e,t)
if(!o)return i
if(-1!=o.indexOf("<title>")){var r=o.split("<title>")[1].split("</title>")
i.header=r[0],o=r[1]}if(o&&-1!=o.indexOf("<message>")){var r=o.split("<message>")[1].split("</message>")
i.msg=r[0],o=r[1]}else i.msg=o
if(o&&-1!=o.indexOf("<hint>")){i.hints=[]
for(var s=o.split("<hint>"),a=0;a<s.length;a++){var l=s[a].split("</hint")[0]
i.hints.push(l)}}return i},e.ErrorHandler.localize=function(){if(e.AlertBox.instances.length>0)if(e.AlertBox.dismiss(),e.ErrorHandler.currentError){var t=e.ErrorHandler.currentError.shift(),i=e.ErrorHandler.currentError
e.ErrorHandler.reportError(t,i[0],i[1],i[2])}else{var t=e.ErrorHandler.currentErrors.shift(),n=e.ErrorHandler.currentErrors[0]
e.ErrorHandler.reportErrors(t,n)}}}(),function(){"use strict"
var e=function(e,t){this.viewer=e,this.options=t,this.id=""}
e.prototype.load=function(){return!0},e.prototype.unload=function(){return!0},e.prototype.getState=function(e){},e.prototype.restoreState=function(e,t){return!0},e.prototype.extendLocalization=function(e){return Autodesk.Viewing.Private.extendLocalization(e)},e.prototype.getCache=function(){this.viewer.extensionCache||(this.viewer.extensionCache={},Autodesk.Viewing.Private.logger.warn("Extension cache runtime creation; missing ViewingApplication context."))
var e=this.viewer.extensionCache[this.id]
return e||(e=this.viewer.extensionCache[this.id]={}),e},Autodesk.Viewing.Extension=e}(),function(){"use strict"
var e=Autodesk.Viewing,t=e.Private,i=function(){function e(e,t){return!l[e]&&(l[e]=t,!0)}function t(e){return l.hasOwnProperty(e)?l[e]:null}function i(e){return!!l.hasOwnProperty(e)&&(delete l[e],!0)}function n(e,t){return!c[e]&&(c[e]=t,!0)}function o(e){return c.hasOwnProperty(e)?c[e]:null}function r(e){return!!c.hasOwnProperty(e)&&(delete c[e],!0)}function s(){var e,t=[]
for(e in l)l.hasOwnProperty(e)&&t.push({id:e,inMemory:!0,isAsync:e in c})
for(e in c)!c.hasOwnProperty(e)||e in l||t.push({id:e,inMemory:!1,isAsync:!0})
return t}function a(e){for(var t in l)l.hasOwnProperty(t)&&l[t].hasOwnProperty("populateDefaultOptions")&&l[t].populateDefaultOptions(e)}var l={},c={}
return{registerExtension:e,getExtension:t,unregisterExtension:i,registerExternalExtension:n,getExternalPath:o,unregisterExternalExtension:r,getRegisteredExtensions:s,popuplateOptions:a}},n=new i,o=function(){}
o.prototype={loadExtension:function(e,t){this.loadedExtensions||(this.loadedExtensions={})
var i=this.getExtension(e)
if(i)return Promise.resolve(i)
if(!n.getExtension(e)){var o=n.getExternalPath(e)
return o?this.loadExtensionAsync(e,o,t):Promise.reject("Extension not found: "+e+". Has it been registered(1)?")}return this.loadExtensionLocal(e,t)},getExtension:function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e]:null},unloadExtension:function(i){var n=!1,o=this.getExtension(i)
return o?(n=o.unload(),t.logger.info("Extension unloaded: "+i),delete this.loadedExtensions[i],this.fireEvent({type:e.EXTENSION_UNLOADED_EVENT,extensionId:i})):t.logger.warn("Extension not found: "+i),n},loadExtensionLocal:function(i,o){var r=n.getExtension(i)
if(!r)return Promise.reject("Extension not found: "+i+". Has it been registered(2)?")
var s=new r(this,o)
return s.id=i,s.load()?(this.loadedExtensions[i]=s,t.logger.info("Extension loaded: "+i),this.fireEvent({type:e.EXTENSION_LOADED_EVENT,extensionId:i}),Promise.resolve(s)):Promise.reject("Extension failed to .load() : "+i)},loadExtensionAsync:function(e,i,n){var o=this
return new Promise(function(r,s){t.loadDependency(e,i,function(){o.loadExtensionLocal(e,n)
var t=o.getExtension(e)
t?r(t):s("Failed to getExtension("+e+")")},function(){s("Failed to loadExtensionAsync: ("+e+") from: ("+i+")")})})},apply:function(e){var t=o.prototype
e.loadExtension=t.loadExtension,e.getExtension=t.getExtension,e.unloadExtension=t.unloadExtension,e.loadExtensionLocal=t.loadExtensionLocal,e.loadExtensionAsync=t.loadExtensionAsync}},Autodesk.Viewing.theExtensionManager=n,Autodesk.Viewing.ExtensionMixin=o}(),function(){"use strict"
var e=Autodesk.Viewing
e.Private.init_UnifiedCamera=function(t){if(void 0===e.UnifiedCamera){var i=function(e,i){t.Camera.call(this),this.fov=45,this.near=.1,this.far=1e5,this.aspect=e/i,this.left=-e/2,this.right=e/2,this.top=i/2,this.bottom=-i/2,this.clientWidth=e,this.clientHeight=i,this.target=new t.Vector3(0,0,-1),this.worldup=new t.Vector3(0,1,0),this.orthographicCamera=new t.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far),this.perspectiveCamera=new t.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this.zoom=1,this.toPerspective()}
i.ORTHO_FOV=2*Math.atan(.5)*180/Math.PI,i.prototype=Object.create(t.Camera.prototype),i.prototype.clone=function(){var e=new i(2*this.right,2*this.top)
return t.Camera.prototype.clone.call(this,e),e.position.copy(this.position),e.up.copy(this.up),this.target&&(e.target=this.target.clone()),this.worldup&&(e.worldup=this.worldup.clone()),this.worldUpTransform&&(e.worldUpTransform=this.worldUpTransform.clone()),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.fov=this.fov,e.aspect=this.aspect,e.zoom=this.zoom,e.isPerspective=this.isPerspective,this.updateProjectionMatrix(),e},i.prototype.__computeFovPosition=function(e){if(Math.abs(this.fov-e)<=1e-4)return this.position.clone()
var i=this.target.clone().sub(this.position),n=t.Math.degToRad(this.fov),o=t.Math.degToRad(e),r=i.length()*Math.tan(.5*n)/Math.tan(.5*o),s=i.normalize().multiplyScalar(-r)
return this.target.clone().add(s)},i.prototype.toPerspective=function(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov),this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.fov=this.fov/this.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspectiveCamera.projectionMatrix,this.isPerspective=!0},i.prototype.toOrthographic=function(){if(this.isPerspective){this.saveFov=this.fov
var e=i.ORTHO_FOV
this.position.copy(this.__computeFovPosition(e)),this.fov=e}this.orthoScale=this.target.clone().sub(this.position).length()
var t=.5*this.orthoScale,n=t*this.aspect
this.left=this.orthographicCamera.left=-n,this.right=this.orthographicCamera.right=n,this.top=this.orthographicCamera.top=t,this.bottom=this.orthographicCamera.bottom=-t,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthographicCamera.projectionMatrix,this.isPerspective=!1},i.prototype.updateProjectionMatrix=function(){this.isPerspective?this.toPerspective():this.toOrthographic()},i.prototype.setSize=function(e,t){this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},i.prototype.setFov=function(e){this.fov=e,this.updateProjectionMatrix()},i.prototype.setLens=function(e,i){void 0===i&&(i=24)
var n=2*t.Math.radToDeg(Math.atan(i/(2*e)))
return this.setFov(n),n},i.prototype.getCameraChangedEvent=function(){return{type:e.CAMERA_CHANGE_EVENT,camera:this}},e.UnifiedCamera=i}}}(),function(){"use strict"
var e=Autodesk.Viewing,t=e.Private
e.ESCAPE_EVENT="escape",e.PROGRESS_UPDATE_EVENT="progress",e.FULLSCREEN_MODE_EVENT="fullScreenMode",e.NAVIGATION_MODE_CHANGED_EVENT="navmode",e.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored",e.VIEWER_RESIZE_EVENT="viewerResize",e.VIEWER_INITIALIZED="viewerInitialized",e.VIEWER_UNINITIALIZED="viewerUninitialized",e.MODEL_ROOT_LOADED_EVENT="svfLoaded",e.GEOMETRY_LOADED_EVENT="geometryLoaded",e.TEXTURES_LOADED_EVENT="texturesLoaded",e.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded",e.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable",e.MODEL_UNLOADED_EVENT="modelUnloaded",e.EXTENSION_LOADED_EVENT="extensionLoaded",e.EXTENSION_UNLOADED_EVENT="extensionUnloaded",e.SELECTION_CHANGED_EVENT="selection",e.AGGREGATE_SELECTION_CHANGED_EVENT="aggregateSelection",e.ISOLATE_EVENT="isolate",e.HIDE_EVENT="hide",e.SHOW_EVENT="show",e.CAMERA_CHANGE_EVENT="cameraChanged",e.EXPLODE_CHANGE_EVENT="explodeChanged",e.FIT_TO_VIEW_EVENT="fitToView",e.CUTPLANES_CHANGE_EVENT="cutplanesChanged",e.TOOL_CHANGE_EVENT="toolChanged",e.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged",e.FINAL_FRAME_RENDERED_CHANGED_EVENT="finalFrameRenderedChanged",e.RENDER_PRESENTED_EVENT="renderPresented",e.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility",e.RESET_EVENT="reset",e.PREF_CHANGED_EVENT="PrefChanged",e.PREF_RESET_EVENT="PrefReset",e.RESTORE_DEFAULT_SETTINGS_EVENT="restoreDefaultSettings",e.ANIMATION_READY_EVENT="animationReady",e.HYPERLINK_EVENT="hyperlink",e.LOAD_GEOMETRY_EVENT="load_geometry",e.LOAD_MISSING_GEOMETRY="loadMissingGeometry",e.FRAGMENTS_LOADED_EVENT="fragmentLoaded",e.NAVIGATION_MODE={ORBIT:0,PAN:1,DOLLY:2,ROLL:3,FOV:4,TOUCH_PAN_DOLLY:5,TOUCH_ROLL:6,OTHER:7}
var i=e.isMobileDevice(),n=0
e.DefaultSettings={ambientShadows:!0,antialiasing:!i,groundShadow:!0,groundReflection:!1,progressiveRendering:!0,renderCache:!1,swapBlackAndWhite:!1,openPropertiesOnSelect:!1,ghosting:!0,viewCube:!i,lineRendering:!0,pointRendering:!0,edgeRendering:!1,lightPreset:t.DefaultLightPreset,backgroundColorPreset:null,reverseMouseZoomDir:!1,reverseHorizontalLookDirection:!1,reverseVerticalLookDirection:!1,alwaysUsePivot:!1,zoomTowardsPivot:!1,orbitPastWorldPoles:!0,leftHandedMouseSetup:!1,clickToSetCOI:!1,optimizeNavigation:i,fusionOrbit:!0,fusionOrbitConstrained:!0,envMapBackground:!1,useFirstPersonPrototype:!1,firstPersonToolPopup:!0,bimWalkToolPopup:!0}
var o=function(i,o){if("undefined"==typeof THREE&&t.logger.warn("Initializing LMV without the THREE.js dependency is not supported.","Call Autodesk.Viewing.Initializer() first or preload the dependencies manually."),i){if(this.clientContainer=i,this.container=document.createElement("div"),this.container.className="adsk-viewing-viewer",this.container.style.height="100%",this.container.style.width="100%",this.container.style.overflow="hidden",this.container.classList.add(e.isTouchDevice()?"touch":"notouch"),this.clientContainer.appendChild(this.container),this.config=o||e.createViewerConfig(),this.contextMenu=null,this.contextMenuCallbacks={},this.__firefoxLMBfix=!1,this.started=!1,"CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]"
this.canvasWrap=document.createElement("div"),this.canvasWrap.classList.add("canvas-wrap"),this.canvas=document.createElement("canvas"),this.canvas.tabIndex=0,this.canvas.setAttribute("data-viewer-canvas","true"),this.canvasWrap.appendChild(this.canvas),this.container.appendChild(this.canvasWrap),this.canvas.viewer=this
var r={prefix:"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.",localStorage:!0}
this.prefs=new t.Preferences(this,r)}this.extensionCache=null,this.running=!1,this._pushedTool="",this._defaultNavigationTool="",this.id=n++,this.impl=new t.Viewer3DImpl(this.canvas,this),this.onResetEvent=this.onResetEvent.bind(this)}
o.populateConfigOptions=function(){},o.prototype.constructor=o,e.EventDispatcher.prototype.apply(o.prototype),e.ScreenModeMixin.prototype.apply(o.prototype),e.ExtensionMixin.prototype.apply(o.prototype),o.ScreenMode=e.ScreenMode,o.ViewerCount=0,o.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"]},clickShift:{onObject:["selectToggle"]},disableSpinner:!1,disableMouseWheel:!1,disableTwoFingerSwipe:!1},o.prototype.start=function(e,t,i,n){if(this.started)return 0
this.started=!0
var o=this,r=o.initialize()
return 0!==r?(n&&setTimeout(function(){n(r)},1),r):(setTimeout(function(){o.setUp(o.config)},1),e&&this.loadModel(e,t,i,n),0)},o.prototype.registerUniversalHotkeys=function(){var t,i,n,o=this,r=e.theHotkeyManager.KEYCODES
t=function(){return o.navigation.setRequestFitToView(!0),!0},e.theHotkeyManager.pushHotkeys("Autodesk.FitToView",[{keycodes:[r.f],onPress:t}]),t=function(){return o.navigation.setRequestHomeView(!0),!0},e.theHotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[r.h],onPress:t},{keycodes:[r.HOME],onPress:t}]),i=function(){return!(!o.objectContextMenu||!o.objectContextMenu.hide())||(o.fireEvent({type:e.ESCAPE_EVENT}),!0)},e.theHotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[r.ESCAPE],onRelease:i}]),t=function(){return n=o.getActiveNavigationTool(),o.setActiveNavigationTool("pan")},i=function(){return o.setActiveNavigationTool(n)}
var s=[{keycodes:[r.SHIFT],onPress:t,onRelease:i},{keycodes:[r.SPACE],onPress:t,onRelease:i}]
e.theHotkeyManager.pushHotkeys("Autodesk.Pan",s,{tryUntilSuccess:!0})},o.prototype.createControls=function(){var t=this,i=t.impl
return t.navigation=new e.Navigation(i.camera),t.__initAutoCam(i),t.utilities=new e.ViewingUtilities(i,t.autocam,t.navigation),t.clickHandler=new e.DefaultHandler(i,t.navigation,t.utilities),t.toolController=new e.ToolController(i,t,t.autocam,t.utilities,t.clickHandler),t.toolController.registerTool(new e.GestureHandler(t)),t.toolController.registerTool(e.theHotkeyManager),t.toolController.activateTool(e.theHotkeyManager.getName()),t.registerUniversalHotkeys(),t.toolController.registerTool(new e.OrbitDollyPanTool(i,t)),t.toolController},o.prototype.initialize=function(){this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0)
var i=this.getDimensions()
if(this.canvas.width=i.width,this.canvas.height=i.height,e.isIOSDevice()&&window.devicePixelRatio&&(this.canvas.width/=window.devicePixelRatio,this.canvas.height/=window.devicePixelRatio),this.impl.initialize(),!this.impl.glrenderer()){var n=e.detectWebGL()
if(n<=0)return-1===n?e.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:e.ErrorCodes.BROWSER_WEBGL_DISABLED}var r=this
if(e.isIOSDevice()){var s
this.onResizeCallback=function(e){clearTimeout(s),s=setTimeout(r.resize.bind(r),500)}}else this.onResizeCallback=function(e){r.resize()}
window.addEventListener("resize",this.onResizeCallback,!1),this.initContextMenu(),this.localize(),this.impl.controls=this.createControls(),this.setDefaultNavigationTool("orbit"),this.model=null,this.impl.controls&&this.impl.controls.setAutocam(this.autocam)
var a=this.config&&this.config.canvasConfig?this.config.canvasConfig:o.kDefaultCanvasConfig
if(this.setCanvasClickBehavior(a),!a.disableSpinner){this.loadSpinner=document.createElement("div"),this.loadSpinner.className="spinner",this.container.appendChild(this.loadSpinner)
for(var l=1;l<=3;l++){var c=document.createElement("div")
c.className="bounce"+l,this.loadSpinner.appendChild(c)}}return this.initSettings(),this.viewerState=new t.ViewerState(this),this.config&&this.config.hasOwnProperty("startOnInitialize")&&!this.config.startOnInitialize||this.run(),window.NOP_VIEWER=this,this.addEventListener(e.RESTORE_DEFAULT_SETTINGS_EVENT,this.onResetEvent),this.fireEvent(e.VIEWER_INITIALIZED),o.ViewerCount++,0},o.prototype.setUp=function(e){if(this.config=e,this.config&&this.config.hasOwnProperty("extensions"))for(var i=this.config.extensions,n=0;n<i.length;++n)this.loadExtension(i[n],this.config)
"true"==t.getParameterByName("lmv_viewer_debug")&&this.loadExtension("Autodesk.Debug",this.config)
var r=this.config&&this.config.canvasConfig?this.config.canvasConfig:o.kDefaultCanvasConfig
this.setCanvasClickBehavior(r)},o.prototype.tearDown=function(){if(this.clearSelection(),this.loadedExtensions){for(var i in this.loadedExtensions)try{this.unloadExtension(i)}catch(n){t.logger.error("Failed to unload extension: "+i,n,e.errorCodeString(e.ErrorCodes.VIEWER_INTERNAL_ERROR)),t.logger.track({category:"error_unload_extension",extensionId:i,error_message:n.message,call_stack:n.stack})}this.loadedExtensions=null}t.logger.reportRuntimeStats(!0),this.loadSpinner&&(this.loadSpinner.style.display="block"),this.model=null,this.liveReviewClient&&(this.liveReviewClient.destroy(),this.liveReviewClient=null),this.impl.unloadCurrentModel()},o.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())},o.prototype.localize=function(){e.i18n.localize()},o.prototype.__initAutoCam=function(e){function i(e){o.autocamCamera.isPerspective!==r.isPerspective&&(o.autocamCamera.isPerspective?o.navigation.toPerspective():o.navigation.toOrthographic()),o.navigation.setVerticalFov(o.autocamCamera.fov,!1),o.navigation.setView(o.autocamCamera.position,o.autocamCamera.target),o.navigation.setPivotPoint(o.autocamCamera.pivot),o.navigation.setCameraUpVector(o.autocamCamera.up),e&&o.navigation.setWorldUpVector(o.autocamCamera.worldup),o.impl.syncCamera(e)}function n(e){o.utilities?o.utilities.pivotActive(e,!1):o.impl.controls.pivotActive(e,!1)}var o=this,r=e.camera
r.pivot||(r.pivot=new THREE.Vector3(0,0,0)),r.target||(r.target=new THREE.Vector3(0,0,0)),r.worldup||(r.worldup=r.up.clone()),o.autocamCamera=r.clone(),o.autocamCamera.target=r.target.clone(),o.autocamCamera.pivot=r.pivot.clone(),o.autocamCamera.worldup=r.worldup.clone(),o.autocam=new t.Autocam(o.autocamCamera,o.navigation),o.autocam.cameraChangedCallback=i,o.autocam.pivotDisplayCallback=n,o.autocam.canvas=o.canvas,o.addEventListener("cameraChanged",function(e){var t=e.camera
o.autocam.sync(t)}),o.autocam.sync(r)},o.prototype.uninitialize=function(){window.removeEventListener("resize",this.onResizeCallback,!1),this.onResizeCallback=null,this.canvas.parentNode.removeChild(this.canvas),this.canvas.viewer=null,this.canvas=null,this.canvasWrap=null,this.viewerState=null,t.logger.reportRuntimeStats(),t.logger.track({category:"viewer_destroy"},!0),this.toolController&&(this.toolController.uninitialize(),this.toolController=null,this.clickHandler=null,this.utilities=null),this.navigation&&(this.navigation.uninitialize(),this.navigation=null),this.impl&&(this.impl.dtor(),this.impl=null),this.loadSpinner=null,this.model=null,this.prefs=null,this.autocam.dtor(),this.autocam=null,this.autocamCamera=null,e.theHotkeyManager.popHotkeys("Autodesk.FitToView"),e.theHotkeyManager.popHotkeys("Autodesk.Home"),e.theHotkeyManager.popHotkeys("Autodesk.Escape"),e.theHotkeyManager.popHotkeys("Autodesk.Pan"),e.theHotkeyManager.popHotkeys("Autodesk.Orbit"),o.ViewerCount--,0===o.ViewerCount&&t.clearPropertyWorkerCache(),this.onDefaultContextMenu&&(this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1),this.onDefaultContextMenu=null),this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.extensionCache=null,this.clientContainer=null,this.config=null,this.listeners={},this.contextMenu=null,this.contextMenuCallbacks=null,this.viewCubeUi&&(this.viewCubeUi.uninitialize(),this.viewCubeUi=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.fireEvent(e.VIEWER_UNINITIALIZED),this.listeners={},t.logger.log("viewer destroy")},o.prototype.finish=function(){this.tearDown(),this.uninitialize()},o.prototype.load=function(e,i,n,o,r,s){t.logger.warn("viewer.load() is deprecated. Please use viewer.loadModel() instead.")
var a={ids:null,sharedPropertyDbPath:i,acmSessionId:r,loadOptions:s}
return this.loadModel(e,a,n,o)},o.prototype.setLoadHeuristics=function(i){var n=i.bubbleNode
if(n&&!i.hasOwnProperty("isAEC")){var o=n.findViewableParent()
if(o){var r=o.name(),s=r.slice(r.length-3).toLowerCase()
"rvt"!==s&&"nwd"!==s&&"nwc"!==s||(i.isAEC=!0)}}i.isAEC&&(void 0===i.useConsolidation&&(i.useConsolidation=!e.isMobileDevice()),void 0===i.createWireframe&&(i.createWireframe=!e.isMobileDevice())),i.useConsolidation&&WGS.Consolidation.registerWorkerSupport(t.createWorkerWithIntercept),i.useConsolidation&&!i.bvhOptions&&(i.bvhOptions={frags_per_leaf_node:256,max_polys_per_node:5e4})},o.prototype.loadModel=function(i,n,o,r,s){function a(){if(e.theHotkeyManager)if(h.model.is2d())e.theHotkeyManager.popHotkeys("Autodesk.Orbit")
else{var t,i=function(){return t=h.getActiveNavigationTool(),h.setActiveNavigationTool("orbit")},n=function(){return h.setActiveNavigationTool(t)},o=[{keycodes:[e.theHotkeyManager.KEYCODES.ALT],onPress:i,onRelease:n}]
e.theHotkeyManager.pushHotkeys("Autodesk.Orbit",o,{tryUntilSuccess:!0})}}function l(){if(!e.isNodeJS){var t=h.model.is2d()?"pan":"orbit"
h.setActiveNavigationTool(t),h.setDefaultNavigationTool(t),h.toolController&&h.toolController.activateTool("gestures")}}function c(e){var t=!1
h.model||(h.model=e,t=!0),h.impl.addModel(e),h.loadSpinner&&(h.loadSpinner.style.display="None"),t&&(e.is2d()&&h.activateLayerState("Initial"),a(),l()),o&&o(e)}function d(e,t,i){h.loadSpinner&&(h.loadSpinner.style.display="None"),r&&r(e,t,i)}function u(){h.impl.needsRender=!0,h.removeEventListener(e.GEOMETRY_LOADED_EVENT,u)}var h=this
n=n||{},this.addEventListener(e.GEOMETRY_LOADED_EVENT,u)
var p,m=i.toLowerCase().match(/\.([a-z0-9]+)(\?|$)/),g=m?m[1]:null
if(!(p=n&&n.fileLoader?n.fileLoader:e.FileLoaderManager.getFileLoaderForExtension(g)))return t.logger.error("File extension not supported:"+g,e.errorCodeString(e.ErrorCodes.UNSUPORTED_FILE_EXTENSION)),d(e.ErrorCodes.UNSUPORTED_FILE_EXTENSION,"File extension not supported",0),!1
this.setLoadHeuristics(n)
var f=new p(this.impl),v=f.loadFile(i,n,c,d,s)
return n.isAEC&&f.is3d()&&this.impl.setLightPresetForAec(),v},o.prototype.getDimensions=function(){if(this.container){var t={}
return this.getScreenMode()===e.ScreenMode.kFullScreen?(t.width=screen.width,t.height=screen.height):t=this.container.getBoundingClientRect(),{width:t.width,height:t.height}}return null},o.prototype.resize=function(){return this.impl.resize(this.container.clientWidth,this.container.clientHeight)},o.prototype.getCamera=function(){return this.impl.camera},o.prototype.getState=function(e){return this.viewerState.getState(e)},o.prototype.restoreState=function(t,i,n){var o=this.viewerState.restoreState(t,i,n)
return o&&this.fireEvent({type:e.VIEWER_STATE_RESTORED_EVENT,value:o}),o},o.prototype.setViewFromArray=function(e,t){var i=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0},n={position:new THREE.Vector3(e[0]-i.x,e[1]-i.y,e[2]-i.z),target:new THREE.Vector3(e[3]-i.x,e[4]-i.y,e[5]-i.z),up:new THREE.Vector3(e[6],e[7],e[8]),aspect:e[9],fov:THREE.Math.radToDeg(e[10]),orthoScale:e[11],isPerspective:!e[12]}
this.impl.setViewFromCamera(n)},o.prototype.setViewFromViewBox=function(e,i){var n=this.model
if(n&&!n.is2d())return void t.logger.warn("Viewer3D.setViewFromViewBox is not applicable to 3D")
if(i&&i.length){var o,r=n.getData().metadata,s=r.views
for(o=0;o<s.length&&s[o].name!=i;o++);if(o<s.length){var a=s[o].layer_state
a&&this.activateLayerState(a)}}this.impl.setViewFromViewBox(this.model,e,i,!1)},o.prototype.activateLayerState=function(t){if(t&&t.length){var i=this.model.getData().metadata,n=i?i.layer_states:null
if(!n)return
var o
for(o=0;o<n.length&&n[o].name!=t;o++);if(o<n.length){var r=n[o],s=r.visible_layers,a={}
if(s&&0<s.length)for(var l=0;l<s.length;l++)a[s[l]]=1
var c=[],d=[]
for(var u in i.layers){1===a[i.layers[u].name]?c.push(u):d.push(u)}this.impl.setLayerVisible(c,!0),this.impl.setLayerVisible(d,!1),this.fireEvent({type:e.LAYER_VISIBILITY_CHANGED_EVENT})}}},o.prototype.getLayerStates=function(){var e=this.model,t=e?e.getData().metadata:null,i=t?t.layers:null,n=t?t.layer_states:null
if(!i||!n)return null
var o,r={},s={}
for(var a in i)if(i.hasOwnProperty(a)){var l=parseInt(a),c=i[a]
o="string"==typeof c?c:c.name,r[o]=!0,this.impl.isLayerVisible(l)&&(s[o]=!0)}var d,u,h=[]
for(d=0;d<n.length;++d){var p=n[d],m=p.visible_layers,g={}
if(!p.hidden){if(m&&0<m.length)for(u=0;u<m.length;++u)o=m[u],r.hasOwnProperty(o)&&(g[o]=!0)
h.push({name:p.name,description:p.description,active:function(e,t){var i=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t)
if(i.length!==n.length)return!1
for(var o=0;o<i.length;++o){var r=i[o]
if(e[r]!==t[r])return!1}return!0}(s,g)})}}return 0<h.length?h:null},o.prototype.setViewFromFile=function(){this.setActiveNavigationTool(),this.impl.setViewFromFile(this.model)},o.prototype.getProperties=function(i,n,o){t.logger.track({name:"get_props_count",aggregate:"count"}),this.model?this.model.getProperties(i,n,o):o&&o(e.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist")},o.prototype.getObjectTree=function(t,i){this.model?this.model.getObjectTree(t,i):i&&i(e.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist")},o.prototype.setCanvasClickBehavior=function(e){if(this.impl.controls.hasOwnProperty("setClickBehavior")&&this.impl.controls.setClickBehavior(e),this.clickHandler&&this.clickHandler.setClickBehavior(e),e&&e.disableMouseWheel&&this.toolController.setMouseWheelInputEnabled(!1),e&&e.disableTwoFingerSwipe){var t=this.toolController.getTool("gestures")
t&&t.disableTwoFingerSwipe()}},o.prototype.search=function(t,i,n,o,r){this.searchText=t,this.model?this.model.search(t,i,n,o,r):n&&n(e.ErrorCodes.BAD_DATA,"Search failed since model does not exist")},o.prototype.getHiddenNodes=function(){return this.impl.visibilityManager.getHiddenNodes()},o.prototype.getIsolatedNodes=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes()},o.prototype.isolate=function(e){if(this.model){var t=this.model.getData()
if(t&&t.is2d&&t.loadDone&&"hasObjectProperties"in t)this.impl.visibilityManager.isolate(e)
else{var i=this
this.model.getObjectTree(function(){i.impl.visibilityManager.isolate(e)})}}},o.prototype.isolateById=function(e){return t.logger.warn("isolateById() is deprecated. Use isolate() instead."),this.isolate(e)},o.prototype.setBackgroundColor=function(e,t,i,n,o,r){this.impl.setClearColors(e,t,i,n,o,r)},o.prototype.toggleSelect=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.toggleSelect is not yet implemented for 2D")
this.impl.selector.toggleSelection(e)},o.prototype.select=function(e){"number"==typeof e&&(e=[e]),this.impl.selector.setSelection(e)},o.prototype.clearSelection=function(){this.impl.selector.clearSelection()},o.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()},o.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()},o.prototype.setSelectionMode=function(e){this.impl.selector.setSelectionMode(e)},o.prototype.getSelection=function(){return this.impl.selector.getSelection()},o.prototype.getAggregateSelection=function(e){var t=this.impl.selector.getAggregateSelection()
if(e)for(var i=0;i<t.length;i++)for(var n=0;n<t[i].selection.length;n++)e(t[i].model,t[i].selection[n])
return t},o.prototype.hide=function(e){t.logger.track({name:"hide",aggregate:"count"}),this.impl.visibilityManager.hide(e)},o.prototype.hideById=function(e){this.hide(e)},o.prototype.show=function(e){this.impl.visibilityManager.show(e)},o.prototype.showAll=function(){this.impl.visibilityManager.isolate(),this.model.is2d()&&this.setLayerVisible(null,!0)},o.prototype.toggleVisibility=function(e){this.impl.visibilityManager.toggleVisibility(e)},o.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)},o.prototype.isNodeVisible=function(e,t){return t=t||this.model,this.impl.isNodeVisible(e,t)},o.prototype.explode=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.explode is not applicable to 2D")
t.logger.track({name:"explode_count",aggregate:"count"}),this.impl.explode(e)},o.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()},o.prototype.setQualityLevel=function(e,i){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setQualityLevel is not applicable to 2D")
this.prefs.set("ambientShadows",e),this.prefs.set("antialiasing",i),this.impl.togglePostProcess(e,i)},o.prototype.setGhosting=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setGhosting is not applicable to 2D")
this.prefs.set("ghosting",e),this.impl.toggleGhosting(e)},o.prototype.setGroundShadow=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setGroundShadow is not applicable to 2D"):this.getMemoryInfo()?void t.logger.warn("Viewer3D.setGroundShadow is not available when memory is limited"):(this.prefs.set("groundShadow",e),void this.impl.toggleGroundShadow(e))},o.prototype.setGroundReflection=function(e){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.setGroundReflection is not applicable to 2D"):this.getMemoryInfo()?void t.logger.warn("Viewer3D.setGroundReflection is not available when memory is limited"):(this.prefs.set("groundReflection",e),void this.impl.toggleGroundReflection(e))},o.prototype.setEnvMapBackground=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setEnvMapBackground is not applicable to 2D")
this.prefs.set("envMapBackground",e),this.impl.toggleEnvMapBackground(e)},o.prototype.setFirstPersonToolPopup=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setFirstPersonToolPopup is not applicable to 2D")
this.prefs.set("firstPersonToolPopup",e)},o.prototype.getFirstPersonToolPopup=function(){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.getFirstPersonToolPopup is not applicable to 2D"):this.prefs.firstPersonToolPopup},o.prototype.setBimWalkToolPopup=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setBimWalkToolPopup is not applicable to 2D")
this.prefs.set("bimWalkToolPopup",e)},o.prototype.setRenderCache=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setRenderCache is not applicable to 2D")
this.impl.toggleVizBuffer(e),this.prefs.set("renderCache",e)},o.prototype.getBimWalkToolPopup=function(){return this.model&&this.model.is2d()?void t.logger.warn("Viewer3D.getBimWalkToolPopup is not applicable to 2D"):this.prefs.bimWalkToolPopup},o.prototype.setProgressiveRendering=function(e){this.prefs.set("progressiveRendering",e),this.impl.toggleProgressive(e)},o.prototype.setSwapBlackAndWhite=function(e){this.prefs.set("swapBlackAndWhite",e),this.impl.toggleSwapBlackAndWhite(e)},o.prototype.setOptimizeNavigation=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setOptimizeNaviation is not applicable to 2D")
this.prefs.set("optimizeNavigation",e),this.impl.setOptimizeNavigation(e)},o.prototype.setNavigationLock=function(t){this.navigation.getIsLocked()!==t&&(this.navigation.setIsLocked(t),this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()}))},o.prototype.getNavigationLock=function(){return this.navigation.getIsLocked()},o.prototype.setNavigationLockSettings=function(t){this.navigation.setLockSettings(t),this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()})},o.prototype.getNavigationLockSettings=function(){return this.navigation.getLockSettings()},o.prototype.setActiveNavigationTool=function(t){if(t===this._pushedTool||!t&&!this._pushedTool)return!0
if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1
this.impl.controls.setToolActiveName(this.getDefaultNavigationToolName()),this._pushedTool=null}return t&&t!==this.getDefaultNavigationToolName()||null!==this._pushedTool?!!this.impl.controls.activateTool(t)&&(this._pushedTool=t,this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this._pushedTool}),!0):(this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getDefaultNavigationToolName()}),!0)},o.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool},o.prototype.setDefaultNavigationTool=function(e){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool),this._pushedTool&&this.impl.controls.deactivateTool(this._pushedTool),this.impl.controls.activateTool(e),this._defaultNavigationTool=e,this._pushedTool&&this.impl.controls.activateTool(this._pushedTool)},o.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool},o.prototype.getFOV=function(){return this.navigation.getVerticalFov()},o.prototype.setFOV=function(e){this.navigation.setVerticalFov(e,!0)},o.prototype.getFocalLength=function(){return this.navigation.getFocalLength()},o.prototype.setFocalLength=function(e){this.navigation.setFocalLength(e,!0)},o.prototype.hideLines=function(t){function i(o){t&&o.model.hideLines(t),n.removeEventListener(e.GEOMETRY_LOADED_EVENT,i)}this.prefs.set("lineRendering",!t)
var n=this
this.impl.hideLines(t)||this.addEventListener(e.GEOMETRY_LOADED_EVENT,i)},o.prototype.hidePoints=function(t){function i(o){t&&o.model.hidePoints(t),n.removeEventListener(e.GEOMETRY_LOADED_EVENT,i)}this.prefs.set("pointRendering",!t)
var n=this
this.impl.hidePoints(t)||this.addEventListener(e.GEOMETRY_LOADED_EVENT,i)},o.prototype.setDisplayEdges=function(e){this.prefs.set("edgeRendering",e),this.impl.setDisplayEdges(e)},o.prototype.applyCamera=function(e,t){this.impl.setViewFromCamera(e,!0),t&&this.fitToView()},o.prototype.fitToView=function(e,t){(t=t||this.model)&&(t.isObjectTreeLoaded()||t.is2d()?this.impl.fitToView(e,t):this.impl.fitToView(null,t))},o.prototype.setClickConfig=function(e,t,i){var n=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior()
if(e in n){var o=n[e]
if(t in o)return o[t]=i,!0}return!1},o.prototype.getClickConfig=function(e,t){var i=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior()
if(e in i){var n=i[e]
if(t in n)return n[t]}return null},o.prototype.setClickToSetCOI=function(e,t){!1!==t&&this.prefs.set("clickToSetCOI",e)
var i=this.getClickConfig("click","onObject")
e?-1===i.indexOf("setCOI")&&this.setClickConfig("click","onObject",["setCOI"]):i.indexOf("setCOI")>=0&&this.setClickConfig("click","onObject",["selectOnly"])},o.prototype.initSettings=function(){this.prefs.load(e.DefaultSettings),this.prefs.tag("3d"),this.prefs.tag("2d"),this.prefs.untag("2d",["viewCube","alwaysUsePivot","zoomTowardsPivot","reverseHorizontalLookDirection","reverseVerticalLookDirection","orbitPastWorldPoles","clickToSetCOI","ghosting","optimizeNavigation","renderCache","ambientShadows","antialiasing","groundShadow","groundReflection","lineRendering","edgeRendering","lightPreset","envMapBackground","firstPersonToolPopup","bimWalkToolPopup"]),this.prefs.untag("3d",["swapBlackAndWhite"]),this.setQualityLevel(this.prefs.ambientShadows,this.prefs.antialiasing),this.setGroundShadow(this.prefs.groundShadow),this.setGroundReflection(this.prefs.groundReflection),this.setGhosting(this.prefs.ghosting),this.setProgressiveRendering(this.prefs.progressiveRendering),this.setSwapBlackAndWhite(this.prefs.swapBlackAndWhite),this.setClickToSetCOI(this.prefs.clickToSetCOI),this.setOptimizeNavigation(this.prefs.optimizeNavigation),this.hideLines(!this.prefs.lineRendering),this.hidePoints(!this.prefs.pointRendering),this.setDisplayEdges(this.prefs.edgeRendering),this.setEnvMapBackground(this.prefs.envMapBackground),this.setFirstPersonToolPopup(this.prefs.firstPersonToolPopup),this.setBimWalkToolPopup(this.prefs.bimWalkToolPopup),this.setRenderCache(this.prefs.renderCache),this.navigation.setUsePivotAlways(this.prefs.alwaysUsePivot),this.navigation.setReverseZoomDirection(this.prefs.reverseMouseZoomDir),this.navigation.setReverseHorizontalLookDirection(this.prefs.reverseHorizontalLookDirection),this.navigation.setReverseVerticalLookDirection(this.prefs.reverseVerticalLookDirection),this.navigation.setZoomTowardsPivot(this.prefs.zoomTowardsPivot),this.navigation.setOrbitPastWorldPoles(this.prefs.orbitPastWorldPoles),this.navigation.setUseLeftHandedInput(this.prefs.leftHandedMouseSetup)
var t=this.prefs.backgroundColorPreset
if(t)try{var i=JSON.parse(t)
this.impl.setClearColors(i[0],i[1],i[2],i[3],i[4],i[5])}catch(e){this.prefs.set("backgroundColorPreset",null)}var n=this.prefs.lightPreset
this.impl.setLightPreset(n)},o.prototype.setLightPreset=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setLightPreset is not applicable to 2D")
this.prefs.set("lightPreset",e),this.impl.setLightPreset(e)},o.prototype.setUsePivotAlways=function(e){this.prefs.set("alwaysUsePivot",e),this.navigation.setUsePivotAlways(e)},o.prototype.setReverseZoomDirection=function(e){this.prefs.set("reverseMouseZoomDir",e),this.navigation.setReverseZoomDirection(e)},o.prototype.setReverseHorizontalLookDirection=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D")
this.prefs.set("reverseHorizontalLookDirection",e),this.navigation.setReverseHorizontalLookDirection(e)},o.prototype.setReverseVerticalLookDirection=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setReverseVerticalLookDirection is not applicable to 2D")
this.prefs.set("reverseVerticalLookDirection",e),this.navigation.setReverseVerticalLookDirection(e)},o.prototype.setZoomTowardsPivot=function(e){this.prefs.set("zoomTowardsPivot",e),this.navigation.setZoomTowardsPivot(e)},o.prototype.setOrbitPastWorldPoles=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setOrbitPastWorldPoles is not applicable to 2D")
this.prefs.set("orbitPastWorldPoles",e),this.navigation.setOrbitPastWorldPoles(e)},o.prototype.setUseLeftHandedInput=function(e){this.prefs.set("leftHandedMouseSetup",e),this.navigation.setUseLeftHandedInput(e)},o.prototype.setLayerVisible=function(i,n,o){function r(e){if(e.isLayer)return[e.index]
if(e.children){for(var t=[],i=e.children,n=0;n<i.length;++n)t=t.concat(r(i[n]))
return t}return[]}if(this.model&&!this.model.is2d())return void t.logger.warn("Viewer3D.setLayerVisible is not yet implemented for 3D")
var s=this.model.getLayersRoot()
if(s&&0!==s.childCount){if(null===i&&(i=[s]),Array.isArray(i)||(i=[i]),o){var a=r(s)
this.impl.setLayerVisible(a,!1),this.impl.visibilityManager.isolate(),n=!0}for(var l=[],c=0;c<i.length;++c){var d=r(i[c])
l=l.concat(d)}this.impl.setLayerVisible(l,n),this.fireEvent({type:e.LAYER_VISIBILITY_CHANGED_EVENT})}},o.prototype.isLayerVisible=function(e){return this.model&&!this.model.is2d()?(t.logger.warn("Viewer3D.isLayerVisible is not yet implemented for 3D"),!1):!!(e&&e.isLayer&&this.impl.isLayerVisible(e.index))},o.prototype.anyLayerHidden=function(){function e(t){if(t.isLayer)return!i.impl.isLayerVisible(t.index)
for(var n=t.children,o=0;o<n.length;++o)if(e(n[o]))return!0
return!1}if(this.model&&!this.model.is2d())return t.logger.warn("Viewer3D.anyLayerHidden is not yet implemented for 3D"),!1
var i=this,n=i.model.getLayersRoot()
return!(!n||!e(n))},o.prototype.setGroundShadowColor=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setGroundShadowColor is not applicable to 2D")
this.impl.setGroundShadowColor(e)},o.prototype.setGroundShadowAlpha=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setGroundShadowAlpha is not applicable to 2D")
this.impl.setGroundShadowAlpha(e)},o.prototype.setGroundReflectionColor=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setGroundReflectionColor is not applicable to 2D")
this.impl.setGroundReflectionColor(e)},o.prototype.setGroundReflectionAlpha=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.setGroundReflectionAlpha is not applicable to 2D")
this.impl.setGroundReflectionAlpha(e)},o.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()},o.prototype.setCutPlanes=function(e){if(this.model&&this.model.is2d())return void t.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D")
this.impl.setCutPlanes(e)},o.prototype.getScreenShot=function(e,t,i){return this.impl.getScreenShot(e,t,i)},o.prototype.getScreenShotBuffer=function(e,t,i){return this.impl.getScreenShotBuffer(e,t,i)},o.prototype.setContextMenu=function(e){this.contextMenu&&this.contextMenu.hide(),this.contextMenu=e||null},o.prototype.setDefaultContextMenu=function(){var e=Autodesk.Viewing.Extensions
return!(!e||!e.ViewerObjectContextMenu)&&(this.setContextMenu(new e.ViewerObjectContextMenu(this)),!0)},o.prototype.triggerContextMenu=function(e){return this.config&&this.config.onTriggerContextMenuCallback&&this.config.onTriggerContextMenuCallback(e),!!this.contextMenu&&(this.contextMenu.show(e),!0)},o.prototype.triggerSelectionChanged=function(e){this.config&&this.config.onTriggerSelectionChangedCallback&&this.config.onTriggerSelectionChangedCallback(e)},o.prototype.triggerDoubleTapCallback=function(e){this.config&&this.config.onTriggerDoubleTapCallback&&this.config.onTriggerDoubleTapCallback(e)},o.prototype.triggerSingleTapCallback=function(e){this.config&&this.config.onTriggerSingleTapCallback&&this.config.onTriggerSingleTapCallback(e)},o.prototype.initContextMenu=function(){function e(e){var i=e.button
return"buttons"in e&&(!t.__firefoxLMBfix||1&e.buttons?2===i&&1&e.buttons&&(i=0,t.__firefoxLMBfix=!0):(t.__firefoxLMBfix=!1,i=0)),i===(!!t.navigation&&t.navigation.getUseLeftHandedInput()?0:2)}(!this.config||!this.config.hasOwnProperty("disableBrowserContextMenu")||this.config.disableBrowserContextMenu)&&(this.onDefaultContextMenu=function(e){e.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1))
var t=this,i=this.canvas||this.container
i.addEventListener("mousedown",function(i){e(i)&&(t.startX=i.clientX,t.startY=i.clientY)}),i.addEventListener("mouseup",function(i){return e(i)&&i.clientX===t.startX&&i.clientY===t.startY&&t.triggerContextMenu(i),!0},!1)},o.prototype.registerContextMenuCallback=function(e,t){this.contextMenuCallbacks[e]=t},o.prototype.unregisterContextMenuCallback=function(e){return e in this.contextMenuCallbacks&&(delete this.contextMenuCallbacks[e],!0)},o.prototype.runContextMenuCallbacks=function(e,t){for(var i in this.contextMenuCallbacks)this.contextMenuCallbacks.hasOwnProperty(i)&&this.contextMenuCallbacks[i](e,t)},o.prototype.playAnimation=function(e){var t=this.impl.keyFrameAnimator
t&&t.play(0,e)},o.prototype.joinLiveReview=function(e){this.liveReviewClient||(this.liveReviewClient=new t.LiveReviewClient(this))
var i=this.liveReviewClient
t.loadDependency("lmv_io","socket.io-1.3.5.js",function(){i.joinLiveReviewSession(e)})},o.prototype.leaveLiveReview=function(){this.liveReviewClient&&this.liveReviewClient.leaveLiveReviewSession()},o.prototype.setModelUnits=function(e){this.model&&(this.model.getData().overriddenUnits=e)},o.prototype.worldToClient=function(e){return this.impl.worldToClient(e)},o.prototype.clientToWorld=function(e,t,i){return this.impl.clientToWorld(e,t,i)},o.prototype.modelHasTopology=function(){return!(!this.model||!this.model.hasTopology())},o.prototype.setSelectionColor=function(e){this.impl.setSelectionColor(e)},o.prototype.createViewCube=function(){this.viewCubeUi||(this.viewCubeUi=new t.ViewCubeUi(this),this.viewCubeUi.create())},o.prototype.displayViewCube=function(e){this.viewCubeUi&&this.viewCubeUi.displayViewCube(e,!1)},o.prototype.displayViewCubeUI=function(e){this.viewCubeUi&&this.viewCubeUi.setVisible(e)},o.prototype.setViewCube=function(e){this.viewCubeUi&&this.viewCubeUi.cube&&this.viewCubeUi.cube.cubeRotateTo(e)},o.prototype.setThemingColor=function(e,t,i){i=i||this.model,i.setThemingColor(e,t),this.impl.invalidate(!0)},o.prototype.clearThemingColors=function(e){e=e||this.model,e.clearThemingColors(),this.impl.invalidate(!0)},o.prototype.transferModel=function(e,t){var i=this.impl.findModel(e)
if(i){var n=[]
this.getAggregateSelection(function(t,i){t.id==e&&n.push(i)})
var o=this.impl.visibilityManager.getIsolatedNodes(i),r=this.impl.visibilityManager.getHiddenNodes(i),s=this.impl.matman().exportModelMaterials(i)
this.impl.removeModel(i),t.model=i,t.impl.addModel(i),t.impl.matman().importModelMaterials(s),t.loadSpinner&&(t.loadSpinner.style.display="None"),i.loader&&i.loader.viewer3DImpl===this.impl&&(i.loader.viewer3DImpl=t.impl),i.getData().loadDone&&t.impl.onLoadComplete(i),t.impl.selector.setSelection(n,i),0!=o.length?t.impl.visibilityManager.isolate(o,i):0!=r.length&&t.impl.visibilityManager.hide(r,i)}},o.prototype.hideModel=function(e){var t=this.impl.modelQueue(),i=t.hideModel(e),n=this.impl.model
return i&&n&&n.id===e&&(this.impl.model=null,t.isEmpty()||(this.impl.model=t.getModels()[0]),this.model=this.impl.model),this.impl.invalidate(!0,!0,!0),i},o.prototype.showModel=function(e){var t=this.impl.modelQueue(),i=t.showModel(e)
return i&&!this.model&&(this.impl.model=t.getModels()[0],this.model=this.impl.model),this.impl.invalidate(!0,!0,!0),i},o.prototype.getHiddenModels=function(){return this.impl.modelQueue().getHiddenModels()},o.prototype.getMemoryInfo=function(){var e=this.impl.modelQueue()
return e?e.getMemoryInfo():null},o.prototype.onResetEvent=function(){var e=this.model
this.impl.setupLighting(e),e.isAEC()&&e.is3d()&&this.impl.setLightPresetForAec()},Autodesk.Viewing.Viewer3D=o}()
var av=Autodesk.Viewing
av.ErrorCodes={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,BAD_DATA_MODEL_IS_EMPTY:11,RTC_ERROR:12,UNSUPORTED_FILE_EXTENSION:13,VIEWER_INTERNAL_ERROR:14},av.errorCodeString=function(e){return"ErrorCode:"+e+"."},function(){"use strict"
function e(e,o,r){if(e.urlPattern=r.urn,e.tileSize=r.tileSize?r.tileSize:512,e.texWidth=r.resolution[0],e.texHeight=r.resolution[1],e.paperWidth=r.paperWidth,e.paperHeight=r.paperHeight,e.paperUnits=r.paperUnits,e.levelOffset=i.LeafletLoader.computeLevelOffset(e.tileSize),i.offline&&t.isMobileDevice()){var s=n.getSubItemsWithProperties(o,{role:"leaflet-zip"},!1)
s.length>0&&(e.maxLevel=s[0].max_level-e.levelOffset)}}var t=Autodesk.Viewing,i=Autodesk.Viewing.Private,n=function(e,n,o){function r(e){if(e){var t,n=e.children||e.derivatives,o=n?n.length:0
if("geometry"===e.type&&o){var s=0
for(t=0;t<o;t++){var l=n[t]
l&&"view"===l.type&&(a.myViewGeometry[l.guid]=e,s++)}a.myNumViews[e.guid]=s}else if("application/autodesk-db"==e.mime&&e.urn)0===e.urn.indexOf(i.ViewingService.OSS_PREFIX)?a.myPropertyDb=e.urn.substr(0,e.urn.lastIndexOf("%2F")+3):a.myPropertyDb=e.urn.substr(0,e.urn.lastIndexOf("/")+1)
else if(0<o)for(t=0;t<o;t++)r(n[t])}}function s(e){if(e)for(var t=e.children||e.derivatives,i=t?t.length:0,n=0;n<i;n++)t[n].parent=e,s(t[n])}this.myPath=n,this.myData=e,e&&(this.docRoot=new t.BubbleNode(e)),this.myViewGeometry={},this.myNumViews={},this.myPropertyDb=null,this.acmSessionId=o
var a=this
r(e),s(this.myData)}
n.prototype.constructor=n,n.load=function(e,o,r,s){function a(e){var t=n.getViewableItems(e),i=t[0]
return n.getSubItemsWithProperties(i,{type:"geometry"},!0).length}function l(e,t){var i=[],n=0,o=0
t=t||"children"
var r=function(e){var s=e[t]||[],a=e.messages||[]
a.filter(function(e){return"error"===e.type}).length>0&&(n+=1),"inprogress"===e.status&&(o+=1),Array.prototype.push.apply(i,a.slice(0))
for(var l=s.length;l--;r(s[l]));}
r(e)
var s="translated"
s=n>0?"failed":s,s=o>0?"processing":s
for(var a=i.length;a--;i[a].$translation=s);return i}function c(s){function c(e){if(/<[^>]*script/.test(e))return void(r&&r(t.ErrorCodes.BAD_DATA,"Malicious document content detected Abort loading"))
var i="string"==typeof e?JSON.parse(e):e,c=new n(i,h,s)
if(a(c)>0)u=l(c.getRootItem()),o&&o(c,u)
else if(r){u=l(c.getRootItem())
var d=t.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT
r(d,"No viewable content",u)}}function d(e,i,n){var o=l(n)
if(r){var s="Error: "+e+" ("+i+")",a=t.Private.ErrorHandler.getErrorCode(e)
r(a,s,e,i,o)}}var u,h=n.getDocumentPath(e),p={queryParams:s?"acmsession="+s:""}
i.ViewingService.getManifest(i.initLoadContext(p),h,c,d)}"function"!=typeof arguments[1]&&(i.logger.warn("Document.load called with deprecated (auth) parameter"),"function"==typeof arguments[2]&&(o=arguments[2]),"function"==typeof arguments[3]&&(r=arguments[3])),s?i.ViewingService.getACMSession(t.getApiEndpoint(),s,c,r):c()},n.getDocumentPath=function(e){if(-1===e.indexOf("urn:")){if(-1!==e.indexOf("://"))return e
var t=e
return"undefined"!=typeof window?(0!==t.indexOf("/")&&(t="/"+t),window.location.protocol+"//"+window.location.host+t):t}return e},n.requestThumbnailWithSecurity=function(e,t){var n=function(e){t(null,e)},o=function(){t("error",null)},r={responseType:"blob",skipAssetCallback:!0,size:e.width,guid:e.guid},s="urn:"+e.urn
i.ViewingService.getThumbnail(i.initLoadContext(),s,n,o,r)},n.prototype.getFullPath=function(e){if(!e)return e
var n=e
if(i.offline){if(-1==n.indexOf(t.Private.offlineResourcePrefix)){var o=n.indexOf(t.Private.ViewingService.OSS_PREFIX)
if(-1!==o){var r=n.substr(n.indexOf("/")+1),s=decodeURIComponent(r),a=s.substr(s.indexOf("/"))
n=decodeURIComponent(t.Private.offlineResourcePrefix)+a}else n=decodeURIComponent(t.Private.offlineResourcePrefix)+n.substr(n.indexOf("/"))}}else 0===e.indexOf("urn")?n=t.getItemApi(null,e):0===e.indexOf("$file$")&&(n=this.myPath.replace("/bubble.json","")+e.replace("$file$",""))
return n},n.prototype.getThumbnailOptions=function(e,t,i){var n=t||200,o=i||200
return{urn:this.myData.urn,width:n,height:o,guid:e.guid,acmsession:this.acmSessionId}},n.prototype.getThumbnailPath=function(e,i,n){var o=this.getThumbnailOptions(e,i,n),r=t.getThumbnailApi(null,o.urn)+"?guid="+o.guid+"&width="+o.width+"&height="+o.height
return o.acmsession&&(r+="&acmsession="+o.acmsession),r},n.prototype.getViewablePath=function(t,i){if("geometry"===t.type){var o=[]
if("3d"===t.role?o=n.getSubItemsWithProperties(t,{mime:"application/autodesk-svf"},!1):"2d"===t.role&&(o=n.getSubItemsWithProperties(t,{role:"leaflet"},!1),o.length>0&&i&&e(i,t,o[0]),0===o.length&&(o=n.getSubItemsWithProperties(t,{role:"image"},!1)),0===o.length&&(o=n.getSubItemsWithProperties(t,{mime:"application/autodesk-f2d"},!1)),0===o.length&&(o=n.getSubItemsWithProperties(t,{role:"tileRoot"},!0))),o.length>0)return this.getFullPath(o[0].urn)}else if("view"===t.type){var r=this.getViewGeometry(t)
if(r)return this.getViewablePath(r)}return""},n.prototype.getPropertyDbPath=function(){return this.getFullPath(this.myPropertyDb)},n.prototype.getRootItem=function(){return this.myData},n.prototype.getRoot=function(){return this.docRoot},n.prototype.getPath=function(){return this.myPath},n.prototype.getItemById=function(e){function t(i){if(!i)return null
for(var n in i){var o=i[n]
if("guid"===n&&o===e)return i
if(null!==o&&"object"==typeof o&&"parent"!==n){var r=t(o)
if(r)return r}}return null}return t(this.myData)},n.getSubItemsWithProperties=function(e,t,i){var o=[]
if(!e)return[]
for(var r=e.children||e.derivatives,s=r?r.length:0,a=0;a<s;a++){var l=r[a];(function(e,t){for(var i in t)if(!(i in e)||t[i]!==e[i])return!1
return!0})(l,t)&&o.push(l),i&&o.push.apply(o,n.getSubItemsWithProperties(l,t,i))}return o},n.getViewableItems=function(e){return n.getSubItemsWithProperties(e.getRootItem(),{type:"folder",role:"viewable"},!0).concat(n.getSubItemsWithProperties(e.getRootItem(),{outputType:"svf"},!0))},n.prototype.getViewGeometry=function(e){return this.myViewGeometry[e.guid]},n.prototype.getNumViews=function(e){return this.myNumViews[e.guid]||0},n.prototype.getParentId=function(e){var t=this.getItemById(e)
if(!t)return null
var i=t.parent
return i?i.guid:null},n.prototype.getMessages=function(e,t){var i=[]
if(!e)return i
var n=null
t&&(n=this.getRootItem())
for(var o=e;o&&(!t||parent!==n);){if(o.messages)for(var r=0;r<o.messages.length;r++)i.push(o.messages[r])
o=o.parent}return i},t.Document=n}(),function(){"use strict"
function e(e){this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1},this.__lockSettings={orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1},this.FIT_TO_VIEW_VERTICAL_MARGIN=.05,this.FIT_TO_VIEW_VERTICAL_OFFSET=0,this.FIT_TO_VIEW_HORIZONTAL_MARGIN=.05,this.FIT_TO_VIEW_HORIZONTAL_OFFSET=0,this.__pivotIsSetFlag=!1,this.__fitToViewRequested=!1,this.__homeViewRequested=!1,this.__transitionActive=!1,this.__destinationView=null,this.__is2D=!1,this.__isTouchDevice=!1,this.__kEpsilon=1e-6,this.__minDistance=1e-5
var t=void 0,i=void 0,n=null,o={left:0,top:0,width:1,height:1}
this.uninitialize=function(){this.setCamera(null)},this.setCamera=function(e){e!==n&&(n=e,e&&(e.hasOwnProperty("target")||(e.target=new THREE.Vector3(0,0,0)),e.hasOwnProperty("pivot")||(e.pivot=new THREE.Vector3(0,0,0)),e.worldup=e.up.clone(),e.dirty=!0))},this.getCamera=function(){return n},this.setScreenViewport=function(e){o=e},this.getScreenViewport=function(){return o},this.__setUp=function(e){if(e&&n){if(0!==e.clone().normalize().sub(n.worldup).lengthSq())return n.worldup.copy(e).normalize(),n.dirty=!0,!0}return!1},this.__getUp=function(){return n?n.worldup:new THREE.Vector3(0,1,0)},this.setView=function(e,t){n&&e&&t&&(n.position.copy(e),n.target.copy(t),n.dirty=!0)},this.orientCameraUp=function(){n&&this.isActionEnabled("roll")&&(n.up.copy(this.getAlignedUpVector()),n.dirty=!0)},this.getPivotPoint=function(){return n?n.pivot.clone():new THREE.Vector3(0,0,0)},this.setPivotPoint=function(e){n&&e&&(n.pivot.copy(e),n.dirty=!0)},this.getPosition=function(){return n?n.position.clone():new THREE.Vector3(0,0,1)},this.setPosition=function(e){n&&e&&(n.position.copy(e),n.dirty=!0)},this.setTarget=function(e){n&&e&&(n.target.copy(e),n.dirty=!0)},this.getTarget=function(){return n?n.target.clone():new THREE.Vector3(0,0,0)},this.getEyeVector=function(){return n?n.target.clone().sub(n.position):new THREE.Vector3(0,0,-1)},this.getEyeToCenterOfBoundsVec=function(e){return n?e.center().sub(n.position):new THREE.Vector3(0,0,-1)},this.getFovMin=function(){return 6.88},this.getFovMax=function(){return 100},this.isPointVisible=function(e){return(new THREE.Frustum).setFromMatrix(n.projectionMatrix.clone().multiply(n.matrixWorldInverse)).containsPoint(e)},this.setVerticalFov=function(e,t){if((!n||n.isPerspective)&&(e<6.88?e=6.88:e>100&&(e=100),n&&this.isActionEnabled("fov"))){if(Math.abs(n.fov-e)<=1e-6)return
if(t){var i=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),o=this.getPosition(),r=this.getEyeVector(),s=THREE.Math.degToRad(n.fov),a=THREE.Math.degToRad(e),l=i?this.getPivotPlaneDistance():r.length(),c=l*Math.tan(.5*s)/Math.tan(.5*a),d=r.normalize().multiplyScalar(l-c)
this.setPosition(o.add(d)),i&&this.setTarget(this.getTarget().add(d))}n.setFov(e),n.dirty=!0}},this.computeFit=function(t,i,n,o,r){if(!o||o.empty())return{position:t,target:i}
r=void 0===r?1:r
for(var s=o.center(),a=o.size(),l=t.clone().sub(i).normalize(),c=Math.tan(THREE.Math.degToRad(.5*n)),d=0,u=this.computeOrthogonalUp(t,i),h=l.clone().cross(u).normalize(),p=new THREE.Vector3,m=0===a.z?4:8,g=0;g<m;g++){p.set(0==(1&g)?-.5*a.x:.5*a.x,0==(2&g)?-.5*a.y:.5*a.y,0==(4&g)?-.5*a.z:.5*a.z)
var f=0
e.isPerspective&&(f=p.dot(l))
var v=Math.abs(p.dot(u)),E=Math.abs(p.dot(h)),y=f+(1+2*this.FIT_TO_VIEW_VERTICAL_MARGIN/(1-2*this.FIT_TO_VIEW_VERTICAL_MARGIN))*v/c
d<y&&(d=y),y=f+(1+2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN/(1-2*this.FIT_TO_VIEW_HORIZONTAL_MARGIN))*E/(r*c),d<y&&(d=y)}return s.add(u.multiplyScalar(-d*this.FIT_TO_VIEW_VERTICAL_OFFSET)),s.add(h.multiplyScalar(d*this.FIT_TO_VIEW_HORIZONTAL_OFFSET)),l.multiplyScalar(d),{position:s.clone().add(l),target:s}},this.computeOrthogonalUp=function(e,t){var i=this.__getUp(),n=t.clone().sub(e)
if(0===n.lengthSq())return n.copy(i)
var o=n.clone().cross(i)
return 0===o.lengthSq()&&(i.z>i.y?n.y-=1e-4:n.z-=1e-4,o.crossVectors(n,i)),o.cross(n).normalize()},this.fitBounds=function(e,t,i){var o=this.getTarget(),r=this.getPosition()
if(!this.isActionEnabled("gotoview")||!t||t.empty())return{position:r,target:o}
var s=this.getVerticalFov(),a=this.computeFit(r,o,s,t,n.aspect),l=i?this.computeOrthogonalUp(r,o):n.up
return e?(n.up.copy(l),this.setView(a.position,a.target)):this.setRequestTransitionWithUp(!0,a.position,a.target,s,l),this.setPivotPoint(a.target),this.setPivotSetFlag(!0),a},this.computeOverviewDistance=function(e){if(this.__is2D){var t=e.size(),i=n.aspect,o=t.x/i,r=t.y
return Math.max(o,r)}var s=this.getVerticalFov(),t=e.size(),a=t.length()
return 0===a&&(a=2),n.isPerspective?.5*a/Math.tan(THREE.Math.degToRad(.5*s)):a},this.applyDollyConstraint=function(e,o){var r=e
if((t||o)&&e>1){var s,a=n.isPerspective?this.getEyeToCenterOfBoundsVec(o):this.getEyeVector()
s=t?2*this.computeOverviewDistance(t):2*this.computeOverviewDistance(o)
var l=Math.abs(s/a.length())
l=Math.max(l,1),r=Math.min(r,l)}if((i||o)&&this.__is2D){var c
c=i?n.clientHeight/i:this.computeOverviewDistance(o)/200
var a=this.getEyeVector(),d=c/-a.z
d=Math.min(d,1),r=Math.max(r,d)}return r},this.applyPanningConstraint2D=function(e){if(this.__is2D&&t){var i=n.position.x+e.x,o=n.position.y+e.y
i=THREE.Math.clamp(i,t.min.x,t.max.x),o=THREE.Math.clamp(o,t.min.y,t.max.y)
var r=i-n.position.x,s=o-n.position.y,a=Math.min(e.x,0),l=Math.min(e.y,0),c=Math.max(e.x,0),d=Math.max(e.y,0)
r=THREE.Math.clamp(r,a,c),s=THREE.Math.clamp(s,l,d),e.x=r,e.y=s}},this.updateCamera=function(){n&&(n.updateProjectionMatrix(),this.orient(n,n.target,n.position,n.up),n.dirty=!1)},this.setCamera(e),this.setConstraints2D=function(e,n){t=e,i=n}}var t=Autodesk.Viewing,i=t.Private
e.prototype.constructor=e,e.prototype.setIs2D=function(e){this.__is2D=!!e},e.prototype.getIs2D=function(){return this.__is2D},e.prototype.setIsTouchDevice=function(e){this.__isTouchDevice=!!e},e.prototype.getIsTouchDevice=function(){return this.__isTouchDevice},e.prototype.orient=function(){function e(){t||(t=new THREE.Matrix4,i=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3)}var t,i,n,o
return function(r,s,a,l){e()
var c=t.elements
o.subVectors(a,s).normalize(),0===o.lengthSq()&&(o.z=1),i.crossVectors(l,o).normalize(),0===i.lengthSq()&&(l.z>l.y?o.y-=1e-4:o.z+=1e-4,i.crossVectors(l,o).normalize()),n.crossVectors(o,i),c[0]=i.x,c[4]=n.x,c[8]=o.x,c[1]=i.y,c[5]=n.y,c[9]=o.y,c[2]=i.z,c[6]=n.z,c[10]=o.z,r.setRotationFromMatrix(t)}}(),e.prototype.fov2fl=function(e){var t=THREE.Math.degToRad(e)
return t<=0&&(t=1e-4),Math.round(12/Math.tan(.5*t))},e.prototype.fl2fov=function(e){e<=0&&(e=1e-4)
var t=2*Math.atan(12/e)
return THREE.Math.radToDeg(t)},e.prototype.setCameraUpVector=function(e){if(this.isActionEnabled("roll")){var t=this.getCamera()
t.up.copy(e),t.dirty=!0}},e.prototype.getCameraUpVector=function(){var e=this.getCameraRightVector(!1),t=this.getEyeVector()
return e.cross(t).normalize()},e.prototype.getAlignedUpVector=function(){var e=this.getCameraRightVector(!0),t=this.getEyeVector()
return e.cross(t).normalize()},e.prototype.getCameraRightVector=function(e){var t=new THREE.Vector3,i=e?this.getWorldUpVector():this.getCamera().up,n=this.getEyeVector()
return t.crossVectors(n,i),0===t.lengthSq()&&(Math.abs(n.z)>=Math.abs(n.y)?i.set(0,1,0):i.set(0,0,1),t.crossVectors(n,i)),t.normalize()},e.prototype.setWorldUpVector=function(e,t){this.isActionEnabled("roll")&&(this.__setUp(e),t&&this.orientCameraUp())},e.prototype.getWorldUpVector=function(){return this.__getUp().clone()},e.prototype.getWorldRightVector=function(){var e=new THREE.Vector3
return e.copy(this.__getUp()),Math.abs(e.z)<=Math.abs(e.y)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},e.prototype.getVerticalFov=function(){return this.getCamera().fov},e.prototype.getHorizontalFov=function(){var e=this.getScreenViewport()
return this.getCamera().fov*(e.width/e.height)},e.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())},e.prototype.setFocalLength=function(e,t){this.setVerticalFov(this.fl2fov(e),t)},e.prototype.setReverseZoomDirection=function(e){this.__options.reverseDolly=!!e},e.prototype.setReverseHorizontalLookDirection=function(e){if(this.getIs2D())return void i.logger.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D")
this.__options.reverseHorizontalLookDirection=!!e},e.prototype.setReverseVerticalLookDirection=function(e){if(this.getIs2D())return void i.logger.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D")
this.__options.reverseVerticalLookDirection=!!e},e.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly},e.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection},e.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection},e.prototype.setZoomTowardsPivot=function(e){this.__options.dollyToPivot=!!e},e.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot},e.prototype.setOrbitPastWorldPoles=function(e){if(this.getIs2D())return void i.logger.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D")
this.__options.orbitPastPoles=!!e},e.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles},e.prototype.setUsePivotAlways=function(e){this.__options.usePivotAlways=!!e},e.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways},e.prototype.setUseLeftHandedInput=function(e){this.__options.useLeftHandedInput=!!e},e.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput},e.prototype.setIsLocked=function(e){this.__options.lockNavigation=!!e},e.prototype.getIsLocked=function(){return this.__options.lockNavigation},e.prototype.setLockSettings=function(e){for(var t in this.__lockSettings)e.hasOwnProperty(t)&&(this.__lockSettings[t]=e[t])},e.prototype.getLockSettings=function(){var e={}
for(var t in this.__lockSettings)e[t]=this.__lockSettings[t]
return e},e.prototype.isActionEnabled=function(e){return!this.__options.lockNavigation||!0===this.__lockSettings[e]},e.prototype.setPivotSetFlag=function(e){this.__pivotIsSetFlag=!!e},e.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag},e.prototype.setRequestFitToView=function(e){this.isActionEnabled("gotoview")&&(this.__fitToViewRequested=!!e)},e.prototype.getRequestFitToView=function(){return this.__fitToViewRequested},e.prototype.setRequestHomeView=function(e){this.isActionEnabled("gotoview")&&(this.__homeViewRequested=!!e)},e.prototype.getRequestHomeView=function(){return this.__homeViewRequested},e.prototype.setRequestTransition=function(e,t,i,n,o,r){this.__destinationView=e?{position:t.clone(),coi:i.clone(),fov:n,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:o,pivot:r?r.clone():i.clone()}:null},e.prototype.setRequestTransitionWithUp=function(e,t,i,n,o,r,s){this.__destinationView=e?{position:t.clone(),coi:i.clone(),fov:n,up:o.clone(),worldUp:r||this.getWorldUpVector(),reorient:!1,pivot:s?s.clone():i.clone()}:null},e.prototype.getRequestTransition=function(){return this.__destinationView},e.prototype.setTransitionActive=function(e){this.__transitionActive=!!e},e.prototype.getTransitionActive=function(){return this.__transitionActive},e.prototype.getWorldSize=function(e){var t=this.getScreenViewport(),i=t.width/t.height,n=2*e*Math.tan(THREE.Math.degToRad(.5*this.getCamera().fov)),o=n*i
return new THREE.Vector2(o,n)},e.prototype.getWorldPoint=function(e,t){t=1-t,e=2*e-1,t=2*t-1
var i,n=this.getCamera()
n.isPerspective&&(i=new THREE.Vector3(e,t,1),i=i.unproject(n))
var o,r,s=this.getEyeVector(),a=this.getPosition()
if(!n.isPerspective||isNaN(i.x)){var l=this.getWorldSize(s.length()),c=this.getCameraRightVector(!1).multiplyScalar(.5*e*l.x),d=this.getCameraUpVector().multiplyScalar(.5*t*l.y)
o=s.clone().add(c).add(d).normalize()}else o=i.sub(a).normalize()
var u=this.getPivotPoint(),h=o.dot(s)
return r=this.__pivotIsSetFlag&&(this.getIs2D()||n.isPerspective&&h>0)?0!==h?Math.abs(u.sub(a).dot(s))/h:u.sub(a).length():n.isPerspective?.5*(n.near+n.far):n.orthoScale,o.multiplyScalar(r).add(a)},e.prototype.getPivotPlaneDistance=function(){var e=this.getPivotPoint(),t=this.getEyeVector(),i=this.getPosition()
return e.sub(i).dot(t.normalize())},e.prototype.panRelative=function(e,t,i){if(this.isActionEnabled("pan")){var n=this.getWorldSize(i),o=e*n.x,r=t*n.y,s=this.getCameraRightVector(!1).multiplyScalar(o),a=this.getCameraUpVector().multiplyScalar(r),l=s.add(a)
this.applyPanningConstraint2D(l),this.setView(this.getPosition().add(l),this.getTarget().add(l))}},e.prototype.dollyFromPoint=function(e,t,i){if(this.isActionEnabled("zoom")&&!(Math.abs(e)<=this.__kEpsilon)){var n=this.getPosition(),o=t.clone().sub(n),r=this.getEyeVector()
if(!this.getCamera().isPerspective){var s=r.lengthSq(),a=r.dot(o)
if(0==a)return
o.multiplyScalar(s/a),t=n.clone().add(o)}var l=o.length(),c=l+e
c<this.__minDistance&&(c=this.__minDistance)
var d=c/l
if(d=this.applyDollyConstraint(d,i),Math.abs(d-1)>this.__kEpsilon){o.multiplyScalar(d),o.set(-o.x,-o.y,-o.z)
var u=o.add(t),r=this.getEyeVector()
this.getCamera().isPerspective||r.multiplyScalar(d),this.setView(u,r.add(u))}}},e.prototype.toPerspective=function(){if(this.getIs2D())return void i.logger.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D")
var e=this.getCamera()
e.isPerspective||(e.toPerspective(),e.dirty=!0)},e.prototype.toOrthographic=function(){var e=this.getCamera()
e.isPerspective&&(e.toOrthographic(),e.dirty=!0)},e.snapToAxis=function(e){var t=new THREE.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z))
return t.x>t.y&&t.x>t.z?e.set(e.x>0?1:-1,0,0):t.y>t.x&&t.y>t.z?e.set(0,e.y>0?1:-1,0):e.set(0,0,e.z>0?1:-1),e},Autodesk.Viewing.Navigation=e}(),function(){"use strict"
function e(e,t){for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],o=Array.isArray(n),r=e[i],s=Array.isArray(r)
o&&s?(n?o||(n=[n]):n=[],r?s||(r=[r]):r=[],e[i]=r.concat(n)):e[i]=n}}var t=Autodesk.Viewing,i=Autodesk.Viewing.Private,n=function(e,t){this.appContainerId=e,this.container=document.getElementById(e),this.options=t||{},this.myRegisteredViewers={},this.myDocument=null,this.myCurrentViewer=null,this.urn=null,this.selectedItem=null,this.bubble=null,this.extensionCache={}
var i=this
this.onHyperlinkHit=function(e){var t=e.data.href,n=i.bubble.search({viewableID:t})
if(n&&n.length>0)i.selectItem(n[0].data)
else{var o=new RegExp(/^https?:\/\//)
t.match(o)||(t="http://"+t),window.open(t)}},this.onLoadGeometry=function(e){var t=e.data
i.selectItem(t.item,t.onSuccessCb,t.onErrorCb)}}
n.prototype.k3D="3D",n.prototype.finish=function(){this.myCurrentViewer&&(this.myCurrentViewer.finish(),this.myCurrentViewer=null)},n.prototype.registerViewer=function(e,n,o){if(e!==this.k3D)return void i.logger.error("The only acceptable viewer type is k3D.",t.errorCodeString(t.ErrorCodes.VIEWER_INTERNAL_ERROR))
o=o||{},this.options&&this.options.hasOwnProperty("disableBrowserContextMenu")&&(o.hasOwnProperty("disableBrowserContextMenu")||(o.disableBrowserContextMenu=this.options.disableBrowserContextMenu)),this.myRegisteredViewers[e]={},this.myRegisteredViewers[e].class=n,this.myRegisteredViewers[e].config=o},n.prototype.getViewerClass=function(e){return this.myRegisteredViewers.hasOwnProperty(e)?this.myRegisteredViewers[e].class:null},n.prototype.getViewerContainer=function(){return document.getElementById(this.appContainerId)},n.prototype.getViewer=function(t){var i=this.myRegisteredViewers[this.k3D]
if(!i)return null
var n={}
e(n,i.config),e(n,t)
var o=i.class
if(this.myCurrentViewer&&this.myCurrentViewer.__proto__.constructor===o)return this.myCurrentViewer.tearDown(),this.myCurrentViewer.setUp(n),this.myCurrentViewer
this.setCurrentViewer(null)
for(var r=this.getViewerContainer();r.hasChildNodes();)r.removeChild(r.lastChild)
var s=new o(r,n)
return this.setCurrentViewer(s),s},n.prototype.setCurrentViewer=function(e){this.myCurrentViewer&&(this.myCurrentViewer.removeEventListener(t.HYPERLINK_EVENT,this.onHyperlinkHit),this.myCurrentViewer.removeEventListener(t.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),this.myCurrentViewer.finish()),this.myCurrentViewer=e,this.myCurrentViewer&&(e.addEventListener(t.HYPERLINK_EVENT,this.onHyperlinkHit),e.addEventListener(t.LOAD_GEOMETRY_EVENT,this.onLoadGeometry),e.extensionCache=this.extensionCache)},n.prototype.getCurrentViewer=function(){return this.myCurrentViewer},n.prototype.setDocument=function(e){if(!e.urn||"$file$"===e.urn)return i.logger.error("Unsupported Manifest urn: "+e.urn),!1
var n=t.Document.getDocumentPath(e.urn)
return this.myDocument=new t.Document(e,n),this.bubble=this.myDocument.getRoot(),this.onDocumentLoaded(this.myDocument),!0},n.prototype.loadDocument=function(e,n,o,r){var s=this
i.logger.track({category:"load_document",urn:0==e.indexOf("urn:")?e.substring(4):e}),t.Document.load(e,function(e,t){s.myDocument=e,s.bubble=e.getRoot(),s.onDocumentLoaded(e,t),n&&n(e,t)},function(e,t,i,n,r){s.onDocumentFailedToLoad(e,t,r),o&&o(e,t,i,n,r)},r)},n.prototype.onDocumentLoaded=function(e,t){i.logger.log(e,t)},n.prototype.onDocumentFailedToLoad=function(e,n,o){i.logger.error(t.errorCodeString(e),n,o)},n.prototype.getDefaultGeometry=function(e){for(var t=0,i=e.length;t<i;++t){var n=e[t].useAsDefault
if(!0===n||"true"===n)return e[t]}return e[0]},n.prototype.selectItem=function(e,t,n){var o={}
e instanceof Autodesk.Viewing.BubbleNode&&(e=e.data)
var r=this.myDocument.getViewablePath(e,o)
if(r||"view"!==e.type||(r=this.urn),!r)return!1
var s,a,l,c=!1
if("geometry"===e.type&&"3d"===e.role)c=!0,a=e.name,l=e
else if("view"===e.type&&"3d"===e.role)s=e,c=!0,(l=this.myDocument.getViewGeometry(e))&&(a=l.name)
else if("geometry"===e.type&&"2d"===e.role){var d=Autodesk.Viewing.Document.getSubItemsWithProperties(e,{mime:"application/autodesk-f2d"},!1),u=Autodesk.Viewing.Document.getSubItemsWithProperties(e,{role:"leaflet"},!1),h=Autodesk.Viewing.Document.getSubItemsWithProperties(e,{role:"image"},!1);(d.length>0||u.length>0||h.length>0)&&(c=!0),a=e.name,l=e}else"view"===e.type&&"2d"===e.role&&(s=e,c=!0,(l=this.myDocument.getViewGeometry(e))&&(a=l.name))
if(!c)return!1
var p=r.indexOf("urn:")
i.logger.track({category:"load_viewable",role:e.role,type:e.type,urn:-1!==p?r.substring(p+4):r})
var m=this.myDocument.getMessages(e,!0),g=this,f=this.myCurrentViewer&&this.urn===r,v=function(){var i=g.myCurrentViewer
s&&s.camera?i.setViewFromArray(s.camera,s.name):s&&s.viewbox?i.setViewFromViewBox(s.viewbox,s.name):f&&i.setViewFromFile(),t&&t(g.myCurrentViewer,e,m)},E=function(e,t,i,o){n&&n(e,t,i,o,m)},y=!1
if(f)v&&v(),y=!0
else{this.urn=null
var A={defaultModelStructureTitle:a,viewableName:a}
e.hasOwnProperty("extensions")&&(A.extensions=Array.isArray(e.extensions)?e.extensions:[e.extensions])
var T=this.getViewer(A)
if(T){var b={ids:null,bubbleNode:this.bubble?this.bubble.findByGuid(e.guid):null,sharedPropertyDbPath:this.myDocument.getPropertyDbPath(),acmSessionId:this.myDocument.acmSessionId,loadOptions:o,useConsolidation:this.options.useConsolidation,consolidationMemoryLimit:this.options.consolidationMemoryLimit||104857600}
if(T.started)T.loadModel(this.myDocument.getFullPath(r),b,v,E),y=!0
else{y=0===T.start(this.myDocument.getFullPath(r),b,v,E)}this.urn=r}}return!!y&&(this.selectedItem=e,this.onItemSelected(e,l),!0)},n.prototype.onItemSelected=function(e,t){if(i.logger.log("Selected URL: http://"+location.host+location.pathname+"?document=urn:"+this.myDocument.getRootItem().guid+"&item="+encodeURIComponent(e.guid)),this.itemSelectedObservers)for(var n=this.getCurrentViewer(),o=0;o<this.itemSelectedObservers.length;++o){var r=this.itemSelectedObservers[o]
r.onItemSelected&&r.onItemSelected(n,e,t)}},n.prototype.addItemSelectedObserver=function(e){this.itemSelectedObservers||(this.itemSelectedObservers=[]),this.itemSelectedObservers.push(e)},n.prototype.selectItemById=function(e,t,i){var n=this.myDocument.getItemById(e)
return!!n&&this.selectItem(n,t,i)},n.prototype.getSelectedItem=function(){return this.selectedItem},n.prototype.getNamedViews=function(e){if(!(e=e||this.selectedItem)||!e.guid)return[]
var t=this.bubble.findByGuid(e.guid)
return e===this.selectedItem&&(t=t.findParentGeom2Dor3D()),t.getNamedViews()},t.ViewingApplication=n}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.ViewCubeUi=function(e){this.viewer=e,this.container=null,this.cube=null,this.viewcube=null,this.infoButton=null,this.homeViewContainer=null}
var avp=Autodesk.Viewing.Private
Autodesk.Viewing.Private.ViewCubeUi.prototype={constructor:Autodesk.Viewing.UI.ViewCube,create:function(){var e=this.viewer.config,t=!e||void 0===e.wantInfoButton||e.wantInfoButton
this.initContainer(),t&&this.initInfoButton(),this.initHomeButton()},initContainer:function(){this.container=document.createElement("div"),this.container.className="viewcubeUI",this.viewer.container.appendChild(this.container)},initInfoButton:function(){if(!(0<document.getElementsByClassName("infoButton").length)){this.infoButton=document.createElement("div"),this.infoButton.className="infoButton",this.infoButton.style.cursor="pointer",this.container.appendChild(this.infoButton)
var e=this
this.infoButton.addEventListener("click",function(t){var i=e.viewer.getPropertyPanel(!0),n=!i.areDefaultPropertiesShown()||!i.isVisible()
n&&i.showDefaultProperties(),n!==i.isVisible()&&i.setVisible(n)})}},initHomeButton:function(){if(!(0<document.getElementsByClassName("homeViewWrapper").length)){var e=document.createElement("div")
e.className="homeViewWrapper",e.style.cursor="pointer",this.container.appendChild(e),this.homeViewContainer=e
var t=this
e.addEventListener("click",function(e){t.viewer.navigation.setRequestHomeView(!0)}),this._initHomeMenu(e)}},_initHomeMenu:function(e){var t=this.viewer,i=t.autocam,n=this
this.hideHomeViewMenu=function(e){a.style.display="none",document.removeEventListener("click",n.hideHomeViewMenu)}
var o=document.createElement("div")
o.className="homeViewMenuHandle"
var r=document.createElement("img"),s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEBSURBVHja7JcxCsIwFIb/V3oFx04v4iB4A3ev4Ak9iOABOhQcageHDh7iuVSwpW1eYmIFEwiFQvN9SZP/ERIRLNkyLNySQBLIhy+I6AhgE5F5FZHTpACAbV3X61h0Zs5nVwBAJiL0rd+eNuHvnQIArTEmplhrE7gAWEUUePSO/Vg1jJgFvQyYWoFoWTDMgLlNWDFzIyIUqjNzA6DSCpwBlMaYW4iZd+OU3bh2ARG5h5J4h3fj6nIghIQNbg2iTyQ0cFUS+kho4eoodpFwgTvVAo2EK9y5GM1J+MC9quGYhC98shaoPiQqAOwB7Hzhrxn1umMrABy6pxeT0t3w7wWeAwD5qe4YizvzugAAAABJRU5ErkJggg=="
r.src=s,r.width=r.height=18,o.appendChild(r),o.addEventListener("mouseover",function(e){r.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEVSURBVHja7JcxDoJAEEX/rvY2HMEb6AEsaTDxBngKIzfgDBR6AxJtiI0egN7Ght6GWBIYGzVKQHaQDYU7yYSwxb5HMvs3CCJCnyXRcxkBIzAsLwyWpx0ARyNzn29m81oBAE60mmqj237smBkwAl9PAfIssv3Y1kbMs+j9VZQvIyHEGMBI40enRHSpFdCcBR8ZUJcD2rKgnAH1Q5gmnu3HXcOBNPGUBIrQDbqUeMKL0A2UBIjo2pXEO5yIrso50IVEE7wxiH6RUIErJWEbCVW4chRzJDhw1l2gIsGFPzdmNQBLLrZr6R7pcL69WrpHkovtGoDF2o8rUCXRFt5aoCzRFl4pwCwLwOTxBGOeXi3Mv+HfC9wHAAIQ03ZDDGqmAAAAAElFTkSuQmCC"}),o.addEventListener("mouseleave",function(e){r.src=s}),e.appendChild(o)
var a=document.createElement("div")
a.className="homeViewMenu",this.viewer.container.appendChild(a)
var l=document.createElement("div")
l.className="homeViewMenuItem",l.textContent=Autodesk.Viewing.i18n.translate("Set current view as Home"),a.appendChild(l),l.addEventListener("click",function(e){i.setCurrentViewAsHome(!1),n.hideHomeViewMenu(e)})
var c=document.createElement("div")
c.className="homeViewMenuItem",c.textContent=Autodesk.Viewing.i18n.translate("Focus and set as Home"),a.appendChild(c),c.addEventListener("click",function(e){i.setCurrentViewAsHome(!0),n.hideHomeViewMenu(e)})
var d=document.createElement("div")
d.className="homeViewMenuItem",d.textContent=Autodesk.Viewing.i18n.translate("Reset Home"),a.appendChild(d),d.addEventListener("click",function(e){i.resetHome(),n.hideHomeViewMenu(e)}),e.addEventListener("mouseover",function(e){(t.model&&t.model.is2d()||t.prefs&&!t.prefs.viewCube)&&(o.style.display="block")}),e.addEventListener("mouseleave",function(e){o.style.display="none"}),o.addEventListener("click",function(e){(t.model&&t.model.is2d()||t.prefs&&!t.prefs.viewCube)&&(a.style.display="block",document.addEventListener("click",n.hideHomeViewMenu)),e.stopPropagation()}),e.addEventListener("contextmenu",function(e){(t.model&&t.model.is2d()||t.prefs&&!t.prefs.viewCube)&&(a.style.display="block",document.addEventListener("click",n.hideHomeViewMenu))})},setVisible:function(e){this.container.style.display=e?"block":"none"},showTriad:function(e){this.cube&&this.cube.showTriad(e)},displayViewCube:function(e,t){if(t&&this.viewer.prefs.set("viewCube",e),e&&!this.cube)this.viewcube=document.createElement("div"),this.viewcube.className="viewcube",this.container.appendChild(this.viewcube),this.cube=new avp.Autocam.ViewCube("cube",this.viewer.autocam,this.viewcube,LOCALIZATION_REL_PATH)
else if(!this.cube)return void this._positionHomeButton()
this.viewcube.style.display=e?"block":"none",this._positionHomeButton(),e&&this.viewer.autocam.refresh()},_positionHomeButton:function(){if(this.homeViewContainer){var e,t=this.cube&&this.viewcube&&"block"===this.viewcube.style.display,i=this.viewer.container.getBoundingClientRect(),n=this.homeViewContainer.getBoundingClientRect()
if(t){var o=this.viewcube.getBoundingClientRect()
e=i.left+i.width-o.left-n.width}else if(this.infoButton){var r=this.infoButton.getBoundingClientRect()
e=i.left+i.width-r.left+r.width-n.width}else e=10
this.homeViewContainer.style.right=e+"px"}},uninitialize:function(){this.container&&(this.viewer.container.removeChild(this.container),this.viewcube=null),this.infoButton=null,this.cube&&(this.cube.dtor(),this.cube=null),this.homeViewContainer=null,this.hideHomeViewMenu=null,this.viewer=null}}
var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,avu=Autodesk.Viewing.UI,ave=Autodesk.Viewing.Extensions,stringToDOM=avp.stringToDOM=function(e){var t=document.createElement("div")
return t.innerHTML=e,t.firstChild}
!function(){"use strict"
av.TOOLBAR_CREATED_EVENT="toolbarCreated",av.VIEW_CUBE_CREATED_EVENT="viewCubeCreated",av.SIDE_BAR_OPEN_EVENT="SIDE_BAR_OPEN_EVENT",av.TOOLBAR={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools"}
var e=function(e,t){t||(t={}),t.startOnInitialize=!1,av.Viewer3D.call(this,e,t),this.toolbar=null,this.dockingPanels=[],this.modelstructure=null,this.layersPanel=null}
e.populateConfigOptions=function(e){e.hasOwnProperty("wantInfoButton")||(e.wantInfoButton=!0),e.hasOwnProperty("disabledExtensions")||(e.disabledExtensions={}),["measure","hyperlink","section"].forEach(function(t){e.disabledExtensions.hasOwnProperty(t)||(e.disabledExtensions[t]=!1)})},e.prototype=Object.create(av.Viewer3D.prototype),e.prototype.constructor=e,e.prototype.initialize=function(){var e=av.Viewer3D.prototype.initialize.call(this)
if(e>0)return avp.ErrorHandler.reportError(this.container,e),e
var t=this
if(this.toolController){var i=new av.HotGestureTool(this)
this.toolController.registerTool(i),this.toolController.activateTool(i.getName())}return this.getToolbar(!0),this.addEventListener(av.FULLSCREEN_MODE_EVENT,function(e){t.resizePanels({viewer:t}),t.updateFullscreenButton(e.mode)}),this.contextMenu||this.setDefaultContextMenu(),this.progressbar=new avp.ProgressBar(this.container),this.addEventListener(av.PROGRESS_UPDATE_EVENT,function(e){void 0!==e.percent&&t.progressbar.setPercent(e.percent)},!1),this.selectionActive=!1,this.addEventListener(av.SELECTION_CHANGED_EVENT,function(e){if(t.selectionActive=e.dbIdArray.length>0,t.prefs.openPropertiesOnSelect){t.getPropertyPanel(!0).setVisible(t.selectionActive)}}),this.addEventListener(av.ISOLATE_EVENT,function(e){(t.prefs.openPropertiesOnSelect||e.nodeIdArray[0]===e.model.getRootId())&&t.propertygrid&&t.propertygrid.setVisible(e.nodeIdArray.length>0||t.selectionActive)}),this.addEventListener(av.VIEWER_STATE_RESTORED_EVENT,function(e){t.renderoptions&&t.renderoptions.syncUI()
var i=t.getSettingsPanel(!0)
i&&i.syncUI()}),this.addEventListener(av.VIEWER_RESIZE_EVENT,function(e){t.resizePanels(),t.viewCubeUi&&t.viewCubeUi.cube&&t.viewCubeUi.cube.refreshCube(),t.updateToolbarButtons(e.width,e.height)}),this.addEventListener(av.NAVIGATION_MODE_CHANGED_EVENT,function(e){t.updateToolbarButtons(t.container.clientWidth,t.container.clientHeight)}),this.initEscapeHandlers(),this.localize(),this.run(),0},e.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null),this.modelstructure&&(this.modelstructure.uninitialize(),this.modelstructure=null),this.layersPanel&&(this.layersPanel.uninitialize(),this.layersPanel=null),this.propertygrid&&(this.propertygrid.uninitialize(),this.propertygrid=null),this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null),this.viewerOptionButton&&(this.viewerOptionButton=null),av.theHotkeyManager.popHotkeys("Autodesk.ROLL"),av.theHotkeyManager.popHotkeys("Autodesk.FOV"),this.removeEventListener(av.RENDER_OPTION_CHANGED_EVENT,this.onRenderOptionChanged),this.onRenderOptionChanged=null,this.removeEventListener(av.VIEWER_STATE_RESTORED_EVENT,this.onRestoreState),this.onRestoreState=null,this.progressbar=null,this.modelTools=null,this.navTools=null,this.settingsTools=null,this.debugMenu=null,this.modelStats=null,this.explodeSlider=null,this.explodeSubmenu=null,this.toolbar=null,av.Viewer3D.prototype.uninitialize.call(this)},e.prototype.setUp=function(e){e||(e={}),e.startOnInitialize=!1,this.getToolbar(!0),av.Viewer3D.prototype.setUp.call(this,e)},e.prototype.tearDown=function(){av.Viewer3D.prototype.tearDown.call(this),this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.modelstructure&&this.setModelStructurePanel(null),this.propertygrid&&this.setPropertyPanel(null),this.viewerSettingsPanel&&this.setSettingsPanel(null),this.layersPanel&&this.setLayersPanel(null),this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null),this.removeEventListener(av.GEOMETRY_LOADED_EVENT,this.initViewCube)},e.prototype.loadModel=function(e,t,i,n,o){function r(e){if(!l.running)return void avp.logger.error("createUI expects the viewer to be running.",av.errorCodeString(av.ErrorCodes.VIEWER_INTERNAL_ERROR))
l.createUI(e)}function s(e){setTimeout(function(){r(e),i&&i.call(i,e)},1)}function a(e){avp.ErrorHandler.reportError(l.container,e),n&&n.apply(n,arguments)}var l=this
return av.Viewer3D.prototype.loadModel.call(this,e,t,s,a,o)},e.prototype.createUI=function(e){if(this.model===e){var t=this
this.initViewCube=function(){setTimeout(function(){t.displayViewCube(t.prefs.viewCube),t.removeEventListener(av.GEOMETRY_LOADED_EVENT,t.initViewCube)},1)}
var i=this.config.disabledExtensions||{}
this.initHotkeys(e),this.loadExtension("Autodesk.DefaultTools.NavTools",t.config),this.initModelTools(e),avp.ENABLE_DEBUG&&this.initDebugTools(),this.toolbar.container.style.display="block",this.fireEvent({type:av.TOOLBAR_CREATED_EVENT}),this.createViewCube(),this.fireEvent({type:av.VIEW_CUBE_CREATED_EVENT}),this.initModality(),this.resize(),e.is2d()?(this.unloadExtension("Autodesk.BimWalk"),this.unloadExtension("Autodesk.FirstPerson"),this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),this.displayViewCube(!1,!1),setTimeout(function(){i.measure||t.loadExtension("Autodesk.Measure",t.config),i.hyperlink||t.loadExtension("Autodesk.Hyperlink",t.config)},1)):(-1===this.getDefaultNavigationToolName().indexOf("orbit")&&this.setDefaultNavigationTool("orbit"),setTimeout(function(){t.prefs.useFirstPersonPrototype?t.loadExtension("Autodesk.BimWalk",t.config):t.loadExtension("Autodesk.FirstPerson",t.config),t.prefs.fusionOrbit&&t.loadExtension("Autodesk.Viewing.FusionOrbit",t.config),i.measure||t.loadExtension("Autodesk.Measure",t.config),i.section||t.loadExtension("Autodesk.Section",t.config),i.hyperlink||t.loadExtension("Autodesk.Hyperlink",t.config),avp.isExperimentalFlagEnabled("billboards",t.config)&&(t.loadExtension("Autodesk.Comments",t.config),t.loadExtension("Autodesk.BillboardGui",t.config))},1),setTimeout(function(){avp.isExperimentalFlagEnabled("sidebar-ui",t.config)&&t.loadExtension("Autodesk.SideBarUi",t.config)},1),this.addEventListener(av.GEOMETRY_LOADED_EVENT,this.initViewCube))
var n=function(){if(t.modelstructure){var e=function(e){var i=t.config.defaultModelStructureTitle?t.config.defaultModelStructureTitle:""
t.modelstructure.setModel(e,i)},i=function(e){}
t.model.getObjectTree(e,i)}t.removeEventListener(av.OBJECT_TREE_CREATED_EVENT,n)}
this.addEventListener(av.OBJECT_TREE_CREATED_EVENT,n)}},e.prototype.addOptionToggle=function(e,t,i,n,o){var r=o?this.prefs[o]:null
i="boolean"==typeof r?r:i
var s=document.createElement("li")
s.className="toolbar-submenu-listitem"
var a=document.createElement("input")
a.className="toolbar-submenu-checkbox",a.type="checkbox",a.id=t,s.appendChild(a)
var l=document.createElement("label")
return l.setAttribute("for",t),l.setAttribute("data-i18n",t),l.textContent=av.i18n.translate(t),s.appendChild(l),e.appendChild(s),a.checked=i,a.addEventListener("touchstart",av.touchStartToClick),l.addEventListener("touchstart",av.touchStartToClick),s.addEventListener("touchstart",av.touchStartToClick),a.addEventListener("click",function(e){n(a.checked),e.stopPropagation()}),l.addEventListener("click",function(e){e.stopPropagation()}),s.addEventListener("click",function(e){n(!a.checked),e.stopPropagation()}),o&&this.prefs.addListeners(o,function(e){a.checked=e},function(e){a.checked=e,n(e)}),a},e.prototype.addOptionList=function(e,t,i,n,o,r){var s=this.prefs[r]
n="number"==typeof s?s:n
var a=function(e){var t=e.target.selectedIndex
o(t),e.stopPropagation()},l=document.createElement("select")
l.className="optionDropDown",l.id="selectMenu_"+t
for(var c=0;c<i.length;c++){var d=document.createElement("option")
d.value=c,d.setAttribute("data-i18n",i[c]),d.textContent=Autodesk.Viewing.i18n.translate(i[c]),l.add(d)}var u=document.createElement("li")
u.className="toolbar-submenu-select"
var h=document.createElement("div")
return h.className="toolbar-submenu-selectlabel",h.setAttribute("for",t),h.setAttribute("data-i18n",t),h.textContent=av.i18n.translate(t),u.appendChild(h),u.appendChild(l),e.appendChild(u),l.selectedIndex=n,l.onchange=a,l.addEventListener("touchstart",function(e){e.stopPropagation()}),l.addEventListener("click",function(e){e.stopPropagation()}),r&&this.prefs.addListeners(r,function(e){l.selectedIndex=e},function(e){l.selectedIndex=e,o(e)}),l},e.prototype.showViewer3dOptions=function(e){var t=this.getSettingsPanel(!0)
e&&t.isVisible()&&t.setVisible(!1),t.setVisible(e)},e.prototype.showRenderingOptions=function(e){this.renderoptions.setVisible(e)},e.prototype.showLayerManager=function(e){this.layersPanel.setVisible(e)},e.prototype.initHotkeys=function(e){var t,i,n=this,o=av.theHotkeyManager.KEYCODES
if(!e.is2d()){var r
t=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("fov"))&&(r=n.getActiveNavigationTool(),n.setActiveNavigationTool("fov"),!0)},i=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("fov"))&&(n.setActiveNavigationTool(r),!0)},av.theHotkeyManager.pushHotkeys("Autodesk.FOV",[{keycodes:[o.CONTROL,o.SHIFT],onPress:t,onRelease:i}],{tryUntilSuccess:!0})}var s
t=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("roll"))&&(s=n.getActiveNavigationTool(),n.setActiveNavigationTool("worldup"),!0)},i=function(){return!(n.toolController.getIsLocked()||!n.navigation.isActionEnabled("roll"))&&(n.setActiveNavigationTool(s),!0)},av.theHotkeyManager.pushHotkeys("Autodesk.ROLL",[{keycodes:[o.ALT,o.SHIFT],onPress:t,onRelease:i}],{tryUntilSuccess:!0})},e.prototype.setModelStructurePanel=function(e){var t=this
return(e instanceof av.UI.ModelStructurePanel||null===e)&&(this.modelstructure&&(this.modelstructure.setVisible(!1),this.removePanel(this.modelstructure),this.modelstructure.uninitialize()),this.modelstructure=e,e&&(this.addPanel(this.modelstructure),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.settingsTools.structurebutton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)}),t.model&&t.model.getObjectTree(function(e){t.modelstructure&&t.modelstructure.setModel(e)})),!0)},e.prototype.setLayersPanel=function(e){var t=this
return this.model&&!this.model.is2d()?(avp.logger.warn("av.Viewer3D.setLayersPanel is not yet implemented for 3D"),!1):(e instanceof av.UI.LayersPanel||!e)&&(this.layersPanel&&(this.layersPanel.setVisible(!1),this.removePanel(this.layersPanel),this.layersPanel.uninitialize()),this.layersPanel=e,e&&(this.addPanel(e),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.settingsTools.layerButton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},e.prototype.setPropertyPanel=function(e){var t=this
return(e instanceof av.UI.PropertyPanel||!e)&&(this.propertygrid&&(this.propertygrid.setVisible(!1),this.removePanel(this.propertygrid),this.propertygrid.uninitialize()),this.propertygrid=e,e&&(this.addPanel(e),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.settingsTools.propertiesbutton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},e.prototype.getPropertyPanel=function(e){return!this.propertygrid&&e&&this.setPropertyPanel(new ave.ViewerPropertyPanel(this)),this.propertygrid},e.prototype.setSettingsPanel=function(e){var t=this
return(e instanceof av.UI.SettingsPanel||!e)&&(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),this.viewerSettingsPanel=e,e&&(this.addPanel(e),e.addVisibilityListener(function(i){i&&t.onPanelVisible(e,t),t.viewerOptionButton.setState(i?avu.Button.State.ACTIVE:avu.Button.State.INACTIVE)})),!0)},e.prototype.getSettingsPanel=function(e){return!this.viewerSettingsPanel&&e&&this.setSettingsPanel(new ave.ViewerSettingsPanel(this,this.model)),this.viewerSettingsPanel},e.prototype.initModelTools=function(e){var t=this
if(e.is2d()){var i=new ave.ViewerLayersPanel(this)
this.setLayersPanel(i)
var n=new avu.Button("toolbar-layersTool")
n.setToolTip("Layer Manager"),n.setIcon("adsk-icon-layers"),n.onClick=function(e){t.layersPanel||t.setLayersPanel(new ave.ViewerLayersPanel(t)),t.showLayerManager(!t.layersPanel.isVisible())},this.settingsTools.addControl(n),this.settingsTools.layerButton=n}else{if(!t.modelstructure){var o={docStructureConfig:t.config.docStructureConfig}
t.setModelStructurePanel(new ave.ViewerModelStructurePanel(t,"Browser",o))}var r=new avu.Button("toolbar-modelStructureTool")
r.setToolTip("Model browser"),r.setIcon("adsk-icon-structure"),r.onClick=function(e){t.showModelStructurePanel(!t.modelstructure.isVisible())},this.settingsTools.addControl(r),this.settingsTools.structurebutton=r,this.initExplodeSlider()}t.addEventListener(av.RESET_EVENT,function(){t.model&&!t.model.is2d()&&(t.explode(0),t.explodeSlider.value=0),t.showAll()})
var s=new avu.Button("toolbar-propertiesTool")
s.setToolTip("Properties"),s.setIcon("adsk-icon-properties"),s.onClick=function(e){var i=t.getPropertyPanel(!0)
i.setVisible(!i.isVisible())},s.setVisible(!t.prefs.openPropertiesOnSelect),this.settingsTools.addControl(s),this.settingsTools.propertiesbutton=s
var a=new ave.ViewerSettingsPanel(this,e)
this.setSettingsPanel(a),a.syncUI()
var l=new avu.Button("toolbar-settingsTool")
if(this.viewerOptionButton=l,l.setIcon("adsk-icon-settings"),l.setToolTip("Settings"),this.settingsTools.addControl(l),this.createViewerOptionsMenu(e),avp.ENABLE_DEBUG&&!e.is2d()){this.renderoptions=new avp.RenderOptionsPanel(this),this.addPanel(this.renderoptions)
var c=new avu.Button("toolbar-renderOptionsTool")
c.setToolTip("Rendering options"),c.setIcon("adsk-icon-settings-render"),c.onClick=function(e){t.showRenderingOptions(!t.renderoptions.isVisible())},this.settingsTools.addControl(c)}if(this.canChangeScreenMode()){var d=new avu.Button("toolbar-fullscreenTool",{collapsible:!1})
d.setToolTip("Full screen"),d.setIcon("adsk-icon-fullscreen"),d.onClick=function(e){t.nextScreenMode()},this.settingsTools.addControl(d),this.settingsTools.fullscreenbutton=d,this.updateFullscreenButton(this.getScreenMode())}},e.prototype.setPropertiesOnSelect=function(e){this.prefs.set("openPropertiesOnSelect",e),this.settingsTools.propertiesbutton.setVisible(!e)},e.prototype.addDivider=function(e){var t=document.createElement("li")
return t.className="toolbar-submenu-horizontal-divider",e.appendChild(t),t},e.prototype.createViewerOptionsMenu=function(e){function t(e){if(i.getExtension("Autodesk.SideBarUi")){var t=Autodesk.SideBarUi.Content
return void i.fireEvent({type:av.SIDE_BAR_OPEN_EVENT,content:t.Settings})}var n=i.getSettingsPanel(!0)
n.isVisible()?i.showViewer3dOptions(!1):(i.showViewer3dOptions(!0),n.selectTab(e))}var i=this
this.viewerOptionButton.onClick=function(){t(ave.ViewerSettingTab.Performance)}},e.prototype.initDebugTools=function(){var e=new avu.ControlGroup("debugTools")
this.debugMenu=e
var t=new avu.Button("toolbar-debugTool")
t.setIcon("adsk-icon-bug"),e.addControl(t),this.debugMenu.debugSubMenuButton=t,this.createDebugSubmenu(this.debugMenu.debugSubMenuButton),this.toolbar.addControl(e)},e.prototype.createDebugSubmenu=function(e){function t(){i.localize()}var i=this,n=document.createElement("div")
n.id="toolbar-debugToolSubmenu",n.classList.add("toolbar-submenu"),n.classList.add("toolbar-settings-sub-menu"),n.classList.add("adsk-hidden"),this.debugMenu.subMenu=n,this.debugMenu.subMenu.style.minWidth="180px",this.container.appendChild(n),this.initModelStats(),this.addDivider(n),this.addDivider(n)
var o=["English","Chinese Simplified","Chinese Traditional","Japanese","Czech","Korean","Polish","Russian","French","German","Italian","Spanish","Portuguese Brazil","Turkish"],r=["en","zh-Hans","zh-Hant","ja","cs","ko","pl","ru","fr","de","it","es","pt-br","tr"],s=i.selectedLanguage?i.selectedLanguage:0
this.addOptionList(n,"Language",o,s,function(e){var n=r[e]
i.selectedLanguage=e,avp.setLanguage(n,t)},null).parentNode.style.paddingBottom="15px",this.addDivider(this.debugMenu.subMenu)
var a=["UNKNOWN FAILURE","BAD DATA","NETWORK ERROR","NETWORK ACCESS DENIED","NETWORK FILE NOT FOUND","NETWORK SERVER ERROR","NETWORK UNHANDLED RESPONSE CODE","BROWSER WEBGL NOT SUPPORTED","BAD DATA NO VIEWABLE CONTENT"]
this.addOptionList(n,"Error",a,0,function(e){var t=e+1
avp.ErrorHandler.reportError(i.container,t,"")},null).parentNode.style.paddingBottom="15px"
var l=n.getBoundingClientRect()
this.debugMenu.subMenu.style.width=l.width+"px",this.container.removeChild(n),e.container.appendChild(n)
var c=l.left+l.width,d=this.container.getBoundingClientRect().right
if(c>d){var u=-(c-d+10)+"px"
this.debugMenu.subMenu.style.left=u}e.onMouseOver=function(e){n.classList.remove("adsk-hidden")},e.onMouseOut=function(e){n.classList.add("adsk-hidden")},av.isTouchDevice()&&(e.onClick=function(e){n.classList.toggle("adsk-hidden")})},e.prototype.initModelStats=function(){function e(e){var t=i.impl,n=""
i.model&&(n+="Geom&nbsp;polys:&nbsp;"+t.modelQueue().getGeometryList().geomPolyCount+"<br>",n+="Instance&nbsp;polys:&nbsp;"+t.modelQueue().getGeometryList().instancePolyCount+"<br>",n+="Fragments:&nbsp;"+t.modelQueue().getFragmentList().getCount()+"<br>",n+="Geoms:&nbsp;"+t.modelQueue().getGeometryList().geoms.length+"<br>",n+="Loading&nbsp;time:&nbsp;"+(t.model.loader.loadTime/1e3).toFixed(2)+" s<br>"),n+="# "+(e||""),i.modelStats.innerHTML=n}function t(){i.modelStats=document.createElement("div"),i.modelStats.className="statspanel",i.container.appendChild(i.modelStats),i.addEventListener(av.PROGRESS_UPDATE_EVENT,function(t){t.message&&e(t.message)}),i.fpsDisplay=document.createElement("div"),i.fpsDisplay.className="fps",i.container.appendChild(i.fpsDisplay)}var i=this
this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,function(n){n&&!i.modelStats&&(t(),e("")),i.modelStats.style.visibility=n?"visible":"hidden",i.fpsDisplay.style.visibility=n?"visible":"hidden",i.impl.fpsCallback=n?function(e){i.fpsDisplay.textContent=""+(0|e)}:null})},e.prototype.initEscapeHandlers=function(){var e=this
this.addEventListener(av.ESCAPE_EVENT,function(t){if(!e.contextMenu||!e.contextMenu.hide()){if(e.renderoptions&&e.renderoptions.isVisible())return void e.renderoptions.setVisible(!1)
if(e.getActiveNavigationTool()!==e.getDefaultNavigationToolName())return e.toolController&&e.toolController.setIsLocked(!1),e.setActiveNavigationTool(),void avp.HudMessage.dismiss()
if(e.selectionActive)return void e.clearSelection()
if(!e.areAllVisible())return void e.showAll()
if(!avp.AlertBox.dismiss()){for(var i=0;i<e.dockingPanels.length;++i){var n=e.dockingPanels[i]
if("none"!==n.container.style.display&&""!==n.container.style.display)return void(n.container===e.modelstructure?e.showModelStructurePanel(!1):n.setVisible(!1))}e.escapeScreenMode()}}})},e.prototype.showViewCubeUI=function(e){this.viewCubeUi.setVisible(e)},e.prototype.showViewCubeTriad=function(e){this.viewCubeUi.showTriad(e)},e.prototype.displayViewCube=function(e,t){this.viewCubeUi.displayViewCube(e,t)},e.prototype.displayHomeandInfoButton=function(e){var t=this.container.querySelector(".homeViewWrapper"),i=this.container.querySelector(".infoButton")
t&&(t.style.display=e?"":"none"),i&&(i.style.display=e?"":"none")},e.prototype.getToolbar=function(e){if(!this.toolbar&&e){var t=av.UI
this.toolbar=new t.ToolBar("guiviewer3d-toolbar"),this.navTools=new t.RadioButtonGroup(av.TOOLBAR.NAVTOOLSID),this.modelTools=new t.ControlGroup(av.TOOLBAR.MODELTOOLSID),this.settingsTools=new t.ControlGroup(av.TOOLBAR.SETTINGSTOOLSID),this.toolbar.addControl(this.navTools),this.toolbar.addControl(this.modelTools),this.toolbar.addControl(this.settingsTools),this.container.appendChild(this.toolbar.container),this.toolbar.container.style.display="none"}return this.toolbar},e.prototype.showModelStructurePanel=function(e){this.modelstructure.setVisible(e),e&&this.modelstructure instanceof ave.ViewerModelStructurePanel&&(this.modelstructure.setSelection(this.getSelection()),this.modelstructure.setIsolation(this.getIsolatedNodes()))},e.prototype.onPanelVisible=function(e){this.dockingPanels.splice(this.dockingPanels.indexOf(e),1),this.dockingPanels.splice(0,0,e)},e.prototype.updateFullscreenButton=function(e){var t="adsk-icon-fullscreen"
switch(e){case av.ScreenMode.kNormal:this.isScreenModeSupported(av.ScreenMode.kFullBrowser)||(t="adsk-icon-fullscreen")
break
case av.ScreenMode.kFullBrowser:t=this.isScreenModeSupported(av.ScreenMode.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit"
break
case av.ScreenMode.kFullScreen:t="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(t)},e.prototype.localize=function(){av.i18n.localize(),this.debugMenu&&this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.container.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton)),avp.ErrorHandler.localize()},e.prototype.addPanel=function(e){return-1===this.dockingPanels.indexOf(e)&&(this.dockingPanels.push(e),!0)},e.prototype.removePanel=function(e){var t=this.dockingPanels.indexOf(e)
return t>-1&&(this.dockingPanels.splice(t,1),!0)},e.prototype.resizePanels=function(e){e=e||{}
var t=this.toolbar.getDimensions().height,i=this.getDimensions(),n=i.height
e.dimensions&&e.dimensions.height?n=e.dimensions.height:e.dimensions={height:i.height,width:i.width},e.dimensions.height=n-t
var o=e?e.viewer:null
o||(o=this)
var r=e?e.dockingPanels:null
r||(r=o.dockingPanels)
var s,a,l=o.container.getBoundingClientRect(),c=l.top,d=l.bottom,u=l.left,h=l.right
e&&e.dimensions?(s=e.dimensions.width,a=e.dimensions.height,d=e.dimensions.height):(s=l.width,a=l.height)
for(var p=0;p<r.length;++p){var m=r[p].container,g=m.getBoundingClientRect(),f=g.top,v=g.bottom,E=g.left,y=g.right,A=g.width,T=g.height
A&&T&&(s<A&&(A=Math.round(s),m.style.width=A+"px"),a<T&&(T=Math.round(a),m.style.height=T+"px"),(h<y||m.dockRight)&&(E=Math.round(h-A-u),m.style.left=E+"px"),(d<v||m.dockBottom)&&(f=Math.round(d-T-c),f<0&&(f=0),m.style.top=f+"px"),m.style.maxWidth=Math.round(s)+"px",m.style.maxHeight=Math.round(a)+"px")}},e.prototype.initExplodeSlider=function(){var e=this,t=new avu.Button("toolbar-explodeTool")
t.setIcon("adsk-icon-explode"),t.setToolTip("Explode model"),e.modelTools.addControl(t,{index:0})
this.explodeSubmenu=avp.stringToDOM('<div class="explode-submenu" style="display:none"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"/></div>')
var i
i=document.querySelector("#toolbar-explodeTool").parentNode,this.explodeSubmenu.classList.add("ios"),i.appendChild(this.explodeSubmenu)
var n=this.explodeSubmenu.querySelector(".explode-slider")
e.explodeSlider=n,n.oninput=function(t){e.explode(n.value)},n.onchange=function(t){e.explode(n.value)},this.explodeSubmenu.onclick=function(e){e.stopPropagation()}
var o=t.container.querySelector(".adsk-control-tooltip")
t.onClick=function(i){var r=t.getState()
r===avu.Button.State.INACTIVE?(t.setState(avu.Button.State.ACTIVE),o.style.display="none",e.explodeSubmenu.style.display="",avp.logger.track({category:"tool_changed",name:"explode"})):r===avu.Button.State.ACTIVE&&(t.setState(avu.Button.State.INACTIVE),o.style.display="",n.parentNode.style.display="none",e.explode(0),e.explodeSlider.value=0)}},e.prototype.initInspectTools=function(){var e=new avu.Button("toolbar-inspectTools")
e.setToolTip("Inspect"),e.setIcon("measure"),e.setVisible(!1),this.modelTools.addControl(e)
var t=new avu.RadioButtonGroup("toolbar-inspectSubMenu")
t.addClass("toolbar-vertical-group"),t.setVisible(!1),this.modelTools.addControl(t),e.container.insertBefore(t.container,e.container.firstChild),e.onMouseOver=function(){t.setVisible(!0)},e.onMouseOut=function(){t.setVisible(!1)},av.isTouchDevice()&&(e.onClick=function(e){t.setVisible(!t.isVisible())})},e.prototype.initModality=function(){function e(t){for(var i=0;i<2&&t.parentElement;){var n=t.id
if(0===n.indexOf("toolbar-")){if(n.indexOf("arrow")===n.length-5)return
return e(t.parentElement)||t}t=t.parentElement,i++}}function t(e){return e.id.substring(8,e.id.length)}function i(e){return e.classList.contains("active")}function n(e){var t=document.createEvent("Event")
t.initEvent("click",!0,!0),e.dispatchEvent(t)}function o(e,t,i){a[e]=i?t:void 0}function r(r){if(!r.target.classList.contains("clickoff")){var l=e(r.target)
if(l){var c=t(l)
if(s[c]&&!("sectionTool"===c&&(r.target.classList.contains("adsk-icon-section-analysis")||r.target.querySelector(".adsk-icon-section-analysis"))||a[c]&&(o(c,l,!1),i(l)))){for(var d in a){var u=a[d]
if(u){var h=t(u)
i(u)?s[c][h]||n(u):o(h,u,!1)}}o(c,l,!0)}}}}var s={orbitTools:{explodeTool:1},panTool:{explodeTool:1},zoomTool:{explodeTool:1},beelineTool:{},sectionTool:{},measureTool:{},explodeTool:{},billboardTool:{}},a={}
this.toolbar.container.addEventListener("click",r,!0)},e.prototype.updateToolbarButtons=function(e,t){if(this.getToolbar(!1)){var i,n
n=e>310?"block":"none",i=this.modelTools.getControl("toolbar-explodeTool"),i&&i.setDisplay(n),n=e>380?"block":"none",i=this.modelTools.getControl("toolbar-collaborateTool"),i&&i.setDisplay(n),n=e>515?"block":"none"
var o=this.navTools.getControl("toolbar-cameraSubmenuTool")
o&&(o.setDisplay(n),i=o.subMenu.getControl("toolbar-homeTool"),i&&i.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),i=o.subMenu.getControl("toolbar-fitToViewTool"),i&&i.setDisplay(this.navigation.isActionEnabled("gotoview")?"block":"none"),i=o.subMenu.getControl("toolbar-focalLengthTool"),i&&i.setDisplay(this.navigation.isActionEnabled("fov")?"block":"none"),(i=o.subMenu.getControl("toolbar-rollTool"))&&i.setDisplay(this.navigation.isActionEnabled("roll")?"block":"none")),n=e>700?"block":"none",i=this.modelTools.getControl("toolbar-measureTool"),i&&i.setDisplay(n),i=this.modelTools.getControl("toolbar-sectionTool"),i&&i.setDisplay(n),n=e>740?"block":"none",i=this.navTools.getControl("toolbar-beelineTool"),i&&i.setDisplay(this.navigation.isActionEnabled("walk")?n:"none"),i=this.navTools.getControl("toolbar-firstPersonTool"),i&&i.setDisplay(this.navigation.isActionEnabled("walk")?n:"none"),i=this.navTools.getControl("toolbar-zoomTool"),i&&i.setDisplay(this.navigation.isActionEnabled("zoom")?n:"none"),i=this.navTools.getControl("toolbar-panTool"),i&&i.setDisplay(this.navigation.isActionEnabled("pan")?n:"none"),(i=this.navTools.getControl("toolbar-orbitTools"))&&i.setDisplay(this.navigation.isActionEnabled("orbit")?n:"none")}},avp.GuiViewer3D=e}(),function(){"use strict"
function e(e,t){this._id=e,this._isCollapsible=!t||t.collapsible,this._toolTipElement=null,this._listeners={},this.container=document.createElement("div"),this.container.id=e,this.addClass("adsk-control")}var t=Autodesk.Viewing
Autodesk.Viewing.UI
e.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"},t.EventDispatcher.prototype.apply(e.prototype),e.prototype.constructor=e,e.prototype.container=null,e.prototype.getId=function(){return this._id},e.prototype.setVisible=function(t){if(!this.container.classList.contains("adsk-hidden")===t)return!1
t?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden")
var i={type:e.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:t}
return this.fireEvent(i),!0},e.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")},e.prototype.setToolTip=function(e){return(!this._toolTipElement||this._toolTipElement.getAttribute("tooltipText")!==e)&&(this._toolTipElement||(this._toolTipElement=document.createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement)),this._toolTipElement.setAttribute("data-i18n",e),this._toolTipElement.setAttribute("tooltipText",e),this._toolTipElement.textContent=Autodesk.Viewing.i18n.translate(e,{defaultValue:e}),!0)},e.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")},e.prototype.setCollapsed=function(t){if(!this._isCollapsible||this.isCollapsed()===t)return!1
t?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed")
var i={type:e.Event.COLLAPSED_CHANGED,isCollapsed:t}
return this.fireEvent(i),!0},e.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")},e.prototype.isCollapsible=function(){return this._isCollapsible},e.prototype.addClass=function(e){this.container.classList.add(e)},e.prototype.removeClass=function(e){this.container.classList.remove(e)},e.prototype.getPosition=function(){var e=this.container.getBoundingClientRect()
return{top:e.top,left:e.left}},e.prototype.getDimensions=function(){var e=this.container.getBoundingClientRect()
return{width:e.width,height:e.height}},e.prototype.setDisplay=function(e){this.container.style.display=e},Autodesk.Viewing.UI.Control=e}(),function(){"use strict"
function e(i,n){t.Control.call(this,i,n)
var o=this
this._controls=[],this.addClass("adsk-control-group"),this.handleChildSizeChanged=function(t){var i={type:e.Event.SIZE_CHANGED,childEvent:t}
o.fireEvent(i)}}var t=Autodesk.Viewing.UI
e.Event={VISIBILITY_CHANGED:t.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:t.Control.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"},e.prototype=Object.create(t.Control.prototype),e.prototype.constructor=e,e.prototype.addControl=function(i,n){var o=n&&void 0!==n.index?n.index:this._controls.length
if(null!==this.getControl(i.getId()))return!1
var r={type:e.Event.CONTROL_ADDED,control:i,index:o}
return o<this._controls.length?(this.container.insertBefore(i.container,this._controls[o].container),this._controls.splice(o,0,i)):(this.container.appendChild(i.container),this._controls.push(i)),i.addEventListener(t.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),i.addEventListener(t.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),i instanceof e&&i.addEventListener(e.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.fireEvent(r),this.fireEvent(e.Event.SIZE_CHANGED),!0},e.prototype.indexOf=function(e){for(var t=0;t<this._controls.length;t++){var i=this._controls[t]
if(i===e||"string"==typeof e&&e===i.getId())return t}return-1},e.prototype.removeControl=function(i){var n="string"==typeof i?this.getControl(i):i
if(!n)return!1
var o=this._controls.indexOf(n)
if(-1===o)return!1
this._controls.splice(o,1),this.container.removeChild(n.container)
var r={type:e.Event.CONTROL_REMOVED,control:n,index:o}
return n.removeEventListener(t.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),n.removeEventListener(t.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),n instanceof e&&n.removeEventListener(e.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.fireEvent(r),this.fireEvent(e.Event.SIZE_CHANGED),!0},e.prototype.getControl=function(e){for(var t=0;t<this._controls.length;t++)if(e===this._controls[t].getId())return this._controls[t]
return null},e.prototype.getControlId=function(e){return e<0||e>=this._controls.length?null:this._controls[e].getId()},e.prototype.getNumberOfControls=function(){return this._controls.length},e.prototype.setCollapsed=function(t){if(!this._isCollapsible)return!1
var i=!1
return this._controls.forEach(function(e){e.isCollapsible()&&e.setCollapsed(t)&&(i=!0)}),i&&(t?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.fireEvent({type:e.Event.COLLAPSED_CHANGED,isCollapsed:t})),i},Autodesk.Viewing.UI.ControlGroup=e}(),function(){"use strict"
function e(e,i){t.ControlGroup.call(this,e,i),this.removeClass("adsk-control-group"),this.addClass("adsk-toolbar")}var t=Autodesk.Viewing.UI
e.Event={VISIBILITY_CHANGED:t.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:t.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:t.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:t.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:t.ControlGroup.Event.SIZE_CHANGED},e.prototype=Object.create(t.ControlGroup.prototype),e.prototype.constructor=e,Autodesk.Viewing.UI.ToolBar=e}(),function(){"use strict"
function e(n,o){i.Control.call(this,n,o)
var r=this
this._state=e.State.INACTIVE,this.icon=document.createElement("div"),this.icon.classList.add("adsk-button-icon"),this.container.appendChild(this.icon),this.container.addEventListener("click",function(t){r.getState()!==e.State.DISABLED&&(r.fireEvent(e.Event.CLICK),r.onClick&&r.onClick(t)),t.stopPropagation()}),t.isTouchDevice()?this.container.addEventListener("touchstart",t.touchStartToClick):(this.container.addEventListener("mouseover",function(e){r.onMouseOver(e)}),this.container.addEventListener("mouseout",function(e){r.onMouseOut(e)})),this.addClass("adsk-button"),this.addClass(e.StateToClassMap[this._state])}var t=Autodesk.Viewing,i=Autodesk.Viewing.UI
e.Event={VISIBILITY_CHANGED:i.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:i.Control.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"},e.State={ACTIVE:0,INACTIVE:1,DISABLED:2},e.StateToClassMap=function(){var t=e.State,i={}
return i[t.ACTIVE]="active",i[t.INACTIVE]="inactive",i[t.DISABLED]="disabled",i}(),e.prototype=Object.create(i.Control.prototype),e.prototype.constructor=e,e.prototype.setState=function(t){if(t===this._state)return!1
this.removeClass(e.StateToClassMap[this._state]),this.addClass(e.StateToClassMap[t]),this._state=t
var i={type:e.Event.STATE_CHANGED,state:t}
return this.fireEvent(i),!0},e.prototype.setIcon=function(e){this.iconClass&&this.icon.classList.remove(this.iconClass),this.iconClass=e,this.icon.classList.add(e)},e.prototype.getState=function(){return this._state},e.prototype.onClick=function(e){},e.prototype.onMouseOver=function(e){},e.prototype.onMouseOut=function(e){},Autodesk.Viewing.UI.Button=e}(),function(){"use strict"
function e(e,n){t.Button.call(this,e,n),this.arrowButton=new t.Button(e+"arrow"),this.arrowButton.addClass("adsk-button-arrow"),this.arrowButton.removeClass("adsk-button"),this.subMenu=new t.RadioButtonGroup(e+"SubMenu"),this.subMenu.addClass("toolbar-vertical-group"),this.subMenu.setVisible(!1),this.container.insertBefore(this.subMenu.container,this.container.firstChild),this.container.insertBefore(this.arrowButton.container,this.container.firstChild)
var o=this
this.arrowButton.onClick=function(e){o.subMenu.setVisible(!o.subMenu.isVisible())},this.toggleFlyoutVisible=function(){o.subMenu.setVisible(!o.subMenu.isVisible())},this.onClick=function(e){o.subMenu.setVisible(!o.subMenu.isVisible())},this.subMenuActiveButtonChangedHandler=function(e){e.isActiveButton?(o.setIcon(e.target.getActiveButton().iconClass),o.setToolTip(e.target.getActiveButton().getToolTip()),o.setState(t.Button.State.ACTIVE),o.onClick=e.button.onClick):o.setState(t.Button.State.INACTIVE)},this.subMenu.addEventListener(t.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler)
var r=i.stringToDOM('<div class="clickoff" style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>')
this.subMenu.container.insertBefore(r,this.subMenu.container.firstChild),r.addEventListener("click",function(e){o.subMenu.setVisible(!1),e.stopPropagation()})}var t=Autodesk.Viewing.UI,i=Autodesk.Viewing.Private
e.prototype=Object.create(t.Button.prototype),e.prototype.constructor=e,e.prototype.addControl=function(e){this.subMenu.addControl(e),e.addEventListener(t.Button.Event.CLICK,this.toggleFlyoutVisible)},e.prototype.removeControl=function(e){e.removeEventListener(t.Button.Event.CLICK,this.toggleFlyoutVisible)},e.prototype.setState=function(e){if(e===t.Button.State.INACTIVE){var i=this.subMenu.getActiveButton()
i&&i.setState(t.Button.State.INACTIVE)}t.Button.prototype.setState.call(this,e)},e.prototype.saveAsDefault=function(){this.defaultState={},this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")&&(this.defaultState.tooltip=this._toolTipElement.getAttribute("tooltipText")),this.defaultState.icon=this.iconClass,this.defaultState.onClick=this.onClick},e.prototype.restoreDefault=function(){this.defaultState&&(this.defaultState.tooltip&&this.setToolTip(this.defaultState.tooltip),this.defaultState.icon&&this.setIcon(this.defaultState.icon),this.onClick=this.defaultState.onClick,this.setState(t.Button.State.INACTIVE))},Autodesk.Viewing.UI.ComboButton=e}(),function(){"use strict"
function e(i,n){t.ControlGroup.call(this,i,n)
var o=this
this._activeButton=null,this._handleButtonStateChange=function(i){var n=t.Button.State
if(i.state!==n.ACTIVE)return void(i.target===o._activeButton&&(o._activeButton=null,o.fireEvent({type:e.Event.ACTIVE_BUTTON_CHANGED,button:i.target,isActiveButton:!1})))
o._activeButton=i.target,o.fireEvent({type:e.Event.ACTIVE_BUTTON_CHANGED,button:i.target,isActiveButton:!0}),o._controls.forEach(function(e){e!==i.target&&e.getState()!==n.DISABLED&&e.setState(n.INACTIVE)})}}var t=Autodesk.Viewing.UI
e.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:t.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:t.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:t.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:t.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:t.ControlGroup.Event.SIZE_CHANGED},e.prototype=Object.create(t.ControlGroup.prototype),e.prototype.constructor=e,e.prototype.addControl=function(e,i){return e instanceof t.Button&&(!!t.ControlGroup.prototype.addControl.call(this,e,i)&&(e.addEventListener(t.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0))},e.prototype.removeControl=function(e){var i="string"==typeof e?this.getControl(e):e
return!(null===i||!t.ControlGroup.prototype.removeControl.call(this,i))&&(i.removeEventListener(t.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0)},e.prototype.getActiveButton=function(){return this._activeButton},Autodesk.Viewing.UI.RadioButtonGroup=e}(),function(){"use strict"
function e(e,t){i.DomDispatcher.prototype.apply(this),this.viewer=e,this.container=t}var t=AutodeskNamespace("Autodesk.SideBarUi.Content"),i=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils"),n=Autodesk.Viewing
t.Settings=e
var o=e.prototype
e.IDS={SHOW_VIEWCUBE:1,ACT_ON_PIVOT:2,ZOOM_TOWARDS_PIVOT:3,LEFT_MOUSE_PIVOT:4,FUSION_ORBIT:5,REVERSE_MOUSE_ZOOM:6,ORBIT_PAST_POLES:7,OPEN_PROPS_ON_SELECT:8,LEFT_HAND_MOUSE_SETUP:9,MAX_NAV:10,GHOSTING:10,SMOOTH_NAVIGATION:11,ANTIALIASING:12,AMBIENT_SHADOWS:13,GROUND_SHADOWS:14,GROUND_REFLECTIONS:15,ENV_MAP_BG:16,PROGRESSIVE_RENDERING:17,SWAP_BLACK_AND_WHITE:18,RENDER_CACHE:19},e.ELEMENTS=[{id:1,text:"Show ViewCube",pref:"viewCube",defaultValue:!0,mode:["3d"]},{id:2,text:"ViewCube acts on pivot",pref:"alwaysUsePivot",defaultValue:!1,mode:["3d"]},{id:3,text:"Zoom towards pivot",pref:"zoomTowardsPivot",defaultValue:!1,mode:["3d"]},{id:4,text:"Set pivot with left mouse button",pref:"clickToSetCOI",defaultValue:!1,mode:["3d"]},{id:5,text:"Fusion style orbit",pref:"fusionOrbit",defaultValue:!1,mode:["3d"]},{id:6,text:"Reverse mouse zoom direction",pref:"reverseMouseZoomDir",defaultValue:!1,mode:["2d","3d"]},{id:7,text:"Orbit past world poles",pref:"orbitPastWorldPoles",defaultValue:!0,mode:["3d"]},{id:8,text:"Open properties on select",pref:"openPropertiesOnSelect",defaultValue:!0,mode:["2d","3d"]},{id:9,text:"Left handed mouse setup",pref:"leftHandedMouseSetup",defaultValue:!1,mode:["2d","3d"]},{id:10,text:"Ghost hidden objects",pref:"ghosting",defaultValue:!0,mode:["3d"]},{id:11,text:"Smooth navigation",pref:"optimizeNavigation",defaultValue:n.isMobileDevice(),mode:["3d"]},{id:12,text:"Anti-aliasing",pref:"antialiasing",defaultValue:!0,mode:["3d"]},{id:13,text:"Ambient shadows",pref:"ambientShadows",defaultValue:!0,mode:["3d"]},{id:14,text:"Ground shadow",pref:"groundShadow",defaultValue:!0,mode:["3d"]},{id:15,text:"Ground reflection",pref:"groundReflection",defaultValue:!0,mode:["3d"]},{id:16,text:"Environment map for background",pref:"envMapBackground",defaultValue:!0,mode:["3d"]},{id:17,text:"Progressive model display",pref:"progressiveRendering",defaultValue:!0,mode:["2d","3d"]},{id:18,text:"Swap black and white",pref:"swapBlackAndWhite",defaultValue:!1,mode:["2d"]},{id:20,text:"Use RenderCache",pref:"renderCache",defaultValue:!1,mode:["3d"]}],o.load=function(){var t=e.ELEMENTS
e.createDom(this,this.viewer,this.container,t),this.onPrefChangedBinded=this.onPrefChanged.bind(this),this.viewer.addEventListener(n.PREF_CHANGED_EVENT,this.onPrefChangedBinded),this.onPrefResetBinded=this.onPrefReset.bind(this),this.viewer.addEventListener(n.PREF_RESET_EVENT,this.onPrefResetBinded)},o.unload=function(){this.viewer.removeEventListener(n.PREF_CHANGED_EVENT,this.onPrefChangedBinded),this.onPrefChangedBinded=null,this.viewer.addEventListener(n.PREF_RESET_EVENT,this.onPrefResetBinded),this.onPrefResetBinded=null,this.unhookEvents()},o.getTitle=function(){return"Settings"},o.onPrefChanged=function(t){var i=t.name,n=e.getIdFromPref(i)
if(-1!==n){var o='[data-value="'+n+'"]'
this.container.querySelector(o).querySelector("input").checked=t.value}},o.onPrefReset=function(t){var i=t.name,n=e.getIdFromPref(i);-1!==n&&(this.onPrefChanged(t),e.setState(this.viewer,n,t.value))},e.getIdFromPref=function(t){var i=-1
return e.ELEMENTS.forEach(function(e){e.pref===t&&(i=e.id)}),i},e.setState=function(t,i,n){var o=e.IDS
switch(i){case o.SHOW_VIEWCUBE:t.displayViewCube(n)
break
case o.ACT_ON_PIVOT:t.setUsePivotAlways(n)
break
case o.ZOOM_TOWARDS_PIVOT:t.setZoomTowardsPivot(n)
break
case o.LEFT_MOUSE_PIVOT:t.setClickToSetCOI(n)
break
case o.FUSION_ORBIT:n?t.loadExtension("Autodesk.Viewing.FusionOrbit",null):t.unloadExtension("Autodesk.Viewing.FusionOrbit",null)
break
case o.REVERSE_MOUSE_ZOOM:t.setReverseZoomDirection(n)
break
case o.ORBIT_PAST_POLES:t.setOrbitPastWorldPoles(n)
break
case o.OPEN_PROPS_ON_SELECT:t.setPropertiesOnSelect(n)
break
case o.LEFT_HAND_MOUSE_SETUP:t.setUseLeftHandedInput(n)
break
case o.GHOSTING:t.setGhosting(n)
break
case o.SMOOTH_NAVIGATION:t.setOptimizeNavigation(n)
break
case o.ANTIALIASING:t.setQualityLevel(t.prefs.ambientShadows,n)
break
case o.AMBIENT_SHADOWS:t.setQualityLevel(n,t.prefs.antialiasing)
break
case o.GROUND_SHADOWS:t.setGroundShadow(n)
break
case o.GROUND_REFLECTIONS:t.setGroundReflection(n)
break
case o.ENV_MAP_BG:t.setEnvMapBackground(n)
break
case o.PROGRESSIVE_RENDERING:t.setProgressiveRendering(n)
break
case o.SWAP_BLACK_AND_WHITE:t.setSwapBlackAndWhite(n)
break
case o.RENDER_CACHE:t.impl.toggleVizBuffer(n)
break
default:console.log(i)}},e.createDom=function(t,i,n,o){var r=i.model.is2d()?"2d":"3d",s=o.filter(function(e){return-1!==e.mode.indexOf(r)}),a=s.filter(function(t){return t.id<e.IDS.MAX_NAV}),l=s.filter(function(t){return t.id>=e.IDS.MAX_NAV})
e.createTable(n,a,"Navigation and selection"),e.createTable(n,l,"Performance and appearance")
s.forEach(function(t){var o='[data-value="'+t.id+'"]'
n.querySelector(o).querySelector("input").checked=e.isChecked(i,t)}),t.hookEvent(n,"click","tr",function(t,n){var o=parseInt(n.getAttribute("data-value")),r=n.querySelector("input")
t.target!==r&&(r.checked=!r.checked)
var s=r.checked
e.setState(i,o,s)})
var c=document.createElement("button")
c.className="lmv-sidebar-menu-button",c.setAttribute("data-i18n","Restore default settings"),c.textContent=Autodesk.Viewing.i18n.translate("Restore default settings"),n.appendChild(c),t.hookEvent(c,"click","button",function(e,t){var n=r
i.prefs.reset(n)})},e.createTable=function(t,i,n){var o=document.createElement("div")
o.classList.add("lmv-sidebar-menu-heading"),o.setAttribute("data-i18n",n),o.textContent=Autodesk.Viewing.i18n.translate(n),t.appendChild(o)
var r=document.createElement("table")
r.classList.add("adsk-lmv-tftable"),r.classList.add("adsk-lmv-settings")
var s=i.map(e.renderOption)
return r.innerHTML=s.join("\n"),t.appendChild(r),r},e.renderOption=function(e){var t=Autodesk.Viewing.i18n.translate(e.text)
return'<tr data-value="'+e.id+'"><td><div data-i18n="'+e.text+'">'+t+'</div></td><td><input type="checkbox"></td></tr>'},e.isChecked=function(e,t){var i=t.pref?e.prefs[t.pref]:null
return"boolean"==typeof i?i:t.defaultValue}}(),function(){"use strict"
function e(){}var t=AutodeskNamespace("Autodesk.Viewing.Private"),i=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils")
i.DomDispatcher=e,e.prototype={constructor:e,apply:function(t){t.hookEvent=e.prototype.hookEvent,t.unhookEvents=e.prototype.unhookEvents,t.eventsHooked=[]},hookEvent:function(e,i,n,o){var r=function(e){var i=t.DomUtils.seekSelectorUp(e.target,n)
i&&o(e,i)}
e.addEventListener(i,r),this.eventsHooked.push({domElem:e,eventStr:i,callback:r})},unhookEvents:function(){this.eventsHooked.forEach(function(e){e.domElem.removeEventListener(e.eventStr,e.callback)}),this.eventsHooked.length=0}},i.seekSelectorUp=function(e,i){for(;e;){if(t.DomUtils.matchesSelector(e,i))return e
e=e.parentNode}return e},i.matchesSelector=function(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):e.mozMatchesSelector?e.mozMatchesSelector(t):!!e.webkitMatchesSelector&&e.webkitMatchesSelector(t)},i.removeChildren=function(e){e.innerHTML=""},i.remove=function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}}(),function(){"use strict"
function e(e,t){Autodesk.Viewing.Extension.call(this,e,t),i.DomDispatcher.prototype.apply(this),this.currentContent=null}var t=AutodeskNamespace("Autodesk.SideBarUi"),i=AutodeskNamespace("Autodesk.Viewing.Private.DomUtils")
AutodeskNamespace("Autodesk.SideBarUi.Content")
e.populateDefaultOptions=function(e){e.experimental.push("--sidebar-ui")},e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e,t.SideBarUi=e
var n=e.prototype
n.load=function(){return this.openSideMenuBinded=this.openSideMenu.bind(this),this.viewer.addEventListener(av.SIDE_BAR_OPEN_EVENT,this.openSideMenuBinded),!0},n.unload=function(){return this.viewer.removeEventListener(av.SIDE_BAR_OPEN_EVENT,this.openSideMenuBinded),this.openSideMenuBinded=null,this.currentContent&&(this.currentContent.unload(),this.currentContent=null),this.domNav&&(i.remove(this.domNav),this.domNav=null),this.unhookEvents(),!0},n.createSlidingSideBar=function(e){var t=this.domNav=document.createElement("div")
t.className="lmv-sidebar-menu--slide-left"
t.innerHTML=['<button class="lmv-sidebar-menu__title">',"</button>",'<button class="lmv-sidebar-menu-button lmv-sidebar-menu-button__cross">&times;</button>','<div class="lmv-sidebar-menu__content">',"</div>"].join(""),e.appendChild(t),this.domContent=this.domNav.querySelector(".lmv-sidebar-menu__content"),this.domCloseBtn=this.domNav.querySelector("button.lmv-sidebar-menu__title"),this.setCloseButton(),this.hookEvent(this.domNav,"click",".lmv-sidebar-menu__title",function(e){this.toggleCollapsed()}.bind(this)),this.hookEvent(this.domNav,"click",".lmv-sidebar-menu-button__cross",function(e){this.closeSideMenu()}.bind(this))},n.setCloseButton=function(e){var t=e||"Close"
this.domCloseBtn.setAttribute("data-i18n",t),this.domCloseBtn.textContent=Autodesk.Viewing.i18n.translate(t)},n.openSideMenu=function(e){if(this.domNav||this.createSlidingSideBar(this.viewer.container),this.currentContent&&(this.currentContent.unload(),this.currentContent=null,i.removeChildren(this.domContent)),e.content){var t=e.content
this.currentContent=new t(this.viewer,this.domContent),this.currentContent.load()
var n=this.currentContent.getTitle()
this.setCloseButton(n)}var o=this.domNav
requestAnimationFrame(function(){o.classList.remove("is-collapsed"),o.classList.add("is-active")})},n.toggleCollapsed=function(){this.domNav.classList.toggle("is-collapsed"),this.domNav.scrollTop=0},n.closeSideMenu=function(){this.domNav.classList.remove("is-active")},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.SideBarUi",e)}(),function(){function e(){this.ios=window.webkit,this.android=window.JSINTERFACE,this.iosSend=function(e,t){return window.webkit.messageHandlers.callbackHandler.postMessage({command:e,data:t})},this.androidSend=window.JSINTERFACE}AutodeskNamespace("Autodesk.Viewing")
var t=e.prototype
t.animationReady=function(){this.ios?this.iosSend("animationReady"):this.android&&this.androidSend.animationReady()},t.onSelectionChanged=function(e){this.ios?this.iosSend("selectionChanged",e):this.android&&this.androidSend.onSelectionChanged(e)},t.onLongTap=function(e,t){this.ios?this.iosSend("onLongTap",[e,t]):this.android&&this.androidSend.onLongTap(e,t)},t.onSingleTap=function(e,t){this.ios?this.iosSend("onSingleTap",[e,t]):this.android&&this.androidSend.onSingleTap(e,t)},t.onDoubleTap=function(e,t){this.ios?this.iosSend("onDoubleTap",[e,t]):this.android&&this.androidSend.onDoubleTap(e,t)},t.setRTCSession=function(e){this.ios?this.iosSend("setRTCSession",{id:e}):this.android&&this.androidSend.setRTCSessionID(e)},t.putProperties=function(e,t){this.ios?this.iosSend("putProperties",{name:e,value:t}):this.android&&this.androidSend.putProperties(e,t)},t.onPropertyRetrievedSuccess=function(){this.ios?this.iosSend("onPropertyRetrievedSuccess"):this.android&&this.androidSend.onPropertyRetrievedSuccess()},t.onPropertyRetrievedFailOrEmptyProperties=function(){this.ios?this.iosSend("onPropertyRetrievedFailOrEmptyProperties"):this.android&&this.androidSend.onPropertyRetrievedFailOrEmptyProperties()},t.resetAnimationStatus=function(){this.ios?this.iosSend("resetAnimationStatus"):this.android&&this.androidSend.resetAnimationStatus()},t.setPauseUI=function(){this.ios?this.iosSend("setPauseUI"):this.android&&this.androidSend.setToPaused()},t.getDeviceAvailableMemory=function(){return this.ios?this.iosSend("getDeviceAvailableMemory"):this.android?this.androidSend.getDeviceAvailableMemory():void 0},t.onDeviceMemoryInsufficient=function(){return this.ios?this.iosSend("onDeviceMemoryInsufficient"):this.android?this.androidSend.onDeviceMemoryInsufficient():void 0},t.updateAnimationTime=function(e){this.ios?this.iosSend("updateAnimationTime",e):this.android&&this.androidSend.updateAnimationTime(e)},t.setLoadingProgress=function(e,t){this.ios?this.iosSend("setLoadingProgress",{state:e,progress:t}):this.android&&this.androidSend.setLoadingProgress(e,t)},t.objectTreeCreated=function(){this.ios?this.iosSend("objectTreeCreated"):this.android&&this.androidSend.objectTreeCreated()},t.geometryLoaded=function(){this.ios?this.iosSend("geometryLoaded"):this.android&&this.androidSend.geometryLoaded()},t.putSheets=function(e,t){this.ios?this.iosSend("putSheets",[e,t]):this.android&&this.androidSend.putSheets(e,t)},t.putAllSheets=function(e){this.ios?this.iosSend("putAllSheets",e):this.android&&this.androidSend.putAllSheets(e)},t.hideLoadingView=function(){this.android&&this.androidSend.hideLoadingView()},t.instanceTree=function(e){this.ios?this.iosSend("instanceTree",e):this.android&&this.androidSend.instanceTree(e)},t.loadSheetFailed=function(){this.ios?this.iosSend("loadSheetFailed"):this.android&&this.androidSend.loadSheetFailed()},t.sheetSelected=function(e){this.ios?this.iosSend("sheetSelected",e):this.android&&this.androidSend.sheetSelected(e)},Autodesk.Viewing.MobileCallbacks=e,window.MobileCallbacks=e}(),function(){"use strict"
function e(e){return"application/autodesk-db"==e.mime&&e.urn?0===e.urn.indexOf("urn:adsk.objects:os.object")?e.urn.substr(0,e.urn.lastIndexOf("%2F")+3):e.urn.substr(0,e.urn.lastIndexOf("/")+1):null}function t(n,o){if(this.parent=o,this.id=i++,this.data=n,this.isLeaf="geometry"===n.type&&("3d"===n.role||"2d"===n.role||"lod"===n.role),Array.isArray(n.children)){this.children=[]
for(var r=n.children.length,s=0;s<r;s++)this.children[s]=new t(n.children[s],this)
for(var s=0;s<r;s++){var a=e(n.children[s])
a&&(this.sharedPropertyDbPath=a),"lod"===n.children[s].role&&(this.lodNode=this.children[s])}}}var i=1
t.prototype.getRootNode=function(){return this.parent?this.parent.getRootNode():this},t.prototype.findPropertyDbPath=function(){return this.sharedPropertyDbPath?this.sharedPropertyDbPath:this.parent?this.parent.findPropertyDbPath():null},t.prototype._raw=function(){return this.data},t.prototype.name=function(){return this.data.name},t.prototype.guid=function(){return this.data.guid},t.prototype.urn=function(e){var t=this.data.urn
if(!e)return t
for(var i=this.parent;!t&&i;)t=i.data.urn,i=i.parent
return t},t.prototype.getTag=function(e){return(this.data.tags?this.data.tags:this.data)[e]},t.prototype.setTag=function(e,t){this.data.tags?this.data.tags[e]=t:this.data[e]=t},t.prototype.isGeomLeaf=function(){return this.isLeaf},t.prototype.isViewable=function(){return"viewable"===this.data.role},t.prototype.getLodNode=function(){return this.lodNode},t.prototype.isGeometry=function(){return"geometry"===this.data.type},t.prototype.is2D=function(){return"2d"===this.data.role},t.prototype.is3D=function(){return"3d"===this.data.role},t.prototype.is2DGeom=function(){return this.isGeometry()&&this.is2D()},t.prototype.is3DGeom=function(){return this.isGeometry()&&this.is3D()},t.prototype.getPlacementTransform=function(){if(!this.is2DGeom())return this.findViewableParent().getTag("placement")
var e=this.findViewableParent().data.sheet_placement
if(e&&e.placements){var t=e.placements[this.data.viewableID]
if(t)return t}},t.prototype.isMetadata=function(){if(this.data.role){if(-1!==this.data.role.indexOf("Autodesk.CloudPlatform.DesignDescription"))return!0
if("Autodesk.CloudPlatform.PropertyDatabase"===this.data.role)return!0}return!1},t.prototype.findViewableParent=function(){for(var e=this;e&&!e.isViewable();)e=e.parent
return e},t.prototype.findParentGeom2Dor3D=function(){for(var e=this;e&&!e.is2DGeom()&&!e.is3DGeom();)e=e.parent
return e},t.prototype.getViewableRootPath=function(){if(!this.isGeomLeaf())return null
var e=this.is2D()?"application/autodesk-f2d":"application/autodesk-svf",t=this.search({mime:e})
if(t&&t.length){return t[0].data.urn}return null},t.prototype.getNamedViews=function(){var e=this.search({type:"view"})
return e=e.filter(function(e){return!!e.data.name&&!!Array.isArray(e.data.camera)})},t.prototype.findByGuid=function(e){var t=null
return this.traverse(function(i){if(i.data.guid===e)return t=i,!0}),t},t.prototype.search=function(e){var t=[]
return this.traverse(function(i){var n=!0
for(var o in e)if(!i.data.hasOwnProperty(o)||i.data[o]!==e[o]){n=!1
break}n&&t.push(i)}),t.length?t:null},t.prototype.searchByTag=function(e){var t=[]
return this.traverse(function(i){var n=!0
for(var o in e)if(i.getTag(o)!==e[o]){n=!1
break}n&&t.push(i)}),t.length?t:null},t.prototype.traverse=function(e){if(e(this))return!0
if(this.children)for(var t=0;t<this.children.length;t++)if(this.children[t].traverse(e))return!0
return!1},t.prototype.getLevel=function(){var e=this.data.levelNumber
return Array.isArray(e)?e[0]:e},t.MODEL_NODE={role:"3d",type:"geometry"},t.GEOMETRY_SVF_NODE={role:"graphics",mime:"application/autodesk-svf"},t.SHEET_NODE={role:"2d",type:"geometry"},t.GEOMETRY_F2D_NODE={role:"graphics",mime:"application/autodesk-f2d"},t.VIEWABLE_NODE={role:"viewable"},Autodesk.Viewing.BubbleNode=t}(),function(){"use strict"
Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.Wireframes","extensions/Wireframes/Wireframes.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.RaaS","extensions/RaaS/RaaS.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.MarkupsCore","extensions/Markups/Markups.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.MarkupsGui","extensions/Markups/MarkupsGui.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Billboard","extensions/Billboard/Billboard.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.BillboardGui","extensions/Billboard/Billboard.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.Comments","extensions/Comments/Comments.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.InViewerSearch","extensions/InViewerSearch/InViewerSearch.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.WebVR","extensions/WebVR/WebVR.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.MemoryManager","extensions/MemoryManager/MemoryManager.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Viewing.MemoryManager","extensions/MemoryManager/MemoryManager.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Beeline","extensions/Beeline/Beeline.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.FirstPerson","extensions/FirstPerson/FirstPerson.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.BimWalk","extensions/BimWalk/BimWalk.js"),Autodesk.Viewing.theExtensionManager.registerExternalExtension("Autodesk.Debug","extensions/Debug/Debug.js")}(),Autodesk.Viewing.Extensions.ViewerPanelMixin=function(){this.getContainerBoundingRect=function(){var e=this.parentContainer.getBoundingClientRect(),t={height:0,width:0,left:0,bottom:0,right:0,top:0},i=document.getElementsByClassName("toolbar-menu")
return i&&i.length>0&&(t=i[0].getBoundingClientRect()),{height:e.height-t.height,width:e.width,left:e.left,bottom:e.bottom-t.height,right:e.right,top:e.top}}},function(){"use strict"
var e=Autodesk.Viewing,t=(Autodesk.Viewing.Private,Autodesk.Viewing.UI),i=Autodesk.Viewing.Extensions,n={click:{onObject:["isolate"]},clickCtrl:{onObject:["toggleVisibility"]}}
i.ViewerModelStructurePanel=function(e,i,o){this.viewer=e,o=o||{},o.heightAdjustment=75,t.ModelStructurePanel.call(this,e.container,e.container.id+"ViewerModelStructurePanel",i,o),this.clickConfig=o&&o.docStructureConfig?o.docStructureConfig:n,this.isMac=-1!==navigator.userAgent.search("Mac OS"),this.initSearchBox(),this.prevSearchResults=[],this.prevSearchString=""},i.ViewerModelStructurePanel.prototype=Object.create(t.ModelStructurePanel.prototype),i.ViewerModelStructurePanel.prototype.constructor=i.ViewerModelStructurePanel,i.ViewerPanelMixin.call(i.ViewerModelStructurePanel.prototype),i.ViewerModelStructurePanel.prototype.initialize=function(){t.ModelStructurePanel.prototype.initialize.call(this)
var i=this
i.addEventListener(i.viewer,e.SELECTION_CHANGED_EVENT,function(e){i.setSelection(e.nodeArray.slice())}),i.addEventListener(i.viewer,e.ISOLATE_EVENT,function(e){i.setIsolation(e.nodeIdArray.slice())}),i.addEventListener(i.viewer,e.HIDE_EVENT,function(e){i.setHidden(e.nodeIdArray.slice(),!0)}),i.addEventListener(i.viewer,e.SHOW_EVENT,function(e){i.setHidden(e.nodeIdArray.slice(),!1)})},i.ViewerModelStructurePanel.prototype.uninitialize=function(){this.viewer=null,t.ModelStructurePanel.prototype.uninitialize.call(this)},i.ViewerModelStructurePanel.prototype.handleAction=function(e,t){for(var i in e)switch(e[i]){case"selectOnly":this.viewer.select(t)
break
case"deselectAll":this.viewer.select([])
break
case"selectToggle":this.viewer.toggleSelect(t)
break
case"isolate":this.viewer.isolate(t)
break
case"showAll":this.viewer.isolate(null)
break
case"focus":this.viewer.fitToView()
break
case"hide":this.viewer.hide(t)
break
case"show":this.viewer.show(t)
break
case"toggleVisibility":this.viewer.toggleVisibility(t)}},i.ViewerModelStructurePanel.prototype.ctrlDown=function(e){return this.isMac&&e.metaKey||!this.isMac&&e.ctrlKey},i.ViewerModelStructurePanel.prototype.onClick=function(e,t){if(!this.isMac||!t.ctrlKey){var i=this,n="click"
i.ctrlDown(t)&&(n+="Ctrl"),t.shiftKey&&(n+="Shift"),t.altKey&&(n+="Alt"),this.clickConfig&&this.clickConfig[n]?i.handleAction(this.clickConfig[n].onObject,e):this.viewer.select(e)}},i.ViewerModelStructurePanel.prototype.onDoubleClick=function(e,t){this.handleAction(["focus"],e)},i.ViewerModelStructurePanel.prototype.onHover=function(e,t){this.viewer.impl.rolloverObjectNode(e)},i.ViewerModelStructurePanel.prototype.onRightClick=function(e,t){if(this.isMac&&t.ctrlKey&&0===t.button)return this.clickConfig&&this.clickConfig.clickCtrl?this.handleAction(this.clickConfig.clickCtrl.onObject,e):this.viewer.select(e),null
var i=[],n=!0
if(t.shiftKey||this.isMac&&t.metaKey||t.ctrlKey&&(this.isMac||2===t.button))for(var o=this.viewer.impl.selector.getSelection(),r=0;r<o.length;++r)o[r]!==e?i.push(o[r]):n=!1
return n&&i.push(e),this.viewer.select(i),this.viewer.contextMenu.show(t)},i.ViewerModelStructurePanel.prototype.setHidden=function(e,t){this.uiCreated||this.createUI()
for(var i=0;i<e.length;++i)this.tree&&this.tree.iterate(e[i],t?function(e,i){i.classList.add("dim"),i.classList.remove("visible",!t)}:function(e,t){t.classList.remove("dim"),t.classList.add("visible")})},i.ViewerModelStructurePanel.prototype.setIsolation=function(e){if(void 0!==this.rootId&&null!==this.rootId){if(this.tree&&this.tree.iterate(this.rootId,function(e,t){t.classList.remove("dim"),t.classList.remove("visible")}),e.length>0){if(1===e.length&&e[0]===this.rootId)return
this.setHidden([this.rootId],!0),this.setHidden(e,!1)}this.searchbox&&!this.inSearchIsolate&&(this.searchbox.value="")}},i.ViewerModelStructurePanel.prototype.initSearchBox=function(){function t(){if(!r.isSearching){for(var e=0;e<r.prevSearchResults.length;e++)r.tree.setCollapsed(r.prevSearchResults[e],!0,!0)
if(0===i.value.length)r.isSearching=!1,r.prevSearchString="",o.isolate()
else{if(r.prevSearchString==i.value)return
r.isSearching=!0,o.search(i.value,function(e){if(r.inSearchIsolate=!0,o.isolate(e),r.inSearchIsolate=!1,e.length){for(var t=0;t<e.length;t++)r.tree.setCollapsed(e[t],!1,!0)
r.resizeToContent(),r.tree.scrollTo(e[0])}r.prevSearchResults=e,r.isSearching=!1},null,["name"])}}}var i=document.createElement("input")
i.className="toolbar-search-box",i.type="search",i.results=5,i.placeholder=e.i18n.translate("Filter by name"),i.incremental="incremental",i.autosave=this.container.id+"search_autosave",i.setAttribute("data-i18n","[placeholder]Filter by name"),this.scrollContainer.parentNode.insertBefore(i,this.scrollContainer),this.searchbox=i
var n,o=this.viewer,r=this
i.addEventListener("input",function(e){clearTimeout(n),n=setTimeout(t,500)}),i.addEventListener("change",function(e){clearTimeout(n),t()})}}(),function(){"use strict"
var e=Autodesk.Viewing,t=e.UI,i=function(e){this.viewer=e,this.currentNodeIds=[],this.currentModel=null,this.isSelection=!1,this.isDirty=!0,this.propertyNodeId=null,t.PropertyPanel.call(this,e.container,"ViewerPropertyPanel","Object Properties Loading...")}
i.prototype=Object.create(t.PropertyPanel.prototype),i.prototype.constructor=i,e.Extensions.ViewerPanelMixin.call(i.prototype),i.prototype.initialize=function(){t.PropertyPanel.prototype.initialize.call(this)
var i=this
i.addEventListener(i.viewer,e.AGGREGATE_SELECTION_CHANGED_EVENT,function(e){e.selections&&e.selections.length?(i.currentNodeIds=e.selections[0].dbIdArray,i.currentModel=e.selections[0].model,i.isSelection=e.selections[0].dbIdArray.length>0):i.isSelection=!1,i.isDirty=!0,i.requestProperties()}),i.addEventListener(i.viewer,e.ISOLATE_EVENT,function(e){0==e.nodeIdArray.length&&i.isSelection||(i.currentModel=e.model,i.currentNodeIds=e.nodeIdArray,i.isDirty=!0,i.requestProperties())}),i.addEventListener(i.viewer,e.HIDE_EVENT,function(e){i.isDirty=!0,i.requestProperties()}),i.addEventListener(i.viewer,e.SHOW_EVENT,function(e){i.isDirty=!0,i.requestProperties()}),this.currentModel=i.viewer.model,this.currentNodeIds=i.viewer.getSelection(),0===this.currentNodeIds.length?this.currentNodeIds=i.viewer.getIsolatedNodes():this.isSelection=!0},i.prototype.setTitle=function(e,i){e||(e="Object Properties",i=i||{},i.localizeTitle=!0),t.PropertyPanel.prototype.setTitle.call(this,e,i)},i.prototype.setVisible=function(e){t.DockingPanel.prototype.setVisible.call(this,e),this.requestProperties()},i.prototype.visibilityChanged=function(){t.DockingPanel.prototype.visibilityChanged.call(this),this.isVisible()&&this.requestProperties()},i.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(this.currentNodeIds.length>0?this.setNodeProperties(this.currentNodeIds[this.currentNodeIds.length-1]):this.showDefaultProperties(),this.isDirty=!1)},i.prototype.setNodeProperties=function(e){var t=this
this.propertyNodeId=e,t.currentModel.getProperties(e,function(e){if(t.viewer&&(t.setTitle(e.name),t.setProperties(e.properties),t.highlight(t.viewer.searchText),t.resizeToContent(),t.isVisible())){var i=t.viewer.toolController,n=i.lastClickX,o=i.lastClickY,r=t.container.getBoundingClientRect(),s=r.left,a=r.top,l=r.width,c=r.height,d=t.viewer.canvas.getBoundingClientRect(),u=d.left,h=d.top,p=d.width,m=d.height
s<=n&&n<s+l&&a<=o&&o<a+c&&(n<s+l/2&&n+l<u+p?(t.container.style.left=Math.round(n-u)+"px",t.container.dockRight=!1):u<=n-l?(t.container.style.left=Math.round(n-u-l)+"px",t.container.dockRight=!1):n+l<u+p?(t.container.style.left=Math.round(n-u)+"px",t.container.dockRight=!1):o+c<h+m?(t.container.style.top=Math.round(o-h)+"px",t.container.dockBottom=!1):h<=o-c&&(t.container.style.top=Math.round(o-h-c)+"px",t.container.dockBottom=!1))}})},i.prototype.showDefaultProperties=function(){var e=this.currentModel.getRootId()
e?this.setNodeProperties(e):(this.propertyNodeId=null,this.setTitle("Model Properties",{localizeTitle:!0}),t.PropertyPanel.prototype.showDefaultProperties.call(this))},i.prototype.areDefaultPropertiesShown=function(){var e=this.currentModel.getRootId()
return this.propertyNodeId===e},i.prototype.uninitialize=function(){t.PropertyPanel.prototype.uninitialize.call(this),this.viewer=null},i.prototype.onCategoryClick=function(e,i){t.PropertyPanel.prototype.onCategoryClick.call(this,e,i),this.resizeToContent()},i.prototype.onCategoryIconClick=function(e,i){t.PropertyPanel.prototype.onCategoryIconClick.call(this,e,i),this.resizeToContent()},Autodesk.Viewing.Extensions.ViewerPropertyPanel=i}(),function(){"use strict"
var e=function(e){var t=e.container
Autodesk.Viewing.UI.LayersPanel.call(this,e,t,t.id+"ViewerLayersPanel"),this.onRestoreStateBinded=this.onRestoreState.bind(this),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded)}
e.prototype=Object.create(Autodesk.Viewing.UI.LayersPanel.prototype),e.prototype.constructor=e,Autodesk.Viewing.Extensions.ViewerPanelMixin.call(e.prototype),e.prototype.uninitialize=function(){this.onRestoreStateBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_STATE_RESTORED_EVENT,this.onRestoreStateBinded),this.onRestoreStateBinded=null),Autodesk.Viewing.UI.LayersPanel.prototype.uninitialize.call(this)},e.prototype.onRestoreState=function(){this.update()},e.prototype.onClick=function(e,t){if(!this.isMac||!t.ctrlKey){var i=!(t.shiftKey||t.metaKey||t.ctrlKey)
this.setLayerVisible(e,i)}},e.prototype.onRightClick=function(e,t){var i=!(t.shiftKey||t.metaKey||t.ctrlKey)
this.setLayerVisible(e,i)},e.prototype.onImageClick=function(e,t){this.isMac&&t.ctrlKey||this.setLayerVisible(e)},e.prototype.onTitleClick=function(e){this.viewer.setLayerVisible(null,!0)},e.prototype.onTitleDoubleClick=function(e){this.viewer.fitToView()},Autodesk.Viewing.Extensions.ViewerLayersPanel=e}(),function(){"use strict"
var e=Autodesk.Viewing,t=e.Private,i=Autodesk.Viewing.Extensions,n=Autodesk.Viewing.UI
i.ViewerSettingTab={Navigation:"navigationtab",Performance:"performancetab"}
var o=function(o,r){this.viewer=o,this.is3dMode=!r.is2d(),n.SettingsPanel.call(this,o.container,"ViewerSettingsPanel"+o.id,"Settings",{width:400,heightAdjustment:155}),this.addTab(i.ViewerSettingTab.Navigation,"Navigation and selection",{className:"navigation"}),this.addTab(i.ViewerSettingTab.Performance,"Performance and appearance",{className:"performance"}),this.restoreDiv=document.createElement("div"),this.restoreDiv.className="viewer-restore-defaults",this.restoreDiv.setAttribute("data-i18n","Restore default settings"),this.restoreDiv.textContent=Autodesk.Viewing.i18n.translate("Restore default settings"),this.addEventListener(this.restoreDiv,"touchstart",e.touchStartToClick),this.addEventListener(this.restoreDiv,"click",function(){o.fireEvent({type:e.RESTORE_DEFAULT_SETTINGS_EVENT})},!1),this.container.appendChild(this.restoreDiv),this.modelPreferenceCount=0,this.createNavigationPanel(),this.createPerformancePanel(),this.modelPreferenceCount&&t.logger.log("Model locked ("+this.modelPreferenceCount+") render settings in UI.")}
o.prototype=Object.create(n.SettingsPanel.prototype),o.prototype.constructor=o,i.ViewerPanelMixin.call(o.prototype),o.prototype.uninitialize=function(){this.viewer=null,n.SettingsPanel.prototype.uninitialize.call(this),this.envSelect=null},o.prototype.addCheckbox=function(e,t,i,o,r){function s(e){r&&a.prefs.set(r,e),o(e)}var a=this.viewer,l=a.prefs[r]
i="boolean"==typeof l?l:i
var c=n.SettingsPanel.prototype.addCheckbox.call(this,e,t,i,s),d=this.getControl(c)
return d.saveKey=r,r?a.prefs.addListeners(r,function(e){d.setValue(e)},function(e){d.setValue(e),o(e)}):d.sliderRow.classList.add("logicalgroup"),a.prefs.hasTag(r,"no-storage")&&(d.sliderRow.classList.add("no-storage"),this.modelPreferenceCount++),c},o.prototype.addDropdown=function(e,i,n,o,r,s,a){var l=new t.OptionDropDown(e,i,n,o,r)
return this.addEventListener(l,"change",s),a&&this.viewer.prefs.addListeners(a,function(e){l.dropdownElement.selectedIndex=e},function(e){l.dropdownElement.selectedIndex=e,s(e)}),l},o.prototype.removeCheckbox=function(e){return this.viewer.prefs.removeListeners(e.saveKey),this.removeEventListener(e,"change",e.changeListener),n.SettingsPanel.prototype.removeCheckbox.call(this,e)},o.prototype.createNavigationPanel=function(){var e=this.viewer,t=i.ViewerSettingTab.Navigation
this.is3dMode&&(this.addCheckbox(t,"Show ViewCube",!0,function(t){e.displayViewCube(t)},"viewCube"),this.addCheckbox(t,"ViewCube acts on pivot",!1,function(t){e.setUsePivotAlways(t)},"alwaysUsePivot"),this.addCheckbox(t,"Zoom towards pivot",!1,function(t){e.setZoomTowardsPivot(t)},"zoomTowardsPivot"),this.addCheckbox(t,"Set pivot with left mouse button",!1,function(t){e.setClickToSetCOI(t)},"clickToSetCOI"),this.addCheckbox(t,"Fusion style orbit",!1,function(t){t?e.loadExtension("Autodesk.Viewing.FusionOrbit",null):e.unloadExtension("Autodesk.Viewing.FusionOrbit",null)},"fusionOrbit")),this.addCheckbox(t,"Reverse mouse zoom direction",!1,function(t){e.setReverseZoomDirection(t)},"reverseMouseZoomDir"),this.is3dMode&&this.addCheckbox(t,"Orbit past world poles",!0,function(t){e.setOrbitPastWorldPoles(t)},"orbitPastWorldPoles"),this.addCheckbox(t,"Open properties on select",!0,function(t){e.setPropertiesOnSelect(t)},"openPropertiesOnSelect"),this.addCheckbox(t,"Left handed mouse setup",!1,function(t){e.setUseLeftHandedInput(t)},"leftHandedMouseSetup"),this.is3dMode&&this.addCheckbox(t,"New First Person Tool Prototype",e.prefs.get("useFirstPersonPrototype"),function(t){t?(e.unloadExtension("Autodesk.FirstPerson",e.config),e.loadExtension("Autodesk.BimWalk",e.config)):(e.unloadExtension("Autodesk.BimWalk",e.config),e.loadExtension("Autodesk.FirstPerson",e.config))},"useFirstPersonPrototype")},o.prototype.refreshParentCheckbox=function(e,t){for(var i=this,n=0;n<e.length;n++){if(!1===i.getControl(e[n]).getValue())return void i.getControl(t).setValue(!1)}i.getControl(t).setValue(!0)},o.prototype.createPerformancePanel=function(){function n(e,t){for(var i=0;i<e.length;i++)o.getControl(e[i]).setChecked(t)}var o=this,r=this.viewer,s=i.ViewerSettingTab.Performance,a=this.scrollContainer.childNodes[1],l={perfoptimizationGroup:[],visualoptimizationGroup:[]}
if(this.is3dMode){this.perfOptimizationBoxId=this.addCheckbox(s,"Performance Optimization",!1,function(e){n(l.perfoptimizationGroup,e)}),this.optimizeNavigationhkBoxId=this.addCheckbox(s,"Smooth navigation",e.isMobileDevice(),function(e){r.setOptimizeNavigation(e),o.refreshParentCheckbox(l.perfoptimizationGroup,o.perfOptimizationBoxId)},"optimizeNavigation"),l.perfoptimizationGroup.push(this.optimizeNavigationhkBoxId),this.progressiveRenderChkBoxId=this.addCheckbox(s,"Progressive model display",!0,function(e){r.setProgressiveRendering(e),o.refreshParentCheckbox(l.perfoptimizationGroup,o.perfOptimizationBoxId)},"progressiveRendering"),l.perfoptimizationGroup.push(this.progressiveRenderChkBoxId),this.visualOptimizationBoxId=this.addCheckbox(s,"Visual Quality Optimization",!1,function(e){n(l.visualoptimizationGroup,e)}),this.antialiasingChkBoxId=this.addCheckbox(s,"Anti-aliasing",!0,function(e){r.setQualityLevel(r.prefs.ambientShadows,e),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"antialiasing"),l.visualoptimizationGroup.push(this.antialiasingChkBoxId),this.ambientshadowsChkBoxId=this.addCheckbox(s,"Ambient shadows",!0,function(e){r.setQualityLevel(e,r.prefs.antialiasing),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"ambientShadows"),l.visualoptimizationGroup.push(this.ambientshadowsChkBoxId),this.groundShadowChkBoxId=this.addCheckbox(s,"Ground shadow",!0,function(e){r.setGroundShadow(e),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"groundShadow"),l.visualoptimizationGroup.push(this.groundShadowChkBoxId),this.groundReflectionChkBoxId=this.addCheckbox(s,"Ground reflection",!1,function(e){r.setGroundReflection(e),o.refreshParentCheckbox(l.visualoptimizationGroup,o.visualOptimizationBoxId)},"groundReflection"),l.visualoptimizationGroup.push(this.groundReflectionChkBoxId),this.viewerBehaviorLabel=new t.OptionLabel("Viewer Behavior",a.tBodies[0]),this.viewerBehaviorLabel.sliderRow.classList.add("logicalgroup"),this.ghosthiddenChkBoxId=this.addCheckbox(s,"Ghost hidden objects",!0,function(e){r.setGhosting(e)},"ghosting"),this.displayLinesId=this.addCheckbox(s,"Display Lines",!0,function(e){r.hideLines(!e)},"lineRendering"),this.displayPointsId=this.addCheckbox(s,"Display Points",!0,function(e){r.hidePoints(!e)},"pointRendering"),this.displayEdgesId=this.addCheckbox(s,"Display edges",!1,function(e){r.setDisplayEdges(e)},"edgeRendering"),this.environmentLabel=new t.OptionLabel("Environment",a.tBodies[0]),this.environmentLabel.sliderRow.classList.add("logicalgroup"),this.envMapBackgroundChkBoxId=this.addCheckbox(s,"Environment Image Visible",!0,function(e){r.setEnvMapBackground(e)},"envMapBackground")
for(var c=[],d=0;d<t.LightPresets.length;d++)c.push(t.LightPresets[d].name)
var u=this.envSelect=this.addDropdown("Environment and Lighting Selection",a.tBodies[0],c,r.impl.currentLightPreset(),!0,function(e){var t=u.dropdownElement.selectedIndex
r.setLightPreset(t)},"lightPreset")}this.is3dMode||(this.perfOptimizationLabel=new t.OptionLabel("Performance Optimization",a.tBodies[0]),this.perfOptimizationLabel.sliderRow.classList.add("logicalgroup"),this.progressiveRenderChkBoxId2d=this.addCheckbox(s,"Progressive model display",!0,function(e){r.setProgressiveRendering(e)},"progressiveRendering"),this.viewerBehaviorLabel=new t.OptionLabel("Viewer Behavior",a.tBodies[0]),this.viewerBehaviorLabel.sliderRow.classList.add("logicalgroup"),this.swapBlackAndWhiteChkBoxId=this.addCheckbox(s,"Switch sheet color white to black",!0,function(e){r.setSwapBlackAndWhite(e)},"swapBlackAndWhite"))},o.prototype.syncUI=function(){var e=this.viewer,t=this.getControl(this.perfOptimizationBoxId),i=this.getControl(this.visualOptimizationBoxId),n=this.getControl(this.optimizeNavigationhkBoxId),o=this.getControl(this.antialiasingChkBoxId)
o&&o.setValue(e.prefs.antialiasing)
var r=this.getControl(this.ambientshadowsChkBoxId)
r&&r.setValue(e.prefs.ambientShadows)
var s=this.getControl(this.groundShadowChkBoxId)
s&&s.setValue(e.prefs.groundShadow)
var a=this.getControl(this.groundReflectionChkBoxId)
a&&a.setValue(e.prefs.groundReflection)
var l=this.getControl(this.envMapBackgroundChkBoxId)
l&&l.setValue(e.impl.isEnvMapBackground())
var c=this.getControl(this.progressiveRenderChkBoxId)
c&&c.setValue(e.prefs.progressiveRendering)
var d=this.getControl(this.swapBlackAndWhiteChkBoxId)
d&&d.setValue(e.prefs.swapBlackAndWhite)
var u=this.getControl(this.ghosthiddenChkBoxId)
if(u&&u.setValue(e.prefs.ghosting),this.is3dMode){var h=c.getValue(),p=n.getValue(),m=o.getValue(),g=r.getValue(),f=s.getValue(),v=a.getValue()
h&&p?t.setValue(!0):t.setValue(!1),m&&g&&f&&v?i.setValue(!0):i.setValue(!1)
var E=this.getControl(this.displayLinesId)
E&&E.setValue(e.prefs.lineRendering)
var y=this.getControl(this.displayPointsId)
y&&y.setValue(e.prefs.pointRendering)
var A=this.getControl(this.displayEdgesId)
A&&A.setValue(e.prefs.edgeRendering)}},i.ViewerSettingsPanel=o}(),function(){"use strict"
function e(e){t.ObjectContextMenu.call(this,e)}var t=Autodesk.Viewing.UI,i=Autodesk.Viewing.Private
e.prototype=Object.create(t.ObjectContextMenu.prototype),e.prototype.constructor=e,e.prototype.buildMenu=function(e,t){var n=this,o=[],r=this.viewer.navigation,s=this.viewer.model.is2d(),a=this.viewer.container.getBoundingClientRect(),l=e.clientX-a.left,c=e.clientY-a.top,d=n.viewer.impl.hitTest(l,c,!1)
if(d&&d.dbId){-1==d.model.selector.getSelection().indexOf(d.dbId)&&this.viewer.impl.selector.setSelection([d.dbId],d.model),t.hasSelected=!0,t.hasVisible=!0}t.hasSelected&&(o.push({title:"Isolate",target:function(){var e=n.viewer.getAggregateSelection(),t=n.viewer.impl.modelQueue().getModels().concat()
for(e.forEach(function(e){e.model.visibilityManager.isolate(e.selection)
var i=t.indexOf(e.model)
i>=0&&t.splice(i,1)});t.length;)t.pop().visibilityManager.setAllVisibility(!1)
n.viewer.clearSelection(),i.logger.track({name:"isolate_count",aggregate:"count"})}}),t.hasVisible&&o.push({title:"Hide Selected",target:function(){var e=n.viewer.impl.visibilityManager
n.viewer.getAggregateSelection(function(t,i){e.hide(i,t)}),n.viewer.clearSelection()}}),t.hasHidden&&o.push({title:"Show Selected",target:function(){var e=n.viewer.getSelection()
n.viewer.clearSelection(),n.viewer.show(e)}})),s&&o.push({title:"Show All Layers",target:function(){n.viewer.setLayerVisible(null,!0)}}),o.push({title:"Show All Objects",target:function(){n.viewer.showAll(),i.logger.track({name:"showall",aggregate:"count"})}})
var u=n.viewer.getAggregateSelection()
return!s&&1===u.length&&r.isActionEnabled("gotoview")&&o.push({title:"Focus",target:function(){if(u=n.viewer.getAggregateSelection(),u.length>0){var e=u[0]
n.viewer.fitToView(e.selection,e.model)}else 0===u.length&&n.viewer.fitToView()
i.logger.track({name:"fittoview",aggregate:"count"})}}),t.hasSelected&&o.push({title:"Clear Selection",target:function(){n.viewer.clearSelection(),i.logger.track({name:"clearselection",aggregate:"count"})}}),o},Autodesk.Viewing.Extensions.ViewerObjectContextMenu=e}(),function(){"use strict"
function e(e,t){Autodesk.Viewing.Extension.call(this,e,t)}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360")
e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e,e.prototype.load=function(){function e(){i.impl.setLightPreset(0,!0),i.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e)}var i=this.viewer,n=new t.CAMModelStructurePanel(this.viewer,"CAM Model Structure Loading",this.options)
return i.setModelStructurePanel(n),i.hideLines(!1),i.setGhosting(!1),i.setQualityLevel(!1,!0),i.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e),!0},e.prototype.unload=function(){this.viewer.setModelStructurePanel(null)},t.CAM360Extension=e,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.CAM360",t.CAM360Extension)}(),function(){"use strict"
function e(e,t,n){i.ViewerModelStructurePanel.call(this,e,t,n),this.viewer=e}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360"),i=Autodesk.Viewing.Extensions
e.prototype=Object.create(i.ViewerModelStructurePanel.prototype),e.prototype.constructor=e,e.prototype.sortCamNodes=function(e,t){function i(e,t){function i(e,t){for(var i=0;i<e.length;++i){var n=e[i]
if(n.displayName===t)return n.displayValue}return null}function n(n){var r=i(n.properties,"9429B915-D020-4CEB-971B-6ADD0A5D4BFA")
r?("CAM_Setup"==r?o.camSetupNodes.push(e):"CAM_Operation"==r?o.camOperationNodes.push(e):"CAM_Tool"===r?o.camToolNodes.push(e):"CAM_Stock"===r?o.camStockNodes.push(e):"CAM_Folder"==r&&o.camFolderNodes.push(e),o.camNodes.push(e)):o.camModelNodes.push(e),t()}function r(e,i,n){t()}o.viewer.getProperties(e,n,r)}function n(){r.length>0?i(r.shift(),n):t()}this.camNodes=[],this.camModelNodes=[],this.camSetupNodes=[],this.camStockNodes=[],this.camOperationNodes=[],this.camToolNodes=[],this.camFolderNodes=[]
var o=this,r=[]
e.enumNodeChildren(e.getRootId(),function(e){r.push(e)},!0),r.shift(),n()},e.prototype.setModel=function(e,t){var n=this
n.sortCamNodes(e,function(){i.ViewerModelStructurePanel.prototype.setModel.call(n,e,t),n.SetCAMNodeVisible(!1),n.setVisible(!0),n.ExpandSetupNodes(),n.resizeToContent()})},e.prototype.initialize=function(){function e(i){t.SetCAMNodeVisible(!1),t.removeEventListener(t.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e)}i.ViewerModelStructurePanel.prototype.initialize.call(this)
var t=this
this.viewer.model&&this.viewer.model.isLoadDone()||t.addEventListener(t.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e),t.addEventListener(t.viewer,Autodesk.Viewing.SHOW_EVENT,function(e){var i=e.nodeIdArray
if(i)for(var n=0;n<i.length;n++)t.setCamNodeVisibility(i[n])}),t.addEventListener(t.viewer,Autodesk.Viewing.SELECTION_CHANGED_EVENT,function(e){var i=e.nodeArray
if(i)for(var n=0;n<i.length;n++)t.HideHightlightCAMNode(i[n])}),t.addEventListener(t.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(e){var i=e.nodeIdArray
if(i)if(0==i.length)t.SetModelVisible(),t.SetCAMNodeVisible(!0)
else for(var n=0;n<i.length;n++)t.setCamNodeVisibility(i[n])})},e.prototype.IsCAMNode=function(e){return-1!==this.camNodes.indexOf(e)},e.prototype.IsCAMSetupNode=function(e){return-1!==this.camSetupNodes.indexOf(e)},e.prototype.IsCAMStockNode=function(e){return-1!==this.camStockNodes.indexOf(e)},e.prototype.IsCAMToolNode=function(e){return-1!==this.camToolNodes.indexOf(e)},e.prototype.IsCAMOperationNode=function(e){return-1!==this.camOperationNodes.indexOf(e)},e.prototype.IsCAMFolderNode=function(e){return-1!==this.camFolderNodes.indexOf(e)},e.prototype.shouldInclude=function(e){return!this.IsCAMStockNode(e)},e.prototype.isGroupNode=function(e){return!this.IsCAMOperationNode(e)&&i.ViewerModelStructurePanel.prototype.isGroupNode.call(this,e)},e.prototype.setNodeVisibility=function(e,t){t?this.viewer.show(e):this.viewer.hide(e)},e.prototype.SetModelVisible=function(){if(this.camModelNodes)for(var e=0;e<this.camModelNodes.length;e++)this.setNodeVisibility(this.camModelNodes[e],!0)},e.prototype.SetCAMNodeVisible=function(e){if(this.camNodes){for(var t=0;t<this.camNodes.length;t++)this.setNodeVisibility(this.camNodes[t],e)
this.SetToolNodeVisible(!1)}},e.prototype.SetToolNodeVisible=function(e){if(this.camToolNodes)for(var t=0;t<this.camToolNodes.length;t++)this.setNodeVisibility(this.camToolNodes[t],e)},e.prototype.HideHightlightNode=function(e){var t=this.viewer.impl,i=this
i.instanceTree.enumNodeFragments(e,function(e){t.highlightFragment(i.model,e,!1,!0)},!0)},e.prototype.HideHightlightCAMNode=function(e){var t=this.IsCAMSetupNode(e),i=this.IsCAMOperationNode(e),n=this.IsCAMFolderNode(e),o=this
o.instanceTree.enumNodeChildren(e,function(e){t?o.IsCAMStockNode(e)||o.HideHightlightNode(e):i?o.IsCAMToolNode(e)&&o.HideHightlightNode(e):n&&o.HideHightlightNode(e)},!1)},e.prototype.setCamNodeVisibility=function(e){var t=this.IsCAMSetupNode(e),i=this.IsCAMOperationNode(e),n=this.IsCAMFolderNode(e),o=this
t?this.instanceTree.enumNodeChildren(e,function(e){var t=o.IsCAMStockNode(e)
o.setNodeVisibility(e,t)}):i?this.instanceTree.enumNodeChildren(e,function(e){o.IsCAMToolNode(e)&&o.setNodeVisibility(e,!1)}):n&&this.instanceTree.enumNodeChildren(e,function(e){o.setNodeVisibility(e,!1)})},e.prototype.onClick=function(e,t){i.ViewerModelStructurePanel.prototype.onClick.call(this,e,t),this.SetModelVisible(),this.setCamNodeVisibility(e),this.viewer.fitToView()},e.prototype.ExpandSetupNodes=function(){if(this.camSetupNodes)for(var e=0;e<this.camSetupNodes.length;e++)this.tree.setCollapsed(this.camSetupNodes[e],!1)},t.CAMModelStructurePanel=e}(),function(){"use strict"
function e(e){var t=""
e<0&&(t="-",e=-e)
var i=~~(e/3600),n=~~(e%3600/60),o=e%60,r=t
return i>0&&(r+=i+":"+(n<10?"0":"")),r+=n+":"+(o<10?"0":""),r+=o.toFixed(2)}var t=Autodesk.Viewing,i=t.UI
t.ANIMATION_PLAY_EVENT="animationPlayEvent",t.ANIMATION_PAUSE_EVENT="animationPauseEvent",t.ANIMATION_SEEK_EVENT="animationSeekEvent",t.ANIMATION_PREVIOUS_FRAME_EVENT="animationPreviousFrameEvent",t.ANIMATION_NEXT_FRAME_EVENT="animationNextFrameEvent",t.ANIMATION_TRACK_UPDATE_EVENT="animationTrackUpdateEvent",t.ANIMATION_TOOLBAR_CLOSE_EVENT="animationToolbarCloseEvent"
var n=function(e,i){t.Extension.call(this,e,i),this.viewer=e,this.animTools=null,this.animToolsId="animationTools",this.playButton=null,this.playButtonIsPaused=!0,this.prevAnimationTime=-1}
n.prototype=Object.create(t.Extension.prototype),n.prototype.constructor=n,n.prototype.load=function(){var e=this.viewer
return this.onPlayCallbackBinded=this.onPlayCallback.bind(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onExplodeBinded=this.onExplode.bind(this),this.onResizeBinded=this.onResize.bind(this),this.onEscapeBinded=this.onEscape.bind(this),e.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),e.addEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),e.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded),e.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,this.onEscapeBinded),e.model&&e.model.isObjectTreeCreated()?this.onAnimationReady():(this.onAnimationReadyBinded=this.onAnimationReady.bind(this),e.addEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded)),!0},n.prototype.unload=function(){var e=this.viewer
if(this.onAnimationReadyBinded&&(e.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),this.rewind(),e.impl.invalidate(!0,!0,!0),this.onPlayCallbackBinded=null,this.animTools&&(this.animTools.removeControl(this.animTools.timeText.getId()),this.animTools.removeControl(this.animTools.timeline.getId()),this.animTools.removeControl(this.animTools.timeLeftText.getId()),this.animTools.removeControl(this.animTools.forwardButton.getId()),this.animTools.removeControl(this.animTools.backwardButton.getId()),this.animTools.removeControl(this.animTools.closeButton.getId())),this.toolbar&&(this.toolbar.removeControl(this.animTools),this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.playButton){var i=e.getToolbar(!1)
i&&i.getControl(t.TOOLBAR.MODELTOOLSID).removeControl(this.playButton.getId())}return e.removeEventListener(t.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),e.removeEventListener(t.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),e.removeEventListener(t.VIEWER_RESIZE_EVENT,this.onResizeBinded),e.removeEventListener(t.ESCAPE_EVENT,this.onEscapeBinded),this.onToolbarCreatedBinded&&(e.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),!0},n.prototype.play=function(){if(!this.isPlaying()){this.resetExplode(0,!0)
var e=this.viewer,t=e.impl.keyFrameAnimator
t&&(this.prevAnimationTime>0&&(t.goto(this.prevAnimationTime),this.prevAnimationTime=-1),t.play(0,this.onPlayCallbackBinded),this.updatePlayButton(t.isPaused),e.toolbar&&e.toolbar.addClass("toolbar-animationMenuplacer"),this.animTools&&(this.animTools.setVisible(!0),this.animTools.isPositionAdjusted||(this.adjustToolbarPosition(),this.animTools.isPositionAdjusted=!0)))}},n.prototype.pause=function(){if(!this.isPaused()){var e=this.viewer.impl.keyFrameAnimator
e&&(e.pause(),this.updatePlayButton(e.isPaused))}},n.prototype.isPlaying=function(){var e=this.viewer.impl.keyFrameAnimator
return!!e&&(e.isPlaying&&!e.isPaused)},n.prototype.isPaused=function(){var e=this.viewer.impl.keyFrameAnimator
return!!e&&e.isPaused},n.prototype.rewind=function(){this.setTimelineValue(0)},n.prototype.setTimelineValue=function(e){var t=this.viewer.impl.keyFrameAnimator
if(t){e=Math.min(Math.max(0,e),1)
var i=e*t.duration
t.goto(i),this.updateUI()}},n.prototype.prevKeyframe=function(){var e=this.viewer.impl.keyFrameAnimator
e&&(e.prev(),this.updateUI())},n.prototype.nextKeyframe=function(){var e=this.viewer.impl.keyFrameAnimator
e&&(e.next(),this.updateUI())},n.prototype.getDuration=function(){var e=this.viewer.impl.keyFrameAnimator
return e?e.duration:0},n.prototype.getDurationLabel=function(){return e(this.getDuration())},n.prototype.getCurrentTime=function(){var e=this.viewer.impl.keyFrameAnimator
return e?e.currentTime:0},n.prototype.getCurrentTimeLabel=function(){return e(this.getCurrentTime())},n.prototype.onAnimationReady=function(){var e=this.viewer
this.onAnimationReadyBinded&&(e.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),e.impl.keyFrameAnimator&&(e.toolbar&&e.modelTools?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),e.addEventListener(t.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)))},n.prototype.updateUI=function(){var t=this.viewer.impl.keyFrameAnimator
this.animTools&&t&&(this.animTools.input.value=t.duration>0?t.currentTime/t.duration*100:0,this.animTools.lapse.value=e(t.currentTime),this.animTools.lapseLeft.value=e(t.currentTime-t.duration),this.updatePlayButton(t.isPaused),this.updateToolbarBackground())},n.prototype.onPlayCallback=function(i){if(this.animTools){var n=this.viewer.impl.keyFrameAnimator
this.viewer.fireEvent({type:t.ANIMATION_TRACK_UPDATE_EVENT,data:{time:n.currentTime,duration:n.duration}}),this.animTools.input.value=i,this.animTools.lapse.value=e(n.currentTime),this.animTools.lapseLeft.value=e(n.currentTime-n.duration),i>=100&&this.updatePlayButton(!0),this.updateToolbarBackground()}},n.prototype.updatePlayButton=function(e){if(this.playButton&&e!==this.playButtonIsPaused){this.playButtonIsPaused=e
var i=this.viewer.impl.keyFrameAnimator
e?(this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play"),this.viewer.fireEvent({type:t.ANIMATION_PAUSE_EVENT,data:{time:i.currentTime,duration:i.duration}})):(this.playButton.setIcon("toolbar-animationPauseIcon"),this.playButton.setToolTip("Pause"),this.viewer.fireEvent({type:t.ANIMATION_PLAY_EVENT,data:{time:i.currentTime,duration:i.duration}}))}},n.prototype.resetExplode=function(e,t){var i=this.viewer
i.model.is2d()||0===i.getExplodeScale()||(t&&i.explodeSlider&&(i.explodeSlider.value=e),i.explode(e))},n.prototype.adjustToolbarPosition=function(){var e=this.viewer
if(e.toolbar){var t=e.toolbar.getDimensions().width
t>e.container.getBoundingClientRect().width&&(t=e.modelTools.getDimensions().width)
var i=t-(2*this.animTools.backwardButton.getDimensions().width+3*this.animTools.timeText.getDimensions().width+this.animTools.closeButton.getDimensions().width)+12
this.animTools.input.style.width=i+"px"}},n.prototype.hideAnimateToolbar=function(){this.viewer.toolbar&&this.viewer.toolbar.removeClass("toolbar-animationMenuplacer"),this.animTools&&this.animTools.setVisible(!1)},n.prototype.updateToolbarBackground=function(){if(this.animTools){var e=this.animTools.input,t=e.value,i="#393939"
e.style.background="-webkit-linear-gradient(left,#ffffff "+t+"%, "+i+" "+t+"%)",e.style.background="-moz-linear-gradient(left,#ffffff "+t+"%, "+i+" "+t+"%)",e.style.background="-ms-linear-gradient(left,#ffffff "+t+"%, "+i+" "+t+"%)",e.style.background="-o-linear-gradient(left,#ffffff "+t+"%, "+i+" "+t+"%)",e.style.background="linear-gradient(to right,#ffffff "+t+"%, "+i+" "+t+"%)"}},n.prototype.onCameraChange=function(){if(this.viewer.toolController.cameraUpdated){var e=this.viewer.impl.keyFrameAnimator
if(!e)return
e.isPlaying&&!e.isPaused&&(e.pause(),this.updatePlayButton(e.isPaused))}},n.prototype.onResize=function(){this.toolbar&&(this.viewer.container.clientWidth<(t.isTouchDevice()?560:600)?this.toolbar.setCollapsed(!0):(this.toolbar.setCollapsed(!1),this.adjustToolbarPosition()))},n.prototype.onEscape=function(){this.isPlaying()?this.pause():this.hideAnimateToolbar()},n.prototype.onExplode=function(){var e=this.viewer.impl.keyFrameAnimator
e&&(0!==e.currentTime&&(this.prevAnimationTime=e.currentTime,e.goto(0)),this.updatePlayButton(!0)),this.hideAnimateToolbar()},n.prototype.onToolbarCreated=function(){var n=this.viewer,o=this
this.onToolbarCreatedBinded&&(n.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.toolbar=new i.ToolBar("animation-toolbar"),this.toolbar.addClass("toolbar-animationSubtoolbar"),n.container.appendChild(this.toolbar.container),this.animTools=new i.ControlGroup(this.animToolsId),this.animTools.setVisible(!1),this.toolbar.addControl(this.animTools),this.playButton=new i.Button("toolbar-animationPlay"),this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play"),this.playButton.onClick=function(){o.isPaused()?o.play():o.pause()},n.modelTools.addControl(this.playButton),n.modelTools.resetModelButton&&(n.modelTools.resetModelButton.onClick=function(t){n.showAll()
var i=n.impl.keyFrameAnimator
i&&(i.goto(0),s.value=0,r.value=e(0),l.value=e(-i.duration),o.updatePlayButton(!0)),o.resetExplode(0,!0),o.updateToolbarBackground()}),this.animTools.backwardButton=new i.Button("toolbar-animationBackward"),this.animTools.backwardButton.setToolTip("Previous keyframe"),this.animTools.backwardButton.onClick=function(e){var i=n.impl.keyFrameAnimator
void 0!==i&&i&&(i.prev(),n.fireEvent({type:t.ANIMATION_PREVIOUS_FRAME_EVENT,data:{time:i.currentTime,duration:i.duration}}),o.updateUI())},this.animTools.backwardButton.addClass("toolbar-animationButton"),this.animTools.backwardButton.setIcon("toolbar-animationBackwardIcon"),this.animTools.addControl(this.animTools.backwardButton),this.animTools.forwardButton=new i.Button("toolbar-animationForward"),this.animTools.forwardButton.setToolTip("Next keyframe"),this.animTools.forwardButton.onClick=function(e){var i=n.impl.keyFrameAnimator
void 0!==i&&i&&(i.next(),n.fireEvent({type:t.ANIMATION_NEXT_FRAME_EVENT,data:{time:i.currentTime,duration:i.duration}}),o.updateUI())},this.animTools.forwardButton.addClass("toolbar-animationButton"),this.animTools.forwardButton.setIcon("toolbar-animationForwardIcon"),this.animTools.addControl(this.animTools.forwardButton),this.animTools.timeText=new i.Control("toolbar-animationTimeLapse")
var r=this.animTools.lapse=document.createElement("input")
r.type="text",r.value="0",r.className="animationTimeLapse",r.disabled=!0,this.animTools.timeText.container.appendChild(r),this.animTools.timeText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeText),this.animTools.timeline=new i.Control("toolbar-animationTimeline")
var s=this.animTools.input=document.createElement("input")
s.type="range",s.value="0",s.className="animationTimeline",t.isIE11&&(s.style["padding-top"]="0",s.style["padding-bottom"]="0",s.style["margin-top"]="10px"),this.animTools.timeline.container.appendChild(s),s.addEventListener(t.isIE11?"change":"input",function(i){var a=n.impl.keyFrameAnimator
if(void 0!==a&&a){var c=s.value*a.duration/100
r.value=e(c),l.value=e(c-a.duration),a.goto(c),n.fireEvent({type:t.ANIMATION_SEEK_EVENT,data:{time:c,duration:a.duration}}),o.updatePlayButton(a.isPaused),o.updateToolbarBackground()}})
var a=document.createElement("div")
a.className="adsk-control-tooltip",a.textContent=Autodesk.Viewing.i18n.translate("Click-drag to scrub"),this.animTools.timeline.container.appendChild(a),s.addEventListener("mouseover",function(e){e.target===s&&(a.style.visibility="visible")}),s.addEventListener("mouseout",function(e){e.target===s&&(a.style.visibility="hidden")}),this.animTools.timeline.addClass("toolbar-animationButton"),this.animTools.timeline.addClass("toolbar-animationTimeline"),this.animTools.addControl(this.animTools.timeline),this.animTools.timeLeftText=new i.Control("toolbar-animationRemainingTime")
var l=this.animTools.lapseLeft=document.createElement("input")
l.type="text",l.value="0",l.className="animationTimeLapse",l.disabled=!0,this.animTools.timeLeftText.container.appendChild(l),this.animTools.timeLeftText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeLeftText),this.animTools.closeButton=new i.Button("toolbar-animationClose"),this.animTools.closeButton.setToolTip("Close animation timeline"),this.animTools.closeButton.onClick=function(){o.hideAnimateToolbar(),n.fireEvent({type:t.ANIMATION_TOOLBAR_CLOSE_EVENT})},this.animTools.closeButton.setIcon("toolbar-animationCloseIcon"),this.animTools.closeButton.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.closeButton)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360"),Autodesk.Viewing.Extensions.Fusion360.AnimationExtension=n,t.theExtensionManager.registerExtension("Autodesk.Fusion360.Animation",n)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var e=Autodesk.Viewing,t=e.Private,i=e.Extensions,n=i.Collaboration
n.InteractionInterceptor=function(e){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(e){},this.deactivate=function(e){},this.update=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(t){return e.takeControl(),!1},this.handleButtonDown=function(t,i){return e.takeControl(),!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(t){return e.updatePointer(t),!1},this.handleGesture=function(t){return e.takeControl(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}},n.ViewTransceiver=function(i){function n(e){g=!0
var t=JSON.parse(e.data.msg)
b.restoreState(t),m.impl.invalidate(!0,!1,!0),g=!1}function o(e){return Math.round(1e3*e)/1e3}function r(e){for(var t=0;t<e.length;t++)e[t]=o(e[t])}function s(e){var t=e.data.msg
!0===t[1]||v||(t[0]!=h&&(h=t[0],e.data.lastInControl=t[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:e.data})),f=!1,m.navigation.setView((new THREE.Vector3).set(t[2],t[3],t[4]),(new THREE.Vector3).set(t[5],t[6],t[7])),m.navigation.setCameraUpVector((new THREE.Vector3).set(t[8],t[9],t[10])))}function a(e){if(f||v){var t=e.camera,n=[t.position.x,t.position.y,t.position.z,t.target.x,t.target.y,t.target.z,t.up.x,t.up.y,t.up.z]
r(n),n.unshift(v),n.unshift(i.getLocalId()),E.sendMessage("camera",n,p.channelId),h!=n[0]&&(h=n[0],p.dispatchEvent({type:"controlChange",channelId:p.channelId,data:{lastInControl:h}}))}}function l(e,t,i){e&&!A&&(A=document.createElement("div"),A.classList.add("collabPointer")),e&&!T?(m.container.appendChild(A),T=!0):!e&&T&&(m.container.removeChild(A),T=!1),e&&(A.style.left=t-6+"px",A.style.top=i-6+"px")}function c(e){if(!f&&!v){var t=e.data.msg
y.origin.set(t[1],t[2],t[3]),y.direction.set(t[4],t[5],t[6])
var i=y.at(m.getCamera().near)
i.project(m.getCamera()),i=m.impl.viewportToClient(i.x,i.y),l(!0,i.x,i.y)}}function d(e){if(f){var t=m.impl.clientToViewport(e.canvasX,e.canvasY)
m.impl.viewportToRay(t,y)
var n=[y.origin.x,y.origin.y,y.origin.z,y.direction.x,y.direction.y,y.direction.z]
r(n),n.unshift(i.getLocalId()),E.sendMessage("pointer",n,p.channelId)}}function u(e){if(!g){var t=b.getState(w)
i.sendMessage("state",JSON.stringify(t),p.channelId)}}var h,p=this,m=this.viewer=null,g=!1,f=!1,v=!1,E=this.client=i,y=new THREE.Ray,A=null,T=!1
this.channelId=null
var b,w={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}}
this.takeControl=function(){f=!0,l(!1)},this.updatePointer=function(e){d(e)},this.connectCamera=function(e){v=!e},this.attach=function(i){m&&this.detach(),this.viewer=m=i,b=new t.ViewerState(m),E.addEventListener("cameraChange",s),E.addEventListener("pointerMove",c),E.addEventListener("viewerState",n),m.hasEventListener(e.CAMERA_CHANGE_EVENT,a)||m.addEventListener(e.CAMERA_CHANGE_EVENT,a),m.hasEventListener(e.SELECTION_CHANGED_EVENT,u)||(m.addEventListener(e.SELECTION_CHANGED_EVENT,u),m.addEventListener(e.ISOLATE_EVENT,u),m.addEventListener(e.HIDE_EVENT,u),m.addEventListener(e.SHOW_EVENT,u),m.addEventListener(e.EXPLODE_CHANGE_EVENT,u),m.addEventListener(e.LAYER_VISIBILITY_CHANGED_EVENT,u),m.addEventListener(e.CUTPLANES_CHANGE_EVENT,u))},this.detach=function(){E&&(E.removeEventListener("cameraChange",s),E.removeEventListener("viewerState",n)),m&&(m.removeEventListener(e.CAMERA_CHANGE_EVENT,a),m.removeEventListener(e.SELECTION_CHANGED_EVENT,u),m.removeEventListener(e.ISOLATE_EVENT,u),m.removeEventListener(e.HIDE_EVENT,u),m.removeEventListener(e.SHOW_EVENT,u),m.removeEventListener(e.EXPLODE_CHANGE_EVENT,u),m.removeEventListener(e.LAYER_VISIBILITY_CHANGED_EVENT,u),m.removeEventListener(e.CUTPLANES_CHANGE_EVENT,u),this.viewer=m=null,b=null)}},n.ViewTransceiver.prototype.constructor=n.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(n.ViewTransceiver.prototype)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var e=Autodesk.Viewing,t=e.Extensions,i=e.Private,n=e.UI,o=t.Collaboration
t.Collaboration.Collaboration=function(t,i){e.Extension.call(this,t,i),i&&i.rtc&&i.rtc.disableRTCToolbarButton&&(this.disableRTCToolbarButton=!0)},t.Collaboration.Collaboration.prototype=Object.create(e.Extension.prototype),t.Collaboration.Collaboration.prototype.constructor=t.Collaboration.Collaboration,t.Collaboration.Collaboration.prototype.initNetwork=function(e){this.p2p&&!e||(this.viewtx=new o.ViewTransceiver(this.client),this.interceptor=new o.InteractionInterceptor(this.viewtx),this.viewer.toolController.registerTool(this.interceptor),this.p2p=new i.P2PClient(this.client))},t.Collaboration.Collaboration.prototype.createUI=function(){var e=this,r=this.viewer
if(this.initNetwork(!1),this.panel=new o.DockingCollabPanel(this.viewer,this.client,this.p2p,this.viewtx),t.Collaboration.Collaboration.Panel=this.panel,this.collabButton=new n.Button("toolbar-collaborateTool"),this.collabButton.setToolTip("Live review"),this.collabButton.setIcon("adsk-icon-live-review"),this.collabButton.onClick=function(t){var i=e.panel.isVisible()
if(!document.getElementById("collabBox"))if(i||e.inviteDivInstantiated)e.panel.setVisible(!1,!0),e.panel.reset()
else{var n=new o.CollabPromptBox,s=r.container
n.start(s,function(){e.panel.setVisible(!0,!0)},"Start a Live Review","Start Review")}},this.disableRTCToolbarButton&&this.collabButton.setVisible(!1,!0),this.panel.addVisibilityListener(function(t){if(t){if(r.model){var o=r.model.getData()
e.viewtx.channelId=o.basePath,e.viewtx.attach(r),e.client.connect(e.viewtx.channelId),e.client.join(e.viewtx.channelId)}r.toolController.activateTool(e.interceptor.getName())
e.collabButton.setState(n.Button.State.ACTIVE),i.logger.track({category:"viewer_rtc_start"})}else i.logger&&e.client.isConnected()&&i.logger.track({category:"viewer_rtc_stop"}),e.p2p.hangup(),e.viewtx.detach(r),e.viewtx.channelId=null,e.client.disconnect(),e.panel.reset(),r.toolController.deactivateTool(e.interceptor.getName()),e.collabButton.setState(n.Button.State.INACTIVE)}),r.modelTools.addControl(this.collabButton),Autodesk.Viewing.Private.getParameterByName("invited")){var s=new CollabPromptBox,a=r.container
s.start(a,function(){e.panel.setVisible(!0,!0)},"Join a Live Review","Join Review")}},t.Collaboration.Collaboration.prototype.close=function(){this.panel.setVisible(!1,!0),this.panel.reset()},t.Collaboration.Collaboration.prototype.load=function(){function e(){function e(i){t.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e),n.createUI()}n.client=i.MessageClient.GetInstance(n.options?n.options.messageServerURL:void 0),n.socketErrorHandler=function(e){i.ErrorHandler.reportError(t.container,Autodesk.Viewing.ErrorCodes.RTC_ERROR,e.data),n.close()},n.client.addEventListener("socketError",n.socketErrorHandler),n.presenceChannelId=window.location.host,n.client.isConnected(),t.modelTools?n.createUI():t.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e)}var t=this.viewer,n=this
return i.loadDependency("lmv_io","socket.io-1.3.5.js",e),!0},t.Collaboration.Collaboration.prototype.unload=function(){var e=this.viewer
return this.client.removeEventListener("socketError",this.socketErrorHandler),this.socketErrorHandler=null,this.p2p.hangup(),this.viewtx.detach(e),this.client.disconnect(),this.panel&&(this.panel.reset(),this.panel.setVisible(!1),this.panel.uninitialize(),this.panel=null),e.toolController.deactivateTool(this.interceptor.getName()),this.interceptor=null,e.modelTools.removeControl(this.collabButton.getId()),this.collabButton=null,!0},e.theExtensionManager.registerExtension("Autodesk.Viewing.Collaboration",t.Collaboration.Collaboration)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){function e(e,i,n,o){this.viewer=e,this.client=i,this.p2p=n,this.viewtx=o
t.UI.DockingPanel.call(this,e.container,"CollabPanel","Live review"),this.container.classList.add("collabPanel"),this.container.style.height="auto",this.container.dockRight=!0,this.content=document.createElement("div"),this.container.appendChild(this.content),this.content.classList.add("collabPanelContent"),this.tableContainer=document.createElement("div"),this.tableContainer.classList.add("userListTable","dockingPanelScroll"),this.table=document.createElement("table"),this.table.classList.add("adsk-lmv-tftable"),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.tableContainer.appendChild(this.table),this.content.appendChild(this.tableContainer),this.inviteDiv=document.createElement("div"),this.inviteDiv.className="collabBoxOK",this.inviteDiv.style.float="left",this.inviteDiv.style.width="232px",this.inviteDiv.setAttribute("data-i18n","Invite"),this.inviteDiv.textContent=Autodesk.Viewing.i18n.translate("Invite"),this.content.appendChild(this.inviteDiv),this.inviteDiv.addEventListener("click",function(t){var i=new CollabPromptBox,n=e.container
i.start(n,function(){var e=Autodesk.Viewing.i18n.translate("Please Join My Live Review")
document.location.href="mailto:?subject="+e},"Invite Others","Email Invite",!0)}),this.chatHistory=document.createElement("div"),this.chatHistory.classList.add("chatHistory"),this.chatHistory.classList.add("textEntry"),this.chatHistory.classList.add("dockingPanelScroll"),this.content.appendChild(this.chatHistory),this.chatPanel=document.createElement("div"),this.chatPanel.classList.add("chatPanel"),this.textInput=document.createElement("input"),this.textInput.type="text",this.textInput.classList.add("textEntry"),this.textInput.placeholder=Autodesk.Viewing.i18n.translate("Type a message"),this.chatPanel.appendChild(this.textInput),this.content.appendChild(this.chatPanel),this.isCameraConnected=!0
var r=this
this.addEventListener(i,"userListChange",function(e){if(!e.channelId||e.channelId===r.viewtx.channelId){var t=r.client.getChannelInfo(r.viewtx.channelId)
t&&r.updateUsers(t.users)}}),this.addEventListener(this.viewtx,"controlChange",function(e){e.channelId===r.viewtx.channelId&&r.updateUserInControl(e.data.lastInControl)}),this.addEventListener(i,"chatReceived",function(e){e.channelId===r.viewtx.channelId&&r.updateChatHistory(e)}),this.textInput.onkeyup=function(e){r.handleChatInput(e)},this.addEventListener(this.p2p,"remoteStreamAdded",function(e){r.videoPanel||r.createVideoPanel(),r.remoteVideo.src=window.URL.createObjectURL(e.data)}),this.addEventListener(this.p2p,"localStreamAdded",function(e){r.videoPanel||r.createVideoPanel(),r.localVideo.src=window.URL.createObjectURL(e.data)}),this.addEventListener(this.p2p,"remoteHangup",function(e){r.removeVideoPanel()})}var t=Autodesk.Viewing,i=t.Extensions,n=t.Private,o=(t.UI,i.Collaboration)
Autodesk.Viewing.startLiveReviewSession=function(){o.Panel&&o.Panel.startSession()},Autodesk.Viewing.endLiveReviewSession=function(){o.Panel&&o.Panel.endSession()}
e.prototype=Object.create(t.UI.DockingPanel.prototype),e.prototype.constructor=e,e.prototype.startSession=function(){var e=this
if(!this.isVisible()){var t=new CollabPromptBox,i=this.viewer.container
t.start(i,function(){e.setVisible(!0,!0)},"Start a Live Review","Start Review")}},e.prototype.endSession=function(){this.isVisible()&&(this.setVisible(!1,!0),this.reset())},e.prototype.updateUsers=function(e){for(var t=document.createElement("tbody"),i=0;i<e.length;i++){var n=t.insertRow(-1)
n.id=e[i].id
var o=n.insertCell(0)
o.style.width="14px",o.style.cursor="default"
var r=document.createElement("div")
r.classList.add("statusBase"),r.classList.add("statusNormal"),r.innerHTML="&#9679",o.appendChild(r)
n.insertCell(1).textContent=e[i].name}this.table.replaceChild(t,this.tbody),this.tbody=t,this.fixComponentPlacement()},e.prototype.updateUserInControl=function(e){for(var t=0;t<this.tbody.rows.length;t++){var i=this.tbody.rows[t],n=i.cells[0].childNodes[0]
i.id==e?(n.classList.remove("statusNormal"),n.classList.add("statusInControl"),n.innerHTML="&#9784",i.cells[1].style.color="#4CBA36"):(n.classList.remove("statusInControl"),n.classList.add("statusNormal"),n.innerHTML="&#9679",i.cells[1].style.color="#ffffff")}},e.prototype.updateChatHistory=function(e){var t=this.client.getUserById(e.data.from,e.channelId)
if("/"!=e.data.msg.charAt(0)){if(this.chatHistory.lastUser!=t.name){var i=document.createElement("p"),n=document.createElement("div")
n.classList.add("heading"),n.style.float="left",n.style.fontStyle="normal",n.style.color="#857E7E",n.textContent=t.name,i.appendChild(n)
var o=document.createElement("div")
o.classList.add("heading"),o.style.textAlign="right",o.style.fontStyle="normal",o.style.color="#857E7E",o.textContent=(new Date).toLocaleTimeString(),i.appendChild(o),this.chatHistory.appendChild(i),this.chatHistory.lastUser=t.name}else{var r=document.createElement("br")
this.chatHistory.appendChild(r)}var s=document.createElement("span")
s.classList.add("messageText"),s.textContent=e.data.msg,this.chatHistory.appendChild(s),this.chatHistory.scrollTop=this.chatHistory.scrollHeight}},e.prototype.handleChatInput=function(e){13==e.which&&0!=this.textInput.value.length&&(this.client.sendChatMessage(this.textInput.value,this.viewtx.channelId),this.textInput.value="",this.textInput.placeholder="")},e.prototype.fixComponentPlacement=function(e){var t=this.tableContainer.offsetHeight+this.chatPanel.offsetHeight
this.videoPanel?(t+=this.videoPanel.offsetHeight,this.chatHistory.style.height="calc(100% - "+t+"px)"):this.chatHistory.style.height="calc(100% - "+t+"px)"},e.prototype.createVideoPanel=function(e){this.videoPanel=document.createElement("div"),this.videoPanel.classList.add("videoPanel"),this.localVideo=document.createElement("video"),this.localVideo.autoplay=!0,this.localVideo.muted=!0,this.localVideo.classList.add("videoInset"),this.videoPanel.appendChild(this.localVideo),this.remoteVideo=document.createElement("video"),this.remoteVideo.autoplay=!0,this.remoteVideo.classList.add("videoMain"),this.videoPanel.appendChild(this.remoteVideo)
var t=this,i=document.createElement("div")
i.classList.add("dockingPanelClose"),i.innerHTML="&times",i.title=Autodesk.Viewing.i18n.translate("End video call"),i.onclick=function(e){t.p2p.hangup(),t.removeVideoPanel()},this.videoPanel.appendChild(i),this.content.insertBefore(this.videoPanel,this.chatHistory),this.fixComponentPlacement()},e.prototype.removeCollabPrompt=function(){var e=document.getElementById("collabBox")
e&&(e.style.visibility="hidden",this.viewer.container.removeChild(e))},e.prototype.removeVideoPanel=function(){this.videoPanel&&this.content.removeChild(this.videoPanel),this.videoPanel=null},e.prototype.reset=function(e){if(this.tbody){var t=document.createElement("tbody")
this.table.replaceChild(t,this.tbody),this.tbody=t}this.chatHistory.textContent="",this.textInput.value="",this.removeVideoPanel(),this.removeCollabPrompt()},CollabPromptBox=function(){},CollabPromptBox.prototype.start=function(e,t,i,o,r){if(e&&!document.getElementById("collabBox")){var s=document.createElement("div")
s.id="collabBox",s.className="collabBox",e.appendChild(s)
var a=document.createElement("div")
a.className="collabBoxTitle",a.textContent=Autodesk.Viewing.i18n.translate(i,{defaultValue:i}),s.appendChild(a)
var l=document.createElement("span")
l.className="collabBoxText"
var c="Enter your name"
r&&(c="Review URL"),l.textContent=Autodesk.Viewing.i18n.translate(c,{defaultValue:c}),s.appendChild(l)
var d=document.createElement("span")
d.className="collabBoxInputContainer",s.appendChild(d)
var u=document.createElement("input")
if(u.type="text",u.className="collabBoxInputText",r){var h=window.location.toString();-1==h.indexOf("?")?h+="?invited=true":h+="&invited=true",Autodesk.Viewing.Private.docItemId&&(h+="&itemid="+Autodesk.Viewing.Private.docItemId),h+="&doNotRedirect=true",u.value=h}d.appendChild(u),u.onkeyup=function(i){13==i.keyCode&&(s.style.visibility="hidden",e.removeChild(s),n.setUserName(u.value),t())}
var p=document.createElement("div")
if(p.className="collabBoxClose",p.innerHTML="&times;",p.addEventListener("click",function(t){s.style.visibility="hidden",e.removeChild(s)}),s.appendChild(p),r){var l=document.createElement("span")
l.className="collabBoxText",l.style.marginTop="0px"
var c="Copy and send this URL to invite others"
l.textContent=Autodesk.Viewing.i18n.translate(c,{defaultValue:c}),s.appendChild(l)}else{var m=document.createElement("div")
m.className="collabBoxOK",m.textContent=Autodesk.Viewing.i18n.translate(o,{defaultValue:o}),m.addEventListener("click",function(i){s.style.visibility="hidden",e.removeChild(s),""!==u.value.trim()&&n.setUserName(u.value),t()}),s.appendChild(m)}s.style.visibility="visible",u.focus(),r&&u.select()}},o.DockingCollabPanel=e,o.CollabPromptBox=CollabPromptBox}(),function(){"use strict"
function e(e,t,i){return function(){var o=t.getState()
o===n.Button.State.INACTIVE?(e.setActiveNavigationTool(i),t.setState(n.Button.State.ACTIVE)):o===n.Button.State.ACTIVE&&(e.setActiveNavigationTool(),t.setState(n.Button.State.INACTIVE))}}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.DefaultTools"),i=Autodesk.Viewing,n=i.UI,o=function(e,t){i.Extension.call(this,e,t)}
o.prototype=Object.create(i.Extension.prototype),o.prototype.constructor=o,o.prototype.load=function(){var e=this.viewer,t=new i.FovTool(e),n=new i.WorldUpTool(e.impl,e)
return e.toolController.registerTool(t),e.toolController.registerTool(n),this.createUI(),this.initCameraStateMachine(),this.initFocalLengthOverlay(),!0},o.prototype.createUI=function(){var t=this.viewer,o=t.getToolbar(!0),r=o.getControl(i.TOOLBAR.NAVTOOLSID),s=function(e){return t.navigation.isActionEnabled(e)?"block":"none"}
if(t.model.is3d()){var a=new n.ComboButton("toolbar-orbitTools")
a.setToolTip("Orbit"),a.setIcon("adsk-icon-orbit-constrained"),a.setDisplay(s("orbit")),this.createOrbitSubmenu(a),r.addControl(a),r.orbittoolsbutton=a,a.setState(n.Button.State.ACTIVE),r.returnToDefault=function(){a.setState(n.Button.State.ACTIVE)}}var l=new n.Button("toolbar-panTool")
l.setToolTip("Pan"),l.setIcon("adsk-icon-pan"),l.onClick=e(t,l,"pan"),l.setDisplay(s("pan")),r.addControl(l),r.panbutton=l,t.model.is2d()&&(r.returnToDefault=function(){l.setState(n.Button.State.ACTIVE)},r.returnToDefault())
var c=new n.Button("toolbar-zoomTool")
c.setToolTip("Zoom"),c.setIcon("adsk-icon-zoom"),c.onClick=e(t,c,"dolly"),c.setDisplay(s("zoom")),r.addControl(c),r.dollybutton=c
var d=new n.ComboButton("toolbar-cameraSubmenuTool")
d.setToolTip("Camera interactions"),d.setIcon("adsk-icon-camera"),d.saveAsDefault(),this.createCameraSubmenu(d),r.addControl(d),r.camerabutton=d},o.prototype.createOrbitSubmenu=function(t){var o=this.viewer,r=o.getToolbar(!0),s=r.getControl(i.TOOLBAR.NAVTOOLSID),a=new n.Button("toolbar-freeOrbitTool")
a.setToolTip("Free orbit"),a.setIcon("adsk-icon-orbit-free"),a.onClick=e(o,a,"freeorbit"),t.addControl(a),s.freeorbitbutton=a
var l=new n.Button("toolbar-orbitTool")
l.setToolTip("Orbit"),l.setIcon("adsk-icon-orbit-constrained"),l.onClick=e(o,l,"orbit"),t.addControl(l),s.orbitbutton=l,t.onClick=l.onClick},o.prototype.createCameraSubmenu=function(t){var o=this.viewer,r=o.getToolbar(!0),s=r.getControl(i.TOOLBAR.NAVTOOLSID),a=function(e){return o.navigation.isActionEnabled(e)?"block":"none"}
if(i.isTouchDevice()){var l=new n.Button("toolbar-homeTool")
l.setToolTip("Home"),l.setIcon("adsk-icon-home"),l.onClick=function(){o.navigation.setRequestHomeView(!0)
var e=o.getDefaultNavigationToolName()
o.setActiveNavigationTool(e),t.restoreDefault()},l.setDisplay(a("gotoview")),t.addControl(l),s.homebutton=l}var c=new n.Button("toolbar-fitToViewTool")
if(c.setToolTip("Fit to view"),c.setIcon("adsk-icon-fit-to-view"),c.onClick=function(e){o.fitToView(o.getSelection())
var i=o.getDefaultNavigationToolName()
o.setActiveNavigationTool(i),t.restoreDefault()},c.setDisplay(a("gotoview")),t.addControl(c),s.fovbutton=c,o.model.is3d()){var d=new n.Button("toolbar-focalLengthTool")
d.setToolTip("Focal length"),d.setIcon("adsk-icon-fov"),d.onClick=e(o,d,"fov"),d.setDisplay(a("fov")),t.addControl(d),s.fovbutton=d}var u=new n.Button("toolbar-rollTool")
u.setToolTip("Roll"),u.setIcon("adsk-icon-roll"),u.onClick=e(o,u,"worldup"),u.setDisplay(a("roll")),t.addControl(u),s.rollbutton=u},o.prototype.initCameraStateMachine=function(e){var t=this,n=this.viewer,o=n.getToolbar(!0),r=o.getControl(i.TOOLBAR.NAVTOOLSID)
this.toolChangedHandler=function(e){"fov"===e.toolName&&t.showFocalLengthOverlay(e.active)},n.addEventListener(i.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.navChangedHandler=function(e){n.getDefaultNavigationToolName()===e.id&&r.returnToDefault()},n.addEventListener(i.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler)},o.prototype.initFocalLengthOverlay=function(){var e=this.focallength=document.createElement("div")
e.className="focallength"
var t=document.createElement("table"),i=document.createElement("tbody")
t.appendChild(i),e.appendChild(t),this.viewer.container.appendChild(e)
var n=i.insertRow(-1),o=n.insertCell(0)
o.setAttribute("data-i18n","Focal Length"),o.textContent=Autodesk.Viewing.i18n.translate("Focal Length"),o=n.insertCell(1),o.textContent="",o.style.width="4em",o.style.textAlign="right",this.fovCell=o,e.style.visibility="hidden"},o.prototype.showFocalLengthOverlay=function(e){function t(e){if(e){var t={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."}
i.Private.HudMessage.displayMessage(a.container,t)}else i.Private.HudMessage.dismiss()}function n(e){e&&o(),s.focallength&&(s.focallength.style.visibility=e?"visible":"hidden")}function o(){var e=a.getFocalLength()
l!==e&&(l=e,s.fovCell.textContent=e.toString()+" mm")}function r(e){if(o(),"fov"===a.toolController.getActiveToolName()){var i=a.navigation.getCamera(),r=i&&!i.isPerspective
n(!r),t(r)}}var s=this,a=this.viewer,l=0,c=a.navigation.getCamera(),d=c&&!c.isPerspective
n(e&&!d),t(e&&d),e?a.addEventListener(i.CAMERA_CHANGE_EVENT,r):a.removeEventListener(i.CAMERA_CHANGE_EVENT,r)},o.prototype.unload=function(){return this.destroyUI(),!0},o.prototype.destroyUI=function(){var e=this.viewer,t=e.getToolbar(!1)
if(!t)return!0
var o=t.getControl(i.TOOLBAR.NAVTOOLSID)
return!o||(e.model&&e.model.is3d()&&(o.orbittoolsbutton.subMenu.removeEventListener(n.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,o.orbittoolsbutton.subMenuActiveButtonChangedHandler(o)),o.removeControl(o.orbittoolsbutton.getId()),o.orbittoolsbutton=null,o.orbitbutton.onClick=null,o.orbitbutton=null,o.freeorbitbutton.onClick=null,o.freeorbitbutton=null),o.removeControl(o.panbutton.getId()),o.panbutton.onClick=null,o.panbutton=null,o.removeControl(o.dollybutton.getId()),o.dollybutton.onClick=null,o.dollybutton=null,o.camerabutton.subMenu.removeEventListener(n.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,o.camerabutton.subMenuActiveButtonChangedHandler(o)),o.removeControl(o.camerabutton.getId()),o.camerabutton.onClick=null,o.camerabutton=null,o.rollbutton.onClick=null,o.rollbutton=null,o.fovbutton.onClick=null,o.fovbutton=null,this.focallength=null,e.removeEventListener(i.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.toolChangedHandler=null,e.removeEventListener(i.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler),this.navChangedHandler=null,!0)},t.NavToolsExtension=o,i.theExtensionManager.registerExtension("Autodesk.DefaultTools.NavTools",o)}(),function(){"use strict"
var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),t=Autodesk.Viewing,i=t.UI,n=function(e,t){Autodesk.Viewing.Extension.call(this,e,t)}
n.prototype=Object.create(Autodesk.Viewing.Extension.prototype),n.prototype.constructor=n,n.prototype.onToolbarCreated=function(){this.viewer.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null,this.createUI()},n.prototype.load=function(){var i=this,n=this.viewer
if(this.hasUI=Autodesk.Viewing.Private.GuiViewer3D&&n instanceof Autodesk.Viewing.Private.GuiViewer3D,this.escapeHotkeyId="Autodesk.Measure.Hotkeys.Escape",!n.toolController)return!1
this.options=this.options||{}
var o={}
return o.onCloseCallback=function(e){i.enableMeasureTool(!1)},o.calibrationFactor=this.options.calibrationFactor,o.snapperOptions=this.options.snapperOptions,this.forceCalibrate=this.options.forceCalibrate,this.isCalibrated=null!=this.options.calibrationFactor,this.tool=new e.MeasureTool(n,o),n.toolController.registerTool(this.tool),this.viewer.toolbar?this.createUI():(this.bindedOnToolbarCreated=this.onToolbarCreated.bind(this),this.viewer.addEventListener(t.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated)),!0},n.prototype.unload=function(){var e=this.viewer
return this.destroyUI(),this.bindedOnToolbarCreated&&(this.viewer.removeEventListener(t.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null),e.toolController.deregisterTool(this.tool),this.tool=null,!0},n.prototype.isActive=function(){return this.tool.isActive()},n.prototype.setActive=function(e){return this.enableMeasureTool(e)},n.prototype.toggle=function(){return this.isActive()?this.enableMeasureTool(!1):this.enableMeasureTool(!0),this.isActive()},n.prototype.getMeasurement=function(e,t){var i=null
return this.isActive()&&(i=this.tool.getMeasurement(e,t)),i},n.prototype.getUnitOptions=function(){return[{name:"Unknown",type:""},{name:"Decimal feet",type:"decimal-ft"},{name:"Feet and fractional inches",type:"ft"},{name:"Feet and decimal inches",type:"ft-and-decimal-in"},{name:"Decimal inches",type:"decimal-in"},{name:"Fractional inches",type:"fractional-in"},{name:"Meters",type:"m"},{name:"Centimeters",type:"cm"},{name:"Millimeters",type:"mm"},{name:"Meters and centimeters",type:"m-and-cm"}]},n.prototype.getPrecisionOptions=function(e){if(e)var t=["1","1/2","1/4","1/8","1/16","1/32","1/64"]
else var t=["0","0.1","0.01","0.001","0.0001","0.00001"]
return t},n.prototype.getDefaultUnit=function(){return this.viewer.model.getDisplayUnit()},n.prototype.openCalibrationRequiredDialog=function(){this.hasUI&&this.calibrationToolButton?(this.CalibrationRequiredDialog||(this.CalibrationRequiredDialog=new Autodesk.Viewing.Extensions.Measure.CalibrationRequiredDialog(this,this.viewer,"calibration-required","Calibration Required",this.options)),this.CalibrationRequiredDialog.setVisible(!0)):this.viewer.fireEvent({type:e.CALIBRATION_REQUIRED_EVENT})},n.prototype.enableMeasureTool=function(e){var t=this.viewer.toolController,i=1==this.selectedTool
return this.forceCalibrate|=this.viewer.model.getData().isLeaflet,e&&!i?(this.checkAndFetchTopology(),!this.forceCalibrate||this.forceCalibrate&&this.tool.isCalibrated()?(t.activateTool("measure"),this.selectedTool=1,this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):(this.openCalibrationRequiredDialog(),!1)):!(e||!i)&&(t.deactivateTool("measure"),this.selectedTool=0,this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},n.prototype.enableCalibrationTool=function(e){var t=this.viewer.toolController,i=2==this.selectedTool
return e&&!i?(t.activateTool("calibration"),this.selectedTool=2,this.calibrationToolButton&&this.calibrationToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(e||!i)&&(t.deactivateTool("calibration"),this.selectedTool=0,this.calibrationToolButton&&this.calibrationToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},n.prototype.createUI=function(){var e=this,n=this.viewer,o=n.getToolbar(!0),r=o.getControl(t.TOOLBAR.MODELTOOLSID),s=new i.ComboButton("toolbar-measurementSubmenuTool")
s.setToolTip("Measure"),s.setIcon("adsk-icon-measure"),s.saveAsDefault(),this.createMeasurementSubmenu(s),r.measurementSubmenuButton=s,r&&r.addControl(s,{index:0})
var a=[{keycodes:[t.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return 1==e.selectedTool?e.enableMeasureTool(!1):2==e.selectedTool&&e.enableCalibrationTool(!1)}}]
t.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,a),this.uiCreated=!0},n.prototype.createMeasurementSubmenu=function(e){var n=this,o=this.viewer,r=o.getToolbar(!0),s=r.getControl(t.TOOLBAR.MODELTOOLSID)
this.measureToolButton=new i.Button("toolbar-measureTool"),this.measureToolButton.setToolTip("Measure"),this.measureToolButton.setIcon("adsk-icon-measure"),this.measureToolButton.onClick=function(e){n.enableCalibrationTool(!1),n.enableMeasureTool(!(1==n.selectedTool))},this.onMeasureButtonStateChange=function(e){e.state===i.Button.State.ACTIVE?(n.enableMeasureTool(!0),n.selectedTool=1):e.state===i.Button.State.INACTIVE&&(n.enableMeasureTool(!1),n.selectedTool=0)},this.measureToolButton.addEventListener(i.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange),e.addControl(this.measureToolButton),s.measureToolButton=this.measureToolButton,this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),this.calibrationToolButton=new i.Button("toolbar-calibrationTool"),this.calibrationToolButton.setToolTip("Calibrate"),this.calibrationToolButton.setIcon("calibration-icon"),this.calibrationToolButton.onClick=function(e){n.enableMeasureTool(!1),n.enableCalibrationTool(!(2==n.selectedTool))},this.onCalibrationButtonStateChange=function(e){e.state===i.Button.State.ACTIVE?(n.enableCalibrationTool(!0),n.selectedTool=2):e.state===i.Button.State.INACTIVE&&(n.enableCalibrationTool(!1),n.selectedTool=0)},this.onFinishedCalibration=function(t){n.enableCalibrationTool(!1),e.restoreDefault(),n.enableMeasureTool(!0)},this.calibrationToolButton.addEventListener(i.Button.Event.STATE_CHANGED,this.onCalibrationButtonStateChange),o.addEventListener("finished-calibration",this.onFinishedCalibration),e.addControl(this.calibrationToolButton),s.calibrationToolButton=this.calibrationToolButton},n.prototype.checkAndFetchTopology=function(){var e=this.viewer.toolController.getTool("measure")
return this.uiCreated&&this.viewer.model.is3d()?this.viewer.modelHasTopology()?void(e&&e.setTopologyAvailable()):(e&&e.setFetchingTopology(),void this.viewer.model.fetchTopology().then(function(t){e&&e.setTopologyAvailable()}).catch(function(t){avp.logger.log(t),e&&e.setNoTopology()})):void(e&&e.setNoTopology())},n.prototype.destroyUI=function(){var e=this.viewer
this.measureToolButton&&this.measureToolButton.removeEventListener(i.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange),this.calibrationToolButton&&(this.calibrationToolButton.removeEventListener(i.Button.Event.STATE_CHANGED,this.onCalibrationButtonStateChange),e.removeEventListener("finished-calibration",this.onFinishedCalibration))
var n=e&&e.getToolbar&&e.getToolbar(!1)
if(n){var o=n.getControl(t.TOOLBAR.MODELTOOLSID)
if(o){var r=null
this.measureToolButton&&(r=o.getControl("toolbar-inspectSubMenu"),r?r.removeControl(this.measureToolButton.getId()):o.removeControl(this.measureToolButton.getId())),this.calibrationToolButton&&(r=o.getControl("toolbar-inspectSubMenu"),r?r.removeControl(this.calibrationToolButton.getId()):o.removeControl(this.calibrationToolButton.getId())),this.measureToolButton=null,this.calibrationToolButton=null}}t.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},e.MeasureExtension=n,t.theExtensionManager.registerExtension("Autodesk.Measure",n)}(),function(){"use strict"
Autodesk.Viewing.Extensions.Measure.SnapResult=function(){this.clear()},Autodesk.Viewing.Extensions.Measure.SnapResult.prototype.clear=function(){this._geomType=null,this._snapNode=null,this._geomVertex=null,this._geomEdge=null,this._geomFace=null,this._radius=null,this._intersectPoint=null,this._faceNormal=null,this._viewportIndex2d=null,this._circularArcCenter=null,this._circularArcRadius=null,this._fromTopology=!1},Autodesk.Viewing.Extensions.Measure.SnapResult.prototype.copyTo=function(e){e._snapNode=this._snapNode,e._geomVertex=this._geomVertex,e._geomFace=this._geomFace,e._geomEdge=this._geomEdge,e._radius=this._radius,e._geomType=this._geomType,e._intersectPoint=this._intersectPoint,e._faceNormal=this._faceNormal,e._viewportIndex2d=this._viewportIndex2d,e._circularArcCenter=this._circularArcCenter,e._circularArcRadius=this._circularArcRadius,e._fromTopology=this._fromTopology},Autodesk.Viewing.Extensions.Measure.SnapResult.prototype.clone=function(){var e=new Autodesk.Viewing.Extensions.Measure.SnapResult
return this.copyTo(e),e},Autodesk.Viewing.Extensions.Measure.SnapResult.prototype.isEmpty=function(){return!this.getGeometry()},Autodesk.Viewing.Extensions.Measure.SnapResult.prototype.getFace=function(){return this._geomFace},Autodesk.Viewing.Extensions.Measure.SnapResult.prototype.getEdge=function(){return this._geomEdge},Autodesk.Viewing.Extensions.Measure.SnapResult.prototype.getVertex=function(){return this._geomVertex},Autodesk.Viewing.Extensions.Measure.SnapResult.prototype.getGeometry=function(){switch(this._geomType){case SNAP_VERTEX:return this._geomVertex
case SNAP_EDGE:return this._geomEdge
case SNAP_FACE:return this._geomFace
case SNAP_CIRCULARARC:case SNAP_CURVEDEDGE:return this._geomEdge
case SNAP_CURVEDFACE:return this._geomFace}return null},Autodesk.Viewing.Extensions.Measure.SnapResult.prototype.setGeometry=function(e,t){switch(e){case SNAP_VERTEX:this._geomVertex=t
break
case SNAP_EDGE:this._geomEdge=t
break
case SNAP_FACE:this._geomFace=t
break
case SNAP_CIRCULARARC:case SNAP_CURVEDEDGE:this._geomEdge=t
break
case SNAP_CURVEDFACE:this._geomFace=t
break
default:return}this._geomType=e}}(),function(){"use strict"
Autodesk.Viewing.Extensions.Measure.Measurement=function(e){this.first=new Autodesk.Viewing.Extensions.Measure.SnapResult,this.second=new Autodesk.Viewing.Extensions.Measure.SnapResult,this._units="",this._precision=null,this._calibrationFactor=e.calibrationFactor||1,this.resetMeasureValues()},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.resetMeasureValues=function(){this._isAngle=!1,this._angle=0,this._distanceX=0,this._distanceY=0,this._distanceZ=0,this._distanceXYZ=0,this._result=null},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.clone=function(){var e=new Autodesk.Viewing.Extensions.Measure.Measurement
return e.first=this.first.clone(),e.second=this.second.clone(),e._units=this._units,e._precision=this._precision,e._calibrationFactor=this._calibrationFactor,e},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.hasFirstPick=function(){return!this.first.isEmpty()},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.hasSecondPick=function(){return!this.second.isEmpty()},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.hasFirstPickOnly=function(){return this.hasFirstPick()&&!this.hasSecondPick()},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.isComplete=function(){return this.hasFirstPick()&&this.hasSecondPick()},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.isEmpty=function(){return this.first.isEmpty()&&this.second.isEmpty()},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.clearFirstPick=function(){this.second.copyTo(this.first),this.clearSecondPick()},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.clearSecondPick=function(){this.second.clear(),this.resetMeasureValues()},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.clearBothPicks=function(){this.first.clear(),this.second.clear(),this.resetMeasureValues()},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.matches=function(e,t){return this.first._geomType===e&&this.second._geomType===t},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.hasEqualPicks=function(){if(this.first._geomType===this.second._geomType)switch(this.first._geomType){case SNAP_VERTEX:if(this.first.getGeometry().equals(this.second.getGeometry()))return!0
break
case SNAP_EDGE:case SNAP_CIRCULARARC:case SNAP_CURVEDEDGE:return this.isIdenticalEdges()
case SNAP_FACE:case SNAP_CURVEDFACE:return this.isIdenticalFaces()}return!1},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.isIdenticalEdges=function(){var e=this.first.getGeometry(),t=this.second.getGeometry()
if(e.vertices.length===t.vertices.length){for(var i=0;i<e.vertices.length;i++)if(!e.vertices[i].equals(t.vertices[i]))return!1
return!0}return!1},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.isIdenticalFaces=function(){var e=this.first.getGeometry(),t=this.second.getGeometry()
if(e.faceId&&e.faceId){if(e.fragId===t.fragId&&e.faceId===t.faceId)return!0}else if(e.vertices.length===t.vertices.length){for(var i=0;i<e.vertices.length;i++)if(!e.vertices[i].equals(t.vertices[i]))return!1
return!0}return!1},Autodesk.Viewing.Extensions.Measure.Measurement.prototype.measure=function(e){if(!this.isComplete()||this.hasEqualPicks()||null===this._result)return!1
var t=this._result
if(void 0===t.length)return this._isAngle=!0,this._angle=t,this._distanceXYZ=0,this._distanceX=0,this._distanceY=0,this._distanceZ=0,!0
this._isAngle=!1,this._angle=0
var i=t[0].clone(),n=t[1].clone()
return e.model.is2d()&&e.model.pageToModel(i,n,this.first._viewportIndex2d),this._distanceXYZ=i.distanceTo(n),this._distanceX=Math.abs(i.x-n.x),this._distanceY=Math.abs(i.y-n.y),this._distanceZ=Math.abs(i.z-n.z),!0}}(),function(){"use strict"
function e(e,t,i){function n(){return K.toolController.getTool("calibration")}function o(){var e=n()
return e&&e.isActive()}function r(e){return e.classList.contains("visible")}function s(e,t,i){(e.classList.contains(t)&&!i||!e.classList.contains(t)&&i)&&e.classList.toggle(t,i)}function a(){K.impl.overlayScenes[P]||K.impl.createOverlayScene(P)}function l(e,t){if(e)for(var i in e)if(e.hasOwnProperty(i)){var n=e[i]
n&&t(n)}}function c(){G&&(K.impl.removeOverlay(P,G),G=null),z.length>0&&(K.impl.removeMultipleOverlays(P,z),z.length=0)}function d(){W.length>0&&(K.impl.removeMultipleOverlays(P,W),W.length=0)}function u(){j.length>0&&(K.impl.removeMultipleOverlays(P,j),j.length=0)}function h(){Y.length>0&&(K.impl.removeMultipleOverlays(P,Y),Y.length=0)}function p(){var e=document.createElement("div")
e.className="measure-length"
var t=document.createElement("div")
t.className="measure-fetching-topology",t.style.display="none",e.appendChild(t)
var i=document.createElement("div")
if(i.className="measure-length-text",e.appendChild(i),le){var n=document.createElement("div")
n.className="measure-delta-text",e.appendChild(n)}return e.causeStacking=!0,e}function m(e,t){var i=e.querySelector(".measure-length-text")
i&&(i.style.display=t?"":"none")}function g(e,t){if(e){var i=e.querySelector(".measure-length-text")
i&&(i.textContent=t)}}function f(e,t){if(e){var i=e.querySelector(".measure-delta-text")
i&&(i.textContent=t)}}function v(e,t){if(e){var i=e.querySelector(".measure-fetching-topology")
i&&(i.style.display=t&&J===T?"inline-block":"none")}}function E(e,t,i){var n=document.createElement("div")
n.className="measure-label",n.setAttribute("data-pick",t)
var o=document.createElement("div")
return o.className=e+" measure-label-icon",n.appendChild(o),n.addEventListener("mousedown",function(e){e.canvasX=e.clientX,e.canvasY=e.clientY,Z.editEndpoint(e,i)}),n.addEventListener("mousewheel",K.toolController.mousewheel),A.isMobileDevice()&&(n.style.fontSize="30px",n.style.borderRadius="30px",o.style.width="30px",o.style.height="30px",o.style.fontSize="inherit"),n.causeStacking=!1,n}function y(e,t){if(t)q.indexOf(e)>-1||q.push(e)
else{var i=q.indexOf(e)
i>-1&&q.splice(i,1)}}var A=Autodesk.Viewing,T=1,b=.001,w=t,C=this,S=!1,R=null,x=.7,P="MeasureTool-common",k=null,M=null,V=null,I=null,L=null,D=null,N=null,_=null,O={first:{mesh:null,className:"adsk-icon-first"},second:{mesh:null,className:"adsk-icon-second"}},H={first:{className:"adsk-icon-first",line:null,intersectPoint:null},second:{className:"adsk-icon-second",line:null,intersectPoint:null}},B={first:{mesh:null,className:"adsk-icon-first"},second:{mesh:null,className:"adsk-icon-second"}},F={xyz:{axis:!1,color:"FF9900"},x:{axis:!0,color:"F12C2C"},y:{axis:!0,color:"0BB80B"},z:{axis:!0,color:"2C2CF1"}},G=null,z=[],U={},W=[],j=[],Y=[],X=[],q=[],K=e,Z=i,Q=!1,J=0,$=null,ee=4,te=null,ie=null,ne=null,oe=K.autocam.getWorldRightVector(),re=K.autocam.getWorldUpVector(),se=K.autocam.getWorldFrontVector(),ae=new THREE.Vector3,le=!0
window.addEventListener("mouseup",function(e){Z.handleButtonUp(e)}),this.init=function(){Q=K.model.getData().isLeaflet,ie=K.toolController.getTool("snapper"),ne=K.toolController.getTool("measure")
var e
switch(O.first.label||(e=O.first.label=E(O.first.className,"point-1",1),K.container.appendChild(e)),O.second.label||(e=O.second.label=E(O.second.className,"point-2",2),K.container.appendChild(e)),H.first.label||(e=H.first.label=E(H.first.className,"edge-1",1),K.container.appendChild(e)),H.second.label||(e=H.second.label=E(H.second.className,"edge-2",2),K.container.appendChild(e)),B.first.label||(e=B.first.label=E(B.first.className,"face-1",1),K.container.appendChild(e)),B.second.label||(e=B.second.label=E(B.second.className,"face-2",2),K.container.appendChild(e)),F.xyz.label||(e=F.xyz.label=p(),K.container.appendChild(e)),J){case T:this.setFetchingTopology()
break
case 2:this.setTopologyAvailable()
break
case 0:this.setNoTopology()}this.onCameraChangeBinded=this.onCameraChange,K.addEventListener(A.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded)},this.showFirstVertex=function(){var e=w.first.getGeometry()
if(o()){var t=n()
t.setFirstEndpoint(w.first),t.updateCalibrationLine(e.x,e.y,e.z,e.x,e.y,e.z,1,!1,!0,w.first._geomType)}else{var i=this.setScale(e)
this.showEndPoint(O.first,e,i)}},this.showSecondVertex=function(){if(o()){n().setSecondEndpoint(w.second)}else{var e=w.second.getGeometry(),t=this.setScale(e)
this.showEndPoint(O.second,e,t)}},this.showEndPoint=function(e,t,i){k||(k=new THREE.MeshPhongMaterial({color:2002943,ambient:2002943,opacity:x,transparent:!0,depthTest:!1,depthWrite:!1})),a()
var n=e.mesh
n||(te||(te=new THREE.SphereGeometry(1)),e.geometry=te,n=e.mesh=new THREE.Mesh(e.geometry,k),K.impl.addOverlay(P,n)),n.scale.x=i,n.scale.y=i,n.scale.z=i,n.position.set(t.x,t.y,t.z),n.visible=!0,K.impl.invalidate(!1,!1,!0)},this.setScale=function(e){var t=K.navigation,i=t.getCamera(),n=t.getEyeVector(),o=t.getPosition(),r=e.clone(),s=i.isPerspective?r.sub(o).dot(n.normalize()):t.getEyeVector().length(),a=t.getVerticalFov(),l=2*s*Math.tan(THREE.Math.degToRad(.5*a)),c=t.getScreenViewport(),d=window.devicePixelRatio||1
return 5*l/(c.height*d)},this.updateScale=function(){var e,t=this
l(O,function(e){var i=e.mesh
if(i){var n=t.setScale(i.position)
i.scale.x=n,i.scale.y=n,i.scale.z=n}}),l(W,function(e){var i=t.setScale(e.geometry.vertices[0])
e.material.dashSize=4*i,e.material.gapSize=2*i}),l(H,function(e){l(e.line,function(e){t.setCylinderScale(e)})}),l(z,function(e){t.setCylinderScale(e)})
for(var e in F)if(F.hasOwnProperty(e)){var i=F[e]
i.line&&this.setCylinderScale(i.line)}},this.showFirstEdge=function(){if(o()){var e=w.first._intersectPoint,t=n()
t.setFirstEndpoint(w.first),t.updateCalibrationLine(e.x,e.y,e.z,e.x,e.y,e.z,1,!1,!0,w.first._geomType)}else{var i=w.first.getGeometry()
this.showEdge(H.first,i)}},this.showSecondEdge=function(){if(o()){n().setSecondEndpoint(w.second)}else{var e=w.second.getGeometry()
this.showEdge(H.second,e)}},this.showEdge=function(e,t){M||(M=new THREE.MeshPhongMaterial({color:2002943,ambient:2002943,opacity:x,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),a(),e.line&&K.impl.removeMultipleOverlays(P,e.line),e.line=this.drawEdgeAsCylinder(t,M,5,1),K.impl.addMultipleOverlays(P,e.line)},this.drawEdgeAsCylinder=function(e,t,i,n){var o=[]
if(1==n)for(var r=0;r<e.vertices.length;r+=2){var s=this.cylinderMesh(e.vertices[r],e.vertices[r+1],t,i)
this.setCylinderScale(s),o.push(s)}else for(var r=0;r<e.vertices.length-1;r++){var s=this.cylinderMesh(e.vertices[r],e.vertices[r+1],t,i)
this.setCylinderScale(s),o.push(s)}return o},this.drawLineAsCylinder=function(e,t,i){var n
return 2==e.vertices.length&&(n=this.cylinderMesh(e.vertices[0],e.vertices[1],t,i),this.setCylinderScale(n)),n}
var ce=null
this.cylinderMesh=function(e,t,i,n){var o=(new THREE.Vector3).subVectors(t,e),r=new THREE.Matrix4
r.lookAt(e,t,(new THREE.Object3D).up),r.multiply((new THREE.Matrix4).set(n,0,0,0,0,0,n,0,0,-o.length(),0,0,0,0,0,1)),ce||(ce=new THREE.CylinderGeometry(.1,.1,1,8,1,!0))
var s=new THREE.Mesh(ce,i)
return s.applyMatrix(r),s.lmv_line_width=n,s.position.x=(t.x+e.x)/2,s.position.y=(t.y+e.y)/2,s.position.z=(t.z+e.z)/2,s},this.setCylinderScale=function(e){var t=this.setScale(e.position)
e.hasOwnProperty("lmv_line_width")&&(t*=e.lmv_line_width),e.scale.x=t,e.scale.z=t},this.showFirstFace=function(){if(o()){var e=w.first._intersectPoint,t=n()
t.setFirstEndpoint(w.first),t.updateCalibrationLine(e.x,e.y,e.z,e.x,e.y,e.z,1,!1,!0,w.first._geomType)}else{var i=w.first.getGeometry()
this.showFace(B.first,i)}},this.showSecondFace=function(){if(o()){n().setSecondEndpoint(w.second)}else{var e=w.second.getGeometry()
this.showFace(B.second,e)}},this.showFace=function(e,t){V||(V=new THREE.MeshPhongMaterial({color:2002943,ambient:2002943,opacity:x,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),a(),e.mesh&&K.impl.removeOverlay(P,e.mesh),e.mesh=new THREE.Mesh(t,V),K.impl.addOverlay(P,e.mesh)},this.drawExtensionFace=function(e,t,i){N||(N=new THREE.MeshPhongMaterial({color:6737151,ambient:52479,opacity:.2,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),a()
var n=new THREE.Mesh(e,N)
n.position.set(t.x,t.y,t.z)
var o=n.position.clone()
o.add(i),n.lookAt(o),n.updateMatrixWorld(),j.push(n),K.impl.addOverlay(P,n)},this.drawGreyOutPlane=function(e){_||(_=new THREE.MeshPhongMaterial({color:0,ambient:0,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})),a()
var t=K.model.getMetadata("page_dimensions","page_width"),i=K.model.getMetadata("page_dimensions","page_height"),n=new THREE.Shape
n.moveTo(0,0),n.lineTo(t,0),n.lineTo(t,i),n.lineTo(0,i),n.lineTo(0,0)
var o=$=K.model.getClip(e),r=o.contours[0],s=new THREE.Path
s.moveTo(o.points[r[0]].x,o.points[r[0]].y)
for(var l=1;l<r.length;l++)s.lineTo(o.points[r[l]].x,o.points[r[l]].y)
s.lineTo(o.points[r[0]].x,o.points[r[0]].y),n.holes.push(s)
var c=new THREE.ShapeGeometry(n),d=new THREE.Mesh(c,_)
Y.push(d),K.impl.addOverlay(P,d)},this.getEdgeLength=function(e){for(var t=0,i=e.clone(),n=i.vertices,o=0;o<n.length;o+=2)K.model.is2d()&&K.model.pageToModel(n[o],n[o+1],w.first._viewportIndex2d),t+=n[o].distanceTo(n[o+1])
return t=Autodesk.Viewing.Private.convertUnits(K.model.getUnitString(),w._units,w._calibrationFactor,t),Autodesk.Viewing.Private.formatValueWithUnits(t,w._units,3,w._precision)},this.getCircularArcRadius=function(e){var t=e.radius
if(t){if(K.model.is2d()){var i=e.center.clone(),n=e.vertices[0].clone()
K.model.pageToModel(i,n,w.first._viewportIndex2d),t=i.distanceTo(n)}return t=Autodesk.Viewing.Private.convertUnits(K.model.getUnitString(),w._units,w._calibrationFactor,t),Autodesk.Viewing.Private.formatValueWithUnits(t,w._units,3,w._precision)}},this.getFaceArea=function(e){for(var t=0,i=e.vertices,n=new THREE.Vector3,o=new THREE.Vector3,r=0;r<i.length;r+=3)n.subVectors(i[r+1],i[r]),o.subVectors(i[r+2],i[r]),t+=n.length()*o.length()*Math.sin(n.angleTo(o))/2
return t=Autodesk.Viewing.Private.convertUnits(K.model.getUnitString(),w._units,w._calibrationFactor,t,"square"),w._units?Autodesk.Viewing.Private.formatValueWithUnits(t,w._units+"^2",3,w._precision):Autodesk.Viewing.Private.formatValueWithUnits(t,null,3,w._precision)},this.updateLabels=function(){w.first._geomType===SNAP_EDGE?g(H.first.label,this.getEdgeLength(w.first.getGeometry())):w.first._geomType===SNAP_FACE&&g(B.first.label,this.getFaceArea(w.first.getGeometry())),w.second._geomType===SNAP_EDGE?g(H.second.label,this.getEdgeLength(w.second.getGeometry())):w.second._geomType===SNAP_FACE&&g(B.second.label,this.getFaceArea(w.second.getGeometry()))},this.updateLabelPositions=function(){function e(e,t,i){var n=K.navigation.getCamera(),o=K.navigation.getScreenViewport(),r=new THREE.Vector3(e,t,i)
return r=r.project(n),{x:Math.round((r.x+1)/2*o.width)+5,y:Math.round((1-r.y)/2*o.height)+5}}for(var t in F)if(F.hasOwnProperty(t)){var i=F[t],n=i.label
if(n&&i.p1&&i.p2&&r(n)){var o={x:(i.p1.x+i.p2.x)/2,y:(i.p1.y+i.p2.y)/2,z:(i.p1.z+i.p2.z)/2},s=e(o.x,o.y,o.z)
n.style.top=s.y+"px",n.style.left=s.x+"px",n.point=o,X.push(n)}}if(U&&(n=U.label)&&U.p1&&U.p2&&r(n)){var o={x:(U.p1.x+U.p2.x)/2,y:(U.p1.y+U.p2.y)/2,z:(U.p1.z+U.p2.z)/2},s=e(o.x,o.y,o.z)
n.style.top=s.y+"px",n.style.left=s.x+"px",n.point=o,X.push(n)}for(var t in B)if(B.hasOwnProperty(t)){var a=B[t],n=a.label,o=a.intersectPoint
if(n&&o&&r(n)){var s=e(o.x,o.y,o.z)
n.style.top=s.y+"px",n.style.left=s.x+"px",n.point=o,X.push(n)}}for(var t in H)if(H.hasOwnProperty(t)){var l=H[t],n=l.label,o=l.intersectPoint
if(n&&o&&r(n)){var s=e(o.x,o.y,o.z)
n.style.top=s.y+"px",n.style.left=s.x+"px",n.point=o,X.push(n)}}for(var t in O)if(O.hasOwnProperty(t)){var c=O[t],n=c.label,o=c.position
if(n&&o&&r(n)){var s=e(o.x,o.y,o.z)
n.style.top=s.y+"px",n.style.left=s.x+"px",n.point=o,X.push(n)}}for(var d=0;d<X.length;d++)for(var u=0;u<d;u++)this.labelsOverlapDetection(X[u],X[d])&&le&&this.stackLabels(X)
X=[]},this.labelsOverlapDetection=function(e,t){var i=e.getBoundingClientRect(),n=t.getBoundingClientRect()
if(n.top<i.bottom&&n.bottom>i.top){if(n.right>i.left&&n.right<i.right)return t.style.left=parseInt(t.style.left,10)-(n.right-i.left)+"px",t.causeStacking
if(n.left>i.left&&n.left<i.right)return t.style.left=parseInt(t.style.left,10)+(i.right-n.left)+"px",t.causeStacking
if(n.left<=i.left&&n.right>=i.right)return t.style.left=parseInt(t.style.left,10)+(i.right-n.left)+"px",t.causeStacking}return!1},this.stackLabels=function(e){for(var t=e[0],i=1;i<e.length;i++)if(e[i].causeStacking){e[i].style.left=t.style.left
var n=e[i-1].getBoundingClientRect(),o=e[i-1]==t?ee:0
e[i].style.top=parseInt(e[i-1].style.top,10)+n.height+o+"px"}},this.drawLine=function(e,t,i,r){function l(e,t,n,o,r,l,c,d){var u=F[e],h=u.line,g=u.label,f=new THREE.Vector3(t,n,o),v=new THREE.Vector3(r,l,c)
if(h&&(K.impl.removeOverlay(P,h),u.line=null),g&&(s(g,"visible",!1),y(g,!1)),(Q&&"z"!==e||f.distanceTo(v)>=Math.pow(.01,Math.max(w._precision,1)))&&d){var E="xyz"===e||!S&&i
h||(u.material=new THREE.MeshBasicMaterial({color:parseInt(u.color,16),depthTest:!1,depthWrite:!1}),a()),u.material.opacity=i?1:x
var A=u.geometry=new THREE.Geometry
A.vertices.push(f),A.vertices.push(v)
var T="xyz"===e?5:"z"===e?1:2
if(h=u.line=C.drawLineAsCylinder(A,u.material,T),K.impl.addOverlay(P,h),h.visible=E,u.p1=f,u.p2=v,"xyz"!=e||i){if(!g){if(g=u.label=p(),m(g,"xyz"===e),u.axis){var b=le?"-delta":""
g.className="adsk-icon-axis"+b+"-"+e+" measure-label-axis"+b+" measure-label-axis-"+e,g.delta=le}K.container.appendChild(g)}u.axis||C.updateDistance(),s(g,"visible",E),y(g,E)}}}function c(e,t){return 1-Math.abs(e.dot(t))<b}if(o()){n().updateCalibrationLine(e.x,e.y,e.z,t.x,t.y,t.z,w._precision,i,ie.isSnapped(),w.first._geomType)}else{l("xyz",e.x,e.y,e.z,t.x,t.y,t.z,!0)
var d=K.navigation.getAlignedUpVector(),u=Math.abs(d.x),h=Math.abs(d.y),g=Math.abs(d.z),f=!r&&function(e,t){return ae.subVectors(e,t),ae.normalize(),!c(ae,oe)&&!c(ae,re)&&!c(ae,se)}(e,t)
g>u&&g>h?(l("x",e.x,e.y,e.z,t.x,e.y,e.z,f),l("y",t.x,e.y,e.z,t.x,t.y,e.z,f),l("z",t.x,t.y,e.z,t.x,t.y,t.z,f)):h>u&&h>g?(l("x",e.x,e.y,e.z,t.x,e.y,e.z,f),l("z",t.x,e.y,e.z,t.x,e.y,t.z,f),l("y",t.x,e.y,t.z,t.x,t.y,t.z,f)):(l("y",e.x,e.y,e.z,e.x,t.y,e.z,f),l("z",e.x,t.y,e.z,e.x,t.y,t.z,f),l("x",e.x,t.y,t.z,t.x,t.y,t.z,f))}this.updateLabelPositions()},this.updateDistance=function(){function e(e,t){e&&(e.style.width=t)}function t(e){if(e)return e.getBoundingClientRect().width}le&&(Object.keys(F).forEach(function(t){e(F[t].label,"")}),f(F.x.label,"~ "+ne.getDistanceX()),f(F.y.label,"~ "+ne.getDistanceY()),f(F.z.label,"~ "+ne.getDistanceZ()),g(F.xyz.label,"~ "+ne.getDistanceXYZ()),setTimeout(function(){var i=Math.max(t(F.x.label),t(F.y.label),t(F.z.label),t(F.xyz.label))
Object.keys(F).forEach(function(t){e(F[t].label,i+"px")})},0))},this.updateAngle=function(){g(U.label,"~ "+ne.getAngle())},this.drawExtensionLine=function(e,t,i,n){var o,r,s,l,c=new THREE.Vector3,d=new THREE.Vector3
if(c.subVectors(t,e),d.subVectors(i,t),l=c.dot(d),c.subVectors(i,t),l=-l/c.dot(c),c.subVectors(i,t),c.multiplyScalar(l),s=c.add(t),l<0)o=t,r=s
else{if(!(l>1))return
o=i,r=s}D||(D=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1})),a(),D.opacity=n?1:x
var u=this.setScale(o)
D.dashSize=4*u,D.gapSize=2*u
var h=new THREE.Geometry
h.vertices.push(o),h.vertices.push(r),h.computeLineDistances()
var p=new THREE.Line(h,D)
W.push(p),K.impl.addOverlay(P,p)},this.drawExtensionLinePointToPoint=function(e,t,i){var n=e,o=t
D||(D=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1})),a(),D.opacity=i?1:x
var r=this.setScale(n)
D.dashSize=4*r,D.gapSize=2*r
var s=new THREE.Geometry
s.vertices.push(n),s.vertices.push(o),s.computeLineDistances()
var l=new THREE.Line(s,D)
W.push(l),K.impl.addOverlay(P,l)},this.nearestPointsInSegmentToSegment=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3
o.subVectors(t,e),r.subVectors(n,i),s.subVectors(e,i)
var a,l,c,d,u=o.dot(o),h=o.dot(r),p=r.dot(r),m=o.dot(s),g=r.dot(s),f=u*p-h*h,v=f,E=f
return f<.001?(l=0,v=1,d=g,E=p):(l=h*g-p*m,d=u*g-h*m,l<0?(l=0,d=g,E=p):l>v&&(l=v,d=g+h,E=p)),d<0?(d=0,-m<0?l=0:-m>u?l=v:(l=-m,v=u)):d>E&&(d=E,-m+h<0?l=0:-m+h>u?l=v:(l=-m+h,v=u)),a=Math.abs(l)<.001?0:l/v,c=Math.abs(d)<.001?0:d/E,o.multiplyScalar(a),r.multiplyScalar(c),s.add(o),s.sub(r),o.add(e),r.add(i),[o,r]},this.edgeToEdgeMeasure=function(e,t){var i=w.second.getGeometry(),n=w.first.getGeometry(),r=ie.getEndPointsInEdge(i),s=r[0].clone(),a=r[1].clone()
r=ie.getEndPointsInEdge(n)
var l=r[0].clone(),c=r[1].clone(),d=this.nearestPointInPointToLine(s,l,c),u=this.nearestPointInPointToLine(a,l,c),h=new THREE.Vector3,p=new THREE.Vector3
if(h.subVectors(s,a),p.subVectors(l,c),h.normalize(),p.normalize(),this.isEqualVectors(h,p,.01)||this.isInverseVectors(h,p,.01)||o())return s.distanceTo(e)<=a.distanceTo(e)?(this.drawLine(s,d,t),this.drawExtensionLine(s,l,c,t),[s,d]):(this.drawLine(a,u,t),this.drawExtensionLine(a,l,c,t),[a,u])
var m=this.nearestPointInPointToLine(e,s,a),g=this.angleVectorToVector(h,p)
return s.distanceTo(l)<s.distanceTo(c)&&s.distanceTo(l)<a.distanceTo(l)&&s.distanceTo(l)<a.distanceTo(c)?this.drawAngleLineToLine(s,m,l,c,g,t):s.distanceTo(c)<s.distanceTo(l)&&s.distanceTo(c)<a.distanceTo(l)&&s.distanceTo(c)<a.distanceTo(c)?this.drawAngleLineToLine(s,m,c,l,g,t):a.distanceTo(l)<s.distanceTo(l)&&a.distanceTo(l)<s.distanceTo(c)&&a.distanceTo(l)<a.distanceTo(c)?this.drawAngleLineToLine(a,m,l,c,g,t):this.drawAngleLineToLine(a,m,c,l,g,t),g},this.curvedEdgeToEdgeMeasure=function(e,t,i){for(var n=Number.MAX_VALUE,o=null,r=null,s=e.vertices,a=ie.getEndPointsInEdge(t),l=0;l<s.length;l+=2){var c=this.nearestPointsInSegmentToSegment(s[l],s[l+1],a[0],a[1]),d=c[0].distanceTo(c[1])
d<n&&(n=d,o=c[0],r=c[1])}return this.drawLine(o,r,i),[o,r]},this.curvedEdgeToCurvedEdgeMeasure=function(e){for(var t=w.first.getGeometry(),i=w.second.getGeometry(),n=Number.MAX_VALUE,o=null,r=null,s=t.vertices,a=i.vertices,l=0;l<s.length;l+=2)for(var c=0;c<a.length;c+=2){var d=this.nearestPointsInSegmentToSegment(s[l],s[l+1],a[c],a[c+1]),u=d[0].distanceTo(d[1])
u<n&&(n=u,o=d[0],r=d[1])}return this.drawLine(o,r,e),[o,r]},this.nearestPointInPointToSegment=function(e,t,i){var n,o,r=new THREE.Vector3,s=new THREE.Vector3
return r.subVectors(t,e),s.subVectors(i,t),o=r.dot(s),r.subVectors(i,t),o=-o/r.dot(r),o<0?n=t:o>1?n=i:(r.subVectors(i,t),r.multiplyScalar(o),n=r.add(t)),n},this.nearestPointInPointToLine=function(e,t,i){var n,o=new THREE.Vector3,r=new THREE.Vector3
return o.subVectors(t,e),r.subVectors(i,t),n=o.dot(r),o.subVectors(i,t),n=-n/o.dot(o),o.subVectors(i,t),o.multiplyScalar(n),o.add(t)},this.pointToEdgeMeasure=function(e,t,i,n){var o=ie.getEndPointsInEdge(t),r=o[0],s=o[1],a=this.nearestPointInPointToLine(e,r,s),l=this.nearestPointInPointToLine(i,r,s),c=new THREE.Vector3
return c.subVectors(l,a),c.add(e),this.drawLine(c,l,n),this.drawExtensionLinePointToPoint(e,c,n),[e,a]},this.edgeToPointMeasure=function(e,t,i){var n=ie.getEndPointsInEdge(t),o=n[0],r=n[1],s=this.nearestPointInPointToLine(e,o,r)
return this.drawLine(e,s,i),this.drawExtensionLine(e,o,r,i),[e,s]},this.curvedEdgeToVertexMeasure=function(e,t,i){for(var n=e.vertices,o=Number.MAX_VALUE,r=null,s=0;s<n.length;s+=2){var a=this.nearestPointInPointToSegment(t,n[s],n[s+1]),l=t.distanceTo(a)
l<o&&(o=l,r=a)}return this.drawLine(t,r,i),[t,r]},this.faceToFaceMeasure=function(e,t,i,n,o){var r=t.clone(),s=n.clone(),a=this.angleVectorToVector(t,n)
if(r.x<=s.x+.01&&r.x>=s.x-.01&&r.y<=s.y+.01&&r.y>=s.y-.01&&r.z<=s.z+.01&&r.z>=s.z-.01||r.x<=.01-s.x&&r.x>=-s.x-.01&&r.y<=.01-s.y&&r.y>=-s.y-.01&&r.z<=.01-s.z&&r.z>=-s.z-.01){var l=new THREE.Vector3
l.subVectors(e,i)
var c=r.dot(l)/r.dot(s)
l.addVectors(i,s.multiplyScalar(c))
var d=2*l.distanceTo(e),u=new THREE.PlaneBufferGeometry(d,d)
return this.drawExtensionFace(u,e,t),this.drawLine(i,l,o,!0),[i,l,a]}return a=this.drawAngleFaceToFace(e,t,i,n,o)},this.angleVectorToVector=function(e,t){return 180*e.angleTo(t)/Math.PI},this.intersectPlaneToPlane=function(e,t,i,n){var o=new THREE.Vector3
o.crossVectors(t,n)
var r,s=o.x>=0?o.x:-o.x,a=o.y>=0?o.y:-o.y,l=o.z>=0?o.z:-o.z
r=s>a?s>l?1:3:a>l?2:3
var c,d,u=new THREE.Vector3
switch(c=-t.dot(e),d=-n.dot(i),r){case 1:u.x=0,0!==o.x?(u.y=(d*t.z-c*n.z)/o.x,u.z=(c*n.y-d*t.y)/o.x):(u.y=-d*t.z/(t.z*n.y),u.z=-c*n.y/(t.z*n.y))
break
case 2:u.y=0,0!==o.y?(u.x=(c*n.z-d*t.z)/o.y,u.z=(d*t.x-c*n.x)/o.y):(u.x=-c*n.z/(t.x*n.z),u.z=-d*t.x/(t.x*n.z))
break
case 3:u.z=0,0!==o.z?(u.x=(d*t.y-c*n.y)/o.z,u.y=(c*n.x-d*t.x)/o.z):(u.x=-d*t.y/(t.y*n.x),u.y=-c*n.x/(t.y*n.x))}var h=new THREE.Vector3
return h.addVectors(u,o.multiplyScalar(100)),[this.nearestPointInPointToLine(e,u,h),this.nearestPointInPointToLine(i,u,h)]},this.drawAngle=function(e,t,i,n,o,r){I||(I=new THREE.MeshPhongMaterial({color:10066329,ambient:10066329,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),L=new THREE.MeshBasicMaterial({color:16750848,depthTest:!1,depthWrite:!1})),a(),c()
var s=e.distanceTo(t),l=new THREE.CircleGeometry(s,100,0,o*Math.PI/180),d=new THREE.Mesh(l,I),u=d.geometry.vertices[0].clone()
d.geometry.vertices.push(u),d.position.set(e.x,e.y,e.z)
var h=d.position.clone()
h.add(n),d.lookAt(h),d.updateMatrixWorld()
var p=d.geometry.vertices[1].clone(),m=d.geometry.vertices[d.geometry.vertices.length-2].clone()
p.applyMatrix4(d.matrixWorld),m.applyMatrix4(d.matrixWorld)
var g=new THREE.Vector3,f=new THREE.Vector3,v=new THREE.Vector3,E=new THREE.Vector3
g.subVectors(p,e),f.subVectors(m,e),v.subVectors(t,e),E.subVectors(i,e)
var y,A=g.angleTo(v),T=g.angleTo(E),b=f.angleTo(v),w=f.angleTo(E)
y=(A<=.001&&A>=-.001||T<=.001&&T>=-.001)&&(b<=.001&&b>=-.001||w<=.001&&w>=-.001)?0:(A<=Math.PI+.001&&A>=Math.PI-.001||T<=Math.PI+.001&&T>=Math.PI-.001)&&(b<=Math.PI+.001&&b>=Math.PI-.001||w<=Math.PI+.001&&w>=Math.PI-.001)?Math.PI:A<=b+.001&&A>=b-.001||A<=w+.001&&A>=w-.001?A:T
var C=new THREE.Matrix4
if(C.makeRotationAxis(n,y),C.multiply(d.matrix),d.matrix=C,d.rotation.setFromRotationMatrix(d.matrix),d.updateMatrixWorld(),p=d.geometry.vertices[1].clone(),m=d.geometry.vertices[d.geometry.vertices.length-2].clone(),p.applyMatrix4(d.matrixWorld),m.applyMatrix4(d.matrixWorld),g.subVectors(p,e),f.subVectors(m,e),A=g.angleTo(v),T=g.angleTo(E),b=f.angleTo(v),w=f.angleTo(E),A>=.001&&T>=.001){var C=new THREE.Matrix4
C.makeRotationAxis(n,2*-y),C.multiply(d.matrix),d.matrix=C,d.rotation.setFromRotationMatrix(d.matrix)}var S=new THREE.CircleGeometry(.9*s,100,0,o*Math.PI/180)
S.vertices.splice(0,1),d.updateMatrixWorld(),S.applyMatrix(d.matrixWorld)
var R=this.drawEdgeAsCylinder(S,L,2.5,0),x=new THREE.Geometry,k=new THREE.Geometry
x.vertices.push(d.geometry.vertices[0].clone(),d.geometry.vertices[1].clone()),k.vertices.push(d.geometry.vertices[0].clone(),d.geometry.vertices[d.geometry.vertices.length-2].clone()),x.applyMatrix(d.matrixWorld),k.applyMatrix(d.matrixWorld)
var M=this.drawLineAsCylinder(x,L,2.5),V=this.drawLineAsCylinder(k,L,2.5)
G=d,z=R.concat([M,V]),K.impl.addOverlay(P,G),K.impl.addMultipleOverlays(P,z),r.copy(d.geometry.vertices[Math.round(d.geometry.vertices.length/2)-1]),r.applyMatrix4(d.matrixWorld)},this.drawAngleFaceToFace=function(e,t,i,n,o){var r=this.intersectPlaneToPlane(e,t,i,n),a=new THREE.Vector3,l=new THREE.Vector3
a.subVectors(e,r[0]),l.subVectors(i,r[1])
var c=this.angleVectorToVector(a,l),d=r[0].clone(),u=new THREE.Vector3
u.crossVectors(t,n),u.normalize(),r=this.intersectPlaneToPlane(e,t,d,u)
var h=r[0].clone()
r=this.intersectPlaneToPlane(i,n,d,u)
var m=r[0].clone(),f=new THREE.Vector3
if(this.drawAngle(d,h,m,u,c,f),o){var v=U.label
v||(v=U.label=p(),K.container.appendChild(v)),g(v,ne.getAngle()),s(v,"visible",!0),y(v,!0),U.p1=f.clone(),U.p2=f.clone(),this.updateLabelPositions()}return c},this.drawAngleLineToLine=function(e,t,i,n,o,r){var a=e,l=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3
c.subVectors(e,t),d.subVectors(i,n),l.crossVectors(c,d),l.normalize()
var u=t,h=new THREE.Vector3
h.subVectors(a,i),h.add(n)
var m=new THREE.Vector3
if(this.drawAngle(a,u,h,l,o,m),r){var f=U.label
f||(f=U.label=p(),K.container.appendChild(f)),g(f,ne.getAngle()),s(f,"visible",!0),y(f,!0),U.p1=m.clone(),U.p2=m.clone(),this.updateLabelPositions()}},this.intersectLineToLine=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3
o.subVectors(i,e),o.cross(n),r.crossVectors(t,n)
var s=o.divide(r)
return r=t.clone(),r.multiplyScalar(s),o.addVectors(e,r),o},this.nearestPointInPointToPlane=function(e,t,i){var n=new THREE.Vector3,o=i.clone(),r=new THREE.Vector3
r.subVectors(e,t)
var s=-o.dot(r),a=o.dot(o),l=s/a
return n.addVectors(e,o.multiplyScalar(l)),n},this.faceToPointMeasure=function(e,t,i,n,o){var r=i.vertices[0],s=this.nearestPointInPointToPlane(n,r,e),a=t.clone(),l=new THREE.Vector3
l.subVectors(a,s),l.add(n)
var c=2*s.distanceTo(t),d=new THREE.PlaneBufferGeometry(c,c)
return this.drawExtensionFace(d,t,e),this.drawLine(n,s,o),[n,s]},this.nearestPointInPointToTriangle=function(e,t,i,n){var o,r=Number.MAX_VALUE
if(o=this.pointProjectsInTriangle(e,t,i,n))return o
var s=this.nearestPointInPointToSegment(e,t,i)
return e.distanceTo(s)<r&&(r=e.distanceTo(s),o=s.clone()),s=this.nearestPointInPointToSegment(e,t,n),e.distanceTo(s)<r&&(r=e.distanceTo(s),o=s.clone()),s=this.nearestPointInPointToSegment(e,i,n),e.distanceTo(s)<r&&(o=s.clone()),o},this.pointToFaceMeasure=function(e,t,i,n){var o=w.second.getGeometry(),r=o.vertices[0],s=this.nearestPointInPointToPlane(e,r,t),a=i.clone(),l=new THREE.Vector3
return l.subVectors(a,s),l.add(e),this.drawLine(a,l,n),this.drawExtensionLinePointToPoint(e,l,n),[e,s]},this.curvedFaceToVertexMeasure=function(e,t,i){for(var n,o=Number.MAX_VALUE,r=e.vertices,s=0;s<r.length;s+=3){var a=this.nearestPointInPointToTriangle(t,r[s],r[s+1],r[s+2])
t.distanceTo(a)<o&&(o=t.distanceTo(a),n=a)}return this.drawLine(n,t,i),[n,t]},this.pointProjectsInTriangle=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Vector3
o.subVectors(i,t),r.subVectors(n,t),a.crossVectors(o,r),s.subVectors(e,t),o.cross(s)
var l=o.dot(a)/a.dot(a)
s.cross(r)
var i=s.dot(a)/a.dot(a),t=1-l-i
if(t>=0&&t<=1&&i>=0&&i<=1&&l>=0&&l<=1){var c=THREE.Triangle.normal(t,i,n)
return this.nearestPointInPointToPlane(e,t,c)}},this.nearestPointsInLineSegmentToTriangle=function(e,t,i,n,o){var r,s,a=[],l=Number.MAX_VALUE,c=this.pointProjectsInTriangle(e,i,n,o)
c&&e.distanceTo(c)<l&&(l=e.distanceTo(c),a[0]=e,a[1]=c)
var d=this.pointProjectsInTriangle(t,i,n,o)
d&&t.distanceTo(d)<l&&(l=t.distanceTo(d),a[0]=t,a[1]=d),r=i,s=n
var u=this.nearestPointsInSegmentToSegment(e,t,r,s)
return u[0].distanceTo(u[1])<l&&(l=u[0].distanceTo(u[1]),a[0]=u[0].clone(),a[1]=u[1].clone()),r=i,s=o,u=this.nearestPointsInSegmentToSegment(e,t,r,s),u[0].distanceTo(u[1])<l&&(l=u[0].distanceTo(u[1]),a[0]=u[0].clone(),a[1]=u[1].clone()),r=n,s=o,u=this.nearestPointsInSegmentToSegment(e,t,r,s),u[0].distanceTo(u[1])<l&&(a[0]=u[0].clone(),a[1]=u[1].clone()),a},this.nearestPointsInEdgeToFace=function(e,t,i){for(var n=[],o=Number.MAX_VALUE,r=0;r<i.vertices.length;r+=3){var s=this.nearestPointsInLineSegmentToTriangle(e,t,i.vertices[r],i.vertices[r+1],i.vertices[r+2])
s[0].distanceTo(s[1])<o&&(o=s[0].distanceTo(s[1]),n=s)}return n},this.nearestPointsInTriangleToTriangle=function(e,t,i,n,o,r){function s(e,t,i,n){var o=l.pointProjectsInTriangle(e,t,i,n)
o&&e.distanceTo(o)<d&&(d=e.distanceTo(o),c[0]=e,c[1]=o)}function a(e,t,i,n){var o=l.nearestPointsInSegmentToSegment(e,t,i,n)
o[0].distanceTo(o[1])<d&&(d=o[0].distanceTo(o[1]),c=o)}var l=this,c=[],d=Number.MAX_VALUE
return s(e,n,o,r),s(t,n,o,r),s(i,n,o,r),s(n,e,t,i),s(o,e,t,i),s(r,e,t,i),a(e,t,n,o),a(e,t,n,r),a(e,t,o,r),a(e,i,n,o),a(e,i,n,r),a(e,i,o,r),a(t,i,n,o),a(t,i,n,r),a(t,i,o,r),c},this.curvedEdgeToFaceMeasure=function(e,t,i){for(var n=Number.MAX_VALUE,o=[],r=e.vertices,s=0;s<r.length;s+=2){var a=this.nearestPointsInEdgeToFace(r[s],r[s+1],t)
a[0].distanceTo(a[1])<n&&(n=a[0].distanceTo(a[1]),o=a)}return this.drawLine(o[0],o[1],i),[o[0],o[1]]},this.curvedFaceToFaceMeasure=function(e){var t=w.first.getGeometry(),i=w.second.getGeometry(),n=Number.MAX_VALUE,o=[],r=t.vertices,s=i.vertices
t.computeBoundingSphere(),i.computeBoundingSphere()
var a=new THREE.Sphere,l=new THREE.Sphere,c=[],d=Number.MAX_VALUE,u=[],h=[]
t.bSpheres=[],i.bSpheres=[]
for(var p=0;p<r.length;p+=3){a.setFromPoints([r[p],r[p+1],r[p+2]]),t.bSpheres.push(a.clone())
var m=a.center.distanceTo(i.boundingSphere.center)+a.radius+i.boundingSphere.radius
m<d&&(d=m)}for(var p=0;p<r.length;p+=3){a=t.bSpheres[p/3]
var g=a.center.distanceTo(i.boundingSphere.center)-a.radius-i.boundingSphere.radius
g<=d&&u.push(p)}d=Number.MAX_VALUE
for(var f=0;f<s.length;f+=3){l.setFromPoints(s[f],s[f+1],s[f+2]),i.bSpheres.push(l.clone())
var m=l.center.distanceTo(t.boundingSphere.center)+l.radius+t.boundingSphere.radius
m<d&&(d=m)}for(var f=0;f<s.length;f+=3){l=i.bSpheres[f/3]
var g=l.center.distanceTo(t.boundingSphere.center)-l.radius-t.boundingSphere.radius
g<=d&&h.push(f)}d=Number.MAX_VALUE
for(var p=0;p<u.length;p++){a=t.bSpheres[u[p]/3]
for(var f=0;f<h.length;f++){l=i.bSpheres[h[f]/3]
var g=a.center.distanceTo(l.center)-a.radius-l.radius,m=a.center.distanceTo(l.center)+a.radius+l.radius
m<d&&(d=m,c.push({i:u[p],j:h[f],value:g}))}}for(var v=0;v<c.length;v++)if(c[v].value<=d&&c[v].value<n){var E=this.nearestPointsInTriangleToTriangle(r[c[v].i],r[c[v].i+1],r[c[v].i+2],s[c[v].j],s[c[v].j+1],s[c[v].j+2])
E[0].distanceTo(E[1])<n&&(n=E[0].distanceTo(E[1]),o=E)}return this.drawLine(o[0],o[1],e),[o[0],o[1]]},this.faceToEdgeMeasure=function(e,t,i,n){var o,r,s=w.first.getGeometry(),a=w.second.getGeometry(),l=ie.getEndPointsInEdge(a)
l[0].distanceTo(t)<l[1].distanceTo(t)?(o=l[0],r=l[1]):(o=l[1],r=l[0])
var c=new THREE.Vector3
c.subVectors(r,o)
var d=this.angleLineToPlane(c,e)
if(c.dot(e)<=.01&&c.dot(e)>=-.01){var u=s.vertices[0],h=this.nearestPointInPointToPlane(o,u,e),p=this.nearestPointInPointToLine(i,o,r)
return this.faceToPointMeasure(e,t,s,p),[o,h,d]}var m=this.nearestPointInPointToLine(i,o,r)
return this.drawAngleEdgeToFace(s.vertices[0],e,t,o,m,d,n),d},this.edgeToFaceMeasure=function(e,t,i,n){var o,r,s=w.first.getGeometry(),a=w.second.getGeometry(),l=ie.getEndPointsInEdge(s)
l[0].distanceTo(i)<l[1].distanceTo(i)?(o=l[0],r=l[1]):(o=l[1],r=l[0])
var c=new THREE.Vector3
c.subVectors(r,o)
var d=this.angleLineToPlane(c,t)
if(c.dot(t)<=.01&&c.dot(t)>=-.01){var u=a.vertices[0],h=this.nearestPointInPointToPlane(o,u,t),p=new THREE.Vector3
p.subVectors(i,h),p.add(o)
var m=new THREE.Vector3
return m.subVectors(i,h),m.add(r),this.drawLine(p,i,n),this.drawExtensionLinePointToPoint(p,m,n),[o,h,d]}var g=this.nearestPointInPointToLine(e,o,r)
return this.drawAngleEdgeToFace(a.vertices[0],t,i,o,g,d,n),d},this.angleLineToPlane=function(e,t){var i=this.angleVectorToVector(e,t)
return i>90?i-=90:i=90-i,i},this.drawAngleEdgeToFace=function(e,t,i,n,o,r,a){var l=this.intersectPointLineToPlane(e,t,n,o)
if(l){var c=o
if(90===r)var d=i.clone()
else var d=this.nearestPointInPointToPlane(o,e,t)
var u=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3
h.subVectors(o,n),p.subVectors(d,l),u.crossVectors(h,p),u.normalize()
var m=new THREE.Vector3
if(this.drawAngle(l,c,d,u,r,m),a){var f=U.label
if(!f){f=U.label=document.createElement("div"),f.className="measure-length",K.container.appendChild(f)
var v=document.createElement("div")
v.className="measure-length-text",f.appendChild(v),f.style.pointerEvents="none",f.causeStacking=!0}g(f,ne.getAngle()),s(f,"visible",!0),y(f,!0),U.p1=m.clone(),U.p2=m.clone(),this.updateLabelPositions()}}},this.intersectPointLineToPlane=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3
o.subVectors(n,i),r.subVectors(i,e)
var s=t.dot(o),a=-t.dot(r)
return Math.abs(s)<.001?null:(o.multiplyScalar(a/s),o.add(i),o)},this.nearestVertexInVertexToEdge=function(e,t){for(var i,n=Number.MAX_VALUE,o=0;o<t.vertices.length;o++){var r=e.distanceTo(t.vertices[o])
n>r&&(i=t.vertices[o],n=r)}return i},this.isEqualVectors=function(e,t,i){return Math.abs(e.x-t.x)<=i&&Math.abs(e.y-t.y)<=i&&Math.abs(e.z-t.z)<=i},this.isInverseVectors=function(e,t,i){return Math.abs(e.x+t.x)<=i&&Math.abs(e.y+t.y)<=i&&Math.abs(e.z+t.z)<=i},this.setSimple=function(e){if(S!=e){S=e
for(var t in F)if("xyz"!==t&&F.hasOwnProperty(t)){var i=F[t]
i.line&&(i.line.visible=!e,i.label&&(s(i.label,"visible",!e),y(i.label,!e)))}K.impl.invalidate(!1,!1,!0)}},this.hide=function(){var e
for(e in O)if(O.hasOwnProperty(e)){var t=O[e]
t.mesh&&(t.mesh.visible=!1),t.label&&(s(t.label,"visible",!1),y(t.label,!1))}for(e in H)if(H.hasOwnProperty(e)){var i=H[e]
if(i.line)for(var n in i.line)i.line[n].visible=!1
i.label&&(s(i.label,"visible",!1),y(i.label,!1))}for(e in B)if(B.hasOwnProperty(e)){var o=B[e]
o.mesh&&(o.mesh.visible=!1),o.label&&(s(o.label,"visible",!1),y(o.label,!1))}for(e in F)if(F.hasOwnProperty(e)){var r=F[e]
r.line&&(r.line.visible=!1),r.label&&(s(r.label,"visible",!1),y(r.label,!1))}U.label&&(s(U.label,"visible",!1),y(U.label,!1)),c(),D&&d(),N&&u(),_&&h(),$=null,K.impl.invalidate(!1,!1,!0)},this.hideClick=function(e){if(O.hasOwnProperty(e)){var t=O[e]
t.mesh&&(t.mesh.visible=!1),t.label&&(s(t.label,"visible",!1),y(t.label,!1))}if(H.hasOwnProperty(e)){var i=H[e]
if(i.line)for(var n in i.line)i.line[n].visible=!1
i.label&&(s(i.label,"visible",!1),y(i.label,!1))}if(B.hasOwnProperty(e)){var o=B[e]
o.mesh&&(o.mesh.visible=!1),o.label&&(s(o.label,"visible",!1),y(o.label,!1))}for(var r in F)if(F.hasOwnProperty(r)){var a=F[r]
a.line&&(a.line.visible=!1),a.label&&(s(a.label,"visible",!1),y(a.label,!1))}U.label&&(s(U.label,"visible",!1),y(U.label,!1)),c(),D&&d(),N&&u(),K.impl.invalidate(!1,!1,!0)},this.destroy=function(){var e
for(e in O)if(O.hasOwnProperty(e)){var t=O[e]
t.mesh&&(K.impl.removeOverlay(P,t.mesh),t.mesh=t.geometry=null),t.label&&(t.label.parentNode.removeChild(t.label),t.label=null)}for(e in H)if(H.hasOwnProperty(e)){var i=H[e]
i.line&&(K.impl.removeMultipleOverlays(P,i.line),i.line=i.intersectPoint=null),i.label&&(i.label.parentNode.removeChild(i.label),i.label=null)}for(e in B)if(B.hasOwnProperty(e)){var n=B[e]
n.mesh&&(K.impl.removeOverlay(P,n.mesh),n.mesh=n.intersectPoint=null),n.label&&(n.label.parentNode.removeChild(n.label),n.label=null)}k=null,V=null,M=null,I=null,D=null,d(),N=null,u(),_=null,h()
for(e in F)if(F.hasOwnProperty(e)){var o=F[e]
o.line&&(K.impl.removeOverlay(P,o.line),o.material=o.line=o.geometry=null),o.label&&(o.label.parentNode.removeChild(o.label),o.label=null),o.material=o.line=o.geometry=o.label=o.p1=o.p2=null}c(),U.label&&(U.label.parentNode.removeChild(U.label),U.label=null),U.label=U.p1=U.p2=null,te&&te.dispose(),ce&&ce.dispose(),K.impl.overlayScenes[P]&&K.impl.removeOverlayScene(P),ie=null,ne=null,q=[],K.removeEventListener(A.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded)},this.setNoTopology=function(){J=0,F.xyz.label&&(v(F.xyz.label,!1),F.xyz.label.classList.remove("fetching-topology"))},this.setFetchingTopology=function(){J=T,F.xyz.label&&(v(F.xyz.label,!0),F.xyz.label.classList.add("fetching-topology"))},this.setTopologyAvailable=function(){J=2,F.xyz.label&&(v(F.xyz.label,!1),F.xyz.label.classList.remove("fetching-topology"))},this.render=function(e){w.hasFirstPick()&&(e&&o()||!o())&&this.doRenderFirst(),w.hasSecondPick()&&this.doRenderSecond(e)},this.doRenderFirst=function(){switch(w.first._geomType){case SNAP_VERTEX:this.showFirstVertex()
break
case SNAP_EDGE:case SNAP_CURVEDEDGE:this.showFirstEdge()
break
case SNAP_FACE:case SNAP_CURVEDFACE:this.showFirstFace()
break
case SNAP_CIRCULARARC:this.showFirstEdge()}},this.doRenderSecond=function(e){var t=null
if(w.matches(SNAP_VERTEX,SNAP_VERTEX))this.showSecondVertex(),this.drawLine(w.first.getGeometry(),w.second.getGeometry(),e),t=[w.first.getGeometry(),w.second.getGeometry()]
else if(w.matches(SNAP_EDGE,SNAP_EDGE))this.showSecondEdge(),t=this.edgeToEdgeMeasure(w.second._intersectPoint,e)
else if(w.matches(SNAP_FACE,SNAP_FACE))this.showSecondFace(),t=this.faceToFaceMeasure(w.first._intersectPoint,w.first._faceNormal,w.second._intersectPoint,w.second._faceNormal,e)
else if(w.matches(SNAP_VERTEX,SNAP_EDGE))this.showSecondEdge(),t=this.pointToEdgeMeasure(w.first.getGeometry(),w.second.getGeometry(),w.second._intersectPoint,e)
else if(w.matches(SNAP_EDGE,SNAP_VERTEX))this.showSecondVertex(),t=this.edgeToPointMeasure(w.second.getGeometry(),w.first.getGeometry(),e)
else if(w.matches(SNAP_VERTEX,SNAP_FACE))this.showSecondFace(),t=this.pointToFaceMeasure(w.first.getGeometry(),w.second._faceNormal,w.second._intersectPoint,e)
else if(w.matches(SNAP_FACE,SNAP_VERTEX))this.showSecondVertex(),t=this.faceToPointMeasure(w.first._faceNormal,w.first._intersectPoint,w.first.getGeometry(),w.second.getGeometry(),e)
else if(w.matches(SNAP_EDGE,SNAP_FACE))this.showSecondFace(),t=this.edgeToFaceMeasure(w.first._intersectPoint,w.second._faceNormal,w.second._intersectPoint,e)
else if(w.matches(SNAP_FACE,SNAP_EDGE))this.showSecondEdge(),t=this.faceToEdgeMeasure(w.first._faceNormal,w.first._intersectPoint,w.second._intersectPoint,e)
else if(w.matches(SNAP_CIRCULARARC,SNAP_CIRCULARARC))if(w.first._circularArcCenter.equals(w.second._circularArcCenter)){var i=this.nearestVertexInVertexToEdge(w.second._intersectPoint,w.second.getGeometry())
w.second.setGeometry(SNAP_VERTEX,i),this.showSecondVertex(),this.drawLine(w.first._circularArcCenter,w.second.getGeometry(),e),t=[w.first._circularArcCenter,w.second.getGeometry()]}else this.showSecondEdge(),this.drawLine(w.first._circularArcCenter,w.second._circularArcCenter,e),t=[w.first._circularArcCenter,w.second._circularArcCenter]
else w.matches(SNAP_CIRCULARARC,SNAP_VERTEX)?(this.showSecondVertex(),this.drawLine(w.first._circularArcCenter,w.second.getGeometry(),e),t=[w.first._circularArcCenter,w.second.getGeometry()]):w.matches(SNAP_VERTEX,SNAP_CIRCULARARC)?(this.showSecondEdge(),this.drawLine(w.first.getGeometry(),w.second._circularArcCenter,e),t=[w.first.getGeometry(),w.second._circularArcCenter]):w.matches(SNAP_CIRCULARARC,SNAP_EDGE)?(this.showSecondEdge(),t=this.pointToEdgeMeasure(w.first._circularArcCenter,w.second.getGeometry(),w.second._intersectPoint,e)):w.matches(SNAP_EDGE,SNAP_CIRCULARARC)?(this.showSecondEdge(),t=this.edgeToPointMeasure(w.second._circularArcCenter,w.first.getGeometry(),e)):w.matches(SNAP_CIRCULARARC,SNAP_FACE)?(this.showSecondFace(),t=this.pointToFaceMeasure(w.first._circularArcCenter,w.second._faceNormal,w.second._intersectPoint,e)):w.matches(SNAP_FACE,SNAP_CIRCULARARC)?(this.showSecondEdge(),t=this.faceToPointMeasure(w.first._faceNormal,w.first._intersectPoint,w.first.getGeometry(),w.second._circularArcCenter,e)):w.matches(SNAP_CURVEDEDGE,SNAP_VERTEX)?(this.showSecondVertex(),t=this.curvedEdgeToVertexMeasure(w.first.getGeometry(),w.second.getGeometry(),e)):w.matches(SNAP_VERTEX,SNAP_CURVEDEDGE)?(this.showSecondEdge(),t=this.curvedEdgeToVertexMeasure(w.second.getGeometry(),w.first.getGeometry(),e)):w.matches(SNAP_CURVEDEDGE,SNAP_CIRCULARARC)?(this.showSecondEdge(),t=this.curvedEdgeToVertexMeasure(w.first.getGeometry(),w.second._circularArcCenter,e)):w.matches(SNAP_CIRCULARARC,SNAP_CURVEDEDGE)?(this.showSecondEdge(),t=this.curvedEdgeToVertexMeasure(w.second.getGeometry(),w.first._circularArcCenter,e)):w.matches(SNAP_CURVEDEDGE,SNAP_EDGE)?(this.showSecondEdge(),t=this.curvedEdgeToEdgeMeasure(w.first.getGeometry(),w.second.getGeometry(),e)):w.matches(SNAP_EDGE,SNAP_CURVEDEDGE)?(this.showSecondEdge(),t=this.curvedEdgeToEdgeMeasure(w.second.getGeometry(),w.first.getGeometry(),e)):w.matches(SNAP_CURVEDEDGE,SNAP_CURVEDEDGE)?(this.showSecondEdge(),t=this.curvedEdgeToCurvedEdgeMeasure(e)):w.matches(SNAP_CURVEDEDGE,SNAP_FACE)||w.matches(SNAP_CURVEDEDGE,SNAP_CURVEDFACE)?(this.showSecondFace(),t=this.curvedEdgeToFaceMeasure(w.first.getGeometry(),w.second.getGeometry(),e)):w.matches(SNAP_FACE,SNAP_CURVEDEDGE)||w.matches(SNAP_CURVEDFACE,SNAP_CURVEDEDGE)?(this.showSecondEdge(),t=this.curvedEdgeToFaceMeasure(w.second.getGeometry(),w.first.getGeometry(),e)):w.matches(SNAP_CURVEDFACE,SNAP_VERTEX)?(this.showSecondVertex(),t=this.curvedFaceToVertexMeasure(w.first.getGeometry(),w.second.getGeometry(),e)):w.matches(SNAP_VERTEX,SNAP_CURVEDFACE)?(this.showSecondFace(),t=this.curvedFaceToVertexMeasure(w.second.getGeometry(),w.first.getGeometry(),e)):w.matches(SNAP_CURVEDFACE,SNAP_CIRCULARARC)?(this.showSecondEdge(),t=this.curvedFaceToVertexMeasure(w.first.getGeometry(),w.second._circularArcCenter,e)):w.matches(SNAP_CIRCULARARC,SNAP_CURVEDFACE)?(this.showSecondFace(),t=this.curvedFaceToVertexMeasure(w.second.getGeometry(),w.first._circularArcCenter,e)):w.matches(SNAP_CURVEDFACE,SNAP_EDGE)?(this.showSecondEdge(),t=this.curvedEdgeToFaceMeasure(w.second.getGeometry(),w.first.getGeometry(),e)):w.matches(SNAP_EDGE,SNAP_CURVEDFACE)?(this.showSecondFace(),t=this.curvedEdgeToFaceMeasure(w.first.getGeometry(),w.second.getGeometry(),e)):w.matches(SNAP_CURVEDFACE,SNAP_FACE)||w.matches(SNAP_CURVEDFACE,SNAP_CURVEDFACE)?(this.showSecondFace(),t=this.curvedFaceToFaceMeasure(e)):w.matches(SNAP_FACE,SNAP_CURVEDFACE)&&(this.showSecondFace(),t=this.curvedFaceToFaceMeasure(e))
R=t,w._result=t},this.consumeSingleClick=function(e){if(!o()){switch(w.first._geomType){case SNAP_VERTEX:s(O.first.label,"visible",!0),y(O.first.label,!0),O.first.position=w.first.getGeometry().clone()
break
case SNAP_EDGE:case SNAP_CURVEDEDGE:s(H.first.label,"visible",!0),y(H.first.label,!0),H.first.intersectPoint=w.first._intersectPoint.clone()
break
case SNAP_FACE:case SNAP_CURVEDFACE:s(B.first.label,"visible",!0),y(B.first.label,!0),B.first.intersectPoint=w.first._intersectPoint.clone()}if(w.hasSecondPick()&&e){switch(w.second._geomType){case SNAP_VERTEX:s(O.second.label,"visible",!0),y(O.second.label,!0),O.second.position=w.second.getGeometry().clone()
break
case SNAP_EDGE:case SNAP_CURVEDEDGE:s(H.second.label,"visible",!0),y(H.second.label,!0),H.second.intersectPoint=w.second._intersectPoint.clone()
break
case SNAP_FACE:case SNAP_CURVEDFACE:s(B.second.label,"visible",!0),y(B.second.label,!0),B.second.intersectPoint=w.second._intersectPoint.clone()}}this.updateLabelPositions()}},this.onCameraChange=function(){K.model&&!K.model.is2d()&&q.forEach(function(e){s(e,"visible",K.navigation.isPointVisible(e.point))})}}AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.Indicator=e}(),function(){"use strict"
AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.MeasureTool=function(e,t){function i(){A.updateLabelPositions()}function n(){s.clearMeasurement()}function o(){return!!x&&x.isActive()}function r(){A&&(A.hide(),A.destroy()),y.resetMeasureValues(),T&&(T.setVisible(!1),T.updatePanel())}var s=this,a=e,l=t||{},c=["measure"],d=!1,u=!1,h=!1,p=!1,m=0,g=!1,f=!1,v=!1,E=!1,y=new Autodesk.Viewing.Extensions.Measure.Measurement(t),A=null,T=null,b=null,w=null,C=!0,S=!1,R=Autodesk.Viewing.Private.GuiViewer3D&&e instanceof Autodesk.Viewing.Private.GuiViewer3D,x=null
this.register=function(){if(R&&!T&&(T=new Autodesk.Viewing.Extensions.Measure.MeasurePanel(s,a,"measure-panel","Measure",t),a.addPanel(T)),!b){var i=l?l.snapperOptions:null
b=new Autodesk.Viewing.Extensions.Measure.Snapper(e,i),a.toolController.registerTool(b)}w||(w=new Autodesk.Viewing.Extensions.Measure.MagnifyingGlass(e),a.toolController.registerTool(w)),x||(x=new Autodesk.Viewing.Extensions.Measure.CalibrationTool(e,s,b,y,t),a.toolController.registerTool(x))},this.deregister=function(){this.deactivate(),T&&(a.removePanel(T),T.uninitialize()),a.toolController.deregisterTool(b),a.toolController.deregisterTool(w),a.toolController.deregisterTool(x),b=null,w=null,x=null},this.isActive=function(){return d},this.getNames=function(){return c},this.getName=function(){return c[0]},this.getCursor=function(){return u||o()?null:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAKZJREFUeNrclLEKwzAQQ9+FgH/Nk7d8ViFT+6cG36IsNXgIdMg5kAoOIw8WSDoDvAEN04BdEhFjgCTR4e6klFxSIgDLSNydbdsAPgRCktRaUylFkfZ0Z2qtVTlnAfugGibwAur3JFrAxoBnYGEy1pGYmQCLLNB6Uqmw182M9eRS0yzqGo+y6D9rytSQR8vM7DKfbtHy4x+/xG8J+d4W9WAi8fxFOwYA8W0ypu2ZfcsAAAAASUVORK5CYII=), auto"},this.getMeasurementRaw=function(){return y},this.activate=function(){d=!0,m=0,u=!1,h=!1,C=!!a.impl.rolloverDisabled,a.impl.disableRollover(!0),y._units||(y._units=a.model.getDisplayUnit()),null===y._precision&&(a.model&&a.model.is2d()?y._precision=3:y._precision=1),this.activateUI(),a.clearSelection(),a.toolController.activateTool("snapper"),a.toolController.activateTool("magnifyingGlass"),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,i),a.addEventListener(Autodesk.Viewing.RESET_EVENT,n)},this.deactivate=function(){d=!1,y.clearBothPicks(),this.clearMeasurement(),r(),b&&b.isActive()&&a.toolController.deactivateTool("snapper"),w&&w.isActive()&&a.toolController.deactivateTool("magnifyingGlass"),a.impl.disableRollover(C),a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,i),a.removeEventListener(Autodesk.Viewing.RESET_EVENT,n)},this.update=function(){return!1},this.enableCalibrate=function(e){b.enableCalibrate(e)},this.getUnits=function(){return y._units},this.setUnits=function(e){y._units!==e&&(y._units=e,A&&A.updateDistance())},this.getPrecision=function(){return y._precision},this.setPrecision=function(e){y._precision!==e&&(y._precision=e,A&&A.updateDistance())},this.setCalibrationFactor=function(e){y._calibrationFactor=e},this.getCalibrationFactor=function(){return y._calibrationFactor},this.getDistanceXYZ=function(){return this.getDistanceAux(y._distanceXYZ)},this.getDistanceX=function(){return this.getDistanceAux(y._distanceX)},this.getDistanceY=function(){return this.getDistanceAux(y._distanceY)},this.getDistanceZ=function(){return this.getDistanceAux(y._distanceZ)},this.getDistanceAux=function(e){if(a.model){var t=Autodesk.Viewing.Private.convertUnits(a.model.getUnitString(),y._units,y._calibrationFactor,e||0)
return Autodesk.Viewing.Private.formatValueWithUnits(t,y._units,3,y._precision)}},this.getAngle=function(){var e=y._angle
return Autodesk.Viewing.Private.formatValueWithUnits(e,String.fromCharCode(176),3,y._precision)},this.isCalibrated=function(){return x.isCalibrated()},this.getMeasurement=function(e,t){y._units=e||y._units,y._precision=t||y._precision
var i=["Vertex","Edge","Face","Circular Arc","Curved Edge","Curved Face"]
return{from:i[this.getFirstGeometry().type],to:i[this.getSecondGeometry().type],distance:this.getDistanceXYZ(),deltaX:this.getDistanceX(),deltaY:this.getDistanceY(),deltaZ:this.getDistanceZ(),angle:this.getAngle(),unitType:y._units,precision:y._precision}},this.clearMeasurement=function(){y.clearBothPicks(),m=1,A&&A.hide(),T&&(T.updatePanel(),T.hideMeasureResult(),T.isolateMeasure&&this.clearIsolate()),a.model.is2d()&&(e.impl.updateViewportId(0),b&&b.setViewportId(null))},this.clearRubberBand=function(){y.second.clear(),A.hideClick("second")},this.clearFirstPick=function(){y.second.getGeometry()?(A.hide(),y.clearFirstPick(),a.model.is2d()&&(e.impl.updateViewportId(y.first._viewportIndex2d),b&&b.setViewportId(y.first._viewportIndex2d)),A.render(),A.consumeSingleClick(!1),m=2,T&&T.isolateMeasure&&this.clearIsolate()):this.clearMeasurement(),T&&T.showSelection1()},this.clearSecondPick=function(){y.clearSecondPick(),m=2,A.hideClick("second"),T&&T.isolateMeasure&&this.clearIsolate(),a.model.is2d()&&(e.impl.updateViewportId(y.first._viewportIndex2d),b&&b.setViewportId(y.first._viewportIndex2d))},this.getIndicator=function(){return A},this.getFirstGeometry=function(){return{type:y.first._geomType,geometry:y.first.getGeometry()}},this.getSecondGeometry=function(){return{type:y.second._geomType,geometry:y.second.getGeometry()}},this.getEdgeLength=function(e){return A.getEdgeLength(e)},this.getFaceArea=function(e){return A.getFaceArea(e)},this.getCircularArcRadius=function(e){return A.getCircularArcRadius(e)},this.isolateMeasurement=function(){y.first._snapNode&&y.second._snapNode&&a.isolate([y.first._snapNode,y.second._snapNode])},this.clearIsolate=function(){a.showAll()},this._handleMouseEvent=function(e){var t=!1
if(b.isSnapped())switch(m){case 0:this.clearMeasurement(),m=1
case 1:t=this._handleSnappedFirstPick(e)
break
case 2:t=this._handleSnappedSecondPick(e)}else t=this._handleRubberBand(e)
return v&&this._doConsumeSingleClick(),t},this._handleSnappedFirstPick=function(t){return 1===m&&(b.copyResults(y.first),o()&&(x.showLabel(!1),x.showPanel(!1)),a.model.is2d()&&(S||(e.impl.updateViewportId(y.first._viewportIndex2d),b&&b.setViewportId(y.first._viewportIndex2d)),v&&g&&(e.impl.updateViewportId(0),b.setViewportId(null))),A.render(v),T&&!g&&T.showSelection1(),!0)},this._handleSnappedSecondPick=function(e){return 2!==m||(b.copyResults(y.second),!y.hasEqualPicks()&&(A.render(v),!0))},this._handleRubberBand=function(e){if(2!==m&&!g)return!1
var t=this.inverseProject(e.canvasX,e.canvasY)
if(g)switch(b.copyResults(y.first),y.second._geomType){case SNAP_VERTEX:A.drawLine(y.second.getGeometry(),t,v)
break
case SNAP_EDGE:A.edgeToPointMeasure(t,y.second.getGeometry(),v)
break
case SNAP_FACE:A.faceToPointMeasure(y.second._faceNormal,y.second._intersectPoint,y.first.getGeometry(),t,v)
break
case SNAP_CIRCULARARC:A.drawLine(y.second._circularArcCenter,t,v)
break
case SNAP_CURVEDEDGE:A.curvedEdgeToVertexMeasure(y.second.getGeometry(),t,v)
break
case SNAP_CURVEDFACE:A.curvedFaceToVertexMeasure(y.second.getGeometry(),t,v)}else switch(b.copyResults(y.second),y.first._geomType){case SNAP_VERTEX:A.drawLine(y.first.getGeometry(),t,v)
break
case SNAP_EDGE:A.edgeToPointMeasure(t,y.first.getGeometry(),v)
break
case SNAP_FACE:A.faceToPointMeasure(y.first._faceNormal,y.first._intersectPoint,y.first.getGeometry(),t,v)
break
case SNAP_CIRCULARARC:A.drawLine(y.first._circularArcCenter,t,v)
break
case SNAP_CURVEDEDGE:A.curvedEdgeToVertexMeasure(y.first.getGeometry(),t,v)
break
case SNAP_CURVEDFACE:A.curvedFaceToVertexMeasure(y.first.getGeometry(),t,v)}return!1},this.isEditingEndpoint=function(){return g||f},this._doConsumeSingleClick=function(){var t=2===m||g
A.consumeSingleClick(t),o()&&A.hide(),t&&(y.measure(a)||g)&&(y._isAngle?T&&T.showAngleResult():(T&&(y.first._geomType===SNAP_FACE&&y.second._geomType===SNAP_FACE?T.showDistanceResult(!0):T.showDistanceResult()),o()&&(x.updateDistance(y._distanceXYZ),x.showPanel(!0),x.showLabel(!0),x.clearSize())),T&&(T.showSelection2(),T.updatePanel()),A.updateDistance(),A.updateAngle(),T&&T.isolateMeasure&&this.isolateMeasurement(),a.model.is2d()&&(e.impl.updateViewportId(0),b.setViewportId(null)),o()&&A.hide())},this.inverseProject=function(e,t){var i=a.navigation.getCamera(),n=a.navigation.getScreenViewport(),o=new THREE.Vector3
return o.x=e/n.width*2-1,o.y=-(t/n.height*2-1),o.z=0,o=o.unproject(i)},this.handleButtonDown=function(e,t){return u=!0,0!==t||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey||(v=!0),!1},this.handleMouseMove=function(e){return v=!1,p=h,2===m?(this.clearRubberBand(),this._handleMouseEvent(e),f&&A.consumeSingleClick(!0)):g&&(A.hideClick("first"),this._handleMouseEvent(e),A.consumeSingleClick()),!1},this.restoreMouseListeners=function(){a.toolController.getTool("gestures").controller.enableMouseButtons(!0)},this.handlePressHold=function(e){if(v=!1,av.isMobileDevice())switch(e.type){case"press":return S=!0,1!==m||g||(y.clearFirstPick(),A.hideClick("first")),2===m&&this.clearRubberBand(),g&&A.hideClick("first"),this._handleMouseEvent(e),!0
case"pressup":return v=!0,this.restoreMouseListeners(),E=!E,this.handleSingleClick(e),S=!1,!0}return!1},this.handleGesture=function(e){if(av.isMobileDevice()&&(v=!1,S))switch(1!=m||g||(y.clearFirstPick(),A.hideClick("first")),g&&A.hideClick("first"),2===m&&this.clearRubberBand(),e.type){case"dragstart":case"dragmove":return this._handleMouseEvent(e),!0
case"dragend":return S=!1,v=!0,E=!E,this.handleSingleClick(e),this.restoreMouseListeners(),!0
case"pinchstart":case"pinchmove":this._handleMouseEvent(e)
break
case"pinchend":return v=!0,E=!E,this.handleSingleClick(e),this.restoreMouseListeners(),!0}return!1},this.handleButtonUp=function(e,t){return u=!1,h=!1,p&&this.isEditingEndpoint()&&(v=!0,E=!E,this.handleSingleClick(e),g=!1,f=!1),p=!1,!1},this.handleSingleClick=function(e,t){return v&&(this._handleMouseEvent(e)||(this.clearMeasurement(),m=0,g=!1,f=!1),1===m?g?(m=0,g=!1):m=2:2===m&&(m=0,f=!1),v=!1,E=!E),!0},this.handleDoubleClick=function(e,t){return!0},this.handleWheelInput=function(e){return A.updateScale(),!1},this.handleSingleTap=function(e){return E||(v=!0,2===m&&this.clearRubberBand(),b.onMouseDown({x:e.canvasX,y:e.canvasY}),this.handleSingleClick(e),g=!1,f=!1),E=!E,!0},this.handleDoubleTap=function(e){return!0},this.handleResize=function(){A&&A.updateLabelPositions()},this.setNoTopology=function(){A&&A.setNoTopology()},this.setFetchingTopology=function(){A&&A.setFetchingTopology()},this.setTopologyAvailable=function(){y._hasTopology=!0,A&&A.setTopologyAvailable()},this.editEndpoint=function(t,i){if(m=i,1===m?(g=!0,f=!1):2===m&&(g=!1,f=!0),a.model.is2d()){var n=g?y.second._viewportIndex2d:y.first._viewportIndex2d
e.impl.updateViewportId(n),b&&b.setViewportId(n)}h=!0,o&&(x.showLabel(!1),x.showPanel(!1)),this._handleMouseEvent(t)},this.activateUI=function(){A||(A=new Autodesk.Viewing.Extensions.Measure.Indicator(a,y,this)),A.init(),A.hide(),T&&!o()&&(T.setVisible(!0),T.updatePanel(),a.model&&a.model.is2d()&&T.isolate.setVisibility(!1),y._units?Autodesk.Viewing.isSafari()||T.disableUnitOption(0):T.disableUnitOption())}}}(),function(){"use strict"
var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),t=Autodesk.Viewing,i=Autodesk.Viewing.Extensions,n=Autodesk.Viewing.Private,o=Autodesk.Viewing.UI,r=function(e,i,r,s,a){o.DockingPanel.call(this,i.container,r,s,a),this.kPanelExpandedHeight=310,this.kPanelCollapsedHeight=35,this.isDeltaExpanded=!0,this.isSettingsExpanded=!1,this.isolateMeasure=!1,this.measureTool=e,this.viewer=i,this.parentContainer=i.container,this.container.classList.add("measurePanel"),this.container.dockRight=!0,this.container.style.minWidth="300px",this.container.style.width="300px",this.container.style.minHeight=this.kPanelCollapsedHeight+"px",this.container.style.height=this.kPanelExpandedHeight+"px",this.container.style.maxHeight=this.kPanelExpandedHeight+"px",this.container.style.top="200px",this.container.style.left="220px",this.container.style.position="absolute",this.addEventListener(this.closer,"click",function(e){a&&a.onCloseCallback&&a.onCloseCallback()}),this.container.children[0].classList.add("expanded"),a=a||{},a.heightAdjustment||(a.heightAdjustment=40),a.marginTop||(a.marginTop=0),a.left=!1,this.createScrollContainer(a),this.measureResults=document.createElement("div"),this.scrollContainer.appendChild(this.measureResults)
var l=this
this.selection1=document.createElement("div"),this.selection1.className="measure-result-container",this.measureResults.appendChild(this.selection1)
var c=document.createElement("div")
c.className="measure-selectionOne-label",this.selection1.appendChild(c)
var d=document.createElement("div")
d.className="adsk-icon-first measure-label-icon",c.appendChild(d),this.selection1Result=document.createElement("div"),this.selection1Result.className="measure-selection-result",this.selection1.appendChild(this.selection1Result)
var u=document.createElement("div")
u.className="adsk-icon-refresh measure-repick",u.addEventListener("click",function(e){l.firstSelectionRepick()},!0),this.selection1.appendChild(u),this.addDivider(this.selection1),this.results=document.createElement("div"),this.results.className="measure-result-container",this.measureResults.appendChild(this.results),this.distIcon=document.createElement("div"),this.distIcon.className="adsk-icon-measure-distance measure-distance-icon",this.results.appendChild(this.distIcon),this.angleIcon=document.createElement("div"),this.angleIcon.className="adsk-icon-measure-angle measure-angle-icon",this.results.appendChild(this.angleIcon),this.distanceDiv=document.createElement("div"),this.distanceDiv.className="measure-result",this.results.appendChild(this.distanceDiv),this.angleDiv=document.createElement("div"),this.angleDiv.className="measure-result",this.results.appendChild(this.angleDiv),this.initialDiv=document.createElement("div"),this.initialDiv.className="measure-initial",this.initialDiv.textContent="0.00",this.results.appendChild(this.initialDiv),this.settingsButton=document.createElement("div"),this.settingsButton.className="adsk-icon-settings measure-settings-button",this.settingsButton.addEventListener("click",function(e){l.showMeasureSettings()},!0),this.results.appendChild(this.settingsButton),this.deltaButton=document.createElement("div"),this.deltaButton.className="adsk-icon-arrow measure-delta-button",this.deltaButton.addEventListener("click",function(e){l.toggle()},!0),this.results.appendChild(this.deltaButton),this.deltaXDiv=document.createElement("div"),this.deltaXDiv.className="measure-delta-result",this.results.appendChild(this.deltaXDiv)
var h=document.createElement("span")
h.setAttribute("data-i18n","Delta"),h.textContent=t.i18n.translate("Delta"),this.deltaXDiv.appendChild(h)
var p=document.createElement("span")
p.className="measure-label-axis-x",p.textContent="X",this.deltaXDiv.appendChild(p)
var m=document.createElement("span")
this.deltaXDiv.appendChild(m),this.deltaYDiv=document.createElement("div"),this.deltaYDiv.className="measure-delta-result",this.results.appendChild(this.deltaYDiv)
var g=document.createElement("span")
g.setAttribute("data-i18n","Delta"),g.textContent=t.i18n.translate("Delta"),this.deltaYDiv.appendChild(g)
var f=document.createElement("span")
f.className="measure-label-axis-y",f.textContent="Y",this.deltaYDiv.appendChild(f)
var v=document.createElement("span")
this.deltaYDiv.appendChild(v),this.deltaZDiv=document.createElement("div"),this.deltaZDiv.className="measure-delta-result",this.results.appendChild(this.deltaZDiv)
var E=document.createElement("span")
E.setAttribute("data-i18n","Delta"),E.textContent=t.i18n.translate("Delta"),this.deltaZDiv.appendChild(E)
var y=document.createElement("span")
y.className="measure-label-axis-z",y.textContent="Z",this.deltaZDiv.appendChild(y)
var A=document.createElement("span")
this.deltaZDiv.appendChild(A),this.addDivider(this.results),this.selection2=document.createElement("div"),this.selection2.className="measure-result-container",this.measureResults.appendChild(this.selection2)
var T=document.createElement("div")
T.className="measure-selectionTwo-label",this.selection2.appendChild(T)
var b=document.createElement("div")
b.className="adsk-icon-second measure-label-icon",T.appendChild(b),this.selection2Result=document.createElement("div"),this.selection2Result.className="measure-selection-result",this.selection2.appendChild(this.selection2Result)
var w=document.createElement("div")
w.className="adsk-icon-refresh measure-repick",w.addEventListener("click",function(e){l.secondSelectionRepick()},!0),this.selection2.appendChild(w),this.addDivider(this.selection2),this.measureSettings=document.createElement("div"),this.measureSettings.className="measure-settings",this.measureSettings.style.display="none",this.measureResults.appendChild(this.measureSettings),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable measure-table",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.measureSettings.appendChild(this.table),this.units=[{name:"Unknown",units:"",matches:[""]},{name:"Decimal feet",units:"decimal-ft",matches:["ft","decimal-ft"]},{name:"Feet and fractional inches",units:"ft-and-fractional-in",matches:["ft-and-fractional-in"]},{name:"Feet and decimal inches",units:"ft-and-decimal-in",matches:["ft-and-decimal-in"]},{name:"Decimal inches",units:"decimal-in",matches:["in","decimal-in"]},{name:"Fractional inches",units:"fractional-in",matches:["fractional-in"]},{name:"Meters",units:"m",matches:["m"]},{name:"Centimeters",units:"cm",matches:["cm"]},{name:"Millimeters",units:"mm",matches:["mm"]},{name:"Meters and centimeters",units:"m-and-cm",matches:["m-and-cm"]}]
var C=this.findUnits(),S=[]
t.isSafari()&&this.viewer.model.getDisplayUnit()&&this.units.shift()
for(var R=0;R<this.units.length;++R)S.push(this.units[R].name)
this.unitList=new n.OptionDropDown("Unit type",this.tbody,S,C),this.addEventListener(this.unitList,"change",function(e){var t=l.unitList.selectedIndex,i=l.units[t].units
l.measureTool.setUnits(i),l.setupPrecision(),l.updatePanel(),n.logger.track({category:"pref_changed",name:"measure/units",value:i})}),this.precisionList=new n.OptionDropDown("Precision",this.tbody,[],-1),this.addEventListener(this.precisionList,"change",function(e){var t=l.precisionList.selectedIndex
l.measureTool.setPrecision(t),l.updatePanel(),n.logger.track({category:"pref_changed",name:"measure/precision",value:t})}),this.setupPrecision(),this.isolate=new n.OptionCheckbox("Isolate measurement",this.tbody,!1),this.addEventListener(this.isolate,"change",function(e){var t=l.isolate.checked
l.isolateMeasure=t,l.isolateMeasure?l.measureTool.isolateMeasurement():l.measureTool.clearIsolate(),n.logger.track({category:"pref_changed",name:"measure/isolate",value:t})}),this.addDivider(this.measureSettings)
var x=document.createElement("div")
x.className="measure-restart",x.setAttribute("data-i18n","Restart"),x.textContent=t.i18n.translate("Restart"),x.addEventListener("click",function(){l.measureTool.clearMeasurement()},!1),this.measureResults.appendChild(x),this.updatePanel(),this.addVisibilityListener(function(){l.resizeToContent({maxHeight:l.parentContainer.offsetHeight-75})}),this.hideMeasureResult()}
r.prototype=Object.create(o.DockingPanel.prototype),i.ViewerPanelMixin.call(r.prototype),r.prototype.addDropDownMenu=function(e,i,n,o,r){var s=function(e){var t=e.target.selectedIndex
r(t)},a=document.createElement("select")
a.className="optionDropDown"
for(var l=0;l<n.length;l++){var c=document.createElement("option")
c.value=l,c.setAttribute("data-i18n",n[l]),c.textContent=t.i18n.translate(n[l]),a.add(c)}var d=document.createElement("div")
d.className="measure-submenu-select"
var u=document.createElement("div")
return u.className="measure-submenu-selectlabel",u.setAttribute("for",i),u.setAttribute("data-i18n",i),u.textContent=t.i18n.translate(i),d.appendChild(u),d.appendChild(a),e.appendChild(d),a.selectedIndex=o,a.onchange=s,a},r.prototype.addDivider=function(e){var t=document.createElement("div")
return t.className="measure-horizontal-divider",e.appendChild(t),t},r.prototype.findUnits=function(){var e,t,i=this.measureTool.getUnits()
for(e=0;e<this.units.length;++e){var n=this.units[e].matches
if(n)for(t=0;t<n.length;++t)if(n[t]===i)return e}return 0},r.prototype.setupPrecision=function(){for(;this.precisionList.dropdownElement.lastChild;)this.precisionList.dropdownElement.removeChild(this.precisionList.dropdownElement.lastChild)
var e,t=this.measureTool.getUnits()
e="ft-and-fractional-in"===t||"fractional-in"===t?["1","1/2","1/4","1/8","1/16","1/32","1/64"]:["0","0.1","0.01","0.001","0.0001","0.00001"]
for(var i=0;i<e.length;++i){var n=document.createElement("option")
n.value=i,n.textContent=e[i],this.precisionList.dropdownElement.appendChild(n)}var o=this.measureTool.getPrecision()
e.length<=o&&(o=e.length-1,this.measureTool.setPrecision(o)),this.precisionList.dropdownElement.selectedIndex=o},r.prototype.uninitialize=function(){this.viewer=null,o.DockingPanel.prototype.uninitialize.call(this)},r.prototype.onTitleClick=function(e){},r.prototype.deltaCollapse=function(){this.deltaButton.classList.toggle("rotated"),this.measureTool.getIndicator().setSimple(this.isDeltaExpanded),this.isDeltaExpanded?(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none",this.isDeltaExpanded=!1):(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&(this.deltaZDiv.style.display="block"),this.isDeltaExpanded=!0),this.resizeToContent()},r.prototype.toggle=function(){this.deltaCollapse()},r.prototype.isExpanded=function(){return this.container.children[0].classList.contains("expanded")},r.prototype.getContentSize=function(){return{height:this.isExpanded()?this.measureResults.clientHeight+46:0,width:this.measureResults.clientWidth}},r.prototype.updatePanel=function(){function e(e,t,i){t?e.textContent="~ "+i:e.children[2].textContent=" = ~ "+i}e(this.distanceDiv,!0,this.measureTool.getDistanceXYZ()),e(this.deltaXDiv,!1,this.measureTool.getDistanceX()),e(this.deltaYDiv,!1,this.measureTool.getDistanceY()),e(this.deltaZDiv,!1,this.measureTool.getDistanceZ()),e(this.angleDiv,!0,this.measureTool.getAngle()),this.unitList.dropdownElement.selectedIndex=this.findUnits(),this.precisionList.dropdownElement.selectedIndex=this.measureTool.getPrecision(),this.initialDiv.textContent=n.formatValueWithUnits(0,null,3,this.measureTool.getPrecision()),this.showSelection1(),this.showSelection2()},r.prototype.showDistanceResult=function(e){this.results.style.display="block",this.initialDiv.style.display="none",this.angleDiv.style.display="none",this.angleIcon.style.display="none",this.distanceDiv.style.display="inline-block",this.distIcon.style.display="inline-block",e?(this.deltaButton.style.display="none",this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none")):(this.deltaButton.style.display="inline-block",this.isDeltaExpanded&&(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&(this.deltaZDiv.style.display="block"))),this.resizeToContent()},r.prototype.showAngleResult=function(){this.results.style.display="block",this.initialDiv.style.display="none",this.angleDiv.style.display="inline-block",this.angleIcon.style.display="inline-block",this.distanceDiv.style.display="none",this.distIcon.style.display="none",this.deltaButton.style.display="none",this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none"),this.resizeToContent()},r.prototype.showSelection1=function(){var e=this.measureTool.getFirstGeometry()
null!==e.type&&(e.type===SNAP_VERTEX?(this.selection1Result.setAttribute("data-i18n","Vertex"),this.selection1Result.textContent=t.i18n.translate("Vertex"),this.selection1Result.style.display="inline-block"):e.type===SNAP_EDGE||e.type===SNAP_CURVEDEDGE?(this.selection1Result.setAttribute("data-i18n","Edge"),this.selection1Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection1Result.style.display="inline-block"):e.type===SNAP_FACE||e.type===SNAP_CURVEDFACE?(this.selection1Result.setAttribute("data-i18n","Face"),this.selection1Result.textContent=t.i18n.translate("Face")+" ~ "+this.measureTool.getFaceArea(e.geometry),this.selection1Result.style.display="inline-block"):e.type===SNAP_CIRCULARARC&&(this.selection1Result.setAttribute("data-i18n","Edge"),e.geometry.radius?this.selection1Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getCircularArcRadius(e.geometry)+" (R)":this.selection1Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection1Result.style.display="inline-block"),this.selection1.style.display="block",this.resizeToContent())},r.prototype.showSelection2=function(){var e=this.measureTool.getSecondGeometry()
null!==e.type&&(e.type===SNAP_VERTEX?(this.selection2Result.setAttribute("data-i18n","Vertex"),this.selection2Result.textContent=t.i18n.translate("Vertex"),this.selection2Result.style.display="inline-block"):e.type===SNAP_EDGE||e.type===SNAP_CURVEDEDGE?(this.selection2Result.setAttribute("data-i18n","Edge"),this.selection2Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection2Result.style.display="inline-block"):e.type===SNAP_FACE||e.type===SNAP_CURVEDFACE?(this.selection2Result.setAttribute("data-i18n","Face"),this.selection2Result.textContent=t.i18n.translate("Face")+" ~ "+this.measureTool.getFaceArea(e.geometry),this.selection2Result.style.display="inline-block"):e.type===SNAP_CIRCULARARC&&(this.selection2Result.setAttribute("data-i18n","Edge"),e.geometry.radius?this.selection2Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getCircularArcRadius(e.geometry)+" (R)":this.selection2Result.textContent=t.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(e.geometry),this.selection2Result.style.display="inline-block"),this.selection2.style.display="block",this.resizeToContent())},r.prototype.firstSelectionRepick=function(){this.measureTool.clearFirstPick(),this.selection1Result.textContent=this.selection2Result.textContent,this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},r.prototype.secondSelectionRepick=function(){this.measureTool.clearSecondPick(),this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},r.prototype.hideMeasureResult=function(){this.clearSelectionOne(),this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},r.prototype.disableUnitOption=function(e){null!=e?(this.unitList.dropdownElement.children[e].style.display="none",t.isIE11&&(this.unitList.dropdownElement.children[e].disabled=!0,this.unitList.dropdownElement.children[e].style.visibility="hidden")):this.unitList.dropdownElement.disabled=!0},r.prototype.showMeasureSettings=function(){this.isSettingsExpanded?(this.measureSettings.style.display="none",this.isSettingsExpanded=!1):(this.measureSettings.style.display="block",this.isSettingsExpanded=!0),this.resizeToContent()},r.prototype.clearSelectionOne=function(){this.selection1Result.setAttribute("data-i18n","Select Object"),this.selection1Result.textContent=t.i18n.translate("Select Object")},r.prototype.clearSelectionTwo=function(){this.selection2Result.setAttribute("data-i18n","Select Object"),this.selection2Result.textContent=t.i18n.translate("Select Object")},r.prototype.clearResult=function(){this.distIcon.style.display="none",this.angleIcon.style.display="none",this.distanceDiv.style.display="none",this.angleDiv.style.display="none",this.initialDiv.style.display="inline-block",this.deltaButton.style.display="none",this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none"},e.MeasurePanel=r}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.CalibrationTool=function(e,t,i,n,o){function r(e,t,i){var n=c.navigation.getCamera(),o=c.navigation.getScreenViewport(),r=new THREE.Vector3(e,t,i)
return r=r.project(n),{x:Math.round((r.x+1)/2*o.width),y:Math.round((1-r.y)/2*o.height)}}function s(e,t,i){(e.classList.contains(t)&&!i||!e.classList.contains(t)&&i)&&e.classList.toggle(t,i)}function a(){M&&M.clearRect(0,0,M.canvas.width,M.canvas.height),I&&(s(I[1],"visible",!1),s(I[2],"visible",!1))}var l=this,c=e,d=t,u=i,h=o||{},p=["calibration"],m=!1,g=!1,f=null,v=null!=h.calibrationFactor,E=!1,y=o.maxPrecision||5,A=n,T=null,b=null,w=null,C=null,S=null,R=null,x=null,P=Autodesk.Viewing.Private.GuiViewer3D&&e instanceof Autodesk.Viewing.Private.GuiViewer3D,k=null,M=null,V=null,I=null,L=null,D=null,N="#FFD83C",_="#039BE5",O="#000",H=null,B=Autodesk.Viewing.Extensions.Measure
B.CALIBRATION_REQUIRED_EVENT="calibration-required",B.OPEN_CALIBRATION_PANEL_EVENT="open-calibration-panel",B.CLOSE_CALIBRATION_PANEL_EVENT="close-calibration-panel",B.CLEAR_CALIBRATION_SIZE_EVENT="clear-calibration-size",this.register=function(){function e(e){var t=I[e]=document.createElement("div")
t.className="calibration-endpoint",c.container.appendChild(t)
var i=document.createElement("div")
i.className="calibration-endpoint-text",i.textContent=e.toString(),t.appendChild(i),t.addEventListener("mousedown",function(t){t.canvasX=t.clientX,t.canvasY=t.clientY,d.editEndpoint(t,e)}),t.addEventListener("mousewheel",c.toolController.mousewheel)}if(P&&!x&&(x=new Autodesk.Viewing.Extensions.Measure.CalibrationPanel(l,c,"calibration-panel","Calibration",h),c.addPanel(x)),k&&M||(k=document.createElement("canvas"),c.container.appendChild(k),k.width=c.container.clientWidth,k.height=c.container.clientHeight,k.className="calibration-line",M=k.getContext("2d"),M.strokeStyle=N,M.lineWidth=3),!V){V=document.createElement("div"),V.className="calibration-label",s(V,"visible",!1),c.container.appendChild(V)
var t=document.createElement("div")
t.className="calibration-label-text",V.appendChild(t)}I||(I={},e(1),e(2))},this.deregister=function(){this.deactivate(),x&&(c.removePanel(x),x.uninitialize(),x=null),I&&(c.container.removeChild(I[1]),c.container.removeChild(I[2]),I=null),k&&(c.container.removeChild(k),k=null)},this.isActive=function(){return m},this.getNames=function(){return p},this.getName=function(){return p[0]},this.getCursor=function(){return g?null:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAYCAYAAAD+vg1LAAAAAXNSR0IArs4c6QAAAwZJREFUSA2tVEtLW0EUvjGJefoqSY0x0WBSiY+oNWiUINkU6ioLaaAlG1eudNVFoT+grgopiCkEIbUK1o0lusmurRSEWmmKG6MNtNhNosWqyU2CZPpN8cr15nFD7YHDzHnON2fOGYZhmHkw4XEW+wD4xkT4lMvl6CE0+Y2ohh+dz+cZn89HVS/5+n/d/wVMkXq9Xor2v5SBgsmymQwZHx+vOqlKpXKDXWI3eU6Tg+kqSjSh3W4/s9lsvzUajaNcAK3xY7Dyci3nd6WXSCS60dHRvMfjSRcKBfWV4SYbrVarB8p0PB5nY7HYmdVq/aDX67WlckpKKcvpOjs7X09OTvoPDw8z2Wy2Bu+imJqa+npycnJXGHOt3YRGoSyVSvvMZrNkYWFBs7GxkaoBAXFJcDJhcCW5rq5ur62trQ/EOhyOBhDT2Nj4qVKMqA31ve1yub7Rfufo/PycDA4OxpuamhqECaouhVqtfuD3+1tqa2uZQCCQDoVCWTwknVQDDvIKE1clI1ja09Ozg0cjx8fHpL+/P+50OhMU8f7+Punt7f2I5NdqXRXi9fV1z9jYWCuIWV5eziSTyWAqlXq1urqaw6AwOMiCG4lOYtEturu732xubhK0FQHSvfr6+lsog4HWPIPvIBqNErRiqCiwkkKpVFowZd8xZSQYDLImk+kJ52+xWJ4tLS3hU8yTkZGRBD2Ms4mu6Nun4XA4f3p6SoaGhuJ0+rgg/Bsmt9udYFmWzM3NZdDT05ztWsE5JV0R1AqUCfTt0fb2tjESiRRmZmaOUOcI3w9DY5mdnb03PDzMoDQ/MZFRzM20lO/E38vl8vt46UdAq0WNJWixlEwmu8B1bXioOxwjpgXJ0hMTE1og1qysrDghf+HnKtoD7c7u7i5ZXFzMGY3GF7iFuRR3dHTMr62tXWxtbZH29vZ3RYmECozu54ODAzpdP2hphHZOVigUVjChvgMDA+85fdm1q6vrrU6n+4WR9Zd1ujQ0Nzc/NBgMScSExXwZ2j5oL5Wo46UD/ZvxUemo+AdW1zJzUYr16wAAAABJRU5ErkJggg==), auto"},this.activate=function(){m=!0,E&&w&&C?(L=w,D=C,A.first=S,A.second=R,this.updatePanelPosition(L,D),this.showPanel(!0),this.updateLabelSize(T,b,d.getPrecision()),this.showLabel(!0,!1),this.drawCalibrationLine()):(L=null,D=null),d.enableCalibrate(!0),c.toolController.activateTool("measure"),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.screenSizeChangedBinded=this.screenSizeChanged.bind(this),c.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),c.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.screenSizeChangedBinded)},this.deactivate=function(){m=!1,a(),this.showLabel(!1,!1),this.showPanel(!1),d&&d.isActive()&&(d.enableCalibrate(!1),c.toolController.deactivateTool("measure")),c.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),c.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.screenSizeChangedBinded)},this.updateDistance=function(e){f=e},this.updatePanelPosition=function(e,t){function i(e,t,i,n){var o=r((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2),s=e.x-t.x,a=e.y-t.y,l=null
return l=n?e.x>t.x?new THREE.Vector2(-a,s).normalize():new THREE.Vector2(a,-s).normalize():e.x<=t.x?new THREE.Vector2(-a,s).normalize():new THREE.Vector2(a,-s).normalize(),l.multiplyScalar(i),{x:Math.floor(o.x+l.x),y:Math.floor(o.y-l.y)}}function n(e,t,i,n){return e<0||e+i>c.canvas.clientWidth||t<0||t+n>c.canvas.clientHeight}if(x){var o=parseInt(x.container.getBoundingClientRect().width),s=parseInt(x.container.getBoundingClientRect().height),a=Math.sqrt(Math.pow(o,2)+Math.pow(s,2))/2,l=i(e,t,a,!0),d=l.x-Math.floor(o/2),u=l.y-Math.floor(s/2)
n(d,u,o,s)&&(l=i(e,t,a,!1),d=l.x-Math.floor(o/2),u=l.y-Math.floor(s/2)),n(d,u,o,s)&&(d=c.canvas.clientWidth/2-o/2,u=c.canvas.clientHeight/2-s/2),x.container.style.left=d+"px",x.container.style.top=u+"px"}},this.calibrate=function(e,t){var i=null
if(!isNaN(t)){i=t/Autodesk.Viewing.Private.convertUnits(c.model.getUnitString(),e,1,f),d.setCalibrationFactor(i),d.setUnits(e),d.setPrecision(function(e){return Math.floor(e)===e?0:e.toString().split(".")[1].length||0}(t)),v=!0,T=t,b=e,w=L,C=D}i&&(this.deactivate(),c.fireEvent({type:"finished-calibration"}))},this.calibrateByScale=function(e,t){d.setCalibrationFactor(t),d.setUnits(e),v=!0,b=e},this.getCurrentUnits=function(){return d.getUnits()},this.showPanel=function(e){var t=this
e?x?(this.clearSize(),x.updatePanel(T,b),window.setTimeout(function(){x.requestedSizeTextbox.focus()},0),x.setVisible(!0),window.addEventListener("keyup",function(e){"Escape"==(e.key||String.fromCharCode(e.keyCode))&&t.isActive()&&E&&(t.showPanel(!1),t.showAddCalibrationLabel(),window.removeEventListener("keyup",arguments.callee))})):c.fireEvent({type:B.OPEN_CALIBRATION_PANEL_EVENT,data:{size:T,units:b}}):x?x.setVisible(!1):c.fireEvent({type:B.CLOSE_CALIBRATION_PANEL_EVENT})},this.showLabel=function(e,t){V&&(V.childNodes[0].style.pointerEvents=t?"all":"none",V.classList.visible!=e&&s(V,"visible",e),this.updateLabelPosition())},this.handleButtonDown=function(e,t){return g=!0,!1},this.handleButtonUp=function(e,t){return g=!1,!1},this.isCalibrated=function(){return v},this.updateLabelSize=function(e,t,i){if(""==e)this.updateLabelText(null)
else{var n=Autodesk.Viewing.Private.formatValueWithUnits(parseFloat(e),t,3,i)
this.updateLabelText(n)}},this.updateLabelText=function(e){e&&""!=e?(V.childNodes[0].setAttribute("data-i18n",e),V.childNodes[0].textContent=av.i18n.translate(e),s(V,"visible",!0),this.updateLabelPosition()):s(V,"visible",!1)},this.updateLabelPosition=function(){if(E&&V&&L&&D){var e=r((L.x+D.x)/2,(L.y+D.y)/2,(L.z+D.z)/2),t=L.x-D.x,i=L.y-D.y,n=null,o=null
if(L.x<D.x?(n=180*Math.atan2(-i,-t)/Math.PI,o=new THREE.Vector2(-i,t).normalize()):(n=180*Math.atan2(i,t)/Math.PI,o=new THREE.Vector2(i,-t).normalize()),o.multiplyScalar(8),V.style.top=e.y-o.y+"px",V.style.left=e.x-Math.floor(V.clientWidth/2)+2*o.x+"px",c.model.is2d()){var s=c.navigation.getCameraUpVector(),a=new THREE.Vector3(0,1,0),l=180*a.angleTo(s)/Math.PI
l=s.x>=0?l:-l,n=-(n+l),Math.abs(n)>90&&(n+=180),V.style.transform="rotate("+n+"deg)"}}},this.updateCalibrationLine=function(e,t,i,n,o,r,s,l,c,d){if(l&&!c)return E=!1,L=null,D=null,void a()
L=new THREE.Vector3(e,t,i),D=new THREE.Vector3(n,o,r),l?(E=!0,M.setLineDash([]),this.updatePanelPosition(L,D),this.updateLabelPosition(L,D)):(E=!1,M.setLineDash([10,3])),H=d,this.drawCalibrationLine()},this.setFirstEndpoint=function(e){S=e.clone()},this.setSecondEndpoint=function(e){R=e.clone()},this.drawCalibrationLine=function(){function e(e,t,i){if("2"!==e||E||d.isEditingEndpoint()){var n=I[e]
s(n,"visible",!0),n.style.left=t-parseInt(n.clientWidth)/2+"px",n.style.top=i-parseInt(n.clientHeight)/2+"px"}else s(I[2],"visible",!1)}function t(t,i,n,o){M.save(),M.setLineDash([]),u.isSnapped()&&!E?(M.strokeStyle=_,M.lineWidth=2):(M.strokeStyle=O,M.lineWidth=1),M.beginPath()
var r=i.clone()
r.multiplyScalar(25),M.moveTo(n.x+r.x,n.y+r.y),M.lineTo(n.x-r.x,n.y-r.y),M.stroke(),M.strokeStyle=O,M.lineWidth=1,r=t.clone(),M.beginPath(),r.multiplyScalar(25),M.moveTo(n.x,n.y),M.lineTo(n.x-r.x,n.y-r.y),M.stroke(),e(o,n.x-r.x,n.y-r.y),M.lineWidth=2,M.strokeStyle=N,M.beginPath(),r=i.clone(),r.multiplyScalar(15),M.moveTo(n.x+r.x,n.y+r.y),M.lineTo(n.x-r.x,n.y-r.y),M.stroke()
var s=Math.PI/8,a=r.x*Math.cos(s)-r.y*Math.sin(s)+n.x,l=r.x*Math.sin(s)+r.y*Math.cos(s)+n.y,c=-r.x*Math.cos(s)+r.y*Math.sin(s)+n.x,d=-r.x*Math.sin(s)-r.y*Math.cos(s)+n.y
M.beginPath(),M.moveTo(a,l),M.lineTo(c,d),M.stroke(),M.restore()}if(M&&L&&D){a()
var i=r(L.x,L.y,L.z),n=r(D.x,D.y,D.z)
i.x!=n.x&&i.y!=n.y||E?M.strokeStyle=N:M.strokeStyle=_,i.x===n.x&&i.y===n.y||(M.beginPath(),M.moveTo(i.x,i.y),M.lineTo(n.x,n.y),M.stroke())
var o=new THREE.Vector2(n.x-i.x,n.y-i.y).normalize(),l=new THREE.Vector2(i.x-n.x,i.y-n.y).normalize(),c=new THREE.Vector2(i.y-n.y,n.x-i.x).normalize(),h=new THREE.Vector2(n.y-i.y,i.x-n.x).normalize()
H===SNAP_VERTEX?(t(o,c,i,"1"),t(l,h,n,"2")):(t(o,c,i,"2"),t(l,h,n,"1"))}},this.clearSize=function(){this.updateLabelText(""),x?x.requestedSizeTextbox.value="":c.fireEvent({type:B.CLEAR_CALIBRATION_SIZE_EVENT})},this.showAddCalibrationLabel=function(){var e=this
this.updateLabelText("Add Calibration"),this.showLabel(!0,!0),V.addEventListener("click",function(){V.childNodes[0].style.pointerEvents="none",e.updatePanelPosition(L,D),e.showPanel(!0),e.clearSize(),V.removeEventListener("click",arguments.callee)})},this.onCameraChange=function(){this.drawCalibrationLine(),this.updateLabelPosition()},this.screenSizeChanged=function(e){k.width=e.width,k.height=e.height,M.strokeStyle=N,M.lineWidth=3,this.onCameraChange()},this.getMaxPrecision=function(){return y}},function(){"use strict"
var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),t=Autodesk.Viewing,i=Autodesk.Viewing.Extensions,n=Autodesk.Viewing.Private,o=Autodesk.Viewing.UI,r=function(e,i,r,l,c){var d=this
o.DockingPanel.call(this,i.container,r,l,c),this.viewer=i,this.calibrationTool=e,this.parentContainer=i.container,this.container.style.width="auto",this.container.style.height="200px",this.container.classList.add("calibration-panel"),this.addEventListener(this.closer,"click",function(e){d.setVisible(!1),d.calibrationTool.showAddCalibrationLabel()}),c=c||{},c.heightAdjustment||(c.heightAdjustment=40),c.marginTop||(c.marginTop=0),c.left=!1,this.createScrollContainer(c),this.calibrationMenu=document.createElement("div"),this.scrollContainer.appendChild(this.calibrationMenu),this.table=document.createElement("table"),this.table.className="adsk-lmv-tftable calibration-table",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.calibrationMenu.appendChild(this.table),this.row=this.tbody.insertRow(0),this.requestedSizeTextbox=document.createElement("input"),this.requestedSizeTextbox.className="calibration-textbox",this.requestedSizeTextbox.type="text",this.requestedSizeTextbox.autofocus="true",this.addEventListener(this.requestedSizeTextbox,"keyup",function(e){var t=d.requestedSizeTextbox.value
""!==t&&""===t.split(".")[0]&&(d.requestedSizeTextbox.value="0"+t),d.updateLabel()}),this.addEventListener(this.requestedSizeTextbox,"keypress",function(e){var t=e.key||String.fromCharCode(e.keyCode)
if("Backspace"!=t&&"ArrowLeft"!=t&&"ArrowRight"!=t){if(27==e.keyCode)return d.calibrationTool.showPanel(!1),void d.calibrationTool.showAddCalibrationLabel()
var i=d.requestedSizeTextbox.value,n=d.requestedSizeTextbox.selectionStart
i=[i.slice(0,n),t,i.slice(n)].join(""),"."!=i&&(!a(i)||s(i)>d.calibrationTool.getMaxPrecision())&&e.preventDefault()}})
var u=this.row.insertCell(0)
this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n","Define Size"),this.caption.textContent=t.i18n.translate("Define Size"),u.appendChild(this.caption)
var u=this.row.insertCell(1)
u.style.paddingLeft="5px",u.style.paddingRight="5px",u.appendChild(this.requestedSizeTextbox),this.units=[{name:"Feet",units:"decimal-ft",matches:["ft","decimal-ft"]},{name:"Inches",units:"decimal-in",matches:["in","decimal-in"]},{name:"Meters",units:"m",matches:["m"]},{name:"Centimeters",units:"cm",matches:["cm"]},{name:"Millimeters",units:"mm",matches:["mm"]}]
for(var h=[],p=0;p<this.units.length;++p)h.push(this.units[p].name)
this.unitList=new n.OptionDropDown("Unit type",this.tbody,h,0),this.unitList.dropdownElement.style.width="120px",this.unitList.dropdownElement.style.margin="inherit",this.addEventListener(this.unitList,"change",function(e){d.updateLabel()})
var m=document.createElement("div")
m.className="calibration-button",m.setAttribute("data-i18n","Set Calibration"),m.textContent=t.i18n.translate("Set Calibration"),m.style.width="225px",m.addEventListener("click",function(){var e=d.unitList.selectedIndex,t=d.units[e].units,i=parseFloat(d.requestedSizeTextbox.value)
d.calibrationTool.calibrate(t,i)},!1),this.calibrationMenu.appendChild(m)},s=function(e){var t=e.split(".")[1]
return t?t.length:0},a=function(e){return!isNaN(parseFloat(e))&&!isNaN(+e)&&parseFloat(e)>=0}
r.prototype=Object.create(o.DockingPanel.prototype),i.ViewerPanelMixin.call(r.prototype),r.prototype.uninitialize=function(){this.viewer=null,o.DockingPanel.prototype.uninitialize.call(this)},r.prototype.findUnits=function(){var e,t,i=this.calibrationTool.getCurrentUnits()
for(e=0;e<this.units.length;++e){var n=this.units[e].matches
if(n)for(t=0;t<n.length;++t)if(n[t]===i)return e}return 0},r.prototype.updatePanel=function(e,t){this.unitList.setSelectedIndex(this.findUnits()),this.requestedSizeTextbox.value=e},r.prototype.updateLabel=function(){var e=this.unitList.selectedIndex,t=this.units[e].units,i=this.requestedSizeTextbox.value
this.calibrationTool.updateLabelSize(i,t,s(i))}
var l=function(e,i,n,r,s){var a=this
o.DockingPanel.call(this,i.container,n,r,s),this.viewer=i,this.measureExt=e,this.parentContainer=i.container,this.container.classList.add("calibration-panel"),this.container.style.width="380px",this.container.style.height="190px",this.container.style.left=(this.viewer.canvas.clientWidth-parseInt(this.container.style.width))/2+"px",this.container.style.top=(this.viewer.canvas.clientHeight-parseInt(this.container.style.height))/2+"px",s=s||{},s.heightAdjustment||(s.heightAdjustment=40),s.marginTop||(s.marginTop=0),s.left=!1,this.createScrollContainer(s),this.dialogBox=document.createElement("div"),this.scrollContainer.appendChild(this.dialogBox)
var l=document.createElement("div")
l.className="calibration-text"
var c="Before using the ruler, the scale for this sheet needs to be set and calibrated."
l.setAttribute("data-i18n",c),l.textContent=t.i18n.translate(c),this.dialogBox.appendChild(l)
var d=document.createElement("div")
d.className="calibration-button",d.setAttribute("data-i18n","Calibrate Now"),d.textContent=t.i18n.translate("Calibrate Now"),d.style.float="right",d.addEventListener("click",function(){a.measureExt.enableCalibrationTool(!0),a.setVisible(!1)},!1),this.dialogBox.appendChild(d)
var u=document.createElement("div")
u.className="calibration-button",u.setAttribute("data-i18n","Cancel"),u.textContent=t.i18n.translate("Cancel"),u.style.float="right",u.addEventListener("click",function(){a.setVisible(!1)},!1),this.dialogBox.appendChild(u)}
l.prototype=Object.create(o.DockingPanel.prototype),i.ViewerPanelMixin.call(l.prototype),l.prototype.uninitialize=function(){this.viewer=null,o.DockingPanel.prototype.uninitialize.call(this)},e.CalibrationPanel=r,e.CalibrationRequiredDialog=l}()
var SNAP_VERTEX=0,SNAP_EDGE=1,SNAP_FACE=2,SNAP_CIRCULARARC=3,SNAP_CURVEDEDGE=4,SNAP_CURVEDFACE=5
!function(){function e(e,t){return Math.abs(e-t)<=s}function t(e,t){return Math.abs(e.x-t.x)<=s&&Math.abs(e.y-t.y)<=s&&Math.abs(e.z-t.z)<=s}function i(e,t){return Math.abs(e.x+t.x)<=s&&Math.abs(e.y+t.y)<=s&&Math.abs(e.z+t.z)<=s}var n=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),o=Autodesk.Viewing,r=Autodesk.Viewing.Private,s=.001
n.Snapper=function(a,l){function c(e,t,i){this.viewer=e,this.snapper=t,this.lineGeom=new THREE.Geometry,this.circularArc=null,this.circularArcCenter,this.circularArcRadius,this.ellipticalArc=null,this.ellipticalArcCenter,this.minDist=Number.MAX_VALUE,this.vpIdLine=null,this.vpIdCircular=null,this.vpIdElliptical=null,this.detectRadius=i}function d(){return S=new THREE.MeshPhongMaterial({color:52224,ambient:52224,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide})}var u=new n.SnapResult,h=a,p=l||{},m=p.markupMode?["snapper-markup"]:["snapper"],g=!1,f="MeasureTool-snapper",v=0,E=Number.MAX_VALUE,y=null,A=!1,T=!1,b=!1,w=null,C=!1
this.markupMode=p.markupMode,this.isActive=function(){return g},this.getNames=function(){return m},this.getName=function(){return m[0]},this.activate=function(){g=!0},this.deactivate=function(){g=!1,this.destroy()},this.copyResults=function(e){u.copyTo(e)},this.getEdge=function(){return u._geomEdge},this.getVertex=function(){return u._geomVertex},this.getGeometry=function(){return u.getGeometry()},this.getGeometryType=function(){return u._geomType},this.getIntersectPoint=function(){return u._intersectPoint},this.enableCalibrate=function(e){C=e},this.isSnapped=function(){return b},this.clearSnapped=function(){u.clear(),b=!1},this.setViewportId=function(e){w=e},this.getEndPointsInEdge=function(e){for(var t=e.vertices,i=[],n=0;n<t.length;++n){for(var o=!1,r=0;r<t.length;++r)if(r!==n&&t[r].equals(t[n])){o=!0
break}o||i.push(t[n])}return i},this.snapping3D=function(e){u._snapNode=e.dbId,u._intersectPoint=e.intersectPoint
var t,i=e.face
t=void 0===e.fragId.length?[e.fragId]:e.fragId,u.hasTopology=h.model.hasTopology(),u.hasTopology?this.snapping3DwithTopology(i,t):this.snapping3DtoMesh(i,t)},this.snapping3DwithTopology=function(e,t){u._snapNode&&(t=[],h.model.getData().instanceTree.enumNodeFragments(u._snapNode,function(e){t.push(e)},!0)),u._geomFace=u._geomEdge=u._geomVertex=null,E=Number.MAX_VALUE
for(var i=0;i<t.length;++i){var n=t[i],o=h.impl.getRenderProxy(h.model,n),r=o.geometry,s=h.model.getTopoIndex(n),a=h.model.getTopology(s),l=a.faces,c=a.edges
a.vertices
if(!u._geomFace){u._geomFace=this.faceSnappingWithTopology(e,r,l,o),u._geomFace&&(u._geomFace.fragId=n)
var d=(new THREE.Matrix3).getNormalMatrix(o.matrixWorld)
u._faceNormal=e.normal.applyMatrix3(d).normalize()}this.edgeSnappingWithTopology(u._intersectPoint,r,c,o)}if(u._geomVertex=this.vertexSnappingWithTopology(u._geomEdge,u._intersectPoint),u._geomFace){if(u._radius=this.setDetectRadius(u._intersectPoint),(p.forceSnapVertices||y<u._radius)&&u._geomVertex)this.drawPoint(u._geomVertex),u._geomType=SNAP_VERTEX
else if((p.forceSnapEdges||C||E<u._radius)&&u._geomEdge){this.drawLine(u._geomEdge)
var m=this.edgeIsCircle(u._geomEdge)
m?(u._circularArcCenter=m,u._circularArcRadius=m.distanceTo(u._geomEdge.vertices[0]),u._geomEdge.center=u._circularArcCenter,u._geomEdge.radius=u._circularArcRadius,u._geomType=SNAP_CIRCULARARC):this.edgeIsCurved(u._geomEdge)?u._geomType=SNAP_CURVEDEDGE:u._geomType=SNAP_EDGE}else this.drawFace(u._geomFace),this.faceIsCurved(u._geomFace)?u._geomType=SNAP_CURVEDFACE:u._geomType=SNAP_FACE
b=!0}},this.snapping3DtoMesh=function(e,t){for(var i=0;i<t.length;++i){var n=t[i],o=h.impl.getRenderProxy(h.model,n),r=o.geometry
if(u._geomFace=this.faceSnapping(e,r),u._geomFace){u._geomFace.applyMatrix(o.matrixWorld),u._geomEdge=this.edgeSnapping(u._geomFace,u._intersectPoint),u._geomVertex=this.vertexSnapping(u._geomEdge,u._intersectPoint)
var s=(new THREE.Matrix3).getNormalMatrix(o.matrixWorld)
u._faceNormal=e.normal.applyMatrix3(s).normalize(),u._radius=this.setDetectRadius(u._intersectPoint),p.forceSnapVertices||y<u._radius?(this.drawPoint(u._geomVertex),u._geomType=SNAP_VERTEX):p.forceSnapEdges||C||E<u._radius?(this.drawLine(u._geomEdge),u._geomType=SNAP_EDGE):(this.drawFace(u._geomFace),u._geomType=SNAP_FACE),b=!0
break}}},this.faceSnappingWithTopology=function(e,t,i,n){var o=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Geometry,l=t.attributes
if(void 0!==l.index){for(var c=t.vb?t.vb:l.position.array,d=t.vb?t.vbstride:3,u=0;u<i.length;u++){for(var h=i[u].indexList,p=i[u].id,m=0;m<h.length;m+=3)if(e.a===h[m]){if(e.b===h[m+1]&&e.c===h[m+2]||e.b===h[m+2]&&e.c===h[m+1])break}else if(e.a===h[m+1]){if(e.b===h[m]&&e.c===h[m+2]||e.b===h[m+2]&&e.c===h[m])break}else if(e.a===h[m+2]&&(e.b===h[m]&&e.c===h[m+1]||e.b===h[m+1]&&e.c===h[m]))break
if(m<h.length)break}if(u<i.length)for(var m=0;m<h.length;m+=3){o.set(c[h[m]*d],c[h[m]*d+1],c[h[m]*d+2]),r.set(c[h[m+1]*d],c[h[m+1]*d+1],c[h[m+1]*d+2]),s.set(c[h[m+2]*d],c[h[m+2]*d+1],c[h[m+2]*d+2])
var g=a.vertices.length
a.vertices.push(o.clone()),a.vertices.push(r.clone()),a.vertices.push(s.clone()),a.faces.push(new THREE.Face3(g,g+1,g+2))}}return a.vertices.length>0?(a.faceId=p,a.applyMatrix(n.matrixWorld),a):null},this.faceSnapping=function(i,n){var o=new THREE.Vector3,r=new THREE.Vector3,s=new THREE.Vector3,a=new THREE.Geometry,l=n.attributes
if(void 0!==l.index){var c=l.index.array||n.ib,d=n.vb?n.vb:l.position.array,u=n.vb?n.vbstride:3,h=n.offsets
h&&0!==h.length||(h=[{start:0,count:c.length,index:0}])
for(var p=0;p<h.length;++p)for(var m=h[p].start,g=h[p].count,f=h[p].index,v=m;v<m+g;v+=3){var E=f+c[v],y=f+c[v+1],A=f+c[v+2]
o.set(d[E*u],d[E*u+1],d[E*u+2]),r.set(d[y*u],d[y*u+1],d[y*u+2]),s.set(d[A*u],d[A*u+1],d[A*u+2])
var T=THREE.Triangle.normal(o,r,s),b=new THREE.Vector3
if(b.set(d[i.a*u],d[i.a*u+1],d[i.a*u+2]),t(T,i.normal)&&e(T.dot(o),i.normal.dot(b))){var w=a.vertices.length
a.vertices.push(o.clone()),a.vertices.push(r.clone()),a.vertices.push(s.clone()),a.faces.push(new THREE.Face3(w,w+1,w+2))}}}return a.vertices.length>0?this.getTrianglesOnSameFace(a,i,d,u):null},this.getTrianglesOnSameFace=function(e,t,i,n){var o=!1,r=e.vertices.slice(),s=new THREE.Vector3
s.set(i[t.a*n],i[t.a*n+1],i[t.a*n+2])
var a=new THREE.Vector3
a.set(i[t.b*n],i[t.b*n+1],i[t.b*n+2])
var l=new THREE.Vector3
l.set(i[t.c*n],i[t.c*n+1],i[t.c*n+2])
var c=new THREE.Geometry
c.vertices.push(s),c.vertices.push(a),c.vertices.push(l),c.faces.push(new THREE.Face3(0,1,2))
var d=[]
do{d=[]
for(var u=0;u<r.length;u+=3)if(r[u].equals(s)&&r[u+1].equals(a)&&r[u+2].equals(l))o=!0,d.push(u)
else for(var h=0;h<c.vertices.length;h+=3)if(this.trianglesSharedEdge(r[u],r[u+1],r[u+2],c.vertices[h],c.vertices[h+1],c.vertices[h+2])){var p=c.vertices.length
c.vertices.push(r[u].clone()),c.vertices.push(r[u+1].clone()),c.vertices.push(r[u+2].clone()),c.faces.push(new THREE.Face3(p,p+1,p+2)),d.push(u)
break}for(var m=d.length-1;m>=0;--m)r.splice(d[m],3)}while(d.length>0)
return o?c:null},this.trianglesSharedEdge=function(e,t,i,n,o,r){var s=!1,a=!1,l=!1
return(e.equals(n)||e.equals(o)||e.equals(r))&&(s=!0),(t.equals(n)||t.equals(o)||t.equals(r))&&(a=!0),(i.equals(n)||i.equals(o)||i.equals(r))&&(l=!0),!!(s&a||s&l||a&l)},this.edgeSnappingWithTopology=function(e,t,i,n){var o,r=new THREE.Geometry,s=Number.MAX_VALUE,a=new THREE.Vector3,l=new THREE.Vector3,c=t.attributes
if(void 0!==c.index&&void 0!=i){for(var d=t.vb?t.vb:c.position.array,h=t.vb?t.vbstride:3,p=0;p<i.length;p++)for(var m=i[p].indexList,g=0;g<m.length-1;g++){a.set(d[m[g]*h],d[m[g]*h+1],d[m[g]*h+2]),l.set(d[m[g+1]*h],d[m[g+1]*h+1],d[m[g+1]*h+2]),a.applyMatrix4(n.matrixWorld),l.applyMatrix4(n.matrixWorld)
var f=this.distancePointToLine(e,a,l)
f<s&&(s=f,o=p)}if(o){m=i[o].indexList
for(var v=0;v<m.length-1;v++)r.vertices.push(new THREE.Vector3(d[m[v]*h],d[m[v]*h+1],d[m[v]*h+2])),r.vertices.push(new THREE.Vector3(d[m[v+1]*h],d[m[v+1]*h+1],d[m[v+1]*h+2]))}}E>=s&&r.vertices.length>0&&(E=s,r.applyMatrix(n.matrixWorld),u._geomEdge=r)},this.edgeSnapping=function(e,t){for(var i=new THREE.Geometry,n=!0,o=!0,r=!0,s=0;s<e.vertices.length;s+=3){for(var a=0;a<e.vertices.length;a+=3)s!==a&&((e.vertices[s].equals(e.vertices[a])||e.vertices[s].equals(e.vertices[a+1])||e.vertices[s].equals(e.vertices[a+2]))&&(e.vertices[s+1].equals(e.vertices[a])||e.vertices[s+1].equals(e.vertices[a+1])||e.vertices[s+1].equals(e.vertices[a+2]))&&(n=!1),(e.vertices[s].equals(e.vertices[a])||e.vertices[s].equals(e.vertices[a+1])||e.vertices[s].equals(e.vertices[a+2]))&&(e.vertices[s+2].equals(e.vertices[a])||e.vertices[s+2].equals(e.vertices[a+1])||e.vertices[s+2].equals(e.vertices[a+2]))&&(o=!1),(e.vertices[s+1].equals(e.vertices[a])||e.vertices[s+1].equals(e.vertices[a+1])||e.vertices[s+1].equals(e.vertices[a+2]))&&(e.vertices[s+2].equals(e.vertices[a])||e.vertices[s+2].equals(e.vertices[a+1])||e.vertices[s+2].equals(e.vertices[a+2]))&&(r=!1))
n&&(i.vertices.push(e.vertices[s].clone()),i.vertices.push(e.vertices[s+1].clone())),o&&(i.vertices.push(e.vertices[s].clone()),i.vertices.push(e.vertices[s+2].clone())),r&&(i.vertices.push(e.vertices[s+1].clone()),i.vertices.push(e.vertices[s+2].clone())),n=!0,o=!0,r=!0}for(var l,c=new THREE.Geometry,d=Number.MAX_VALUE,u=0;u<i.vertices.length;u+=2){var h=this.distancePointToLine(t,i.vertices[u],i.vertices[u+1])
h<d&&(d=h,l=u)}return c.vertices.push(i.vertices[l].clone()),c.vertices.push(i.vertices[l+1].clone()),c.vertices=this.getConnectedLineSegmentsOnSameLine(i,c.vertices),E=d,c},this.distancePointToLine=function(e,t,i){var n,o,r=new THREE.Vector3,s=new THREE.Vector3
return r.subVectors(t,e),s.subVectors(i,t),o=r.dot(s),r.subVectors(i,t),o=-o/r.dot(r),o<0?n=e.distanceTo(t):o>1?n=e.distanceTo(i):(r.subVectors(e,t),s.subVectors(e,i),r.cross(s),s.subVectors(i,t),n=Math.sqrt(r.dot(r))/Math.sqrt(s.dot(s))),n},this.getConnectedLineSegmentsOnSameLine=function(e,n){var o=e.vertices.slice(),r=n[0],s=n[1],a=[]
do{a=[]
for(var l=0;l<o.length;l+=2)if(!o[l].equals(r)||!o[l+1].equals(s))for(var c=0;c<n.length;c+=2)if(o[l].equals(n[c])||o[l+1].equals(n[c])||o[l].equals(n[c+1])||o[l+1].equals(n[c+1])){var d=new THREE.Vector3,u=new THREE.Vector3
if(d.subVectors(n[c],n[c+1]),d.normalize(),u.subVectors(o[l],o[l+1]),u.normalize(),t(d,u)||i(d,u)){a.push(l)
break}}for(var h=a.length-1;h>=0;--h)n.push(o[a[h]]),n.push(o[a[h]+1]),o.splice(a[h],2)}while(a.length>0)
return n},this.vertexSnappingWithTopology=function(e,t){var i=Number.MAX_VALUE,n=new THREE.Vector3
if(e&&e.vertices.length>1){var o=t.distanceTo(e.vertices[0]),r=t.distanceTo(e.vertices[e.vertices.length-1])
o<=r?(i=o,n=e.vertices[0].clone()):(i=r,n=e.vertices[e.vertices.length-1].clone())}return y=i,n},this.vertexSnapping=function(e,t){for(var i=Number.MAX_VALUE,n=new THREE.Vector3,o=0;o<e.vertices.length;++o){var r=t.distanceTo(e.vertices[o])
r<i-s&&(i=r,n=e.vertices[o].clone())}return y=i,n},this.edgeIsCircle=function(e){var t=e.vertices
if(t.length<8)return!1
if(t[0].equals(t[t.length-1])){for(var i=new THREE.Vector3(0,0,0),n=0;n<t.length;n+=2)i.add(t[n])
i.divideScalar(t.length/2)
for(var o=i.distanceTo(t[0]),n=0;n<t.length;n+=2)if(!(Math.abs(i.distanceTo(t[n])-o)<=s))return!1
return i}return!1},this.edgeIsCurved=function(e){var i=e.vertices
if(i.length<=2)return!1
if(i[0].equals(i[i.length-1]))return!0
var n=new THREE.Vector3
n.subVectors(i[0],i[1])
for(var o=new THREE.Vector3,r=2;r<i.length;r+=2)if(o.subVectors(i[r],i[r+1]),!t(n,o))return!0
return!1},this.faceIsCurved=function(i){var n=i.vertices,o=i.faces
if(o.length<=1)return!1
for(var r=THREE.Triangle.normal(n[o[0].a],n[o[0].b],n[o[0].c]),s=n[o[0].a],a=1;a<o.length;a++){var l=THREE.Triangle.normal(n[o[a].a],n[o[a].b],n[o[a].c]),c=n[o[a].a]
if(!t(r,l)||!e(r.dot(s),l.dot(c)))return!0}return!1},this.angleVector2=function(e){return e.x>0&&e.y>=0?Math.atan(e.y/e.x):e.x>=0&&e.y<0?Math.atan(e.y/e.x)+2*Math.PI:e.x<0&&e.y<=0?Math.atan(e.y/e.x)+Math.PI:e.x<=0&&e.y>0?Math.atan(e.y/e.x)+Math.PI:null},c.prototype.onLineSegment=function(e,t,i,n,o){var r=this.snapper.getIntersectPoint(),s=this.lineGeom.vertices,a=new THREE.Vector3(e,t,r.z),l=new THREE.Vector3(i,n,r.z),c=this.snapper.distancePointToLine(r,a,l)
c<=this.detectRadius&&c<this.minDist&&(s.splice(0,2,a,l),this.minDist=c,this.vpIdLine=o)},c.prototype.onCircularArc=function(e,t,i,n,o,r){var s=this.snapper.getIntersectPoint(),a=new THREE.Vector2(s.x,s.y),l=new THREE.Vector2(e,t),c=a.distanceTo(l)
a.sub(l)
var d=this.snapper.angleVector2(a)
if(Math.abs(c-o)<=this.detectRadius){if(n>i&&d>=i&&d<=n)var u=new THREE.CircleGeometry(o,100,i,n-i)
else{if(!(n<i&&(d>=i||d<=n)))return
var u=new THREE.CircleGeometry(o,100,i,2*Math.PI-i+n)}u.vertices.splice(0,1),u.applyMatrix((new THREE.Matrix4).makeTranslation(e,t,s.z)),this.circularArc=u,this.circularArcCenter=new THREE.Vector3(e,t,s.z),this.circularArcRadius=o,this.vpIdCircular=r}},c.prototype.onEllipticalArc=function(t,i,n,o,r,s,a,l){var c=this.snapper.getIntersectPoint(),d=new THREE.Vector2(c.x,c.y),u=r-this.detectRadius,h=s-this.detectRadius,p=r+this.detectRadius,m=s+this.detectRadius,g=(d.x-t)*(d.x-t)/(u*u)+(d.y-i)*(d.y-i)/(h*h),f=(d.x-t)*(d.x-t)/(p*p)+(d.y-i)*(d.y-i)/(m*m),v=new THREE.Vector2(t,i)
d.sub(v),d.x*=s,d.y*=r
var E=this.snapper.angleVector2(d)
if(o>2*Math.PI&&(o=2*Math.PI),g>=1&&f<=1&&(o>n&&E>=n&&E<=o||o<n&&(E>=n||E<=o))){var y=new THREE.EllipseCurve(t,i,r,s,n,o,!1),A=new THREE.Path(y.getPoints(50)),T=A.createPointsGeometry(50)
e(o-n,2*Math.PI)||T.vertices.pop(),T.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,c.z)),this.ellipticalArc=T,this.ellipticalArcCenter=new THREE.Vector3(t,i,c.z),this.vpIdElliptical=l}},this.snapping2D=function(e){if(e){var t=e.intersectPoint,i=e.fragId
if(void 0!==i){Array.isArray(i)||(i=[i]),u.hasTopology=!1,u._intersectPoint=t,u._radius=this.setDetectRadius(t)
if(!(null!=h.model.getFragmentList()))return b=!0,u._geomType=SNAP_VERTEX,u._geomVertex=t,void this.drawPoint(u._geomVertex)
for(var n=new c(h,this,u._radius),o=0;o<i.length;++o){var s=h.impl.getRenderProxy(h.model,i[o])
if(s&&s.geometry){new r.VertexBufferReader(s.geometry,h.impl.use2dInstancing).enumGeomsForObject(e.dbId,n)}}if(n.circularArc){if(u._viewportIndex2d=n.vpIdCircular,null!==w&&w!==u._viewportIndex2d)return
t.distanceTo(n.circularArc.vertices[0])<u._radius?(u._geomVertex=n.circularArc.vertices[0],this.drawPoint(u._geomVertex),u._geomType=SNAP_VERTEX):t.distanceTo(n.circularArc.vertices[n.circularArc.vertices.length-1])<u._radius?(u._geomVertex=n.circularArc.vertices[n.circularArc.vertices.length-1],this.drawPoint(u._geomVertex),u._geomType=SNAP_VERTEX):(this.lineStripToPieces(n.circularArc),u._geomEdge=n.circularArc,this.drawLine(u._geomEdge),u._circularArcCenter=n.circularArcCenter,u._circularArcRadius=n.circularArcRadius,u._geomType=SNAP_CIRCULARARC),b=!0}else if(n.ellipticalArc){if(u._viewportIndex2d=n.vpIdElliptical,null!==w&&w!==u._viewportIndex2d)return
t.distanceTo(n.ellipticalArc.vertices[0])<u._radius?(u._geomVertex=n.ellipticalArc.vertices[0],this.drawPoint(u._geomVertex),u._geomType=SNAP_VERTEX):t.distanceTo(n.ellipticalArc.vertices[n.ellipticalArc.vertices.length-1])<u._radius?(u._geomVertex=n.ellipticalArc.vertices[n.ellipticalArc.vertices.length-1],this.drawPoint(u._geomVertex),u._geomType=SNAP_VERTEX):(this.lineStripToPieces(n.ellipticalArc),u._geomEdge=n.ellipticalArc,this.drawLine(u._geomEdge),u._circularArcCenter=n.ellipticalArcCenter,u._circularArcRadius=null,u._geomType=SNAP_CIRCULARARC),b=!0}else if(n.lineGeom.vertices.length){if(u._viewportIndex2d=n.vpIdLine,null!==w&&w!==u._viewportIndex2d)return
if(this.markupMode){var a=n.lineGeom.vertices[0],l=n.lineGeom.vertices[1],d=new THREE.Vector3
d.addVectors(a,l),d.divideScalar(2)
var m=t.distanceTo(d),g=t.distanceTo(a),f=t.distanceTo(l)
u._geomEdge=n.lineGeom,m<u._radius?(u._geomVertex=d,this.drawPoint(u._geomVertex),u._geomType=SNAP_VERTEX):g<u._radius?(u._geomVertex=a,this.drawPoint(u._geomVertex),u._geomType=SNAP_VERTEX):f<u._radius?(u._geomVertex=l,this.drawPoint(u._geomVertex),u._geomType=SNAP_VERTEX):(this.drawLine(u._geomEdge),u._geomType=SNAP_EDGE)}else t.distanceTo(n.lineGeom.vertices[0])<u._radius?(u._geomVertex=n.lineGeom.vertices[0],this.drawPoint(u._geomVertex),u._geomType=SNAP_VERTEX):p.forceSnapVertices||t.distanceTo(n.lineGeom.vertices[1])<u._radius?(u._geomVertex=n.lineGeom.vertices[1],this.drawPoint(u._geomVertex),u._geomType=SNAP_VERTEX):(u._geomEdge=n.lineGeom,this.drawLine(u._geomEdge),u._geomType=SNAP_EDGE)
b=!0}}}},this.snappingLeaflet=function(e){if(e){var t=e.intersectPoint
u._intersectPoint=t,u.hasTopology=!1,u._radius=this.setDetectRadius(t),this.drawPoint(t),u._geomType=SNAP_VERTEX,u._geomVertex=t,b=!0}},this.lineStripToPieces=function(e){for(var t=e.vertices,i=t.length-2;i>0;i--)t.splice(i,0,t[i])},this.createOverlay=function(){h.impl.overlayScenes[f]?0!=v&&h.impl.clearOverlay(f):h.impl.createOverlayScene(f)},this.addOverlay=function(e){h.impl.addOverlay(f,e)},this.clearOverlay=function(){h.impl.overlayScenes[f]&&h.impl.clearOverlay(f),v=0}
var S=null
this.drawFace=function(e){this.createOverlay(),S||d()
var t=new THREE.Mesh(e,S,!0)
v=1,this.addOverlay(t)}
var R=null
this.cylinderMesh=function(e,t,i){var n=(new THREE.Vector3).subVectors(t,e),o=new THREE.Matrix4
o.lookAt(e,t,(new THREE.Object3D).up),o.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-n.length(),0,0,0,0,0,1)),R||(R=new THREE.CylinderGeometry(.5,.5,1,8,1,!0))
var r=new THREE.Mesh(R,i)
return r.applyMatrix(o),r.position.x=(t.x+e.x)/2,r.position.y=(t.y+e.y)/2,r.position.z=(t.z+e.z)/2,r},this.drawLine=function(e){this.createOverlay(),S||d(),v=2
for(var t=0;t<e.vertices.length;t+=2){var i=this.cylinderMesh(e.vertices[t],e.vertices[t+1],S)
this.setEdgeScale(i),this.addOverlay(i)}},this.drawArc=function(e){this.createOverlay(),S||d(),v=2
for(var t=0;t<e.vertices.length-1;t++){var i=this.cylinderMesh(e.vertices[t],e.vertices[t+1],S)
this.setEdgeScale(i),this.addOverlay(i)}}
var x=null
this.drawPoint=function(e){this.createOverlay(),S||d(),x||(x=new THREE.SphereGeometry(1))
var t=new THREE.Mesh(x,S)
t.position.set(e.x,e.y,e.z),this.setPointScale(t),v=3,this.addOverlay(t)},this.setScale=function(e){var t=h.navigation,i=t.getCamera(),n=t.getEyeVector(),o=t.getPosition(),r=e.position.clone(),s=i.isPerspective?r.sub(o).dot(n.normalize()):t.getEyeVector().length(),a=t.getVerticalFov(),l=2*s*Math.tan(THREE.Math.degToRad(.5*a)),c=t.getScreenViewport(),d=window.devicePixelRatio||1
return 5*l/(c.height*d)},this.setPointScale=function(e){var t=this.setScale(e)
e.scale.x=t,e.scale.y=t,e.scale.z=t},this.setEdgeScale=function(e){var t=this.setScale(e)
e.scale.x=t,e.scale.z=t},this.updatePointScale=function(){if(3==v){var e=h.impl.overlayScenes[f]
if(e)for(var t=e.scene,i=0;i<t.children.length;i++){var n=t.children[i]
n&&this.setPointScale(n)}}},this.updateEdgeScale=function(){if(2==v){var e=h.impl.overlayScenes[f]
if(e)for(var t=e.scene,i=0;i<t.children.length;i++){var n=t.children[i]
n&&this.setEdgeScale(n)}}},this.setDetectRadius=function(e){var t=o.isMobileDevice()?25:10,i=h.navigation,n=i.getCamera(),r=i.getEyeVector(),s=i.getPosition(),a=e.clone(),l=n.isPerspective?a.sub(s).dot(r.normalize()):i.getEyeVector().length(),c=i.getVerticalFov(),d=2*l*Math.tan(THREE.Math.degToRad(.5*c)),u=i.getScreenViewport(),p=window.devicePixelRatio||1
return t*d/(u.height*p)},this.drawIntersectFace=function(e,t,i,n){this.createOverlay()
var o=new THREE.Vector3
o.set(t[e.a*i],t[e.a*i+1],t[e.a*i+2])
var r=new THREE.Vector3
r.set(t[e.b*i],t[e.b*i+1],t[e.b*i+2])
var s=new THREE.Vector3
s.set(t[e.c*i],t[e.c*i+1],t[e.c*i+2])
var a=new THREE.Geometry
a.vertices.push(o),a.vertices.push(r),a.vertices.push(s),a.faces.push(new THREE.Face3(0,1,2))
var l=new THREE.Mesh(a,n.material,!0)
l.matrixWorld=n.matrixWorld,this.addOverlay(l)},this.handleWheelInput=function(e){return this.updatePointScale(),this.updateEdgeScale(),!1},this.handleButtonDown=function(e,t){return A=!0,!1},this.handleButtonUp=function(e,t){return A=!1,!1},this.handleMouseMove=function(e){return!A&&(this.onMouseMove({x:e.canvasX,y:e.canvasY}),!1)},this.handleSingleTap=function(e){return this.handleMouseMove(e)},this.destroy=function(){this.clearOverlay(),h.impl.removeOverlayScene(f),x&&(x.dispose(),x=null),R&&(R.dispose(),R=null)},this.handlePressHold=function(e){if(o.isMobileDevice())switch(e.type){case"press":T=!0,this.onMouseMove({x:e.canvasX,y:e.canvasY})
break
case"pressup":this.onMouseMove({x:e.canvasX,y:e.canvasY}),T=!1}return!1},this.handleGesture=function(e){if(T&&o.isMobileDevice())switch(e.type){case"dragstart":case"dragmove":this.onMouseMove({x:e.canvasX,y:e.canvasY})
break
case"dragend":this.onMouseMove({x:e.canvasX,y:e.canvasY}),T=!1}return!1},this.onMouseDown=function(e){this.onMouseMove(e)},this.onMouseMove=function(e){this.clearOverlay(),this.clearSnapped()
var t=h.impl.snappingHitTest(e.x,e.y,!1)
t&&t.intersectPoint&&(t.face?this.snapping3D(t):t.dbId||0===t.dbId?this.snapping2D(t):this.snappingLeaflet(t))},this.nearestPointInPointToEdge=function(e,t){for(var i=e.vertices,n=Number.MAX_VALUE,o=null,r=0;r<i.length;r+=2){var s=this.nearestPointInPointToSegment(t,i[r],i[r+1]),a=t.distanceTo(s)
a<n&&(n=a,o=s)}return o},this.nearestPointInPointToSegment=function(e,t,i){var n,o,r=new THREE.Vector3,s=new THREE.Vector3
return r.subVectors(t,e),s.subVectors(i,t),o=r.dot(s),r.subVectors(i,t),o=-o/r.dot(r),o<0?n=t:o>1?n=i:(r.subVectors(i,t),r.multiplyScalar(o),n=r.add(t)),n},this.nearestPointInPointToLine=function(e,t,i){var n,o=new THREE.Vector3,r=new THREE.Vector3
return o.subVectors(t,e),r.subVectors(i,t),n=o.dot(r),o.subVectors(i,t),n=-n/o.dot(o),o.subVectors(i,t),o.multiplyScalar(n),o.add(t)}}}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.MagnifyingGlass=function(e){var t=e,i=!1,n=["magnifyingGlass"],o=!1,r=null,s=null,a=null,l=null,c=null,d=!1
this.isActive=function(){return i},this.activate=function(){i=!0,this.updateMagnifyingGlassBinded=this.updateMagnifyingGlass.bind(this)},this.updateMagnifyingGlass=function(){if(d)r&&r.classList.remove("visible"),d=!1
else{var e=window.devicePixelRatio,i=80*e,n=e*(l-20),o=e*(c-20)
r||(r=document.createElement("canvas"),r.className="magnifying-glass",r.width=i,r.height=i,r.style.width="80px",r.style.height="80px",r.getContext("2d").translate(0,i),r.getContext("2d").scale(1,-1),t.container.appendChild(r),s=new ImageData(Math.ceil(i/2),Math.ceil(i/2)),a=new Uint8Array(s.data.buffer))
var u=r.getContext("2d"),h=t.canvas.getContext("webgl")
h.readPixels(n,t.canvas.height-o-s.height,s.width,s.height,h.RGBA,h.UNSIGNED_BYTE,a),u.putImageData(s,0,0),u.drawImage(r,0,0,s.width,s.height,0,0,i,i),this.setGlassPosition(r,l,c,80,15),r.classList.toggle("visible",!0)}t.removeEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.updateMagnifyingGlassBinded)},this.deactivate=function(){i=!1},this.getNames=function(){return n},this.getName=function(){return n[0]},this.setGlassPosition=function(e,t,i,n,o){e.style.left=t-n/2+"px",e.style.top=i-n-o>0?i-n-o+"px":i+o+"px"},this.requestUpdate=function(){t.hasEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.updateMagnifyingGlassBinded)||t.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.updateMagnifyingGlassBinded)},this.drawMagnifyingGlass=function(e,t){l=e,c=t,this.requestUpdate()},this.clearMagnifyingGlass=function(){d=!0,this.requestUpdate()},this.handlePressHold=function(e){if(av.isMobileDevice())switch(e.type){case"press":o=!0,this.drawMagnifyingGlass(e.canvasX,e.canvasY)
break
case"pressup":this.clearMagnifyingGlass(),o=!1}return!1},this.handleGesture=function(e){if(o&&av.isMobileDevice())switch(e.type){case"dragstart":case"dragmove":this.drawMagnifyingGlass(e.canvasX,e.canvasY)
break
case"dragend":this.clearMagnifyingGlass(),o=!1
break
case"pinchstart":case"pinchmove":this.drawMagnifyingGlass(e.canvasX,e.canvasY)
break
case"pinchend":this.clearMagnifyingGlass()}return!1},this.handleMouseMove=function(e){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonUp=function(e,t){return!1}},function(){"use strict"
function e(e,t){Autodesk.Viewing.Extension.call(this,e,t),this.createUIBound=function(){e.removeEventListener(av.TOOLBAR_CREATED_EVENT,this.createUIBound),this.createUI(this.viewer.getToolbar(!1))}.bind(this)}var t=AutodeskNamespace("Autodesk.Viewing.Extensions.ZoomWindow")
e.prototype=Object.create(Autodesk.Viewing.Extension.prototype),e.prototype.constructor=e
var i=e.prototype
i.load=function(){var e=this.viewer
return this.tool=new t.ZoomWindowTool(e),e.toolController.registerTool(this.tool),this.createUI(e.getToolbar(!1)),!0},i.createUI=function(e){var t
if(!e||!(t=e.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID))||!t.dollybutton)return void this.viewer.addEventListener(av.TOOLBAR_CREATED_EVENT,this.createUIBound)
var i=this
t.removeControl(t.dollybutton.getId()),this.defaultDollyButton=t.dollybutton,this.zoomWindowToolButton=new Autodesk.Viewing.UI.ComboButton("toolbar-zoomTools"),this.zoomWindowToolButton.setIcon("zoomwindowtoolicon-zoom-window"),this.createZoomSubmenu(this.zoomWindowToolButton),t.addControl(this.zoomWindowToolButton)
var n=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){i.zoomWindowToolButton.getState()===Autodesk.Viewing.UI.Button.State.ACTIVE&&(i.viewer.setActiveNavigationTool(),i.zoomWindowToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}}]
Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,n)},i.destroyUI=function(){var e=this.viewer,t=e.getToolbar(!1)
if(t){var i=t.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID)
i&&(this.zoomWindowToolButton&&(this.zoomWindowToolButton.subMenu.removeEventListener(Autodesk.Viewing.UI.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.zoomWindowToolButton.subMenuActiveButtonChangedHandler(i)),i.removeControl(this.zoomWindowToolButton.getId())),this.zoomWindowToolButton=null,i.panbutton&&this.defaultDollyButton?i.addControl(this.defaultDollyButton):this.defaultDollyButton=null)}Autodesk.Viewing.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},i.createNavToggler=function(e,t,i){return function(){var n=t.getState()
n===Autodesk.Viewing.UI.Button.State.INACTIVE?(e.setActiveNavigationTool(i),t.setState(Autodesk.Viewing.UI.Button.State.ACTIVE)):n===Autodesk.Viewing.UI.Button.State.ACTIVE&&(e.setActiveNavigationTool(),t.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}},i.createZoomSubmenu=function(e){var t=this.viewer,i=t.getToolbar(!0),n=(i.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),new Autodesk.Viewing.UI.Button("toolbar-zoomWindowTool"))
n.setToolTip(Autodesk.Viewing.i18n.translate("Zoom window")),n.setIcon("zoomwindowtoolicon-zoom-window"),n.onClick=this.createNavToggler(t,n,"zoomwindow"),e.addControl(n)
var o=new Autodesk.Viewing.UI.Button("toolbar-zoomTool")
o.setToolTip("Zoom"),o.setIcon("adsk-icon-zoom"),o.onClick=this.createNavToggler(t,o,"dolly"),e.addControl(o),e.onClick=n.onClick},i.unload=function(){var e=this.viewer
return"dolly"!==e.getActiveNavigationTool()&&"zoomwindow"!==e.getActiveNavigationTool()||e.setActiveNavigationTool(),this.destroyUI(),e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.ZoomWindow",e)}(),function(){"use strict"
function e(e){var i=["zoomwindow"],n=!1,o=!1,r=new THREE.Vector3(0,0,-10),s=new THREE.Vector3(0,0,-10),a=null,l=null,c=null,d=null,u=null,h=e.navigation.getCamera()
this.isActive=function(){return n},this.getNames=function(){return i},this.getName=function(){return i[0]},this.onResize=function(){u=null
var t=e.canvas,i=t.clientWidth,n=t.clientHeight,o=new THREE.OrthographicCamera(0,i,0,n,1,1e3)
e.impl.overlayScenes.ZoomWindowRect.camera=o},this.activate=function(t){if(n=!0,null===a){var i=null
i=e.navigation.getIs2D()?new THREE.Color(0):new THREE.Color(16777215),a=new THREE.LineBasicMaterial({color:i,opacity:.6,linewidth:1})}var o=e.canvas,r=o.clientWidth,s=o.clientHeight,l=new THREE.OrthographicCamera(0,r,0,s,1,1e3)
e.impl.createOverlayScene("ZoomWindowRect",a,a,l),e.impl.api.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize),e.toolController.getTool("dolly").activate("orbit")},this.deactivate=function(t){u=null,e.impl.removeOverlayScene("ZoomWindowRect"),n=!1,o=!1,r.set(0,0,-10),s.set(0,0,-10),e.impl.api.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize),e.toolController.getTool("dolly").deactivate("orbit")},this.getCursor=function(){switch(e.toolController.getTool("dolly").getTriggeredMode()){case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto"
case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAADWSURBVEiJ1ZVNEsIwCEYfTg/UjTPuemcvojfCRRMlNKGdKguZyaLkK4/8EERVybQJQERCUU3C63p+n/Bk9QHDRtbIX2GqKh6woRfxLdL0/M1KzYRaA+7AXDW9wN5fvrXEWud6AOABLD7QwREDgCdw7WV6ZjSAsi0Lzn4JmEcHeHbYWxQXw3FTEWmvaWY1X9Iie4CIKHE1fwfIsnSAZD/X/79FGbdISyzA9QMDG3axTTTVwx3NaNbm5B2dRHY1DWCUyd4qIs0bUB8nuz32/11Cu+KPM7sOXlrOS4sOkzb1AAAAAElFTkSuQmCC), auto"},this.handleGesture=function(e){return!0},this.handleSingleClick=function(e,t){return!0},this.startDrag=function(t){if(!1===o){if(o=!0,r.x=t.canvasX,r.y=t.canvasY,s.x=t.canvasX,s.y=t.canvasY,null===u){l=new THREE.Geometry,l.vertices.push(r.clone(),r.clone(),r.clone(),r.clone(),r.clone()),c=new THREE.Geometry,c.vertices.push(r.clone(),r.clone()),d=new THREE.Geometry,d.vertices.push(r.clone(),r.clone())
var i=new THREE.Line(l,a,THREE.LineStrip),n=new THREE.Line(c,a,THREE.LineStrip),h=new THREE.Line(d,a,THREE.LineStrip)
u=new THREE.Group,u.add(i),u.add(n),u.add(h)}else l.vertices[0]=r.clone(),l.vertices[1]=r.clone(),l.vertices[2]=r.clone(),l.vertices[3]=r.clone(),l.vertices[4]=r.clone(),c.vertices[0]=r.clone(),c.vertices[1]=r.clone(),d.vertices[0]=r.clone(),d.vertices[1]=r.clone(),c.verticesNeedUpdate=!0,d.verticesNeedUpdate=!0,l.verticesNeedUpdate=!0
e.impl.addOverlay("ZoomWindowRect",u)}},this.handleButtonDown=function(e,t){return 0===t&&(this.startDrag(e),!0)},this.handleMouseMove=function(e){return!(!l||!o)&&(s.x=e.canvasX,s.y=e.canvasY,!0)},this.endDrag=function(t){!0===o&&(e.impl.removeOverlay("ZoomWindowRect",u),o=!1)},this.handleButtonUp=function(e,t){return 0===t&&(this.endDrag(),!0)},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e){return!1},this.handleBlur=function(e){return!1},this.update=function(){if(this.isActive()){if(!l||!o)return this.zoomWindow()
l.vertices[1].x=r.x,l.vertices[1].y=s.y,l.vertices[2]=s.clone(),l.vertices[3].x=s.x,l.vertices[3].y=r.y,l.vertices[4]=l.vertices[0]
var i=Math.abs(s.x-r.x),n=Math.abs(s.y-r.y),a=i>n?n:i
a>t&&(a=t)
var u=.5*a,h=[.5*(s.x+r.x),.5*(s.y+r.y)]
return c.vertices[0].x=h[0]-u,c.vertices[0].y=h[1],c.vertices[1].x=h[0]+u,c.vertices[1].y=h[1],d.vertices[0].x=h[0],d.vertices[0].y=h[1]-u,d.vertices[1].x=h[0],d.vertices[1].y=h[1]+u,c.verticesNeedUpdate=!0,d.verticesNeedUpdate=!0,l.verticesNeedUpdate=!0,e.impl.invalidate(!1,!1,!0),!1}},this.getPivot=function(e,t,i,n,o){e=2*e/i-1,t=1-2*t/n
var r=new THREE.Vector3(e,t,-1),s=new THREE.Vector3(e,t,1)
r.unproject(o),s.unproject(o),s.sub(r)
var a=o.position,l=o.target,c=l.clone().sub(a).normalize(),d=(c.dot(l)-c.dot(r))/c.dot(s)
return r.add(s.multiplyScalar(d)),r},this.queryMouseRaySceneIntersection=function(t,i){if(null==e)return null
if(null==e.model)return null
if(e.model.is2d())return null
var n=e.impl.hitTest(t,i,!1)
return n?n.intersectPoint:null}
this.zoomWindow=function(){var t=h,i=e.canvas.clientWidth,n=e.canvas.clientHeight,o=r.x,a=r.y,l=s.x,c=s.y,d=Math.abs(l-o),u=Math.abs(c-a)
if(0===d||0===u)return!1
if(s.copy(r),e.navigation.getIs2D()){var p={x:.5*(o+l),y:.5*(a+c)},m=e.navigation.getEyeVector().length(),g=e.impl.clientToViewport(p.x,p.y),f=e.impl.clientToViewport(i/2,n/2)
g.subVectors(g,f),e.navigation.panRelative(g.x/2,g.y/2,m)
var v=d/i,E=u/n,y=v>E?v:E
m=e.navigation.getEyeVector().length()
var A=e.navigation.getWorldPoint(.5,.5)
return e.navigation.dollyFromPoint(m*(y-1),A),!0}var T=null,b=.5*(o+l),w=.5*(a+c)
null===(T=this.queryMouseRaySceneIntersection(b,w))&&(T=this.getPivot(b,w,i,n,h))
var C=t.position,S=t.target.clone().sub(C)
S.normalize()
var R=Math.min(i/d,n/u),x=T.distanceTo(C),P=1*x/R
return S.multiplyScalar(-P),S.add(T),t.position.set(S.x,S.y,S.z),t.target.set(T.x,T.y,T.z),t.dirty=!0,!0}}AutodeskNamespace("Autodesk.Viewing.Extensions.ZoomWindow")
var t=20
Autodesk.Viewing.Extensions.ZoomWindow.ZoomWindowTool=e}(),function(){"use strict"
AutodeskNamespace("Autodesk.Viewing.Extensions.FusionOrbit")
var e=Autodesk.Viewing,t=e.UI,i=e.Extensions.FusionOrbit,n=function(t,i){e.Extension.call(this,t,i)}
n.prototype=Object.create(e.Extension.prototype),n.prototype.constructor=n,n.prototype.load=function(){function t(){o.removeEventListener(e.TOOLBAR_CREATED_EVENT,t),n.createUI()}var n=this,o=this.viewer,r=o.getToolbar?o.getToolbar(!0):void 0
if(this.tool=new i.FusionOrbitTool,this.tool.setViewer(o),o.toolController.registerTool(this.tool),r){var s=r.getControl(e.TOOLBAR.NAVTOOLSID)
s&&s.getNumberOfControls()>0?t():o.addEventListener(e.TOOLBAR_CREATED_EVENT,t)}else o.addEventListener(e.TOOLBAR_CREATED_EVENT,t)
return!0},n.prototype.createUI=function(){var i=this.viewer,n=i.getToolbar(!1),o=n.getControl(e.TOOLBAR.NAVTOOLSID)
this.classicBehavior={},this.classicBehavior.orbitOnClick=o.orbitbutton.onClick,this.classicBehavior.freeorbitOnClick=o.freeorbitbutton.onClick,this.classicBehavior.returnToDefault=o.returnToDefault,o.freeorbitbutton.onClick=function(e){var n=o.freeorbitbutton.getState()
n===t.Button.State.INACTIVE?(i.setActiveNavigationTool("fusion orbit"),o.freeorbitbutton.setState(t.Button.State.ACTIVE)):n===t.Button.State.ACTIVE&&(i.setActiveNavigationTool(),o.freeorbitbutton.setState(t.Button.State.INACTIVE))},o.orbitbutton.onClick=function(e){var n=o.orbitbutton.getState()
n===t.Button.State.INACTIVE?(i.setActiveNavigationTool("fusion orbit constrained"),o.orbitbutton.setState(t.Button.State.ACTIVE)):n===t.Button.State.ACTIVE&&(i.setActiveNavigationTool(),o.orbitbutton.setState(t.Button.State.INACTIVE))},o.returnToDefault=function(){o.orbittoolsbutton.setState(t.Button.State.ACTIVE),o.orbittoolsbutton.setState(t.Button.State.INACTIVE)},o.orbittoolsbutton.setState(t.Button.State.INACTIVE),i.prefs.fusionOrbitConstrained?(o.orbittoolsbutton.onClick=o.orbitbutton.onClick,o.orbittoolsbutton.setIcon(o.orbitbutton.iconClass),i.setDefaultNavigationTool("orbit")):(o.orbittoolsbutton.onClick=o.freeorbitbutton.onClick,o.orbittoolsbutton.setIcon(o.freeorbitbutton.iconClass),i.setDefaultNavigationTool("freeorbit")),i.setActiveNavigationTool(),o.returnToDefault()},n.prototype.unload=function(){var i=this.viewer,n=i.getToolbar(!1),o=n.getControl(e.TOOLBAR.NAVTOOLSID)
return o&&(o.orbitbutton&&(o.orbitbutton.onClick=this.classicBehavior.orbitOnClick),o.freeorbitbutton&&(o.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick),o.returnToDefault=this.classicBehavior.returnToDefault,o.orbittoolsbutton&&(o.orbitbutton?o.orbittoolsbutton.onClick=o.orbitbutton.onClick:o.orbittoolsbutton.onClick=null,o.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),o.orbittoolsbutton.setState(t.Button.State.ACTIVE))),i.setActiveNavigationTool("orbit"),i.setDefaultNavigationTool("orbit"),i.toolController.deregisterTool(this.tool),this.tool.setViewer(null),this.tool=null,!0},i.FusionOrbitExtension=n,e.theExtensionManager.registerExtension("Autodesk.Viewing.FusionOrbit",n)}(),Autodesk.Viewing.Extensions.FusionOrbit.html=['<div class="orbit-gizmo noselect">','<div class="outside"></div>','<div class="ring"></div>','<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="layout-mid">','<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="circle">','<div class="crosshair-area">','<div class="crosshair-v"></div>','<div class="crosshair-h"></div>',"</div>","</div>",'<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>",'<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>"].join("\n"),Autodesk.Viewing.Extensions.FusionOrbit.FusionOrbitTool=function(){var e,t,i,n,o,r=Autodesk.Viewing,s=Autodesk.Viewing.Private,a=["fusion orbit","fusion orbit constrained"],l={HORIZONTAL:0,VERTICAL:1,ROLL:2},c={HORIZONTAL:.005,VERTICAL:.005,ROLL:1},d={},u=r.isTouchDevice(),h=!1,p={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},m=this
this.setViewer=function(e){this.viewer=e,this.navapi=e?e.navigation:null}
var g=function(e){p.buttons[e.touches?0:e.button]=!0,p.src=e.target.className,p.x=0,p.y=0,p.dx=0,p.dy=0,p.firstMove=!0,p.mode=void 0,"ring"===p.src?p.mode=l.ROLL:"edgemark-area"===p.src&&("layout-ver"===e.target.parentNode.className?p.mode=l.HORIZONTAL:"layout-hor"===e.target.parentNode.className&&(p.mode=l.VERTICAL)),b(),e.stopPropagation()},f=function(e){p.buttons[e.touches?0:e.button]=!1,p.src=void 0},v=function(e){p.buttons[0]&&(E(e),y(),p.firstMove=!1)},E=function(e){var t=e.touches?e.touches[0].pageX:e.pageX,i=e.touches?e.touches[0].pageY:e.pageY
p.firstMove||(p.dx=t-p.x,p.dy=i-p.y),p.x=t,p.y=i},y=function(){switch(p.mode){case l.ROLL:if(!m.navapi.isActionEnabled("roll"))return
break
case l.HORIZONTAL:case l.VERTICAL:if(!m.navapi.isActionEnabled("orbit"))return}var e=o.target.clone().sub(o.position).normalize(),t=e.clone().cross(o.up).normalize(),i=t.clone().cross(e).normalize()
if(o.up.copy(i),p.mode===l.ROLL){var r=new THREE.Vector3(p.x-d.center.x,p.y-d.center.y,0),s=new THREE.Vector3(p.dx,p.dy,0).add(r)
r.normalize(),s.normalize()
var a=r.clone().cross(s),u=Math.asin(a.z)
o.up.applyAxisAngle(e,-u*c.ROLL)}else{var h,g
p.mode===l.HORIZONTAL?(g=-p.dx*c.HORIZONTAL,n&&(o.up=Autodesk.Viewing.Navigation.snapToAxis(o.up.clone())),h=o.up):p.mode===l.VERTICAL&&(g=-p.dy*c.VERTICAL,n?(p.firstMove&&(o.up=Autodesk.Viewing.Navigation.snapToAxis(o.up.clone())),h=e.clone().cross(o.up).normalize()):h=t,o.up.applyAxisAngle(h,g))
var f=m.navapi.getPivotPoint(),v=o.position.clone().sub(f)
v.applyAxisAngle(h,g),o.position.addVectors(f,v)
var E=o.target.clone().sub(f)
E.applyAxisAngle(h,g),o.target.addVectors(f,E)}o.dirty=!0},A=function(){var e=o.target.clone().sub(o.position).normalize(),t=m.viewer.impl.rayIntersect(new THREE.Ray(o.position,e))
return t&&t.intersectPoint?t.intersectPoint:o.target},T=function(e,t){var i=t||e.clone().sub(o.position).normalize()
return new THREE.Plane(i,-i.x*e.x-i.y*e.y-i.z*e.z)},b=function(){var e=o.target.clone().sub(o.position).normalize(),t=T(o.position,e),i=t.distanceToPoint(o.pivot)
o.pivot.copy(e).multiplyScalar(i).add(o.position)},w=function(e){e.touches||0!==e.button||b()},C=function(e){h&&m.viewer.setActiveNavigationTool()},S=function(e,t){var i,n=m.viewer.impl.hitTest(e,t)
if(n&&n.intersectPoint)i=n.intersectPoint
else{i=m.viewer.impl.viewportToRay(m.viewer.impl.clientToViewport(e,t)).intersectPlane(T(o.target))}var r=o.position.clone().sub(A()).add(i)
m.navapi.setRequestTransition(!0,r,i,o.fov)}
this.register=function(){e=s.stringToDOM(Autodesk.Viewing.Extensions.FusionOrbit.html),e.style.display="none",this.viewer.canvasWrap.insertBefore(e,this.viewer.canvasWrap.firstChild),t=e.querySelector(".ring"),t.addEventListener("mousedown",g),Array.prototype.forEach.call(e.querySelectorAll(".edgemark-area"),function(e,t){e.addEventListener("mousedown",g),u&&e.addEventListener("touchstart",g)}),window.addEventListener("mouseup",f),window.addEventListener("mousemove",v),i=e.querySelector(".outside"),i.addEventListener("mousedown",C)
var n=e.querySelector(".circle")
n.addEventListener("mousedown",w),u&&(t.addEventListener("touchstart",g),window.addEventListener("touchend",f),window.addEventListener("touchmove",v),i.addEventListener("touchstart",C),n.addEventListener("touchstart",w)),o=this.viewer.impl.camera},this.deregister=function(){window.removeEventListener("mouseup",f),window.removeEventListener("mousemove",v),i.removeEventListener("mousedown",C),u&&(window.removeEventListener("touchend",f),window.removeEventListener("touchmove",v),i.removeEventListener("touchstart",C)),this.viewer.canvasWrap.removeChild(e),e=void 0,t=void 0,i=void 0},this.activate=function(t){e.style.display="",this.handleResize(),n="fusion orbit constrained"===t
var i=this.viewer.toolController.isToolActivated("hyperlink")
i&&this.viewer.toolController.deactivateTool("hyperlink"),n?(this.viewer.setDefaultNavigationTool("orbit"),this.viewer.prefs.set("fusionOrbitConstrained",!0)):(this.viewer.setDefaultNavigationTool("freeorbit"),this.viewer.prefs.set("fusionOrbitConstrained",!1)),i&&this.viewer.toolController.activateTool("hyperlink"),this.viewer.navigation.setZoomTowardsPivot(!0)},this.deactivate=function(t){e.style.display="none",this.viewer.navigation.setZoomTowardsPivot(this.viewer.prefs.zoomTowardsPivot)},this.getNames=function(){return a},this.getName=function(){return a[0]},this.update=function(){return!1},this.handleSingleClick=function(e,t){return S(e.canvasX,e.canvasY),!0},this.handleDoubleClick=function(e,t){return!0},this.handleSingleTap=function(e){return S(e.canvasX,e.canvasY),!0},this.handleDoubleTap=function(e){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){var t,n=this.viewer.impl.canvas.getBoundingClientRect()
t=n.width>n.height?new THREE.Vector2(((e.canvasX+.5)/n.width*2-1)*n.width/n.height,-(e.canvasY+.5)/n.height*2+1):new THREE.Vector2((e.canvasX+.5)/n.width*2-1,(-(e.canvasY+.5)/n.height*2+1)*n.height/n.width)
var o=t.length(),r=o>1.2
return h!==r&&(i.style.cursor=r?"":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",h=r),!1},this.handleGesture=function(e){return b(),!1},this.handleBlur=function(e){return!1},this.handleResize=function(){var i=e.getBoundingClientRect()
d.left=i.left+window.pageXOffset,d.top=i.top+window.pageYOffset,d.width=i.width,d.height=i.height,d.center={},d.center.x=d.left+d.width/2,d.center.y=d.top+d.height/2
var n=.8*(window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth)
e.style.width=e.style.height=n+"px",e.style.top=e.style.left="calc(50% - "+n/2+"px)",t.style.borderWidth=.1*n+"px"}},AutodeskNamespace("Autodesk.Viewing.Private.Collaboration"),function(){function e(e,t,i){function o(t){var i=t.data.msg
if(a.x=i.x1,a.y=i.y1,l.x=i.x2,l.y=i.y2,c=i.explode,i.command)if("gohome"==i.command)a.x=a.y=0,l.x=l.y=0,e.navigation.setRequestHomeView(!0),e.showAll(),e.impl.selector.clearSelection(),e.explode(0),d=null
else if("select"==i.command){var n=e.impl.hitTestViewport(new THREE.Vector3(0,0,0))
n?e.impl.selector.toggleSelection(n.dbId,n.model):e.impl.selector.clearSelection()}else if("hide"==i.command){var n=e.impl.hitTestViewport(new THREE.Vector3(0,0,0))
n&&e.hide(n.dbId)}else if("fly"==i.command)d=d?null:r.target.clone().sub(r.position).normalize()
else if("savepoint"==i.command){var i=s.getState(v)
g.push(i),alertify.success("Savepoint created.")}else"nextsavepoint"==i.command&&g.length&&(f>=g.length&&(f=0),s.restoreState(g[f++]))}var r,s,a=new THREE.Vector2,l=new THREE.Vector2,c=0,d=null,u=e,h=.02,p=.002,m=1,g=[],f=0,v={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},E=function(){if(!e.impl.model.is2d()){var t=e.impl.model.getData().bbox.size(),i=t.length()
h*=i,p*=i,e.removeEventListener(Autodesk.Viewing.PROGRESS_UPDATE_EVENT,E)}}
e.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,E),this.getNames=function(){return["joystick"]},this.getName=function(){return"joystick"},this.activate=function(e){if(t.addEventListener("joystick",o),i.addEventListener("joystick",o),r=u.navigation.getCamera(),u.model){var a=u.model.getBoundingBox()
m=.001*a.size().length(),s=new n.ViewerState(u)}},this.deactivate=function(e){t.removeEventListener("joystick",o),i.removeEventListener("joystick",o),r=null,s=null,g.length=0},this.update=function(t){if(r.isPerspective||e.navigation.toPerspective(),d){var i=d.clone().multiplyScalar(p)
r.position.add(i),r.target.add(i)}if(0!=c){var n=e.getExplodeScale()+.01*c
n>1&&(n=1),n<0&&(n=0),e.explode(n)}if(0==a.x&&0==a.y&&0==l.x&&0==l.y)return!(!d&&!c)
var o=r.target.clone().sub(r.position),s=o.length()
o.multiplyScalar(1/s)
var u=o.clone().cross(r.up).normalize(),m=o.clone().multiplyScalar(a.y*h)
r.position.add(m),r.target.add(m)
var g=u.clone().multiplyScalar(a.x*h)
r.position.add(g),r.target.add(g)
var f=new THREE.Quaternion
f.setFromAxisAngle(u,.05*l.y)
var v=o.clone().applyQuaternion(f)
r.up.applyQuaternion(f)
var E=new THREE.Quaternion
return E.setFromAxisAngle(r.worldup,.05*-l.x),v.applyQuaternion(E),r.up.applyQuaternion(E),v.multiplyScalar(s),r.target.copy(r.position).add(v),d&&d.copy(r.target).sub(r.position).normalize(),!0},this.handleSingleClick=function(e,t){return!1},this.handleDoubleClick=function(e,t){return!1},this.handleSingleTap=function(e){return!1},this.handleDoubleTap=function(e,t){return!1},this.handleKeyDown=function(e,t){return!1},this.handleKeyUp=function(e,t){return!1},this.handleWheelInput=function(e){return!1},this.handleButtonDown=function(e,t){return!1},this.handleButtonUp=function(e,t){return!1},this.handleMouseMove=function(e){return!1},this.handleGesture=function(e,t){return!1},this.handleTouchChange=function(e,t){return!1},this.handleBlur=function(e){return!1},this.handleResize=function(){}}var t=Autodesk.Viewing,i=t.Extensions,n=t.Private,o=t.UI
n.Collaboration
i.RemoteControl=function(i,o){t.Extension.call(this,i,o),this.viewer=i,this.client=n.MessageClient.GetInstance(),this.p2p=new n.P2PClient(this.client),this.controllerTool=new e(i,this.client,this.p2p),i.toolController.registerTool(this.controllerTool)},i.RemoteControl.prototype=Object.create(t.Extension.prototype),i.RemoteControl.prototype.constructor=i.RemoteControl,i.RemoteControl.prototype.createUI=function(){var e=this,t=this.viewer
this.controlButton=new o.Button("toolbar-remoteControlTool"),this.controlButton.setToolTip("Pair with controller device"),this.controlButton.onClick=function(){this.getState()===o.Button.State.INACTIVE?(e.connect(),this.setState(o.Button.State.ACTIVE)):(e.disconnect(),this.setState(o.Button.State.INACTIVE))},this.controlButton.setIcon("adsk-icon-game-controller"),t.modelTools.addControl(this.controlButton),this.panel=new Autodesk.Viewing.UI.DockingPanel(t.container,"remote-panel","Remote Control"),this.panel.width=300,this.panel.height=375,this.panel.container.style.width=this.panel.width+"px",this.panel.container.style.height=this.panel.height+"px",this.panel.container.style.top=(window.innerHeight-this.panel.height)/2+"px",this.panel.container.style.left=(window.innerWidth-this.panel.width)/2+"px",this.panel.body=document.createElement("div"),this.panel.body.classList.add("body"),this.panel.container.appendChild(this.panel.body)
var i=Autodesk.Viewing.i18n.translate("Go to this link"),n=Autodesk.Viewing.i18n.translate("Scan the QR code with your device"),r=Autodesk.Viewing.i18n.translate("or")
this.panel.body.innerHTML=['<p data-i18n="'+i+'">'+i+"</p>",'<p><a class="url" target="_blank" href="#">Link</a></p>','<p data-i18n="'+r+'">'+r+"</p>",'<p data-i18n="'+n+'">'+n+"</p>",'<img class="qr-img" src="">'].join("\n"),this.panel.link=this.panel.container.querySelector(".url"),this.panel.code=this.panel.container.querySelector(".code"),this.panel.qrImg=this.panel.container.querySelector(".qr-img")},i.RemoteControl.prototype.load=function(){function e(n){t.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e),i.createUI()}var t=this.viewer,i=this
return t.modelTools&&t.modelTools.getNumberOfControls()>0?i.createUI():t.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,e),!0},i.RemoteControl.prototype.unload=function(){var e=this.viewer
if(this.p2p.hangup(),this.client.disconnect(),e.toolController.deactivateTool(this.controllerTool.getName()),this.panel&&(this.panel.setVisible(!1),this.panel=null),this.controlButton)try{e.modelTools.removeControl(this.controlButton),this.controlButton=null}catch(e){n.logger.error("RemoteControlReceiver - Failed to remove controlButton"),this.controlButton=null}return!0},i.RemoteControl.prototype.addCrosshair=function(){this.crosshair=n.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>'),this.viewer.canvasWrap.appendChild(this.crosshair)},i.RemoteControl.prototype.removeCrosshair=function(){this.crosshair&&this.crosshair.remove()},i.RemoteControl.prototype.connect=function(e){if(this.client.isConnected())return void console.log("RemoteControl already connected")
var t=this
n.loadDependency("lmv_io","socket.io-1.3.5.js",function(){t.connectAux(e)})},i.RemoteControl.prototype.connectAux=function(e){var t=this,i=this.viewer
t.client.addEventListener("connectSucceeded",function(i){function o(){l&&l.setVisible(!1),t.p2p.removeEventListener("dataChannelAdded",o),t.addCrosshair()}n.logger.log("connect succeeded")
var r=i.data.id+"rc"
t.client.join(r)
var s=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html?sessionId="+r+"&env="+n.env,a="http://chart.googleapis.com/chart?cht=qr&chs=200x200&choe=UTF-8&chld=H|0&chl="+escape(s),l=t.panel
l&&(l.link.href=s,l.link.innerHTML=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html",l.qrImg.src=a,l.setVisible(!0)),t.p2p.addEventListener("dataChannelAdded",o),e&&e instanceof Function&&e(s)}),i.navigation.toPerspective(),t.client.connect(),i.toolController.activateTool(t.controllerTool.getName())},i.RemoteControl.prototype.disconnect=function(){this.p2p.hangup(),this.client.disconnect(),this.viewer.toolController.deactivateTool(this.controllerTool.getName()),this.removeCrosshair()},t.theExtensionManager.registerExtension("Autodesk.Viewing.RemoteControl",i.RemoteControl)}(),function(){AutodeskNamespace("Autodesk.Viewing.Extensions.GamepadModule"),Autodesk.Viewing.Extensions.GamepadModule=function(e){function t(){for(var e in P)if(P.hasOwnProperty(e)&&o.buttons[e].pressed&&.5!=o.buttons[e].value)return b[e]=!0,!0
for(var e in b)if(b.hasOwnProperty(e)&&b[e])return!0
return!(Math.abs(o.axes[R.LEFT_STICK_X])<A&&Math.abs(o.axes[R.LEFT_STICK_Y])<A&&Math.abs(o.axes[R.RIGHT_STICK_X])<A&&Math.abs(o.axes[R.RIGHT_STICK_Y])<A)}function i(){for(var e in S)S.hasOwnProperty(e)&&n(S[e])}function n(e){if(o.buttons[e].value>A)switch(b[e]=!0,e){case S.LEFT_SHOULDER:case S.RIGHT_SHOULDER:P[e]()
break
case S.LEFT_TRIGGER:P[e](o.buttons[S.LEFT_TRIGGER].value)
break
case S.RIGHT_TRIGGER:P[e](o.buttons[S.RIGHT_TRIGGER].value)}else if(b[e])switch(b[e]=!1,e){case S.SOUTH_BTN:case S.EAST_BTN:case S.WEST_BTN:case S.NORTH_BTN:case S.NORTH_DPAD:case S.SOUTH_DPAD:case S.WEST_DPAD:case S.EAST_DPAD:case S.RIGHT_STICK_BUTTON:case S.LEFT_STICK_BUTTON:P[e]()
break
case S.LEFT_TRIGGER:P[e](o.buttons[S.LEFT_TRIGGER].value)
break
case S.RIGHT_TRIGGER:P[e](o.buttons[S.RIGHT_TRIGGER].value)}}var o,r,s,a,l,c,d,u,h,p,m=Autodesk.Viewing.Private,g=e.navigation,f=e.container,v=g.getCamera(),E=1,y=0,A=.1,T=6,b={},w=new THREE.Clock(!0),C={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},S={SOUTH_BTN:0,EAST_BTN:1,WEST_BTN:2,NORTH_BTN:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SOUTH_DPAD:13,EAST_DPAD:15,WEST_DPAD:14,NORTH_DPAD:12,LEFT_STICK_BUTTON:10,RIGHT_STICK_BUTTON:11},R={LEFT_STICK_X:0,LEFT_STICK_Y:1,RIGHT_STICK_X:2,RIGHT_STICK_Y:3},x=function(){},P={}
for(var k in S)S.hasOwnProperty(k)&&(P[S[k]]=x)
this.activate=function(t){var i=e.model.getBoundingBox().size()
E=Math.max(Math.min(Math.min(i.x,i.y),i.z)/10,1e-4),o=navigator.getGamepads()[0],a=new Autodesk.Viewing.Private.ViewerState(e),l=[],c=0,p=t,L(t)},this.deactivate=function(){p=null,a=null},this.update=function(e,n){if(n&&(v=n),e=w.getDelta(),o=navigator.getGamepads()[0],r>-1){(new Date).getTime()-r>s&&V()}if(o&&(u=2*e*E*T,v.isPerspective||g.toPerspective(),o&&t())){v.dirty=!0,d&&(h=v.position.z)
var a=v.target.clone().sub(v.position),l=a.length()
a.multiplyScalar(1/l)
var c=a.clone().cross(v.up).normalize()
if(Math.abs(o.axes[R.LEFT_STICK_Y])>A){var p=a.clone().multiplyScalar(-o.axes[R.LEFT_STICK_Y]*u)
v.position.add(p),v.target.add(p)}if(Math.abs(o.axes[R.LEFT_STICK_X])>A){var m=c.clone().multiplyScalar(o.axes[R.LEFT_STICK_X]*u)
v.position.add(m),v.target.add(m)}var f=new THREE.Quaternion,y=a
if(Math.abs(o.axes[R.RIGHT_STICK_Y])>A){var b=v.clone(),C=a.clone()
f.setFromAxisAngle(c,-o.axes[R.RIGHT_STICK_Y]*u/2),C.applyQuaternion(f),b.up.applyQuaternion(f)
var S=b.worldup.clone(),x=C.angleTo(S),P=THREE.Math.degToRad(5)
x>=P&&x<=Math.PI-P&&(y=a.clone().applyQuaternion(f),v.up.applyQuaternion(f))}var k=new THREE.Quaternion
Math.abs(o.axes[R.RIGHT_STICK_X])>A&&(k.setFromAxisAngle(v.worldup,-o.axes[R.RIGHT_STICK_X]*u/2),y.applyQuaternion(k),v.up.applyQuaternion(k)),i(),d&&(v.position.z=h),y.multiplyScalar(l),v.target.copy(v.position).add(y)}return v}
var M=function(e,t,i,n,o){Autodesk.Viewing.Private.HudMessage.displayMessage(f,e,i,n,o),t>0?(r=(new Date).getTime(),s=t):(r=-1,s=0)},V=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),r=-1},I=function(e){V()
var t
switch(e){case"up":t=d?"Vertical Lock Mode":"Fly mode"}M({msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:t},2e3)},L=function(e){switch(e){case"headtracker":P[S.SOUTH_BTN]=U,P[S.SOUTH_DPAD]=D,P[S.NORTH_DPAD]=q,P[S.WEST_BTN]=Y,P[S.LEFT_SHOULDER]=N,P[S.RIGHT_SHOULDER]=_,P[S.LEFT_TRIGGER]=O,P[S.RIGHT_TRIGGER]=B,P[S.RIGHT_STICK_BUTTON]=W,P[S.LEFT_STICK_BUTTON]=j
break
default:P[S.SOUTH_BTN]=U,P[S.EAST_BTN]=F,P[S.WEST_BTN]=Y,P[S.NORTH_BTN]=X,P[S.SOUTH_DPAD]=D,P[S.WEST_DPAD]=G,P[S.EAST_DPAD]=z,P[S.NORTH_DPAD]=q,P[S.LEFT_SHOULDER]=N,P[S.RIGHT_SHOULDER]=_,P[S.LEFT_TRIGGER]=H,P[S.RIGHT_TRIGGER]=B,P[S.RIGHT_STICK_BUTTON]=W,P[S.LEFT_STICK_BUTTON]=j}},D=function(){e.navigation.setRequestHomeView(!0),e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},N=function(){d?h+=-o.buttons[S.LEFT_SHOULDER].pressed*u:v.translateY(-o.buttons[S.LEFT_SHOULDER].pressed*u)},_=function(){d?h+=o.buttons[S.RIGHT_SHOULDER].pressed*u:v.translateY(o.buttons[S.RIGHT_SHOULDER].pressed*u)},O=function(t){if(t>A){if(.5==t)return void e.explode(0)
y=t
var i=y
i>1&&(i=1),i<0&&(i=0),e.explode(i)}else e.explode(0)},H=function(e){if(e>A){if(.5==e)return v.fov=75,void(b[S.LEFT_TRIGGER]=!1)
v.fov=-45*e+75}else v.fov=75},B=function(e){if(e>A){if(.5==e)return void(b[S.RIGHT_TRIGGER]=!1)
T=-5.5*e+6}else T=6},F=function(){var e=a.getState(C)
l.push(e),m.logger.log("Savepoint created.")},G=function(){l.length&&(c--,c<0&&(c=l.length-1),a.restoreState(l[c]))},z=function(){l.length&&(c++,c>=l.length&&(c=0),a.restoreState(l[c]))},U=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0))
"headtracker"==p&&v.updateMatrixWorld(),t?e.impl.selector.toggleSelection(t.dbId,t.model):e.impl.selector.clearSelection()},W=function(){e.impl.selector.clearSelection()},j=function(){e.showAll(),e.impl.selector.clearSelection(),e.explode(0)},Y=function(){var t=e.impl.hitTestViewport(new THREE.Vector3(0,0,0),!1)
t&&(t.dbId in e.getHiddenNodes()?e.show(t.dbId):e.hide(t.dbId))},X=function(){e.getPropertyPanel(!0).setVisible(!e.getPropertyPanel(!0).isVisible())},q=function(){d=!d,d&&(h=v.position.z),I("up")}}}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.SectionExtension=function(e,t){Autodesk.Viewing.Extension.call(this,e,t),this.viewer=e},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionExtension,Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.load=function(){var e=this,t=this.viewer
if(this.tool=new Autodesk.Viewing.Extensions.Section.SectionTool(t),t.toolController.registerTool(this.tool),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],t.getToolbar){t.getToolbar(!0)?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),t.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded))}this.onResetBinded=this.onReset.bind(this),t.addEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.HOTKEYS_ID="Autodesk.Section.Hotkeys"
var i=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return e.enableSectionTool(!1)}}]
return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,i),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.unload=function(){var e=this.viewer
return Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.destroyUI(),e.removeEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.onResetBinded=null,this.onToolbarCreatedBinded&&(e.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),e.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.isActive=function(){return this.tool.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.toggle=function(){if(this.isActive())this.enableSectionTool(!1)
else{var e=this.sectionStyle||"X"
this.setSectionStyle(e,!0)}return this.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.getSectionStyle=function(){return this.sectionStyle},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.setSectionStyle=function(e,t){if(-1===this.supportedStyles.indexOf(e))return!1
var i=this.isActive(),n=this.sectionStyle!==e||!t
return this.sectionStyle=e,i&&n?this.tool.setSection(e):i||(this.enableSectionTool(!0),n?this.tool.setSection(e):this.tool.attachControl(!0)),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.enableSectionTool=function(e){var t=this.viewer.toolController,i=this.tool.isActive()
return e&&!i?(t.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(e||!i)&&(t.deactivateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onToolbarCreated=function(){this.onToolbarCreatedBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.createUI()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onReset=function(){this.tool.resetSection()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createUI=function(){var e=this.viewer,t=Autodesk.Viewing.UI
this.sectionToolButton=new t.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton)
var i=e.getToolbar(!1),n=i.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID)
if(n){var o=n.getControl("toolbar-resetTool")
o?n.addControl(this.sectionToolButton,{index:n.indexOf(o.getId())}):n.addControl(this.sectionToolButton,{index:0})}},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createSubmenu=function(e){function t(e,t){return function(){var i=e.getState(),o=function(){n.enableSectionTool(!0),e instanceof r.ComboButton==!1?n.tool.setSection(t):n.tool.attachControl(!0)}
i===r.Button.State.INACTIVE?(e.setState(r.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(o,1):o()):i===r.Button.State.ACTIVE&&(e.setState(r.Button.State.INACTIVE),n.enableSectionTool(!1)),n.sectionStyle=t}}function i(){var e=function(){var e=new THREE.Vector3
return function(t,i,n){return e.subVectors(t,i),e.lengthSq()<n}}(),t=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),a=o.autocam.getWorldRightVector(),l=o.autocam.getWorldUpVector(),c=o.autocam.getWorldFrontVector()
e(l,t,1e-4)?n.sectionYButton.setIcon("adsk-icon-plane-x"):e(l,s,1e-4)?n.sectionYButton.setIcon("adsk-icon-plane-z"):n.sectionYButton.setIcon("adsk-icon-plane-y"),e(a,r,1e-4)?n.sectionXButton.setIcon("adsk-icon-plane-y"):e(a,s,1e-4)?n.sectionXButton.setIcon("adsk-icon-plane-z"):n.sectionXButton.setIcon("adsk-icon-plane-x"),e(c,t,1e-4)?n.sectionZButton.setIcon("adsk-icon-plane-x"):e(c,r,1e-4)?n.sectionZButton.setIcon("adsk-icon-plane-y"):n.sectionZButton.setIcon("adsk-icon-plane-z"),o.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,i)}var n=this,o=this.viewer,r=Autodesk.Viewing.UI,s=this.sectionXButton=new r.Button("toolbar-sectionTool-x")
s.setToolTip("Add X plane"),s.setIcon("adsk-icon-plane-x"),s.onClick=t(s,"X"),e.addControl(s)
var a=this.sectionYButton=new r.Button("toolbar-sectionTool-y")
a.setToolTip("Add Y plane"),a.setIcon("adsk-icon-plane-y"),a.onClick=t(a,"Y"),e.addControl(a)
var l=this.sectionZButton=new r.Button("toolbar-sectionTool-z")
l.setToolTip("Add Z plane"),l.setIcon("adsk-icon-plane-z"),l.onClick=t(l,"Z"),e.addControl(l)
var c=this.sectionBoxButton=new r.Button("toolbar-sectionTool-box")
c.setToolTip("Add box"),c.setIcon("adsk-icon-box"),c.onClick=t(c,"BOX"),e.addControl(c),o.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,i)},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.destroyUI=function(){var e=this.viewer,t=e.getToolbar(!1)
if(t){var i=t.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID)
if(i&&this.sectionToolButton){var n=i.getControl("toolbar-inspectSubMenu")
n?n.removeControl(this.sectionToolButton.getId()):i.removeControl(this.sectionToolButton.getId()),this.sectionToolButton=null}}},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",Autodesk.Viewing.Extensions.Section.SectionExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.tintColor={r:1,g:1,b:0},Autodesk.Viewing.Extensions.Section.tintIntensity=.2,Autodesk.Viewing.Extensions.Section.SectionTool=function(e){function t(){I||(y=new THREE.TransformControls(T.camera,T.canvas,"transrotate"),y.addEventListener("change",n),y.setSnap(Math.PI/2,Math.PI/36),A=new THREE.TransformControls(T.camera,T.canvas,"translate"),A.addEventListener("change",n),void 0===T.overlayScenes[M]&&T.createOverlayScene(M),T.addOverlay(M,y),T.addOverlay(M,A),e.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,o),e.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,r),e.addEventListener(Autodesk.Viewing.HIDE_EVENT,r),e.addEventListener(Autodesk.Viewing.SHOW_EVENT,r),e.addEventListener(Autodesk.Viewing.FRAGMENTS_LOADED_EVENT,c),I=!0)}function i(){I&&(T.removeOverlay(M,y),y.removeEventListener("change",n),y=null,T.removeOverlay(M,A),A.removeEventListener("change",n),A=null,T.removeOverlayScene(M),e.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,o),e.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,r),e.removeEventListener(Autodesk.Viewing.HIDE_EVENT,r),e.removeEventListener(Autodesk.Viewing.SHOW_EVENT,r),e.removeEventListener(Autodesk.Viewing.FRAGMENTS_LOADED_EVENT,c),I=!1)}function n(){T.invalidate(!1,!1,!0)}function o(){y&&y.update(),A&&A.update()}function r(){w&&1===x.length&&(u(!0),o(),l((new THREE.Plane).setComponents(x[0].x,x[0].y,x[0].z,x[0].w)))}function s(e){return e&&e.color||new THREE.Color(16777215)}function a(e,t){function i(e){g&&clearTimeout(g),g=0,l=e,f.length=0,v.length=0,u=null,E.length=0,h=-1,p=0,m=0}function n(){g=0
for(var o=performance.now()+e;performance.now()<o;){if(!s())return T.invalidate(!0,!0),void i(null)
var r=f[p]
0==m&&d&&delete d.dbIds[r],a(v[m],r,c,m+1>=v.length,!l||h>=l.length)}g=setTimeout(n,t)}function o(){if(l&&h<l.length)for(;++h<l.length;)if((u=l[h].getFragmentMap())&&(f.length=0,u.enumNodeChildren(l[h].getRootId(),function(e){f.push(e)},!0),f.length>0))return c=l[h],d=E.find(function(e){return e.model===c}),c
for(var e=0;e<E.length;++e)if(c=E[e].model,u=c.getFragmentMap()){f.length=0
var t
for(t in E[e].dbIds){var i=Number(t)
isFinite(i)&&f.push(i)}if(f.length>0)return E.splice(0,e+1),d=null,!0}return c=null,d=null,E.length=0,!1}function r(){if(p>=f.length)return!1
for(;++p<f.length;){var e=f[p]
if(!u.isNodeHidden(e)&&!u.isNodeOff(e)&&(v.length=0,u.enumNodeFragments(e,function(e){v.push(e)},!1),v.length>0))return!0}return!1}function s(){if(++m<v.length)return!0
for(m=0;;){if(r())return!0
if(!o())return!1
p=-1}}var a,l,c,d,u,h,p,m,g=0,f=[],v=[],E=[]
e=e||15,t=t||0,this.start=function(e,t,o){i(e),a=o,o&&(t>=0?g=setTimeout(n,t):n())},this.loadedDbIds=function(e,i){if(a&&e&&i&&!(i.length<=0)){var o=E.find(function(t){return t.model===e})
o||(o={model:e,dbIds:{}},E.push(o),e===c&&(d=o))
var r=e.getFragmentList()
i.forEach(function(e){var t=0|r.getDbIds(e)
o.dbIds[t]=!0}),0==g&&(g=setTimeout(n,t))}}}function l(e){function t(e,t,i,n){var o=e.children.find(function(e){return e.modelId==t&&e.dbId==i})
o&&(e.remove(o),o.geometry&&o.geometry.dispose(),n&&o.material&&o.material.dispose())}init_three_triangulator(),init_three_intersector()
var i=T.sceneAfter.getObjectByName("section")
i&&T.sceneAfter.remove(i)
var n=new THREE.Object3D
n.name="section",T.sceneAfter.add(n)
var o=new THREE.Object3D
n.add(o)
var r=new THREE.Object3D
n.add(r)
var a=Autodesk.Viewing.Private,l=a.Intersector.makePlaneBasis(e),c=(new THREE.Matrix4).getInverse(l),d=T.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0},!1,!1),u=T.matman().findMaterial(null,d)
u.transparent=!0,u.depthTest=!0,u.polygonOffset=!0,u.polygonOffsetFactor=-1,u.polygonOffsetUnits=.1
var h,p=new THREE.Box3,m=T.modelQueue().getModels(),g=[]
_.start(m,50,function(i,n,d,m,f){var v=d.getFragmentList()
if(v.getWorldBounds(i,p),a.Intersector.intersectBoxPlane(e,p)){var E=v.getVizmesh(i)
E.geometry&&!E.geometry.is2d&&!E.geometry.isLines&&E.material.cutplanes&&(h=E.material,a.Intersector.intersectMeshPlane(e,E,g))}if(m){if(g.length){var y=new THREE.Box3
a.Intersector.convertToPlaneCoords(l,g,y)
var A=new a.VertexBufferBuilder(!1,8*g.length),b=s(h),w=0|.25*b.r*255.5,C=0|.25*b.g*255.5,S=0|.25*b.b*255.5,R=4278190080|S<<16|C<<8|w,x=new a.Triangulator.ContourSet(g,y)
x.snapEdges(),x.sanitizeEdges(),x.stitchContours()
var P
for(P=0;P<x.contours.length;P++){var k=x.contours[P]
w=0|255.5*Math.random(),C=0|255.5*Math.random(),S=0|255.5*Math.random()
for(var M=1;M<k.length;M++){var V=x.pts[k[M-1]],I=x.pts[k[M]]
A.addSegment(V.x,V.y,I.x,I.y,0,.02,R,n,0)}}var L={mesh:A.toMesh()}
a.BufferGeometryUtils.meshToGeometry(L)
var D=L.geometry
D.streamingDraw=!0,D.streamingIndex=!0,f&&t(r,d.id,n,!1)
var N=new THREE.Mesh(D,u)
N.matrix.copy(c),N.matrixAutoUpdate=!1,N.frustumCulled=!1,N.modelId=d.id,N.dbId=n,r.add(N)
var _=new a.Triangulator.TriangulatedSurface(x)
if(_.indices.length){var O=new THREE.BufferGeometry,H=new Float32Array(3*_.pts.length)
for(P=0;P<_.pts.length;P++)H[3*P]=_.pts[P].x,H[3*P+1]=_.pts[P].y,H[3*P+2]=0
O.addAttribute("position",new THREE.BufferAttribute(H,3))
var B=h.packedNormals,F=B?new Uint16Array(2*_.pts.length):new Float32Array(3*_.pts.length)
for(P=0;P<_.pts.length;P++)if(B){var G=.5*(0/Math.PI+1)
F[2*P]=65535*G|0,F[2*P+1]=65535}else F[3*P]=0,F[3*P+1]=0,F[3*P+2]=1
O.addAttribute("normal",new THREE.BufferAttribute(F,B?2:3)),B&&(O.attributes.normal.bytesPerItem=2,O.attributes.normal.normalize=!0)
var z=new Uint16Array(_.indices.length)
z.set(_.indices),O.addAttribute("index",new THREE.BufferAttribute(z,1)),O.streamingDraw=!0,O.streamingIndex=!0
var U=T.matman().cloneMaterial(h)
U.packedNormals=B,U.cutplanes=null,U.side=THREE.FrontSide,U.depthTest=!0,U.map=null,U.bumpMap=null,U.normalMap=null,U.alphaMap=null,U.specularMap=null,U.transparent=!1,U.depthWrite=!0,U.hatchPattern=!0,U.needsUpdate=!0
var W=(h.id+2)*Math.PI*.125,j=Math.tan(W)
U.hatchParams=new THREE.Vector2(j,10),U.hatchTintColor=Autodesk.Viewing.Extensions.Section.tintColor,U.hatchTintIntensity=Autodesk.Viewing.Extensions.Section.tintIntensity,null!=U.prismType&&(U.defines={},U.defines[U.prismType.toUpperCase()]="","PrismWood"==U.prismType&&(U.defines.NO_UVW="")),f&&t(o,d.id,n,!0)
var Y=new THREE.Mesh(O,U)
Y.matrix.copy(c),Y.matrixAutoUpdate=!1,Y.modelId=d.id,Y.dbId=n,Y.fragId=g.fragId,o.add(Y)}}g.length=0}})}function c(e){w&&1===x.length&&_.loadedDbIds(e.model,e.getFragIds())}function d(e,t){var i,n,o=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),e.normal)
if(t){var r=e.projectPoint(t.max),s=e.projectPoint(t.min),a=o.clone().inverse()
r.applyQuaternion(a),s.applyQuaternion(a),n=(new THREE.Vector3).subVectors(r,s),i=new THREE.PlaneBufferGeometry(n.x,n.y)}else t=T.getVisibleBounds(),n=2*t.getBoundingSphere().radius,i=new THREE.PlaneBufferGeometry(n,n)
var l=new THREE.MeshBasicMaterial({opacity:0,color:16777215,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),c=new N.SectionMesh(i,l,e),d=e.projectPoint(t.center())
c.position.copy(d),c.quaternion.multiply(o)
for(var u=Autodesk.Viewing.Private.LightPresets[T.currentLightPreset()].bgColorGradient,h="rgb("+(255-u[0])+","+(255-u[1])+","+(255-u[2])+")",p=new THREE.LineBasicMaterial({color:h,linewidth:1,depthTest:!1}),m=c.geometry.getAttribute("position"),g=0;g<D.length;g++){i=new THREE.Geometry,i.vertices.push((new THREE.Vector3).fromArray(m.array,D[g][0]*m.itemSize),(new THREE.Vector3).fromArray(m.array,D[g][1]*m.itemSize))
var f=new THREE.Line(i,p)
c.add(f),c.outlines.push(f)}return c}function u(e){h(function(t){if(t instanceof N.SectionMesh){var i,n,o,r
if(t.connectivity.length>0){var s=(new THREE.Matrix4).getInverse(t.matrixWorld)
for(r=new THREE.Vector3,o=t.geometry.getAttribute("position"),i=0;i<o.length/o.itemSize;i++){var a=t.connectivity[i]
null!==O(t.plane,a[0],a[1],r)&&(r.applyMatrix4(s),o.setXYZ(i,r.x,r.y,r.z))}for(o.needsUpdate=!0,t.geometry.computeBoundingBox(),t.geometry.computeBoundingSphere(),i=0;i<t.outlines.length;i++)n=t.outlines[i],n.geometry.vertices[0].fromArray(o.array,D[i][0]*o.itemSize),n.geometry.vertices[1].fromArray(o.array,D[i][1]*o.itemSize),n.geometry.verticesNeedUpdate=!0}else if(e){var l=T.getVisibleBounds(),c=2*l.getBoundingSphere().radius
for(r=t.plane.projectPoint(l.center()),t.geometry=new THREE.PlaneBufferGeometry(c,c),t.position.copy(r),o=t.geometry.getAttribute("position"),i=0;i<t.outlines.length;i++)n=t.outlines[i],n.geometry.vertices[0].fromArray(o.array,D[i][0]*o.itemSize),n.geometry.vertices[1].fromArray(o.array,D[i][1]*o.itemSize),n.geometry.verticesNeedUpdate=!0}}})}function h(e){for(var t=0;t<R.length;t++)R[t].traverse(e)}function p(){h(function(e){e instanceof N.SectionMesh&&e.update()}),1===x.length&&l((new THREE.Plane).setComponents(x[0].x,x[0].y,x[0].z,x[0].w)),T.setCutPlanes(x)}function m(e){for(var t=0;t<R.length;t++)R[t].visible=e
S!==e&&n(),S=e}function g(t){t&&x.length>0&&(1===x.length&&l((new THREE.Plane).setComponents(x[0].x,x[0].y,x[0].z,x[0].w)),e.setCutPlanes(x)),m(t)}function f(e,t){e.attach(t),e.setPosition(t.position),e.visible=!0}function v(e){T.api.navigation.getEyeVector().dot(e)>0&&e.negate()
var t=new THREE.Group,i=new THREE.Plane(e,0),n=d(i,null)
t.add(n),x.push(n.planeVec),R.push(t),T.addOverlay(M,t),f(y,n),y.showRotationGizmos(!0),P=y.getPicker(),p()}function E(){var e,t,i=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],n=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],o=new THREE.Group,r=T.getVisibleBounds(),s=r.center(),a=new THREE.Box3(r.min,s),l=[],c=[]
for(e=0;e<i.length;e++){var u=new THREE.Plane(i[e],-1*s.dot(i[e]))
if(l.push(u),e>2){var h=u.orthoPoint(a.max),m=u.orthoPoint(a.min),g=(new THREE.Vector3).subVectors(h,m)
u.constant-=g.length()}t=d(u,a),o.add(t),c.push(t),x.push(t.planeVec)}for(e=0;e<c.length;e++){t=c[e]
for(var v=n[e],E=0;E<v.length;E++){for(var b=[],w=v[E],C=0;C<w.length;C++)b.push(l[w[C]])
t.connectivity.push(b)}}R.push(o),T.addOverlay(M,o),f(y,R[0].children[0]),f(A,R[0]),y.showRotationGizmos(!1),P=y.getPicker().concat(A.getPicker()),p()}var y,A,T=e.impl,b=["section"],w=!1,C=!1,S=!0,R=[],x=[],P=[],k="",M="gizmo",V=null,I=!1,L=!0,D=[[0,1],[1,3],[3,2],[2,0]],N=Autodesk.Viewing.Extensions.Section
init_TransformGizmos(),init_SectionMesh()
var _=new a,O=function(){var e=new THREE.Matrix3,t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3
return function(o,r,s,a){e.set(o.normal.x,o.normal.y,o.normal.z,r.normal.x,r.normal.y,r.normal.z,s.normal.x,s.normal.y,s.normal.z)
var l=e.determinant()
return 0===l?null:(t.crossVectors(r.normal,s.normal).multiplyScalar(-o.constant),i.crossVectors(s.normal,o.normal).multiplyScalar(-r.constant),n.crossVectors(o.normal,r.normal).multiplyScalar(-s.constant),(a||new THREE.Vector3).copy(t).add(i).add(n).divideScalar(l))}}(),H=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Raycaster,n=T.camera
return function(o,r,s){var a=T.canvas.getBoundingClientRect(),l=(o.clientX-a.left)/a.width*2-1,c=-(o.clientY-a.top)/a.height*2+1
n.isPerspective?(e.set(l,c,.5),e.unproject(n),i.set(n.position,e.sub(n.position).normalize())):(e.set(l,c,-1),e.unproject(n),t.set(0,0,-1),i.set(e,t.transformDirection(n.matrixWorld)))
var d=i.intersectObjects(r,s)
return d[0]?d[0]:null}}()
this.isActive=function(){return w},this.setSection=function(e){this.clearSection()
var t
switch(e){case"X":t=new THREE.Vector3(1,0,0),v(t)
break
case"Y":t=new THREE.Vector3(0,1,0),v(t)
break
case"Z":t=new THREE.Vector3(0,0,1),v(t)
break
case"BOX":E()}k=e},this.clearSection=function(){for(y&&y.detach(),A&&A.detach();x.length>0;)x.pop()
for(;R.length>0;){var e=R.pop()
T.removeOverlay(M,e)}_.start(null)
var t=T.sceneAfter.getObjectByName("section")
t&&T.sceneAfter.remove(t),T.setCutPlanes()},this.isPlaneOn=function(){return S},this.showPlane=function(e){m(e)},this.attachControl=function(e){e?(f(y,R[0].children[0]),y.highlight(),"BOX"===k&&f(A,R[0])):(y.detach(),A.detach())},this.resetSection=function(){this.setSection(k)},this.getNames=function(){return b},this.getName=function(){return b[0]},this.register=function(){},this.deregister=function(){this.clearSection(),i()},this.activate=function(){t(),w=!0,C=!1,L=!0,x=x||[],g(!0)},this.deactivate=function(){w=!1,C=!1,_.start(null)
var e=T.sceneAfter.getObjectByName("section")
e&&T.sceneAfter.remove(e),g(!1),T.setCutPlanes(),y.detach(),A.detach()},this.update=function(){return!1},this.handleSingleClick=function(e){var t=e.pointers?e.pointers[0]:e,i=H(t,R[0].children)
return i&&(f(y,i.object),y.highlight(),n()),!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(e){return this.handleSingleClick(e,0)},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(e){return C=!0,!!A.onPointerDown(e)||y.onPointerDown(e)},this.handleButtonUp=function(e){return C=!1,!!A.onPointerUp(e)||y.onPointerUp(e)},this.handleMouseMove=function(e){if(C){if(A.onPointerMove(e))return p(),y.update(),!0
if(y.onPointerMove(e))return p(),u(),!0}if("touch"!==e.pointerType){var t=e.pointers?e.pointers[0]:e,i=H(t,R[0].children)
i&&(L=!1)
var n=!!(L||i||H(t,P,!0))
y.visible=n,A.visible=void 0!==A.object&&n,m(n)}return!!A.onPointerHover(e)||y.onPointerHover(e)},this.handleGesture=function(e){switch(e.type){case"dragstart":return V="drag",this.handleButtonDown(e,0)
case"dragmove":return"drag"===V&&this.handleMouseMove(e)
case"dragend":return"drag"===V&&(V=null,this.handleButtonUp(e,0))}return!1},this.handleBlur=function(){return!1},this.handleResize=function(){},this.handlePressHold=function(){return!0}},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim")
var SimulationDef=function(){function e(){var e=this
e.SimulationStudies={LSS:"SimCaseLSS",MODAL:"SimCaseModalFrequencies",BUCKLING:"SimCaseStructuralBuckling",THERMAL:"SimCaseThermalSteady",THERMALSTRESS:"SimCaseThermalStress",SHAPEGENERATOR:"SimCaseTopOpt",NAMES:{UNKNOWN:"Unknown",LSS:"Static Stress",MODAL:"Modal Frequencies",BUCKLING:"Structural Buckling",THERMAL:"Thermal",THERMALSTRESS:"Thermal Stress",SHAPEGENERATOR:"Shape Optimization"}},e.studyNode,e.loadCases={},e.pointMasssesNode=-1,e.pointMassNodes=[],e.connectorsNode=-1,e.connectorNodes=[],e.activeLoadCaseKey=null,e.modelNodes=[],e.analysisType=e.SimulationStudies.LSS,e.modelStructurePanel=null,e.simExt=null,e.simNodes=[]}e.prototype={constructor:e}
var t=e.prototype
return t.studyName=function(){var e=this.SimulationStudies.NAMES.UNKNOWN
return this.analysisType===this.SimulationStudies.LSS?e=this.SimulationStudies.NAMES.LSS:this.analysisType===this.SimulationStudies.MODAL?e=this.SimulationStudies.NAMES.MODAL:this.analysisType===this.SimulationStudies.BUCKLING?e=this.SimulationStudies.NAMES.BUCKLING:this.analysisType===this.SimulationStudies.THERMAL?e=this.SimulationStudies.NAMES.THERMAL:this.analysisType===this.SimulationStudies.THERMALSTRESS?e=this.SimulationStudies.NAMES.THERMALSTRESS:this.analysisType===this.SimulationStudies.SHAPEGENERATOR&&(e=this.SimulationStudies.NAMES.SHAPEGENERATOR),e},t.reset=function(){var e=this
e.studyNode=-1,e.modelNodes=[],e.analysisType=e.SimulationStudies.LSS,e.loadCases={},e.pointMasssesNode=-1,e.pointMassNodes=[],e.connectorsNode=-1,e.connectorNodes=[],e.activeLoadCaseKey=null,e.simNodes=[],e.modelStructurePanel=null},t.addLoadCase=function(e,t,i){var n=this,o=new aves.Fusion360Sim.SimulationLoadCaseDef
return o.loadCase=i,o.loadCaseName=e,n.loadCases["SIM_LOAD_CASE"+t]=o,1===Object.keys(n.loadCases).length&&(n.activeLoadCaseKey="SIM_LOAD_CASE"+t),o},t.shouldDisplayInTree=function(e){var t=this,i=e.dbId
if(t.simNodes.indexOf(i)<0)return!1
if(t.studyNode===i)return!0
if(null===t.activeLoadCaseKey)return!1
if(t.pointMasssesNode===i)return!0
if(-1!==t.pointMassNodes.indexOf(i))return!0
if(-1!==t.connectorNodes.indexOf(i))return!0
if(t.connectorsNode===i)return!0
for(var n=Object.keys(t.loadCases),o=0;o<n.length;o++){var r=t.loadCases[n[o]]
if(r.isImportant(i))return r.shouldDisplayInTree(i)}return!1},e}()
Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef=SimulationDef
var SimulationLoadCaseDef=function(){function e(){var e=this
e.loadCase=-1,e.loadCaseName="",e.constraintsNode=-1,e.constraintNodes=[],e.loadsNode=-1,e.loadNodes=[],e.resultsNode=-1,e.undeformedResults=-1,e.resultTypes={},e.resultGroups={},e.modalResults={}}e.prototype={constructor:e}
var t=e.prototype
return t.associateResult=function(e,t){this.resultTypes[t]=e},t.associateResultGroup=function(e,t){this.resultGroups[t]=e},t.associateModalResult=function(e,t){var i=[]
if(i=this.modalResults[e])i.push(t)
else{var n=[]
n.push(t),i=n}this.modalResults[e]=i},t.isImportant=function(e){var t=this
return t.loadCase===e||(-1!==t.loadNodes.indexOf(e)||(-1!==t.constraintNodes.indexOf(e)||(t.resultsNode===e||(t.constraintsNode===e||t.loadsNode===e))))},t.shouldDisplayInTree=function(e){var t=this
return t.loadCase===e||(-1!==t.loadNodes.indexOf(e)||(-1!==t.constraintNodes.indexOf(e)||t.resultsNode!==e&&(t.constraintsNode===e||t.loadsNode===e)))},t.reset=function(){var e=this
e.constraintsNode=-1,e.constraintNodes=[],e.loadsNode=-1,e.loadNodes=[],e.resultsNode=-1,e.undeformedResults=-1,e.resultTypes={},e.resultGroups={},e.modalResults={}},e}()
Autodesk.Viewing.Extensions.Fusion360Sim.SimulationLoadCaseDef=SimulationLoadCaseDef,AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim")
var av=Autodesk.Viewing,_ave=av.Extension,aves=av.Extensions,avem=av.theExtensionManager,avu=av.UI,i18n=av.i18n,GalleryPanel=function(){function e(e,t){if(e&&t){var i=e.style.cssText.trim()
";"===i.substring(i.length-1)||(i+=";")
var n=[]
for(var o in t)n[n.length]=[o,t[o]].join(":")
n=n.join(";"),e.style.cssText=n}}function t(){var e,t,i,n,o,r,s,a,l,c,d,u,h=this
avu.DockingPanel.prototype.initialize.call(h)
var p=h.container
p.classList.add("propertyPanel","simulation-container","position-"+(h.position||"left")+"-corner"),p.dockRight=!0,n=h.legend=document.createElement("div")
var m=document.createDocumentFragment(),g=document.createElement("div")
g.classList.add("sim-div-Results"),i=h.resultsGroup=document.createElement("select"),i.classList.add("simulation-resultGroup"),g.appendChild(i),o=h.resultTypes=document.createElement("select"),o.classList.add("simulation-resultTypes"),g.appendChild(o),m.appendChild(g)
var f=document.createElement("div")
f.classList.add("sim-div-options"),t=h.optUndeformed=document.createElement("input"),t.classList.add("sim-undeformedOption"),t.setAttribute("type","checkbox"),t.setAttribute("name","optUndeformed"),t.setAttribute("id","Undeformed"),t.addEventListener("change",function(e){var t=h.simDef.loadCases[h.simDef.activeLoadCaseKey]
null!==t&&-1!==t.undeformedResults&&(h.optUndeformed.checked?h.viewer.show(t.undeformedResults):h.viewer.hide(t.undeformedResults))}),t.checked=!1,f.appendChild(t),t.checked=!1,e=h.labelUndeformed=document.createElement("label"),e.classList.add("sim-undeformedOptionText"),e.htmlFor="Undeformed",e.setAttribute("data-i18n","Show Undeformed Model"),e.textContent=i18n.translate("Show Undeformed Model"),f.appendChild(e),m.appendChild(f),r=h.divColorScale=document.createElement("div"),r.classList.add("sim-div-colorscale"),r.classList.add("sim-div-colorscale-top1"),s=h.colorScale=document.createElement("div"),s.classList.add("simulation-colorscale"),r.appendChild(s),a=h.colorScaleTopText=document.createElement("div"),a.classList.add("sim-colorScaleTopText"),a.innerHTML="- 3333",r.appendChild(a),l=h.colorScaleBottomText=document.createElement("div"),l.classList.add("sim-colorScaleBottomText"),l.innerHTML="- 3333",r.appendChild(l),m.appendChild(r),c=h.line2=document.createElement("hr"),c.classList.add("sim-line2"),m.appendChild(c)
var v=document.createElement("div")
v.classList.add("sim-div-Table"),v.addEventListener("click",function(e){v.classList.add("sim-div-Table-Collapse"),p.classList.add("simulation-container-Collapse"),r.classList.add("sim-div-colorscale-Collapse")}),r.addEventListener("click",function(e){v.classList.remove("sim-div-Table-Collapse"),p.classList.remove("simulation-container-Collapse"),r.classList.remove("sim-div-colorscale-Collapse")}),d=h.tbl=document.createElement("table"),u=h.tblBody=document.createElement("tbody"),d.appendChild(u),d.classList.add("sim-table"),v.appendChild(d),m.appendChild(v),n.appendChild(m),p.appendChild(n)}function i(e,t){for(var i=0;i<e.length;++i){var n=e[i]
if(n.displayName===t)return n.displayValue}return null}function n(t,i){var n=!1,o='""'
i<=1&&(n=!0,o="none"),t.disabled=n,e(t,{"-webkit-appearance":o,"-moz-appearance":o,appearance:o})}function o(e,t){var i=this
t=t||{},i.viewer=e,i.simDef=null,avu.DockingPanel.call(i,e.container,"Simulation-Panel","Simulation Results"),i.position=t.position||"right"}o.prototype=Object.create(avu.DockingPanel.prototype)
var r=o.prototype
return r.constructor=o,r.initialize=function(){var e=this
t.call(e),e.resultsGroup.addEventListener("change",function(t){var i=e.simDef,n=i.loadCases[e.simDef.activeLoadCaseKey]
e.viewer.hide(n.resultsNode)
var o="fillResultTypes"
i.modalAnalysis&&(o="fillModalResultTypes"),e[o](i.activeLoadCaseKey,e.resultsGroup.value),setTimeout(function(){e.setSimObjectsVisibility()},100)}),e.resultTypes.addEventListener("change",function(){var t=e.simDef.loadCases[e.simDef.activeLoadCaseKey]
e.viewer.hide(t.resultsNode),e.setSimObjectsVisibility()})},r.setSimulationDef=function(e){function t(e){var t=i(e.properties,"Name")
c.setTitle(t)}function n(e,t,i){}function o(e){var t=i(e.properties,"Elements"),n=i(e.properties,"Nodes")
c.rowElements.cells[1].innerText=t,c.rowNodes.cells[1].innerText=n}var r,s,a,l,c=this
if(c.simDef=e,r=1*e.studyNode,-1===e.undeformedResults&&(c.optUndeformed.classList.add("sim-hide"),c.labelUndeformed.classList.add("sim-hide"),c.divColorScale.classList.remove("sim-div-colorscale-top1"),c.divColorScale.classList.add("sim-div-colorscale-top2")),c.viewer.getProperties(r,t,n),s=i18n.translate(e.studyName()),a=c.tblBody,c.rowType)c.rowType.cells[1].innerHTML=s
else{[{name:"rowType",content:[i18n.translate("Analysis Type"),s]},{name:"rowNodes",content:[i18n.translate("Nodes"),"1872"]},{name:"rowElements",content:[i18n.translate("Elements"),"1084"]},{name:"rowMin",content:[i18n.translate("Min"),"0.000E+02 MPa"]},{name:"rowMax",content:[i18n.translate("Max"),"5.117E+02 MPa"]}].forEach(function(e){c[e.name]=a.insertRow(-1),e.content.forEach(function(t){c[e.name].insertCell(-1).innerHTML=t})})}l=c.viewer,l.model.getObjectTree(function(t){c.instanceTree=t,c.fillResultsGroup(c.simDef.activeLoadCaseKey)
var i=e.analysisType===e.SimulationStudies.MODAL||e.analysisType===e.SimulationStudies.BUCKLING?"fillModalResultTypes":"fillResultTypes"
c[i](c.simDef.activeLoadCaseKey,c.resultsGroup.value),setTimeout(function(){e.simExt.showResultsDlg(!0),e.simExt.applySettings(),c.setSimObjectsVisibility()},500)})
var d=+c.simDef.resultsNode
l.getProperties(d,o,n)},r.processNodes=function(e,t){function n(e,t){function n(n){var o=n.properties,r=i(n.properties,"A1C6011B-E1A6-4ADF-975D-A0003C592F87")
if(r){switch(r){case"SIM_STUDY":a.studyNode=e
var s=i(n.properties,"Study Type")
a.analysisType=s
break
case"SIM_POINT_MASSES":a.pointMasssesNode=e
break
case"SIM_POINT_MASS":a.pointMassNodes.push(e)
break
case"SIM_CONNECTORS":a.connectorsNode=e
break
case"SIM_CONNECTOR":a.connectorNodes.push(e)
break
case"SIM_LOAD_CASE":c=a.addLoadCase(i(n.properties,"Name"),e,e)
break
case"SIM_CONSTRAINTS":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),c.constraintsNode=e
break
case"SIM_CONSTRAINT":c.constraintNodes.push(e)
break
case"SIM_LOADS":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),c.loadsNode=e
break
case"SIM_LOAD":c.loadNodes.push(e)
break
case"SIM_RESULTS_SCALAR_PLOT":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),a.analysisType===a.SimulationStudies.LSS||a.analysisType===a.SimulationStudies.THERMAL||a.analysisType===a.SimulationStudies.THERMALSTRESS||a.analysisType===a.SimulationStudies.SHAPEGENERATOR?c.associateResult(i(o,"Name"),e):c.associateModalResult(i(o,"Name"),e)
break
case"SIM_RESULTS_GROUP":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),a.analysisType!==a.SimulationStudies.LSS&&a.analysisType!==a.SimulationStudies.THERMAL&&a.analysisType!==a.SimulationStudies.THERMALSTRESS&&a.analysisType!==a.SimulationStudies.SHAPEGENERATOR||c.associateResultGroup(i(o,"Name"),e)
break
case"SIM_RESULTS":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),c.resultsNode=e
break
case"SIM_RESULTS_UNDEFORMED_FEATURE_EDGES_PLOT":null==c&&(c=a.addLoadCase(i18n.translate("Load Case:1"),0,0)),c.undeformedResults=e}a.simNodes.push(e)}else a.modelNodes.push(e)
t()}function o(e,i,n){t()}e&&l&&l.getProperties(e,n,o)}function o(){s.length>0?n(s.shift(),o):t(a)}var r=this,s=[],a=r.simDef,l=r.viewer,c=null
a?a.reset():a=new aves.Fusion360Sim.SimulationDef,e.enumNodeChildren(e.getRootId(),function(e){s[s.length]=e},!0),o()},r.initModel=function(e,t){var i=this
i.viewer&&(i.processNodes(e,function(e){e.simExt=t,i.setSimulationDef(e)}),i.addEventListener(i.viewer,av.SELECTION_CHANGED_EVENT,function(e){var t=e.nodeArray
t&&i.handleClick(t[0])}))},r.fillResultsGroup=function(e){var t=this,i=t.simDef,o=i.loadCases[e],r=t.resultsGroup
r.options.length=0
for(var s=Object.keys(i.analysisType===i.SimulationStudies.MODAL||i.analysisType===i.SimulationStudies.BUCKLING?o.modalResults:o.resultGroups),a=0;a<s.length;a++){var l=document.createElement("option")
l.value=s[a]
var c=i.analysisType===i.SimulationStudies.MODAL||i.analysisType===i.SimulationStudies.BUCKLING?s[a]:o.resultGroups[s[a]]
l.setAttribute("data-i18n",c),l.textContent=i18n.translate(c),r.add(l)}n(r,r.options.length,!1)},r.fillResultTypes=function(e,t){function o(e,t,i){}function r(e){function t(e){if(i(e.properties,r)===s){var t=document.createElement("option")
t.value=e.dbId
var o=d.resultTypes[e.dbId]
t.setAttribute("data-i18n",o),t.textContent=i18n.translate(o),l.add(t),n(l,l.options.length,0===c.options.length)}}for(var r="Result group",s=i(e.properties,r),u=Object.keys(d.resultTypes),h=0;h<u.length;h++){var p=+u[h]
a.getProperties(p,t,o)}}var s=this,a=s.viewer,l=s.resultTypes,c=s.resultsGroup,d=s.simDef.loadCases[e]
l.options.length=0
var u=+t
a.getProperties(u,r,o)},r.fillModalResultTypes=function(e,t){function o(e){if(i(e.properties,"Result type")===d){var t=document.createElement("option")
t.value=e.dbId
var o=i(e.properties,"Mode"),r=o
t.setAttribute("data-i18n",r),t.textContent=r,s.resultTypes.add(t),n(a,a.options.length,0===l.options.length)}}function r(e,t,i){}var s=this,a=s.resultTypes,l=s.resultsGroup,c=s.simDef.loadCases[e]
a.options.length=0
for(var d=t,u=c.modalResults[d]||[],h=0;h<u.length;h++){var p=+u[h]
s.viewer.getProperties(p,o,r)}},r.uninitialize=function(){avu.DockingPanel.prototype.uninitialize.call(this),this.viewer=null},r.setTitle=function(e,t){e||(e="Simulations",t=t||{},t.localizeTitle=!0),avu.DockingPanel.prototype.setTitle.call(this,e,t)},r.setModelNodesVisible=function(e){var t=this,i=t.viewer
if(t.simDef){var n=t.simDef.modelNodes
if(n&&n.length>0)for(var o=0;o<n.length;o++)i[e?"show":"hide"](n[o])}},r.setNodeVisibility=function(e,t){this.viewer[t?"show":"hide"](e)},r.isSimStudyNode=function(e){return!!this.simDef.studyNode&&this.simDef.studyNode===e},r.handleClick=function(e){var t=this
if(null===t.simDef)return!1
var i=t.simDef.loadCases[t.simDef.activeLoadCaseKey]
if(null===i)return!1
for(var n=Object.keys(t.simDef.loadCases),o=0;o<n.length;o++){var r=t.simDef.loadCases[n[o]]
if(r.isImportant(e)&&i!==r){-1!==i.loadsNode&&t.viewer.hide(i.loadsNode),-1!==i.constraintsNode&&t.viewer.hide(i.constraintsNode),-1!==i.undeformedResults&&t.viewer.hide(i.undeformedResults),-1!==i.resultsNode&&t.viewer.hide(i.resultsNode),-1!==t.simDef.connectorsNode&&t.viewer.hide(t.simDef.connectorsNode),t.simDef.activeLoadCaseKey=n[o],t.fillResultsGroup(t.simDef.activeLoadCaseKey)
var s=t.simDef.analysisType===t.simDef.SimulationStudies.MODAL||t.simDef.analysisType===t.simDef.SimulationStudies.BUCKLING?"fillModalResultTypes":"fillResultTypes"
return t[s](t.simDef.activeLoadCaseKey,t.resultsGroup.value),setTimeout(function(){t.simDef.simExt.showResultsDlg(!0),t.setSimObjectsVisibility()},500),!0}}return!1},r.setSimObjectsVisibility=function(e){function t(e){var t=i(e.properties,"Minimal value"),n=i(e.properties,"Maximal value"),r=i(e.properties,"Scale reversed"),s=i(e.properties,"Unit")
o.rowMin.cells[1].innerText=t+" "+s,o.rowMax.cells[1].innerText=n+" "+s
var a=i(e.properties,"Lower referential value"),l=i(e.properties,"Upper referential value")
"True"===r?(o.colorScale.style.transform="rotate(90deg)",o.colorScale.style.moztransform="rotate(90deg)",o.colorScale.style.webkittransform="rotate(90deg)"):(o.colorScale.style.transform="rotate(-90deg)",o.colorScale.style.moztransform="rotate(-90deg)",o.colorScale.style.webkittransform="rotate(-90deg)"),o.colorScaleTopText.innerHTML="- "+l+" "+s,o.colorScaleBottomText.innerHTML="- "+a+" "+s}function n(e,t,i){}var o=this,r=o.simDef.loadCases[o.simDef.activeLoadCaseKey]
if(!o.resultTypes||0===o.resultTypes.options.length||null===r)return o.setModelNodesVisible(!0),void o.simDef.simExt.showResultsDlg(!1)
var s=+o.resultTypes.value
o.setModelNodesVisible(!1),-1!==s&&o.viewer.show(s),-1!==r.loadsNode&&o.viewer.show(r.loadsNode),-1!==r.constraintsNode&&o.viewer.show(r.constraintsNode),o.optUndeformed.checked&&-1!==r.undeformedResults&&o.viewer.show(r.undeformedResults),-1!==o.simDef.connectorsNode&&o.viewer.show(o.simDef.connectorsNode),o.viewer.getProperties(s,t,n)},o}()
aves.Fusion360Sim.GalleryPanel=GalleryPanel,AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel=function(e,t,i){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.call(this,e.viewer,t,i),this.viewer=e.viewer,this.ext=e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype=Object.create(Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel,Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.setGallery=function(e){this.simGalleryPanel=e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.initialize=function(){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.initialize.call(this)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimResultsNode=function(e){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.resultsNode)&&this.simGalleryPanel.simDef.resultsNode==e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimStudyNode=function(e){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.studyNode)&&this.simGalleryPanel.simDef.studyNode==e},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isModelNode=function(e){return!!(this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.modelNodes&&0!=this.simGalleryPanel.simDef.modelNodes.length)&&-1!==this.simGalleryPanel.simDef.modelNodes.indexOf(e)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.shouldInclude=function(e){var t=this
if(!t.simGalleryPanel||!t.simGalleryPanel.simDef)return!1
if(t.isModelNode(e))return!0
if(t.isSimStudyNode(e))return!0
for(var i=t.simGalleryPanel.simDef,n=Object.keys(i.loadCases),o=0;o<n.length;o++){if(i.loadCases[n[o]].resultsNode===e)return!1}return!0},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.onClick=function(e,t){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.onClick.call(this,e,t),this.simGalleryPanel.handleClick(e)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.expandStudyNode=function(){this.simGalleryPanel.simDef.studyNode&&this.tree.setCollapsed(this.simGalleryPanel.simDef.studyNode,!1)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim")
var av=Autodesk.Viewing,_ave=av.Extension,aves=av.Extensions,avem=av.theExtensionManager
av.GEOMETRY_LOAD_START="geometryLoadStarted"
var Simulation=function(){function e(e,n){var o=this
n=n||{}
for(var r in t)n[r]=n[r]||t[r]
_ave.call(o,e,n),e.addEventListener(av.GEOMETRY_LOAD_START,function(e){i&&o.unload(),"Autodesk.Fusion360.Simulation"===e.data.extensions?i=!0:(o.unload(),i=!1)}),e.addEventListener(av.GEOMETRY_LOADED_EVENT,function(e){o.load()})}var t={},i=!1
e.prototype=Object.create(_ave.prototype)
var n=e.prototype
return n.constructor=e,n.load=function(){var e=this,t=e.viewer
return!t.model||(e.galleryPanel=new aves.Fusion360Sim.GalleryPanel(e.viewer),e.viewer.addPanel(e.galleryPanel),e.simButton=new av.UI.Button("toolbar-simulation"),e.simButton.setVisible(!1),e.simButton.setToolTip("Simulation Results"),e.simButton.onClick=function(t){var i=e.galleryPanel.isVisible()
e.galleryPanel.setVisible(!i),e.simButton.setState(i?av.UI.Button.State.INACTIVE:av.UI.Button.State.ACTIVE)},e.simButton.setIcon("toolbar-simulationIcon"),t.settingsTools.addControl(e.simButton,{index:1}),e.hideLines=t.prefs.get("lineRendering"),e.ghosting=t.prefs.get("ghosting"),e.ambientShadow=t.prefs.get("ambientShadows"),e.antialiazing=t.prefs.get("antialiasing"),e.lightPreset=t.prefs.get("lightPreset"),t.model.getObjectTree(function(t){setTimeout(function(){e.galleryPanel.initModel(t,e),e.initModelBrowser()},100)}),!0)},n.unload=function(){var e=this
if(e.viewer.model)return e.showResultsDlg(!1),e.viewer.settingsTools.removeControl(this.simButton),e.viewer.removePanel(this.galleryPanel),e.galleryPanel.uninitialize(),e.viewer.hideLines(!e.hideLines),e.viewer.setGhosting(e.ghosting),e.viewer.setQualityLevel(e.ambientShadow,e.antialiazing),e.viewer.setLightPreset(e.lightPreset),!0},n.initModelBrowser=function(){var e=this
setTimeout(function(){e.modelStructurePanel=new Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel(e,"Simulation Model Structure Loading",e.options),e.viewer.setModelStructurePanel(e.modelStructurePanel),e.modelStructurePanel.setGallery(e.galleryPanel)},100)},n.showResultsDlg=function(e){var t=this
t.simButton.setState(e?av.UI.Button.State.ACTIVE:av.UI.Button.State.INACTIVE),t.simButton.setVisible(e),t.galleryPanel.setVisible(e)},n.applySettings=function(){var e=this.viewer
e.hideLines(!1),e.setGhosting(!1),e.setQualityLevel(!1,!0),e.setLightPreset(4)},n.simData=function(){return this.galleryPanel.simDef},e}()
aves.Simulation=Simulation,avem.registerExtension("Autodesk.Fusion360.Simulation",aves.Simulation),function(){"use strict"
var e=Autodesk.Viewing,t=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),i=function(t,i){e.Extension.call(this,t,i),this.tool=null}
i.prototype=Object.create(e.Extension.prototype),i.prototype.constructor=i,i.prototype.load=function(){return this.tool=new t.HyperlinkTool(this.viewer),this.viewer.toolController.registerTool(this.tool),this.viewer.toolController.activateTool(this.tool.getName()),!0},i.prototype.unload=function(){return this.viewer.toolController.deactivateTool(this.tool.getName()),this.viewer.toolController.deregisterTool(this.tool),this.tool=null,!0},t.HyperlinkExtension=i,e.theExtensionManager.registerExtension("Autodesk.Hyperlink",i)}(),function(){"use strict"
var e=Autodesk.Viewing,t=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),i=function(t){e.ToolInterface.call(this),this.names=["hyperlink"]
var i=this,n=-1,o=!1,r=[],s=[],a=null,l=null,c=null,d={},u=null,h=null,p=null
this.panel=null
var m=function(i,n,o,r){a||(a=document.createElement("div"),t.container.appendChild(a),a.setAttribute("data-i18n","Ctrl + Click to preview the link"),a.textContent=e.i18n.translate("Ctrl + Click to preview the link")),a.className="hyperlink-tooltip",a.style.top=n+20+"px",a.style.left=i+20+"px",a.intersectPoint=r},g=function(){a&&(t.container.removeChild(a),a=null)},f=function(){if(a){var e=t.navigation.getCamera(),i=t.navigation.getScreenViewport(),n=(new THREE.Vector3).copy(a.intersectPoint)
n.project(e)
var o=Math.round((n.x+1)/2*i.width),r=Math.round((1-n.y)/2*i.height)
a.style.left=o+20+"px",a.style.top=r+20+"px"}},v=function(n){t.removeEventListener(e.GEOMETRY_LOADED_EVENT,v)
var o=t.model.getData()
l=o.stringDbIds,c=o.stringBoxes,i.loadHyperlinks()},E=function(){i.panel&&i.panel.updatePosition(),f()}
this.activate=function(n){if(t.model&&t.model.isLoadDone()){var o=t.model.getData()
l=o.stringDbIds,c=o.stringBoxes,i.loadHyperlinks()}else t.addEventListener(e.GEOMETRY_LOADED_EVENT,v)
t.addEventListener(e.CAMERA_CHANGE_EVENT,E)},this.deactivate=function(i){t.removeEventListener(e.CAMERA_CHANGE_EVENT,E),r=[],s=[],g(),this.panel&&(this.panel.uninitialize(),this.panel=null),t.HyperlinkBack&&(t.HyperlinkBack.uninitialize(),t.HyperlinkBack=null),t.impl.clearOverlay("Hyperlink-bBox"),t.impl.clearOverlay("Hyperlink-bBox-select")},this.update=function(e){return!1},this.handleSingleClick=function(o,a){this.clearSelection(),this.panel&&(this.panel.uninitialize(),this.panel=null)
var l=t.impl.hitTest(o.canvasX,o.canvasY,!1)
if(l){var c=l.dbId,d=t.model.getDocumentNode(),u=null
d&&(u=d.data.viewableID)
var h=new THREE.Vector2(o.canvasX,o.canvasY)
if(t.model.is2d())for(var p in r){var m=r[p]
if(m.dbId===c){var f=l.intersectPoint.x,v=l.intersectPoint.y
if(f>=m.bBox[0]&&f<=m.bBox[2]&&v>=m.bBox[1]&&v<=m.bBox[3]){if(m.node){var E=m.node.data.name
this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,h,l.intersectPoint,E,m.link,u,c,m.node.data,this.getThumbnail)}else this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,h,l.intersectPoint,null,m.link,u)
return this.highlightSelection(m.bBoxMesh),!0}}}else if(o.ctrlKey&&s[n]){this.controller.setIsLocked(!1),g()
var m=s[n]
if(m.node){var E=m.node.data.name
this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,h,l.intersectPoint,E,m.link,u,c,m.node.data,this.getThumbnail)}else this.panel=new e.Extensions.Hyperlink.HyperlinkPanel(i,t,h,l.intersectPoint,null,m.link,u,c)
return!0}}return!1},this.handleButtonDown=function(e,t){return o=!0,!1},this.handleButtonUp=function(e,t){return o=!1,!1},this.handleMouseMove=function(e){if(!o){if(!t.model.is2d()){var i=t.impl.hitTest(e.canvasX,e.canvasY,!1)
if(i){var r=i.dbId
if(r!=n&&(n=r,g()),this.panel&&this.panel.dbId===r)return
s.hasOwnProperty(n)?null!==s[n]&&m(e.canvasX,e.canvasY,s[n],i.intersectPoint):(s[n]=null,this.loadHyperlink3d(n,e.canvasX,e.canvasY,i.intersectPoint))}else g()}return!1}},this.getCursor=function(){return a?"pointer":null},this.loadHyperlinks=function(){if(l)for(var e=0;e<l.length;e++){var t=l[e]
this.loadHyperlink2d(t,e)}},this.loadHyperlink2d=function(e,n){t.getProperties(e,function(o){for(var s=o.properties,a=0,l=s.length;a<l;a++){var c=s[a]
if("__hyperlink__"===c.displayCategory){var d=null,u=c.displayValue,h=t.model.getDocumentNode()
if(h){h=h.getRootNode()
var p=h.search({viewableID:u})
p&&p.length&&(d=p[0])}r[n]={dbId:e,link:u,node:d},i.highlightText(n)
break}}})},this.loadHyperlink3d=function(e,i,n,o){t.getProperties(e,function(r){for(var a=r.properties,l=0,c=a.length;l<c;l++){var d=a[l]
if("__hyperlink__"===d.displayCategory){var u=null,h=d.displayValue,p=t.model.getDocumentNode()
if(p){p=p.getRootNode()
var g=p.search({viewableID:h})
g&&g.length&&(u=g[0])}s[e]={link:h,node:u},m(i,n,s[e],o)
break}}})},this.getHyperlinks=function(){return _linkCache},this.getThumbnail=function(e,i,n){if(d.hasOwnProperty(e))return void n(d[e])
var o={urn:t.model.getData().urn,width:400,height:400,guid:encodeURIComponent(i.guid),acmsession:t.model.getData().acmSessionId},r=function(t){var i=new FileReader
i.onload=function(t){var i=t.target.result
d[e]=i,n(i)},i.readAsDataURL(t)},s={responseType:"blob",skipAssetCallback:!0,size:o.width,guid:o.guid,acmsession:o.acmsession},a="urn:"+o.urn
avp.ViewingService.getThumbnail(avp.initLoadContext(),a,r,null,s)},this.highlightText=function(e){var t=c[4*e]-.2,i=c[4*e+1]-.2,n=c[4*e+2]+.2,o=c[4*e+3]+.2
r[e].bBox=[t,i,n,o],this.addRectangle(e,t,i,n,o)},this.addRectangle=function(e,i,n,o,s){var a=new THREE.Vector3(i,n,0),l=new THREE.Vector3(o,n,0),c=new THREE.Vector3(o,s,0),d=new THREE.Vector3(i,s,0),h=new THREE.Geometry
if(h.vertices.push(a),h.vertices.push(l),h.vertices.push(c),h.vertices.push(d),h.faces.push(new THREE.Face3(0,1,2)),h.faces.push(new THREE.Face3(0,3,2)),!u){u=new THREE.MeshBasicMaterial({color:240116,opacity:.8,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),t.impl.createOverlayScene("Hyperlink-bBox")}var p=r[e].bBoxMesh=new THREE.Mesh(h,u,!0)
t.impl.addOverlay("Hyperlink-bBox",p)},this.highlightSelection=function(e){if(p=e,t.impl.removeOverlay("Hyperlink-bBox",e),!h){h=new THREE.MeshBasicMaterial({color:16744272,opacity:.8,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),t.impl.createOverlayScene("Hyperlink-bBox-select")}var i=new THREE.Mesh(e.geometry,h)
t.impl.addOverlay("Hyperlink-bBox-select",i)},this.clearSelection=function(){p&&(t.impl.clearOverlay("Hyperlink-bBox-select"),t.impl.addOverlay("Hyperlink-bBox",p),p=null)}}
t.HyperlinkTool=i}(),function(){"use strict"
var e=AutodeskNamespace("Autodesk.Viewing.Extensions.Hyperlink"),t=Autodesk.Viewing,i=(Autodesk.Viewing.Extensions,Autodesk.Viewing.Private,Autodesk.Viewing.UI,function(i,n,o,r,s,a,l,c,d,u){function h(e){p.thumbnail.src=e}var p=this
this.viewer=n,this.container=document.createElement("div"),this.container.className="hyperlink-container",n.container.appendChild(this.container),this.container.style.left=o.x+"px",this.container.style.top=o.y-70+"px",this.intersectPoint=r,this.dbId=c,this.triangle=document.createElement("div"),this.triangle.className="hyperlink-container-triangle",this.container.appendChild(this.triangle),this.panel=document.createElement("div"),this.panel.className="hyperlink-panel",this.container.appendChild(this.panel),this.title=document.createElement("div"),this.title.className="hyperlink-panel-title",s?this.title.textContent=s:(this.title.setAttribute("data-i18n","External Link"),this.title.textContent=t.i18n.translate("External Link")),this.panel.appendChild(this.title),d?(this.thumbnail=document.createElement("img"),this.thumbnail.className="hyperlink-panel-thumbnail",u(c,d,h),this.panel.appendChild(this.thumbnail)):(this.externalLink=document.createElement("div"),this.externalLink.className="hyperlink-panel-external-link",this.externalLink.textContent=a,this.panel.appendChild(this.externalLink)),this.viewButton=document.createElement("div"),this.viewButton.className="hyperlink-panel-view-button",this.viewButton.setAttribute("data-i18n","View"),this.viewButton.textContent=t.i18n.translate("View"),this.panel.appendChild(this.viewButton),this.viewButton.addEventListener("click",function(){p.uninitialize(),i.panel=null,n.HyperlinkBack&&(n.HyperlinkBack.uninitialize(),n.HyperlinkBack=null),n.fireEvent({type:t.HYPERLINK_EVENT,data:{href:a}}),d&&(n.HyperlinkBack=new e.HyperlinkBack(i,n,l))}),this.triangle.style.bottom=this.container.clientHeight-100+"px",this.boundsCheck()})
i.prototype.uninitialize=function(){this.viewer.container.removeChild(this.container),this.container=null},i.prototype.boundsCheck=function(){var e=this.viewer.navigation.getScreenViewport(),t=this.container.clientWidth,i=this.container.clientHeight,n=parseInt(this.container.style.left,10),o=parseInt(this.container.style.top,10),r=n,s=o
n<0&&(r=0),o<0&&(s=0),e.width<n+t&&(r=e.width-t),e.height<o+i&&(s=e.height-i)
var a=this.viewer.navigation.getEyeVector().length(),l=this.viewer.impl.clientToViewport(n,o),c=this.viewer.impl.clientToViewport(r,s)
l.subVectors(l,c),this.viewer.navigation.panRelative(l.x/2,l.y/2,a),this.container.style.left=r+"px",this.container.style.top=s+"px"},i.prototype.updatePosition=function(){var e=this.viewer.navigation.getCamera(),t=this.viewer.navigation.getScreenViewport(),i=(new THREE.Vector3).copy(this.intersectPoint)
i.project(e)
var n=Math.round((i.x+1)/2*t.width),o=Math.round((1-i.y)/2*t.height)
this.container.style.left=n+"px",this.container.style.top=o-70+"px"},e.HyperlinkPanel=i
var n=function(e,i,n){var o=this
this.viewer=i,this.container=document.createElement("div"),this.container.className="hyperlink-back",i.container.appendChild(this.container),this.backButton=document.createElement("div"),this.backButton.className="hyperlink-back-button",this.backButton.setAttribute("data-i18n","Back"),this.backButton.textContent=t.i18n.translate("Back"),this.container.appendChild(this.backButton),this.backButton.addEventListener("click",function(){o.uninitialize(),i.HyperlinkBack=null,e.panel&&(e.panel.uninitialize(),e.panel=null),i.fireEvent({type:t.HYPERLINK_EVENT,data:{href:n}})}),this.closer=document.createElement("div"),this.closer.className="hyperlink-back-closer",this.closer.innerHTML="&times;",this.container.appendChild(this.closer),this.closer.addEventListener("click",function(){o.uninitialize(),i.HyperlinkBack=null})}
n.prototype.uninitialize=function(){this.viewer.container.removeChild(this.container),this.container=null},e.HyperlinkBack=n}(),function(e,t){"use strict"
var i,n=e.document
i=function(){var t,i,o,r,s,a,l,c,d,u,h,p,m,g={},f={},v=!1,E={ENTER:13,ESC:27,SPACE:32},y=[]
return f={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',ok:'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',cancel:'<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},m=function(){var e,t,i=!1,o=n.createElement("fakeelement"),r={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"}
for(e in r)if(void 0!==o.style[e]){t=r[e],i=!0
break}return{type:t,supported:i}},t=function(e){return n.getElementById(e)},g={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,buttonReverse:!1,buttonFocus:"ok",transition:void 0,addListeners:function(e){var t,a,l,c,d,u=void 0!==o,h=void 0!==i,m=void 0!==p,g="",f=this
t=function(t){return void 0!==t.preventDefault&&t.preventDefault(),l(t),void 0!==p&&(g=p.value),"function"==typeof e&&(void 0!==p?e(!0,g):e(!0)),!1},a=function(t){return void 0!==t.preventDefault&&t.preventDefault(),l(t),"function"==typeof e&&e(!1),!1},l=function(e){f.hide(),f.unbind(n.body,"keyup",c),f.unbind(r,"focus",d),u&&f.unbind(o,"click",t),h&&f.unbind(i,"click",a)},c=function(e){var i=e.keyCode;(i===E.SPACE&&!m||m&&i===E.ENTER)&&t(e),i===E.ESC&&h&&a(e)},d=function(e){m?p.focus():!h||f.buttonReverse?o.focus():i.focus()},this.bind(r,"focus",d),this.bind(s,"focus",d),u&&this.bind(o,"click",t),h&&this.bind(i,"click",a),this.bind(n.body,"keyup",c),this.transition.supported||this.setFocus()},bind:function(e,t,i){"function"==typeof e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},handleErrors:function(){if(void 0!==e.onerror){var t=this
return e.onerror=function(e,i,n){t.error("["+e+" on line "+n+" of "+i+"]",0)},!0}return!1},appendButtons:function(e,t){return this.buttonReverse?t+e:e+t},build:function(e){var t="",i=e.type,n=e.message,o=e.cssClass||""
switch(t+='<div class="alertify-dialog">',t+='<a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus</a>',"none"===g.buttonFocus&&(t+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>'),"prompt"===i&&(t+='<div id="alertify-form">'),t+='<article class="alertify-inner">',t+=f.message.replace("{{message}}",n),"prompt"===i&&(t+=f.input),t+=f.buttons.holder,t+="</article>","prompt"===i&&(t+="</div>"),t+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',t+="</div>",i){case"confirm":t=t.replace("{{buttons}}",this.appendButtons(f.buttons.cancel,f.buttons.ok)),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel)
break
case"prompt":t=t.replace("{{buttons}}",this.appendButtons(f.buttons.cancel,f.buttons.submit)),t=t.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel)
break
case"alert":t=t.replace("{{buttons}}",f.buttons.ok),t=t.replace("{{ok}}",this.labels.ok)}return d.className="alertify alertify-"+i+" "+o,c.className="alertify-cover",t},close:function(e,t){var i,n,o=t&&!isNaN(t)?+t:this.delay,r=this
this.bind(e,"click",function(){i(e)}),n=function(e){e.stopPropagation(),r.unbind(this,r.transition.type,n),u.removeChild(this),u.hasChildNodes()||(u.className+=" alertify-logs-hidden")},i=function(e){void 0!==e&&e.parentNode===u&&(r.transition.supported?(r.bind(e,r.transition.type,n),e.className+=" alertify-log-hide"):(u.removeChild(e),u.hasChildNodes()||(u.className+=" alertify-logs-hidden")))},0!==t&&setTimeout(function(){i(e)},o)},dialog:function(e,t,i,o,r){l=n.activeElement
var s=function(){u&&null!==u.scrollTop&&c&&null!==c.scrollTop||s()}
if("string"!=typeof e)throw new Error("message must be a string")
if("string"!=typeof t)throw new Error("type must be a string")
if(void 0!==i&&"function"!=typeof i)throw new Error("fn must be a function")
return this.init(),s(),y.push({type:t,message:e,callback:i,placeholder:o,cssClass:r}),v||this.setup(),this},extend:function(e){if("string"!=typeof e)throw new Error("extend method must have exactly one paramter")
return function(t,i){return this.log(t,e,i),this}},hide:function(){var e,t=this
y.splice(0,1),y.length>0?this.setup(!0):(v=!1,e=function(i){i.stopPropagation(),t.unbind(d,t.transition.type,e)},this.transition.supported?(this.bind(d,this.transition.type,e),d.className="alertify alertify-hide alertify-hidden"):d.className="alertify alertify-hide alertify-hidden alertify-isHidden",c.className="alertify-cover alertify-cover-hidden",l.focus())},init:function(){n.createElement("nav"),n.createElement("article"),n.createElement("section"),null==t("alertify-cover")&&(c=n.createElement("div"),c.setAttribute("id","alertify-cover"),c.className="alertify-cover alertify-cover-hidden",n.body.appendChild(c)),null==t("alertify")&&(v=!1,y=[],d=n.createElement("section"),d.setAttribute("id","alertify"),d.setAttribute("style","z-index : 999999999"),d.className="alertify alertify-hidden",n.body.appendChild(d)),null==t("alertify-logs")&&(u=n.createElement("section"),u.setAttribute("id","alertify-logs"),u.className="alertify-logs alertify-logs-hidden",n.body.appendChild(u)),n.body.setAttribute("tabindex","0"),this.transition=m()},log:function(e,t,i){var n=function(){u&&null!==u.scrollTop||n()}
return this.init(),n(),u.className="alertify-logs",this.notify(e,t,i),this},notify:function(e,t,i){var o=n.createElement("article")
o.className="alertify-log"+("string"==typeof t&&""!==t?" alertify-log-"+t:""),o.innerHTML=e,u.appendChild(o),setTimeout(function(){o.className=o.className+" alertify-log-show"},50),this.close(o,i)},set:function(e){var t
if("object"!=typeof e&&e instanceof Array)throw new Error("args must be an object")
for(t in e)e.hasOwnProperty(t)&&(this[t]=e[t])},setFocus:function(){p?(p.focus(),p.select()):a.focus()},setup:function(e){var n,l=y[0],c=this
v=!0,n=function(e){e.stopPropagation(),c.setFocus(),c.unbind(d,c.transition.type,n)},this.transition.supported&&!e&&this.bind(d,this.transition.type,n),d.innerHTML=this.build(l),r=t("alertify-resetFocus"),s=t("alertify-resetFocusBack"),o=t("alertify-ok")||void 0,i=t("alertify-cancel")||void 0,a="cancel"===g.buttonFocus?i:"none"===g.buttonFocus?t("alertify-noneFocus"):o,p=t("alertify-text")||void 0,h=t("alertify-form")||void 0,"string"==typeof l.placeholder&&""!==l.placeholder&&(p.value=l.placeholder),e&&this.setFocus(),this.addListeners(l.callback)},unbind:function(e,t,i){"function"==typeof e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent("on"+t,i)}},{alert:function(e,t,i){return g.dialog(e,"alert",t,"",i),this},confirm:function(e,t,i){return g.dialog(e,"confirm",t,"",i),this},extend:g.extend,init:g.init,log:function(e,t,i){return g.log(e,t,i),this},prompt:function(e,t,i,n){return g.dialog(e,"prompt",t,i,n),this},success:function(e,t){return g.log(e,"success",t),this},error:function(e,t){return g.log(e,"error",t),this},set:function(e){g.set(e)},hide:function(e){g.hide(e)},labels:g.labels,debug:g.handleErrors}},void 0===e.alertify&&(e.alertify=new i)}(this),function(){var e=Autodesk.Viewing
e.Private
e.ENDPOINT_API_DERIVATIVE_SERVICE_V2="derivativeV2",e.ENDPOINT_API_MODEL_DERIVATIVE_V2="modelDerivativeV2"
var t={derivativeV2:{baseURL:"/derivativeservice/v2",itemURL:"/derivativeservice/v2/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn"},modelDerivativeV2:{baseURL:"/modelderivative/v2/",itemURL:"/modelderivative/v2/designdata/:urn/manifest/:derivativeurn",manifestURL:"/modelderivative/v2/designdata/:urn/manifest",thumbnailsURL:"/modelderivative/v2/designdata/:urn/thumbnail"}},i="",n=e.ENDPOINT_API_DERIVATIVE_SERVICE_V2,o=!1
e.HTTP_REQUEST_HEADERS={},e.setEndpointAndApi=function(e,t){i=e,n=t},e.getEndpointAndApi=function(){return i+t[n].baseURL},e.getApiEndpoint=function(){return i},e.getManifestApi=function(e,o,r){var s=e||i
return r=r||n,s+=t[r].manifestURL,o=o||"",s=s.replace(":urn",o)},e.getItemApi=function(e,o,r){var s=(e||i)+t[r||n].itemURL
o=o||""
var a=o
return a=a.split("/"),a=a[0]||"",a=a.split(":"),a=a[a.length-1]||"",s=s.replace(":urn",a),s=s.replace(":derivativeurn",o)},e.getThumbnailApi=function(e,o,r){return((e||i)+t[r||n].thumbnailsURL).replace(":urn",o||"")},e.makeOssPath=function(e,t,n){return(e||i)+"/oss/v2/buckets/"+t+"/objects/"+encodeURIComponent(decodeURIComponent(n))},e.getUseCredentials=function(){return o},e.setUseCredentials=function(e){o=e},e.setApiEndpoint=function(t){i=t,n=e.ENDPOINT_API_DERIVATIVE_SERVICE_V2},e.getViewingUrl=function(e){return(e||i)+t[n].baseURL}}(),function(){"use strict"
var e=Autodesk.Viewing,t=e.Private,i=e.getGlobal()
i.PROTEIN_ROOT=null,i.PRISM_ROOT=null,i.LOCALIZATION_REL_PATH="",i.LMV_VIEWER_VERSION="2.16",i.LMV_VIEWER_PATCH="1",i.LMV_BUILD_TYPE="Production",i.LMV_RESOURCE_VERSION=null,i.LMV_RESOURCE_ROOT="","v"===LMV_VIEWER_VERSION.charAt(0)&&(LMV_VIEWER_VERSION=LMV_VIEWER_VERSION.substr(1)),i.stderr=function(){console.warn('"stderr" is deprecated; please use "Autodesk.Viewing.Private.logger" instead')},t.env=null,t.docItemId=null,t.token={accessToken:null,getAccessToken:null,tokenRefreshInterval:null},t.assets=[],t.offline=!1,t.offlineResourcePrefix=null
var n={local:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},dev:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},stg:{RTC:["https://rtc-stg.api.autodesk.com:443","https://lmv.autodesk.com:443"]},prod:{RTC:["https://rtc.api.autodesk.com:443","https://lmv.autodesk.com:443"]}},o={local:"",dev:"https://viewing-dev.api.autodesk.com",stg:"https://viewing-staging.api.autodesk.com",prod:"https://viewing.api.autodesk.com"},r={local:"",dev:"https://developer-dev.api.autodesk.com",stg:"https://developer-stg.api.autodesk.com",prod:"https://developer.api.autodesk.com"},s={stg:{CLIENT_ID:"lmv-stag",CLIENT_KEY:"kjemi1rwAgsqIqyvDUtc9etPD6MsAzbV",ENDPOINT:"https://ase-stg.autodesk.com"},prod:{CLIENT_ID:"lmv-prod",CLIENT_KEY:"iaoUM2CRGydfn703yfPq4MAogZi8I5u4",ENDPOINT:"https://ase.autodesk.com"}}
t.EnvironmentConfigurations={Local:{ROOT:"",LMV:n.local},Development:{ROOT:o.dev,LMV:n.dev,bubbleManifest:!0},Staging:{ROOT:o.stg,LMV:n.stg,bubbleManifest:!0},Production:{ROOT:o.prod,LMV:n.prod,bubbleManifest:!0},AutodeskDevelopment:{ROOT:r.dev,LMV:n.dev},AutodeskStaging:{ROOT:r.stg,LMV:n.stg},AutodeskProduction:{ROOT:r.prod,LMV:n.prod}},t.initializeEnvironmentVariable=function(e){var i
if(e&&e.env&&(i=e.env),i||(i=t.getParameterByName("env")),e&&e.offlineResourcePrefix&&(t.offlineResourcePrefix=e.offlineResourcePrefix),e&&e.offline&&"true"===e.offline&&(t.offline=!0),!i)switch(window.location.hostname){case"viewing-dev.api.autodesk.com":i="Development"
break
case"viewing-staging.api.autodesk.com":i="Staging"
break
case"viewing.api.autodesk.com":i="Production"
break
case"developer-dev.api.autodesk.com":i="AutodeskDevelopment"
break
case"developer-stg.api.autodesk.com":i="AutodeskStaging"
break
case"developer.api.autodesk.com":i="AutodeskProduction"
break
case"localhost.autodesk.com":case"":case"127.0.0.1":i="Local"
break
default:i="AutodeskProduction"}t.env=i,"undefined"!=typeof window&&t.logger.info("Host name : "+window.location.hostname),t.logger.info("Environment initialized as : "+i)},t.initializeServiceEndPoints=function(i){var n=i.endpoint
if(!n){n=t.EnvironmentConfigurations[t.env].ROOT}var o=i.api||e.ENDPOINT_API_DERIVATIVE_SERVICE_V2
if(e.setEndpointAndApi(n,o),!e.isNodeJS){var r=["viewer3D.js","viewer3D.min.js","firefly.js","firefly.min.js"]
i&&i.hasOwnProperty("libraryName")&&r.push(i.libraryName)
for(var s,a,l=0;l<r.length;l++){var c=t.getScript(r[l])
a=c?c.src:""
var d=a.indexOf(r[l])
if(d>=0){s=a.substr(0,d)
break}}LMV_RESOURCE_VERSION="v"+LMV_VIEWER_VERSION
var u=t.getParameterByNameFromPath("v",a)
u&&u.length&&u!=LMV_RESOURCE_VERSION?(t.logger.warn("Version string mismatch between requested and actual version: "+u+" vs. "+LMV_RESOURCE_VERSION+". Using "+u),LMV_RESOURCE_VERSION=u):u&&u.length||(LMV_RESOURCE_VERSION=null,t.logger.info("No viewer version specified, will implicitly use "+LMV_VIEWER_VERSION)),LMV_RESOURCE_ROOT=s||LMV_RESOURCE_ROOT}},t.getDomainParam=function(){return e.getUseCredentials()&&!e.isNodeJS?"domain="+encodeURIComponent(window.location.origin):""},t.initLoadContext=function(i){i=i||{},i.auth=e.getUseCredentials(),i.endpoint=e.getApiEndpoint(),i.headers||(i.headers={})
for(var n in e.HTTP_REQUEST_HEADERS)i.headers[n]=e.HTTP_REQUEST_HEADERS[n]
var o=t.getDomainParam()
return o&&(i.queryParams?i.queryParams+="&"+o:i.queryParams=o),i},t.refreshRequestHeader=function(t){e.HTTP_REQUEST_HEADERS.Authorization="Bearer "+t},t.refreshToken=function(e,i,n){t.token.accessToken=e,t.refreshRequestHeader(e),i instanceof Function&&i()},t.initializeAuth=function(i,n){function o(e,r){s=e,t.refreshToken(s,t.token.tokenRefreshInterval?null:i)
var a=r-60
a<=0&&(a=r),t.token.tokenRefreshInterval=1e3*a,setTimeout(function(){n.getAccessToken(o)},t.token.tokenRefreshInterval)}var r=n?n.shouldInitializeAuth:void 0
if(void 0===r){r="false"!==t.getParameterByName("auth").toLowerCase()}if("Local"==t.env||!r)return setTimeout(i,0),e.setUseCredentials(void 0!==n.useCredentials&&n.useCredentials),e.getUseCredentials()
e.setUseCredentials(void 0===n.useCredentials||n.useCredentials)
var s
return n&&n.getAccessToken?(t.token.getAccessToken=n.getAccessToken,"string"==typeof(s=n.getAccessToken(o))&&s&&t.refreshToken(s,i)):n&&n.accessToken?(s=n.accessToken,t.refreshToken(s,i)):(s=t.getParameterByName("accessToken"),s||(s="9AMaRKBoPCIBy61JmQ8OLLLyRblS",t.logger.warn("Warning : no access token is provided. Use built in token : "+s)),t.refreshToken(s,i)),e.getUseCredentials()},t.initializeLogger=function(i){if(t.logger.initialize(i),!(i&&i.hasOwnProperty("useADP")&&0==i.useADP||e.isNodeJS)){var n="https://ase-cdn.autodesk.com/adp/v1.0.3/js/adp-web-analytics-sdk.min.js",o=function(){if("undefined"==typeof Adp)return void t.logger.warn("Autodesk Data Platform SDK not found")
var e
switch(LMV_BUILD_TYPE){case"Production":e=s.prod
break
default:e=s.stg}var i={product:{name:"LMV",line_name:"LMV",key:e.CLIENT_ID,id:e.CLIENT_KEY,id_provider:"appkey",build_id:LMV_VIEWER_VERSION+"."+LMV_VIEWER_PATCH,build_tag:LMV_BUILD_TYPE}},n={server:e.ENDPOINT,enable_geo_data:!1,enable_browser_data:!0,enable_session_messages:!0}
t.logger.adp=new Adp(i,n)}
"function"==typeof require?require([n],function(e){window.Adp=e,o()}):t.loadDependency("Adp",n,o)}},t.initializeProtein=function(){if((!t.ENABLE_DEBUG||"Local"!=t.env||e.getUseCredentials())&&!t.offline){var i=new XMLHttpRequest
i.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=protein",!0),i.responseType="json",i.onload=function(e){var n=i.response.url
n&&n.length&&(n=n.replace("http://","https://"),PROTEIN_ROOT=n+"/",t.logger.info("Protein root is: "+PROTEIN_ROOT))},i.send()
var n=new XMLHttpRequest
n.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=prism",!0),n.responseType="json",n.onload=function(e){var i=n.response.url
i&&i.length&&(i=i.replace("http://","https://"),PRISM_ROOT=i+"/",t.logger.info("Prism root is: "+PRISM_ROOT))},n.send()}},t.getParameterByName=function(e){return"undefined"==typeof window?"":t.getParameterByNameFromPath(e,window.location.href)},t.getParameterByNameFromPath=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")
var i="[\\?&]"+e+"=([^&#]*)",n=new RegExp(i),o=n.exec(t)
return null==o?"":decodeURIComponent(o[1].replace(/\+/g," "))},t.urlIsApiViewingOrDev=function(e){return-1!==e.indexOf("developer.api.autodesk.com")||-1!==e.indexOf("developer-stg.api.autodesk.com")||-1!==e.indexOf("developer-dev.api.autodesk.com")||-1!==e.indexOf("viewing.api.autodesk.com")||-1!==e.indexOf("viewing-staging.api.autodesk.com")||-1!==e.indexOf("viewing-dev.api.autodesk.com")},t.getDemoDocumentURN=function(){var e
switch(t.env){case"Development":e="urn:dXJuOmFkc2suYTM2MGJldGFkZXY6ZnMuZmlsZTplbnRlcnByaXNlLmxtdnRlc3QuRFM1YTczMFFUYmYwMDIyZDA3NTFhYmE5MjZlZDZkMjJlZDY0P3ZlcnNpb249MQ=="
break
case"Staging":e="urn:dXJuOmFkc2suczM6ZGVyaXZlZC5maWxlOlZpZXdpbmdTZXJ2aWNlVGVzdEFwcC91c2Vycy9NaWNoYWVsX0hhbicvTU0zNTAwQXNzZW1ibHkuZHdm"
break
case"Production":e="FIXME"
break
default:e="https://lmv.rocks/viewer/data/gears/output/bubble.json"}return e},t.processMemoryOptions=function(e){if(e){if(e.memory){var i=0|parseInt(e.memory.limit);(e.memory.debug||!1)&&i<=0&&(e.memory.force=!1,t.logger.warn("config.memory.limit value is invalid: ("+e.memory.limit+")"))}var n=t.getParameterByName("viewermemory"),i=0|parseInt(n)
if(i>0){var o="f"===n.charAt(n.length-1).toLowerCase()
e.memory={limit:i,debug:{force:o}},o?t.logger.info("Forcing memory limit to URL param: ("+i+" MegaBytes)."):t.logger.info("Setting memory limit to URL param: ("+i+" MegaBytes).")}else""!==n&&t.logger.warn("Invalid viewermemory URL param value: ("+n+")")}},t.setLanguage=function(e,t){var i={lng:e,resGetPath:"res/locales/__lng__/__ns__.json",ns:{namespaces:["allstrings"],defaultNs:"allstrings"},fallbackLng:"en",debug:!1}
LOCALIZATION_REL_PATH="res/locales/"+e+"/",Autodesk.Viewing.i18n.init(i,function(e){Autodesk.Viewing.i18n.clearDebugLocString(),t&&t()})},t.extendLocalization=function(e){return null!==e&&"object"==typeof e&&(Object.keys(e).forEach(function(t){Autodesk.Viewing.i18n.addResourceBundle(t,"allstrings",e[t],!0,!0)}),!0)},t.initializeLocalization=function(e){var i=e&&e.language||navigator.language,n=i.split("-")
i=n.length>1?n[0].toLowerCase()+"-"+n[1].toUpperCase():n[0].toLowerCase()
var o=["cs","de","en","es","fr","it","ja","ko","pl","pt-BR","ru","tr","zh-HANS","zh-HANT"];-1===o.indexOf(i)&&(i=i.indexOf("zh-CN")>-1?"zh-HANS":i.indexOf("zh-TW")>-1?"zh-HANT":n.length>1&&o.indexOf(n[0])>-1?n[0]:"en"),t.setLanguage(i)},t.initializeUserInfo=function(e){e&&e.userInfo&&(t.setUserName(e.userInfo.name),e.comment2Token&&(t.comment2Token=e.comment2Token))},t.getScript=function(e){e=e.toLowerCase()
var t=document.getElementsByTagName("SCRIPT")
if(t&&t.length>0)for(var i=0;i<t.length;++i)if(t[i].src&&-1!==t[i].src.toLowerCase().indexOf(e))return t[i]
return null},t.getResourceUrl=function(e){var t=LMV_RESOURCE_VERSION
return LMV_RESOURCE_ROOT+e+(t?"?v="+t:"")},t.loadDependency=function(e,i,n,o,r){if(void 0===window[e]){var s=document.createElement("SCRIPT")
s.src=i.indexOf("://")>0?i:t.getResourceUrl(i)
var a=function(){s.onerror=null,s.onload=null},l=function(){a(),o&&o()},c=function(){a(),"function"==typeof define&&define.amd&&"function"==typeof require&&r?require([r],function(t){window[e]=t,n&&n()},l):n&&n()}
s.onload=c,s.onerror=l,document.head.appendChild(s)}else n&&n()},t.injectCSS=function(e,i,n){for(var o=e.indexOf("://")>0?e:t.getResourceUrl(e),r=document.getElementsByTagName("link"),s=0,a=r.length;s<a;s++)if(r[s].href===o)return void(i&&i())
var l=document.createElement("link")
l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",o),i&&(l.onload=i),n&&(l.onerror=n),document.head.appendChild(l)},t.getHtmlTemplate=function(e,i){function n(e){i(e,null)}function o(e){var t=e.currentTarget.responseText
i(null,t)}var r=e.indexOf("://")>0?e:t.getResourceUrl(e),s=new XMLHttpRequest
s.onload=o,s.onerror=n,s.ontimeout=n,s.open("GET",r,!0),s.send()},Autodesk.Viewing.createInitializerOptions=function(){return{env:"AutodeskProduction",api:void 0,getAccessToken:void 0,language:void 0,logLevel:t.LogLevels.ERROR,webGLHelpLink:null}},Autodesk.Viewing.createViewerConfig=function(){var i={extensions:[],sharedPropertyDbPath:void 0,canvasConfig:void 0,startOnInitialize:!0,experimental:[]}
return Autodesk.Viewing.theExtensionManager.popuplateOptions(i),e.Viewer3D&&e.Viewer3D.populateConfigOptions(i),t.GuiViewer3D&&t.GuiViewer3D.populateConfigOptions(i),i},t.isExperimentalFlagEnabled=function(e,t){return!(!t||!Array.isArray(t.experimental))&&-1!==t.experimental.indexOf(e)},Autodesk.Viewing.Initializer=function(i,n){function o(){t.initializeLegacyNamespaces(!1),THREE.warn=t.logger.warn.bind(t.logger),init_three_dds_loader(),init_three_pvr_loader(),t.initializeAuth(n,i),t.initializeLocalization(i),t.initializeUserInfo(i)}e.isNodeJS?(t.initializeEnvironmentVariable(i),t.initializeServiceEndPoints(i),t.initializeLogger(i),t.initializeAuth(n,i)):(t.WEBGL_HELP_LINK=i?i.webGLHelpLink:null,t.initializeEnvironmentVariable(i),t.initializeServiceEndPoints(i),t.initializeLogger(i),t.disableDocumentTouchSafari(),t.initWorkerScript(),t.loadDependency("Promise","es6-promise.min.js",function(){t.loadDependency("THREE","three.min.js",function(){t.loadDependency("WGS","wgs.js",o)})},null,"es6-promise-polyfill"))}}()
